.head 0 +  Application Description: Gupta SQLWindows Standard Application Template
.data CLASSPROPSSIZE
0000: EB00
.enddata
.data CLASSPROPS
0000: 5761746368566172 7300430073457874 456C656300707349 6E73006C73496E73
0020: 417070006C735461 626C65526573756C 744C697374657300 7354797065427572
0040: 0073496E73456E74 6974654170700000 557365476C6F6261 6C50617468000400
0060: 0100000000417070 506174684C656E00 0400240000000041 7070506174680024
0080: 00633A5C705F6C69 6233322E34323B63 3A5C705F6C696233 322E34325C526573
00A0: 6F75726365004442 475F504C41594241 434B5F4755494400 10007945A3EF6B35
00C0: E84897A1CBCC91BC 747F005761746368 566172734C656E00 0400430000000000
00E0: 0000000000000000 000000
.enddata
.head 1 -  Outline Version - 4.0.35
.head 1 +  Design-time Settings
.data VIEWINFO
0000: 6F00000001000000 FFFF01000D004347 5458566965775374 6174650400010000
0020: 0000000000000100 002C000000020000 0003000000FFFFFF FFFFFFFFFFF8FFFF
0040: FFE5FFFFFFFFFFFF FF000000007C0200 004D010000010000 0001000000010000
0060: 000F4170706C6963 6174696F6E497465 6D00000000
.enddata
.data DT_MAKERUNDLG
0000: 0900001000000000 1F433A5C705F6C69 6233322E34325C52 45534F555243455C
0020: 4C6F63322E69636F 1B443A5C4170706C 69635C456C65635F 7265665C4C4F4332
0040: 2E6578651F443A5C 4170706C69635C45 6C65635F7265665C 4C4F43325F303037
0060: 2E646C6C1F443A5C 4170706C69635C45 6C65635F7265665C 4C4F43325F303037
0080: 2E61706300000101 0100640000000000 0001010100000100 0001000C4C4F4332
00A0: 5F3030372E617064 0C4C4F43325F3030 372E646C6C0C4C4F 43325F3030372E61
00C0: 7063000001010100 640000000C4C4F43 325F3030372E6170 6C0C4C4F43325F30
00E0: 30372E646C6C0C4C 4F43325F3030372E 6170630000010101 00640000000C4C4F
0100: 43325F3030372E65 78650C4C4F43325F 3030372E646C6C0C 4C4F43325F303037
0120: 2E61706300000101 0100640000000C4C 4F43325F3030372E 646C6C0C4C4F4332
0140: 5F3030372E646C6C 0C4C4F43325F3030 372E617063000001 010100640000000C
0160: 4C4F43325F303037 2E646C6C0C4C4F43 325F3030372E646C 6C0C4C4F43325F30
0180: 30372E6170630000 0101010064000000 00000000044C4F43 3209535445535544
01A0: 20534108342E322E 302E3030044C4F43 32044C4F43320556 322E393500000000
01C0: 0000000000001443 616C63756C206465 7320E96C65637469 6F6E730000000000
01E0: 0100000001000000 0100010000000000 0000000100001000 0000000000000000
0200: 000000
.enddata
.head 2 -  Outline Window State: Normal
.head 2 +  Outline Window Location and Size
.data VIEWINFO
0000: 6600040003002D00 0000000000000000 0000B71E5D0E0500 1D00FFFF4D61696E
0020: 0000000000000000 0000000000000000 0000003B00010000 00000000000000E9
0040: 1E800A00008600FF FF496E7465726E61 6C2046756E637469 6F6E730000000000
0060: 0000000000000000 0000000000003200 0100000000000000 0000E91E800A0000
0080: DF00FFFF56617269 61626C6573000000 0000000000000000 0000000000000000
00A0: 3000010000000000 00000000F51E100D 0000F400FFFF436C 6173736573000000
00C0: 0000000000000000 0000000000000000
.enddata
.data VIEWSIZE
0000: D000
.enddata
.head 3 -  Left: -0.013"
.head 3 -  Top: 0.0"
.head 3 -  Width:  8.013"
.head 3 -  Height: 4.969"
.head 2 +  Options Box Location
.data VIEWINFO
0000: D4180909B80B1A00
.enddata
.data VIEWSIZE
0000: 0800
.enddata
.head 3 -  Visible? Yes
.head 3 -  Left: 4.15"
.head 3 -  Top: 1.885"
.head 3 -  Width:  3.8"
.head 3 -  Height: 2.073"
.head 2 +  Class Editor Location
.head 3 -  Visible? No
.head 3 -  Left: 0.575"
.head 3 -  Top: 0.094"
.head 3 -  Width:  5.063"
.head 3 -  Height: 2.719"
.head 2 +  Tool Palette Location
.head 3 -  Visible? No
.head 3 -  Left: 6.388"
.head 3 -  Top: 0.729"
.head 2 -  Fully Qualified External References? Yes
.head 2 -  Reject Multiple Window Instances? No
.head 2 -  Enable Runtime Checks Of External References? Yes
.head 2 -  Use Release 4.0 Scope Rules? No
.head 2 -  Edit Fields Read Only On Disable? No
.head 1 +  Libraries
.head 2 -  File Include: BASECLAS.APL
.head 2 -  File Include: HTTP_COCKPIT.apl
.head 2 -  File Include: mtbl.apl
.head 2 -  File Include: mimg.apl
.head 1 +  Global Declarations
.head 2 +  Window Defaults
.head 3 +  Tool Bar
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Form Window
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Dialog Box
.head 4 -  Display Style? Etched
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Top Level Table Window
.head 4 -  Font Name: MS Sans Serif
.head 4 -  Font Size: 8
.head 4 -  Font Enhancement: System Default
.head 4 -  Text Color: System Default
.head 4 -  Background Color: System Default
.head 3 +  Data Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Multiline Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Spin Field
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Background Text
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Pushbutton
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Radio Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Check Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Option Button
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 3 +  Group Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Child Table Window
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  List Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Combo Box
.head 4 -  Font Name: Use Parent
.head 4 -  Font Size: Use Parent
.head 4 -  Font Enhancement: Use Parent
.head 4 -  Text Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 3 +  Line
.head 4 -  Line Color: Use Parent
.head 3 +  Frame
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: 3D Face Color
.head 3 +  Picture
.head 4 -  Border Color: Use Parent
.head 4 -  Background Color: Use Parent
.head 2 +  Formats
.head 3 -  Number: 0'%'
.head 3 -  Number: #0
.head 3 -  Number: ###000
.head 3 -  Number: ###000;'($'###000')'
.head 3 -  Date/Time: hh:mm:ss AMPM
.head 3 -  Date/Time: M/d/yy
.head 3 -  Date/Time: MM-dd-yy
.head 3 -  Date/Time: dd-MMM-yyyy
.head 3 -  Date/Time: MMM d, yyyy
.head 3 -  Date/Time: MMM d, yyyy hh:mm AMPM
.head 3 -  Date/Time: MMMM d, yyyy hh:mm AMPM
.head 3 -  Number: #0
.head 3 -  Input: 99:99
.head 3 -  Input: 88:99
.head 3 -  Number: #0
.head 3 -  Number: #0
.head 3 -  Number: #0
.head 3 -  Number: 0'%'
.head 3 -  Number: #0
.head 3 -  Number: #0
.head 3 -  Input: 999
.head 3 -  Input: 99999
.head 2 +  External Functions
.head 2 +  Constants
.data CCDATA
0000: 3000000000000000 0000000000000000 00000000
.enddata
.data CCSIZE
0000: 1400
.enddata
.head 3 +  System
.head 3 +  User
.head 4 -  String: VERSION = 'V3.17'
.head 4 -  String: DATE_VERSION = '26/05/2010'
.head 4 -  Number: SAM_QuitMulti 			= 6987
.head 3 -  Enumerations
.head 2 +  Resources
.head 3 +  Bitmap: resExitWin
.head 4 -  File Name: Exit_Menu.bmp
.head 3 +  Icon: resAccepter
.head 4 -  File Name: Accepter.ICO
.head 3 +  Bitmap: resPlus
.head 4 -  File Name: ADD16.BMP
.head 3 +  Bitmap: resDelete
.head 4 -  File Name: DELETE16.BMP
.head 3 +  Bitmap: resExcel
.head 4 -  File Name: Excel3.BMP
.head 3 +  ! Icon: resAttention
.head 4 -  File Name: Attention.ICO
.head 3 +  Icon: resAttention
.head 4 -  File Name: Attention.ICO
.head 3 +  Icon: resReport
.head 4 -  File Name: Report.ico
.head 3 +  Icon: resGo
.head 4 -  File Name: Go.ICO
.head 3 +  Icon: resStop
.head 4 -  File Name: Stop.ICO
.head 3 +  Icon: resLogo
.head 4 -  File Name: Logo.ICO
.head 3 +  Icon: resLogoSup
.head 4 -  File Name: LogoSup.ICO
.head 2 +  Variables
.data RESOURCE 0 0 1 1096312207
0000: 8401000001010000 0000000000000000 0200000C000000A2 0600001019000000
0020: 01BC05E0BB0D0000 0000730000000100 0000A3BB06001925 0001BC6F0EB80000
0040: 0073D10001000008 D406000400000081 02BC05700E006E00 7300360100D8065A
0060: 0019000182BC0A0F 0000001B73000100 8D00F10600961900 01BCE0B111000000
0080: 467300010000830A 0700000421000102 BCB211FA00000780 01000000FF680E07
00A0: 0019000901BC8C12 00006E0073003401 000027071A000400 0102A38D1200007F
00C0: 80F20100008F2B07 0096190001BCE064 1300000046730001 0000A34407000431
00E0: 0001026513FA0000 2780010000FF6848 070004008D02AD13 006E007300340100
0100: 004C075A00040002 A3C21300009B7300 010D00
.enddata
.head 3 -  Number: Btmp
.head 3 -  String: gsDateEl
.head 3 -  Window Handle: ghSqlMsg
.head 3 -  Window Handle: ghSqlMaj
.head 3 -  Window Handle: ghSqlErreur
.head 3 -  Window Handle: ghSqlSecondaire
.head 3 -  String: gsMessage[*]
.head 3 -  String: gsPhaseResult
.head 3 -  String: gsPathLoc1Down
.head 3 -  String: gsPathApplic
.head 3 -  String: gsVersionFichierOut
.head 3 -  String: gsGestionElectionType
.head 3 -  String: gsPathLogo
.head 3 -  String: gsPathErreurFF
.head 3 -  String: gsPathExport
.head 3 -  String: gsIN_NivSup
.head 3 -  Boolean: gbGestionElectionType[*]
.head 3 -  Boolean: gbKillTimer
.head 3 -  Date/Time: gdDateDernierFileElection[*]
.head 3 -  Number: gbTrue
.head 3 -  Boolean: gbSauveEluHisto
.head 2 +  Internal Functions
.head 3 +  Function: PalMakeAllDir
.head 4 -  Description: Création de répertoire non existant
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sPath
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If SalStrRightX( sPath, 1 ) = '\\'
.head 6 -  Set sPath= SalStrLeftX(sPath, SalStrLength( sPath)-1)
.head 5 -  Call VisDosMakeAllDir( sPath )
.head 3 +  Function: PalChargeMessage
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 5 -  Long String: sBuffer
.head 5 -  Long String: lsArray[*]
.head 5 -  Number: nNo
.head 5 -  String: sMsg
.head 4 +  Actions
.head 5 -  Call SqlPrepareAndExecute( ghSqlMsg , "Select Msg_No, msg_FF from MSgErr into :nNo , :sMsg ")
.head 5 +  While SqlFetchNext( ghSqlMsg, Btmp )
.head 6 -  Set gsMessage[ nNo ] = sMsg
.head 5 -  !
.head 3 +  Function: PalDtmNoListeProvisoire
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: sGroupe
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nNoListeProv
.head 5 -  Number: lnChar
.head 5 -  Number: lnCharA
.head 5 -  Number: lnMod
.head 5 -  String: lsTmp
.head 5 -  String: sListeNo
.head 4 +  Actions
.head 5 -  Set lsTmp = 'A'
.head 5 -  Set lnCharA = SalStrLop( lsTmp )
.head 5 -  Set lsTmp = sGroupe
.head 5 +  If SalStrLength( lsTmp ) = 1
.head 6 -  Set nNoListeProv =  SalStrLop( lsTmp)-lnCharA + 1
.head 5 +  Else If SalStrLength( lsTmp ) = 2
.head 6 -  Set lnChar = SalStrLop( lsTmp)
.head 6 -  Set lnMod = SalNumberMod( lnChar, lnCharA )+1
.head 6 -  Set nNoListeProv = lnMod*26 + (SalStrLop( lsTmp) - lnCharA + 1)
.head 5 -  Set sListeNo = SalNumberToStrX( nNoListeProv + 100, 0)
.head 5 -  Return (sListeNo)
.head 3 +  Function: PalTransPhonetique
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: psStr
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Set psStr = VisStrSubstitute( psStr, ' ', '' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, '\'', '' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, '.', '' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, ',', '' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, "'", '' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, '"', '' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, '-', '' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'à', 'A' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'â', 'A' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ä', 'A' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'á', 'A' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'À', 'A' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Â', 'A' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ä', 'A' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Á', 'A' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Å', 'A' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ç', 'C' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ç', 'C' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'é', 'E' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'è', 'E' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ê', 'E' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ë', 'E' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'É', 'E' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'È', 'E' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ê', 'E' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ë', 'E' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'î', 'I' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ï', 'I' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ï', 'I' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'í', 'I' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ì', 'I' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Î', 'I' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ï', 'I' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ì', 'I' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ì', 'I' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ñ', 'N' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ñ', 'N' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ô', 'O' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ö', 'O' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ò', 'O' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ó', 'O' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'õ', 'O' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ö', 'O' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ô', 'O' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ò', 'O' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ó', 'O' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Õ', 'O' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ù', 'U' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'û', 'U' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ü', 'U' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ú', 'U' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ü', 'U' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Û', 'U' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ú', 'U' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ù', 'U' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ý', 'Y' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'ÿ', 'Y' )
.head 5 -  Set psStr = VisStrSubstitute( psStr, 'Ý', 'Y' )
.head 5 -  Set psStr = SalStrUpperX(psStr)
.head 5 -  Return psStr
.head 3 +  Function: date_SepaToD
.head 4 -  Description: Formatte la date jj/mm/ssyy -- > ssyymmjj
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: date_in
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: date_tmp
.head 4 +  Actions
.head 5 -  Set date_tmp=SalStrRightX(date_in,4) || SalStrMidX(date_in,3,2) || SalStrLeftX(date_in,2)
.head 5 -  Return date_tmp
.head 3 +  Function: PalEditFile
.head 4 -  Description: Edition d'un fichier donné avec Notepad
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sPathFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nRet
.head 4 +  Actions
.head 5 -  Call SalLoadAppAndWait( "NOTEPAD " || sPathFile , Window_Maximized , nRet)
.head 3 +  Function: PalHttpCockpitWeb5
.head 4 -  Description: Communication avec cockpit ...

pnTypeCom
psWarning
psErreur
psInfo
psElec (Election)
psModule (Logiciel)
psLieu (Ligne, INS, ...)
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: pnTypeCom
.head 5 -  String: psErreur
.head 5 -  String: psWarning
.head 5 -  String: psInfo
.head 5 -  !
.head 5 -  String: psElec
.head 5 -  String: psModule
.head 5 -  String: psLieu
.head 5 -  String: psFichier
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  !
.head 5 -  Boolean: lbMessageBox
.head 5 -  String: lsMessageBox
.head 5 -  Date/Time: ldtDateTime
.head 5 -  String: lsDateTime
.head 5 -  !
.head 5 -  String: lsReponse
.head 5 -  Number: lnReturn
.head 5 -  !
.head 5 -  String: lsUrl
.head 5 -  Boolean: lbAuto
.head 5 -  String: lsQui
.head 5 -  String: lsElec
.head 5 -  String: lsLieu
.head 5 -  String: lsQuand
.head 5 -  String: lsFichier
.head 5 -  String: lsTraitement
.head 5 -  String: lsErreur
.head 5 -  String: lsWarning
.head 5 -  String: lsInfo
.head 5 -  String: lsUser
.head 5 -  String: lsPassword
.head 5 -  String: lsMsgErreur
.head 5 -  !
.head 5 -  String: lsPathname
.head 5 -  !
.head 5 -  String: lsProxyServeur
.head 5 -  Number: lnProxyPort
.head 5 -  String: lsProxyUser
.head 5 -  String: lsProxyPass
.head 5 -  !
.head 5 -  Number: lnEssai
.head 4 +  Actions
.head 5 +  If gsHttpType != '-1'
.head 6 -  Set lnEssai = 1
.head 6 -  Call VisWaitCursor(TRUE)
.head 6 -  ! Initialisation des variables
.head 6 +  If 1
.head 7 -  ! Automatique ?
.head 7 -  Set lbAuto = TRUE
.head 7 -  ! Quelque soit le pnTypeCom
.head 7 +  If 1
.head 8 +  If gsHttpType = '0'
.head 9 -  Set lsUrl = gsHttpCockpit
.head 8 +  Else If gsHttpType = '1'
.head 9 -  Set lsUrl = gsHttpsCockpit
.head 8 -  Set lsQui = psModule
.head 8 -  Set lsElec = psElec
.head 8 -  Set lsLieu = psLieu
.head 8 -  ! date aaaammddhhmmsscc
.head 8 -  Set ldtDateTime = SalDateCurrent(  )
.head 8 -  Call SalDateToStr( ldtDateTime, lsQuand )
.head 8 -  Set lsQuand = SalStrLeftX( lsQuand, 22 )
.head 8 -  Set lsQuand = VisStrSubstitute( lsQuand, '-', '')
.head 8 -  Set lsQuand = VisStrSubstitute( lsQuand, '.', '')
.head 8 -  Set lsQuand = VisStrSubstitute( lsQuand, ':', '')
.head 8 -  Set lsTraitement = SalNumberToStrX( pnTypeCom, 0 )
.head 8 -  Set lsFichier = psFichier
.head 8 -  Set lsWarning = psWarning
.head 8 -  Set lsErreur = psErreur
.head 8 -  ! Proxy
.head 8 -  Set lsProxyServeur = gsProxyServeur
.head 8 -  Set lnProxyPort = gnProxyPort
.head 8 -  Set lsProxyUser = gsProxyUser
.head 8 -  Set lsProxyPass = gsProxyPass
.head 8 -  !
.head 8 -  Set lsUser = gsHttpsLogin
.head 8 -  Set lsPassword = gsHttpsPwd
.head 7 -  ! Spécifique au pnTypeCom
.head 7 +  If gsHTTPMessage[pnTypeCom] != ''
.head 8 -  Set lsInfo =  psModule || ' - '|| gsHTTPMessage[pnTypeCom]
.head 7 +  Else
.head 8 -  Set lsInfo = psModule || ' - '|| 'Msg Inconnu : '|| SalNumberToStrX( pnTypeCom, 0)
.head 7 +  If psInfo != ''
.head 8 -  Set lsInfo = lsInfo || ' - '|| psInfo
.head 7 -  Set lsInfo = VisStrSubstitute( lsInfo, "'","\\'" )
.head 6 -  ! Com
.head 6 +  If 1
.head 7 -  Set lsReponse =''
.head 7 -  Set lnReturn =  SalModalDialog( dlgSendCockpit, hWndForm,
lsUrl,
lbAuto,
lsQui,
lsElec,
lsLieu,
lsQuand,
lsFichier,
lsTraitement,
lsWarning,
lsErreur,
lsInfo,
lsUser,
lsPassword,
lsProxyServeur,
lnProxyPort,
lsProxyUser,
lsProxyPass,
lsMsgErreur )
.head 7 +  If lnReturn = 0
.head 8 -  Set lsReponse = ' Communication avec le serveur cockpit ok ! '
.head 7 +  Else
.head 8 -  ! Erreurs
.head 8 -  ! wnErreur = -1 : Mauvaise réponse du serveur : wsReponse  (Réponse != INSERT INTO ActivityLog)
.head 8 -  ! wnErreur =  1 : erreur 404 page inconnue   ('404' in Réponse)
.head 8 -  ! wnErreur =  2 : Hôte inconnu  ( 'Hôte' in Réponse)
.head 8 -  ! wnErreur =  3 : Connection refusée par le seveur ( 'accès' in Réponse)
.head 8 -  ! wnErreur =  9 : autres erreurs
.head 8 -  Set lsReponse =  SalNumberToStrX( lnReturn, 0 ) || ' : ' || lsMsgErreur
.head 8 -  Call SalMessageBox( lsReponse, 'Information', MB_Ok )
.head 6 -  Call VisWaitCursor(FALSE)
.head 5 -  !
.head 5 -  Call VisWaitCursor(FALSE)
.head 5 -  Return TRUE
.head 3 +  Function: PalGenereCoord
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psPathLoc3
.head 5 -  String: psPathTmp
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Long String: sBuffer[*]
.head 5 -  String: sBuffer1[*]
.head 5 -  String: sBuffer2[*]
.head 5 -  String: sBuffer3[*]
.head 5 -  String: sBuffer4[*]
.head 5 -  String: sBuffer5[*]
.head 5 -  String: sBuffer6[*]
.head 5 -  Long String: sSelect
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsIns
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnNoCdt
.head 5 -  Number: lnNoListe
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  File Handle: lhFile
.head 5 -  Number: lnNbEntite
.head 5 -  String: sFileZIP
.head 5 -  Number: nRet
.head 5 -  String: lsPkZip
.head 5 -  String: lsTypeVote
.head 5 -  String: lsInscrits[10]
.head 5 -  String: lsEntLettre
.head 5 -  String: sTypeEl
.head 5 -  String: lsEntIns
.head 5 -  String: lsEntInsSup
.head 4 +  Actions
.head 5 -  ! Coord Bureaux
.head 5 -  Set sBuffer[0] = "CB_TYPEBUR#CB_INS#CB_ELECT#CB_NBBV#CB_NBBURDEP#CB_NBELECT"
.head 5 -  Set sBuffer[0] =  VisStrSubstitute( sBuffer[lnI], '#', '|' )
.head 5 -  Set lnI = 1
.head 5 -  Set lnNbEntite = 0
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select CB_TYPEBUR||'#'||CB_INS||'#'||CB_ELECT||'#'|| CB_NBBV||'#'|| CB_NBBURDEP||'#'|| CB_NBELECT
	from Coord_Bureau
	Order by CB_TYPEBUR,CB_INS,CB_ELECT
	Into :sBuffer1[lnI] ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer1[lnI], '#', '|' )
.head 6 -  Set lnI = lnI +1
.head 5 +  If SalFileOpen( lhFile, psPathTmp ||'\\CoBur.TXT' , OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set lnJ = 0
.head 6 +  While lnJ < lnI
.head 7 -  Call SalFilePutStr( lhFile, sBuffer[lnJ] )
.head 7 -  Set lnJ = lnJ + 1
.head 6 -  Call SalFileClose( lhFile )
.head 5 -  ! Coord Adresses
.head 5 -  Set sBuffer[0] = "CA_TYPEBUR#CA_INS#CA_ELECT#CA_TYPEADR#CA_LIEU#CA_ADRESSE#CA_CP#CA_COMMUNE#CA_TEL1#CA_TEL2#CA_FAX1#CA_FAX2#CA_MAIL1#CA_MAIL2#CA_INFO"
.head 5 -  Set sBuffer[0] =  VisStrSubstitute( sBuffer[0], '#', '|' )
.head 5 -  Set lnI = 1
.head 5 -  Set lnNbEntite = 0
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select CA_TYPEBUR||'#'||CA_INS||'#'||CA_ELECT||'#'||CA_TYPEADR||'#'||CA_LIEU||'#'||CA_ADRESSE||'#',
	CA_CP||'#'||CA_COMMUNE||'#'||CA_TEL1||'#'||CA_TEL2||'#',
	CA_FAX1||'#'||CA_FAX2||'#'||CA_MAIL1||'#'||CA_MAIL2||'#'||CA_INFO
	from Coord_Adresse
	Order by CA_TYPEBUR,CA_INS,CA_ELECT,CA_TYPEADR
	Into :sBuffer1[lnI], :sBuffer2[lnI], :sBuffer3[lnI] ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer1[lnI]|| sBuffer2[lnI] ||sBuffer3[lnI], '#', '|' )
.head 6 -  Set lnI = lnI +1
.head 5 +  If SalFileOpen( lhFile, psPathTmp ||'\\CoAdr.TXT' , OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set lnJ = 0
.head 6 +  While lnJ < lnI
.head 7 -  Call SalFilePutStr( lhFile, sBuffer[lnJ] )
.head 7 -  Set lnJ = lnJ + 1
.head 6 -  Call SalFileClose( lhFile )
.head 5 -  ! Coord Contacts
.head 5 -  Set sBuffer[0] = "CC_TYPEBUR#CC_INS#CC_ELECT#CC_TYPECO#CC_NOM#CC_PRENOM#CC_SEXE#CC_FCT#CC_TEL1#CC_TEL2#CC_FAX1#CC_FAX2#CC_MAIL1#CC_MAIL2#CC_ADR#"
.head 5 -  Set sBuffer[0] = sBuffer[0] || "CC_CP#CC_COMMUNE#CC_TELPRIVE#CC_FAXPRIVE#CC_GSMPRIVE#CC_NN#CC_INFO"
.head 5 -  Set sBuffer[0] =  VisStrSubstitute( sBuffer[0], '#', '|' )
.head 5 -  Set lnI = 1
.head 5 -  Set lnNbEntite = 0
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select 
CC_TYPEBUR||'#'||CC_INS||'#'||CC_ELECT||'#'||CC_TYPECO||'#'||CC_NOM||'#'||CC_PRENOM||'#'||CC_SEXE||'#',
CC_FCT||'#'||CC_TEL1||'#'||CC_TEL2||'#'||CC_FAX1||'#'||CC_FAX2||'#',
CC_MAIL1||'#'||CC_MAIL2||'#'||CC_ADR||'#'||CC_CP||'#'||CC_COMMUNE||'#'||CC_TELPRIVE||'#',
CC_FAXPRIVE||'#'||CC_GSMPRIVE||'#'||CC_NN||'#'||CC_INFO
	from Coord_Contact
	Order by CC_TYPEBUR,CC_INS,CC_ELECT,CC_TYPECO
	Into :sBuffer1[lnI], :sBuffer2[lnI] :sBuffer3[lnI], :sBuffer4[lnI] ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer1[lnI] ||sBuffer2[lnI] || sBuffer3[lnI] ||sBuffer4[lnI], '#', '|' )
.head 6 -  Set lnI = lnI +1
.head 5 +  If SalFileOpen( lhFile, psPathTmp ||'\\CoCont.TXT' , OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set lnJ = 0
.head 6 +  While lnJ < lnI
.head 7 -  Call SalFilePutStr( lhFile, sBuffer[lnJ] )
.head 7 -  Set lnJ = lnJ + 1
.head 6 -  Call SalFileClose( lhFile )
.head 5 -  !
.head 5 -  ! Entités
.head 5 -  Set sBuffer[0] = "ENT_ID#ENT_NIV_LETTRE#ENT_ELE_EXT#ENT_INS#ENT_INS_NIVSUP#ENT_NB_CDT_MAX#ENT_NB_SUPP_MAX#ENT_INSCRITS_BB#ENT_INSCRITS_E1_E2#ENT_INSCRITS_E3_E4#ENT_INSCRITS_E5#"
.head 5 -  Set sBuffer[0] = sBuffer[0] || "ENT_BURDEP_TOT#ENT_DEP_LISTE#ENT_NOM_FF#ENT_NOM_NN#ENT_NOM_DD#ENT_NOM_EN#ENT_VE"
.head 5 -  Set sBuffer[0] =  VisStrSubstitute( sBuffer[0], '#', '|' )
.head 5 -  Set lnI = 1
.head 5 -  Set lnNbEntite = 0
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select 
	ENT_ID ||'#'|| ENT_NIV_LETTRE ||'#'|| ENT_ELE_EXT ||'#'|| ENT_INS ||'#'|| ENT_INS_NIVSUP||'#'|| @nullvalue(ENT_NB_CDT_MAX,-999) ||'#'|| @nullvalue(ENT_NB_SUPP_MAX,-999),
	'#'|| 'INSCRITS_BB' ||'#'|| 'INSCRITS_E1_E2' ||'#'|| 'INSCRITS_E3_E4' ||'#'|| 'INSCRITS_E5'||'#'|| @nullvalue(ent_BurDep_Tot,-999)|| '#' || ENT_DEP_LISTE ,
	ENT_NOM_FF,ENT_NOM_NN ,ENT_NOM_DD ,ENT_NOM_EN ,
	ENT_NIV_LETTRE, ENT_INS ,ENT_INS_NIVSUP, ent_TypeVote, ENT_ELE_EXT,
	@nullvalue(ENT_INSCRITS_BB,-999) , @nullvalue(ENT_INSCRITS_E1_E2,-999), @nullvalue(ENT_INSCRITS_E3_E4,-999) ,@nullvalue(ENT_INSCRITS_E5,-999)
      from Entite
	Order by ENT_ELE_EXT, ENT_NIV_LETTRE, ENT_INS 
	Into :sBuffer5[lnI],:sBuffer6[lnI],:sBuffer1[lnI],:sBuffer2[lnI],:sBuffer3[lnI],:sBuffer4[lnI],:lsEntLettre,:lsEntIns,:lsEntInsSup,:lsTypeVote,:sTypeEl,
		:lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If lsEntLettre != 'K'
.head 7 +  If sTypeEl = 'CK' or sTypeEl = 'WL' or sTypeEl = 'VL'
.head 8 +  If lsEntLettre = 'C'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ins_nivsup = :lsEntIns and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  Else If (lsEntLettre = 'P' or lsEntLettre = 'O') and sTypeEl = 'WL'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and @left(ent_ins,1) like '"|| SalStrLeftX( lsEntIns, 1 ) ||"' and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  Else If lsEntLettre = 'O'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and @left(ent_ins,2) in ( '21', '23' , '24' , '25') and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  Else If lsEntLettre = 'R'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  Else If sTypeEl = 'SE' or sTypeEl = 'EU' 
.head 8 +  If lsEntLettre = 'C' and lsEntIns = '21004'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ins_nivsup = :lsEntIns and ent_ele_ext = :sTypeEl 
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  Else If lsEntLettre = 'C' and lsEntIns != '21004'
.head 9 +  If sTypeEl = 'SE'
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_dep_liste = :lsEntIns and ent_ele_ext = :sTypeEl 
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 +  Else If sTypeEl = 'EU'
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_dep_liste = :lsEntIns and ent_ele_ext = :sTypeEl and  @left( ent_ins ,2) not in ('21','23')
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  If lsEntLettre = 'P'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ins_nivsup = :lsEntIns and ent_ele_ext = :sTypeEl and Ent_Ins not like '%999'
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  If lsEntLettre = 'L'
.head 9 +  If lsEntIns = '63023'
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ins_nivsup = :lsEntIns and ent_ele_ext = :sTypeEl and Ent_Ins not like '%999'
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 10 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 9 +  Else
.head 10 -  Set lsInscrits[0] = '-999' 
.head 10 -  Set lsInscrits[1] = '-999' 
.head 10 -  Set lsInscrits[2] = '-999' 
.head 10 -  Set lsInscrits[3] = '-999' 
.head 8 +  If lsEntLettre = 'R'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  Else If sTypeEl = 'BR'  
.head 8 +  If lsEntLettre = 'R'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  Else If sTypeEl = 'DE'  
.head 8 +  If lsEntLettre = 'G'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 6 +  Else If lsEntLettre = 'K' and SalStrLeftX(lsEntIns,2) = '23' and sTypeEl = 'EU'
.head 7 -  Set lsEntInsSup = lsEntInsSup || ',92094'
.head 7 -  Set sBuffer[lnI] = VisStrSubstitute( sBuffer[lnI], '#12025#',  '#12025,92094#')
.head 6 -  !
.head 6 -  Set sBuffer[lnI] =  sBuffer5[lnI] || sBuffer6[lnI]
.head 6 +  If TRUE
.head 7 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], 'INSCRITS_BB', lsInscrits[0] ) 
.head 7 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], 'INSCRITS_E1_E2', lsInscrits[1] ) 
.head 7 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], 'INSCRITS_E3_E4', lsInscrits[2] ) 
.head 7 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], 'INSCRITS_E5', lsInscrits[3] ) 
.head 6 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], '-999', 'null' ) 
.head 6 -  ! Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], '#', '"' ) ||',"'|| lsTypeVote ||'"'
.head 6 -  !
.head 6 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI] || '#' ||sBuffer1[lnI] || '#' ||sBuffer2[lnI] || '#' || sBuffer3[lnI] || '#' || sBuffer4[lnI] ||"#"|| lsTypeVote , '#', '|' )
.head 6 -  Set lnNbEntite = lnNbEntite +1
.head 6 -  Set lnI = lnI +1
.head 5 +  If SalFileOpen( lhFile, psPathTmp ||'\\CoEntite.TXT' , OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set lnJ = 0
.head 6 +  While lnJ < lnI
.head 7 -  Call SalFilePutStr( lhFile, sBuffer[lnJ] )
.head 7 -  Set lnJ = lnJ + 1
.head 6 -  Call SalFileClose( lhFile )
.head 5 -  !
.head 5 -  ! Zip des coordonnées
.head 5 -  Call SalGetProfileString( 'PATH', 'PKZIP',  '', lsPkZip, frmLOC2.wsPathINI )
.head 5 +  If lsPkZip = ''
.head 6 -  Call SalMessageBox( "PkZip non trouvé !!", "ERREUR", MB_Ok )
.head 6 -  Return (FALSE)
.head 5 +  If SalStrScan( SalStrUpperX(lsPkZip), "ZIP.EXE" ) != -1
.head 6 -  Set sFileZIP = psPathLoc3 ||"\\COORD.ZIP"
.head 6 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| psPathTmp ||"\\Co*.TXT" ,  Window_NotVisible, nRet )
.head 5 +  Else
.head 6 -  Set sFileZIP = psPathLoc3 ||"\\COORD.7ZA"
.head 6 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| psPathTmp ||"\\Co*.TXT" ,  Window_NotVisible, nRet )
.head 5 -  !
.head 5 -  Return TRUE
.head 3 +  Function: PalDecToHexa
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  Number: nIn
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sOut
.head 5 -  String: sCar[20]
.head 5 -  Number: X1
.head 5 -  Number: X2
.head 4 +  Actions
.head 5 -  !
.head 5 -  Set sCar[0] = '0'
.head 5 -  Set sCar[1] = '1'
.head 5 -  Set sCar[2] = '2'
.head 5 -  Set sCar[3] = '3'
.head 5 -  Set sCar[4] = '4'
.head 5 -  Set sCar[5] = '5'
.head 5 -  Set sCar[6] = '6'
.head 5 -  Set sCar[7] = '7'
.head 5 -  Set sCar[8] = '8'
.head 5 -  Set sCar[9] = '9'
.head 5 -  Set sCar[10] = 'A'
.head 5 -  Set sCar[11] = 'B'
.head 5 -  Set sCar[12] = 'C'
.head 5 -  Set sCar[13] = 'D'
.head 5 -  Set sCar[14] = 'E'
.head 5 -  Set sCar[15] = 'F'
.head 5 -  !
.head 5 +  If nIn < 16
.head 6 -  Set X2 =  nIn
.head 6 -  Set X1 = 0
.head 5 +  Else
.head 6 -  Set X2 = SalNumberMod(  nIn , 16)
.head 6 -  Set X1 = (nIn - X2)/16
.head 5 -  !
.head 5 -  Set sOut = sCar[X1] || sCar[X2]
.head 5 -  Return sOut
.head 2 +  Named Menus
.head 2 +  Class Definitions
.data RESOURCE 0 0 1 2828826433
0000: C40B000035070000 0000000000000000 0200001A00FFFF01 00160000436C6173
0020: 73566172004F7574 6C696E6552006567 496E666F3E003C00 000A63006C734261
0040: 7365436F006C9A00 00000500001E0004 0000020002BC0509 00000600BE047300
0060: 0060000100000004 B300040086020A00 00003DBE00011B00 080000AC00040002
0080: 610B000000BECF00 0106000C00000019 0800000001BC050C DA0000BEA3000100
00A0: 00C1250000001912 0001BC0D0000F600 BE68000100000180 803A0000000100F0
00C0: 000D636C01446644 61746584B0000000 0400B719008004BC 0507000000211E05
00E0: 73000001DB0019A8 0004000002690800 001ECF000106001D 0000000443000102
0100: BC09FB00C9010000 01DE0001C0002100 000019D20001BC0A F6001E6800010000
0120: 0108802100000200 00F00011636C7F54 00696D6566000000 0378000000194B00
0140: 04BC071B00300573 A3000100008D1900 0400D20002BC08F6 00306C0001001D33
0160: 00040001B6020900 9F0100EC0001000D 0100018021330003 000C04636C436163
0180: 686540506F6F6C66 0000F60300048400 000107BC05800500 01000209001E0080
01A0: 0100FC00009B0400 04850003BC05070D 000E097300D90001 0066080019006901
01C0: BC08007B0E003401 0000018064040000 04001812636C624D 75006C74694C616E
01E0: 6775006167652200 0000017A0000044B 0002BC0618000000 5C0973B300010031
0200: 0180040005C10000 18636C0068696C64 54626C4DFE757F00 F4010000D6040002
0220: 3609006E09667300 0100630180040084 06000013636CF56F 4DFF47000100006F
0240: 04006D0207006380 0973003201000001 804604000700001E 136D624DFF7F00F4
0260: 010000D604000237 0092096673000100 6301800400E60800 12F044664D75FFA3
0280: 00010000B70400BE 020031A409730001 1B00018004230009 0000130F6C674D75
02A0: FF3F00017A000004 6B0002091B00B609 73B3000100310180 04000A7200001346
02C0: F0726D4D75FFA300 010000B70400B602 0A0031CE09730001 1B0001800423000B
02E0: 000012C74C624DFF 1F000100BD0004B5 0002078D00EC0973 D900010018018004
0300: 000C003900134D64 F8694D75FFD10001 00005B040002DB09 0098FE097300018D
0320: 0001800491000D00 0012E76C4DFF8F00 0100DE0004DA0002 0786001C0A73006C
0340: 000100010C800400 0E00001C00124F62 4DFF7F00F4010000 D60400023608002E
0360: 0A66730001006301 800400E00F000000 12F850624DFFA300 010000B70400B602
0380: 070031400A730001 1B00018004030010 0000001D04636C51 756573741C436857
03A0: 6E64FC4D75FFE800 010000AD0400026D 080052CC0A730001 C600018004C00011
03C0: 0000001D3F5461E0 626C65576EFF3F00 017A0000046B0002 091B00640A73B300
03E0: 0100310180040012 60000000126352FC 624DFFD100010000 5B040002DB070098
0400: 820A7300018D0001 8004010013000000 1363D354624DFF1F 000100BD0004B500
0420: 020A8D00940A73D9 0001002001801301 0014000000000F63 4465736B00746F70
0440: 4C69737442A06F78 4E01000BBD0019A5 0001BC070D004A1B 7300D10001000066
0460: 190019006901BC08 007B4A0034010000 3200580000190001 DABC09001E4A0001
0480: 000D004B00000096 190001BCB60A004A 4700010000836400 000019A50001BC0B
04A0: ED004AD100010000 607D000000190069 01BC0C007B4A0034 0100009600580000
04C0: 190001DABC0D001E 4A0001000D00AF00 000096190001BCB4 0E00004A47000100
04E0: 0083C80000001925 0001BC0F00ED004A D10001000060E100 000019004901BC10
0500: 00007B4A00340100 00FA005800001900 01D2BC1100001E4A 0001000D00018064
0520: 000100150000000B 63E04469724C6983 7C00000004BD0019 A50001BC078D005C
0540: 1B73D10001000066 190019006901BC08 007B5C00B4010000 325900190001DABC
0560: 09001E5C0001006D 004B0096190001BC B60A005C47000100 004301804B0000E2
0580: 1600000F81547265 654C690F5E000000 F403000096190001 BC3607006E1B4673
05A0: 000100009B190019 A50001BC08ED006E D100010000663200 19006901BC09007B
05C0: 6E00340100000180 04AF000017000000 800C6346696C654C 1FD60000EC000700
05E0: 2D190001BC6D0600 928C1B7300010036 001900194B0001BC 07DB0092A3000100
0600: 00CD320019D20001 BC08F60092680001 00004BB3001900B4 01BC09003D920001
0620: DA0000642C001900 01BC6D0A00928F00 010036007D00194B 0001BC0BDB0092A3
0640: 00010000CD960019 D20001BC0CF60092 6800010000010880 7D00001800000000
0660: 0D63526164696F7C 4C699AB200000500 B71900B401BC0600 215E1C73000001DA
0680: 0000192C00190001 BC6D07005E8F0001 0036003200194B00 01BC08DB005EA300
06A0: 010000CD4B0019D2 0001BC09F6005E68 0001000064B30019 00B401BC0A003D5E
06C0: 00011A0000018081 3000000019000800 63514F456D61696C 60C000000006006F
06E0: 19006901BC050043 7E1D730000B40100 00195900190001DA BC08001E7E000100
0700: 6D00320096190001 BCB60B007E470001 00009B4B0019A500 01BC0EED007ED100
0720: 0100006664001900 6901BC11007B7E00 B40100007D190004 000102D2BC140000
0740: 7F80F20100000F
.enddata
.head 3 +  General Window Class: CValueList
.head 4 -  Description:
.head 4 -  Derived From
.head 4 -  Class Variables
.head 4 -  Instance Variables
.head 4 +  Functions
.head 5 +  Function: AddValue
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Number:
.head 6 +  Parameters
.head 7 -  String: spText
.head 7 -  Number: npValue
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Return VisListAddValue( hWndItem, spText, npValue )
.head 5 +  Function: FindValue
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Number:
.head 6 +  Parameters
.head 7 -  Number: npValue
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Return VisListFindValue( hWndItem, 0, npValue )
.head 5 +  Function: GetSelectedValue
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Number:
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nIdx
.head 7 -  Number: nValue
.head 6 +  Actions
.head 7 -  Set nIdx = SalListQuerySelection( hWndItem )
.head 7 +  If nIdx >= 0
.head 8 -  Set nValue = GetValue( nIdx )
.head 7 -  Return nValue
.head 5 +  Function: GetValue
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Number:
.head 6 +  Parameters
.head 7 -  Number: npIdx
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Return VisListGetValue( hWndItem, npIdx )
.head 5 +  Function: SelectValue
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Number:
.head 6 +  Parameters
.head 7 -  Number: npValue
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nIdx
.head 6 +  Actions
.head 7 -  Set nIdx = FindValue( npValue )
.head 7 +  If nIdx >= 0
.head 8 -  Call SalListSetSelect( hWndItem, nIdx )
.head 7 -  Return nIdx
.head 4 -  Message Actions
.head 3 +  General Window Class: CHandleList
.head 4 -  Description:
.head 4 +  Derived From
.head 5 -  Class: CValueList
.head 4 -  Class Variables
.head 4 -  Instance Variables
.head 4 +  Functions
.head 5 +  Function: AddHandle
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Number:
.head 6 +  Parameters
.head 7 -  String: spText
.head 7 -  Window Handle: hWndp
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Return AddValue( spText, SalWindowHandleToNumber( hWndp ) )
.head 5 +  Function: FindHandle
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Number:
.head 6 +  Parameters
.head 7 -  Window Handle: hWndp
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Return FindValue( SalWindowHandleToNumber( hWndp ) )
.head 5 +  Function: GetHandle
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Window Handle:
.head 6 +  Parameters
.head 7 -  Number: npIdx
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Return SalNumberToWindowHandle( GetValue( npIdx ) )
.head 5 +  Function: GetSelectedHandle
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Window Handle:
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Return SalNumberToWindowHandle( GetSelectedValue( ) )
.head 5 +  Function: SelectHandle
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Number:
.head 6 +  Parameters
.head 7 -  Window Handle: hWndp
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Return SelectValue( SalWindowHandleToNumber( hWndp ) )
.head 4 -  Message Actions
.head 3 +  General Window Class: CWindow
.head 4 -  Description:
.head 4 -  Derived From
.head 4 -  Class Variables
.head 4 -  Instance Variables
.head 4 +  Functions
.head 5 +  Function: AddMsgToLog
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  String: spMsg
.head 7 -  Number: npwParam
.head 7 -  Number: nplParam
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: sItemName
.head 6 +  Actions
.head 7 +  If TRUE
.head 8 -  Call SalGetItemName( hWndItem, sItemName )
.head 8 -  Return FALSE
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call AddMsgToLog( "SAM_Click", wParam, lParam )
.head 5 +  On SAM_ContextMenu
.head 6 -  Call AddMsgToLog( "SAM_ContextMenu", wParam, lParam )
.head 5 +  On SAM_DoubleClick
.head 6 -  Call AddMsgToLog( "SAM_DoubleClick", wParam, lParam )
.head 5 +  On SAM_DropDown
.head 6 -  Call AddMsgToLog( "SAM_DropDown", wParam, lParam )
.head 5 +  On SAM_KillFocus
.head 6 -  Call AddMsgToLog( "SAM_KillFocus", wParam, lParam )
.head 5 +  On SAM_SetFocus
.head 6 -  Call AddMsgToLog( "SAM_SetFocus", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_KeyDown
.head 6 -  Call AddMsgToLog( "MTM_KeyDown", wParam, lParam )
.head 3 +  General Window Class: CEditWindow
.head 4 -  Description:
.head 4 +  Derived From
.head 5 -  Class: CWindow
.head 4 -  Class Variables
.head 4 -  Instance Variables
.head 4 -  Functions
.head 4 +  Message Actions
.head 5 +  ! On SAM_AnyEdit
.head 6 -  Call AddMsgToLog( "SAM_AnyEdit", wParam, lParam )
.head 5 +  On SAM_Validate
.head 6 -  Call AddMsgToLog( "SAM_Validate", wParam, lParam )
.head 3 +  Column Class: CColumn
.head 4 -  Title:
.head 4 -  Visible? Class Default
.head 4 -  Editable? Class Default
.head 4 -  Maximum Data Length: Class Default
.head 4 -  Data Type: Class Default
.head 4 -  Justify: Class Default
.head 4 -  Width:  Class Default
.head 4 -  Width Editable? Class Default
.head 4 -  Format: Class Default
.head 4 -  Country: Class Default
.head 4 -  Input Mask: Class Default
.head 4 -  List in Tool Palette? Yes
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Cell Options
.head 5 -  Cell Type? Class Default
.head 5 -  Multiline Cell? Class Default
.head 5 -  Cell DropDownList
.head 6 -  Sorted? Class Default
.head 6 -  Vertical Scroll? Class Default
.head 6 -  Auto Drop Down? Class Default
.head 6 -  Allow Text Editing? Class Default
.head 5 -  Cell CheckBox
.head 6 -  Check Value:
.head 6 -  Uncheck Value:
.head 6 -  Ignore Case? Class Default
.head 4 -  Description:
.head 4 +  Derived From
.head 5 -  Class: CEditWindow
.head 4 -  Class Variables
.head 4 -  Instance Variables
.head 4 +  Functions
.head 5 +  Function: OnQuerySortString
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  Number: p_nRow
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: sText
.head 6 +  Actions
.head 7 -  Call SalTblGetColumnText( hWndForm, SalTblQueryColumnID( hWndItem ), sText )
.head 7 -  Return SalHStringToNumber( sText )
.head 5 +  Function: OnQuerySortValue
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  Number: p_nRow
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Date/Time: dt
.head 7 -  Number: nColType
.head 7 -  Number: nDataType
.head 7 -  String: sText
.head 6 +  Actions
.head 7 +  If SalTblQueryColumnCellType( hWndItem, nColType )
.head 8 +  If nColType = COL_CellType_DropDownList
.head 9 -  Return SalListQuerySelection( hWndItem )
.head 7 -  !
.head 7 -  Set nDataType = SalGetDataType( hWndItem )
.head 7 -  Call SalTblGetColumnText( hWndForm, SalTblQueryColumnID( hWndItem ), sText )
.head 7 +  Select Case nDataType
.head 8 +  Case DT_String
.head 9 -  Return SalStrLength( sText )
.head 8 +  Case DT_DateTime
.head 9 -  Set dt = SalStrToDate( sText )
.head 9 -  Return ( dt - 1970-01-01 ) * 86400
.head 8 +  Case DT_Number
.head 9 -  Return SalStrToNumber( sText )
.head 8 +  Default
.head 9 -  Return 0
.head 4 -  List Values
.head 4 +  Message Actions
.head 5 +  On MTM_QuerySortString
.head 6 -  Return OnQuerySortString( lParam )
.head 5 +  On MTM_QuerySortValue
.head 6 -  Return OnQuerySortValue( lParam )
.head 3 +  Child Table Class: CTable
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:
.head 6 -  Top:
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 32000
.head 5 -  Discardable? No
.head 4 -  Next Class Child Key: 0
.head 4 -  List in Tool Palette? Yes
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Description:
.head 4 +  Derived From
.head 5 -  Class: CWindow
.head 4 -  Contents
.head 4 -  Class Variables
.head 4 +  Instance Variables
.head 5 -  Number: m_hPal
.head 4 +  Functions
.head 5 +  Function: QueryFocusRow
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Number:
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nRow
.head 7 -  Window Handle: hWndCol
.head 6 +  Actions
.head 7 +  If NOT SalTblQueryFocus( hWndForm, nRow, hWndCol )
.head 8 -  Set nRow = TBL_Error
.head 7 -  Return nRow
.head 4 +  Message Actions
.head 5 +  On SAM_CacheFull
.head 6 -  Call AddMsgToLog( "SAM_CacheFull", wParam, lParam )
.head 5 +  On SAM_ColumnSelectClick
.head 6 -  Call AddMsgToLog( "SAM_ColumnSelectClick", wParam, lParam )
.head 5 +  On SAM_CornerClick
.head 6 -  Call AddMsgToLog( "SAM_CornerClick", wParam, lParam )
.head 5 +  On SAM_CornerDoubleClick
.head 6 -  Call AddMsgToLog( "SAM_CornerDoubleClick", wParam, lParam )
.head 5 +  On SAM_CountRows
.head 6 -  Call AddMsgToLog( "SAM_CountRows", wParam, lParam )
.head 5 +  On SAM_EndCellTab
.head 6 -  Call AddMsgToLog( "SAM_EndCellTab", wParam, lParam )
.head 5 +  On SAM_FetchDone
.head 6 -  Call AddMsgToLog( "SAM_FetchDone", wParam, lParam )
.head 5 +  On SAM_FetchRow
.head 6 -  Call AddMsgToLog( "SAM_FetchRow", wParam, lParam )
.head 5 +  On SAM_FetchRowDone
.head 6 -  Call AddMsgToLog( "SAM_FetchRowDone", wParam, lParam )
.head 5 +  On SAM_RowHeaderClick
.head 6 -  Call AddMsgToLog( "SAM_RowHeaderClick", wParam, lParam )
.head 5 +  On SAM_RowHeaderDoubleClick
.head 6 -  Call AddMsgToLog( "SAM_RowHeaderDoubleClick", wParam, lParam )
.head 5 +  On SAM_RowSetContext
.head 6 -  Call AddMsgToLog( "SAM_RowSetContext", wParam, lParam )
.head 5 +  On SAM_RowValidate
.head 6 -  Call AddMsgToLog( "SAM_RowValidate", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_AreaLBtnDown
.head 6 -  Call AddMsgToLog( "MTM_AreaLBtnDown", wParam, lParam )
.head 5 +  On MTM_AreaLBtnUp
.head 6 -  Call AddMsgToLog( "MTM_AreaLBtnUp", wParam, lParam )
.head 5 +  On MTM_AreaLBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_AreaLBtnDblClk", wParam, lParam )
.head 5 +  On MTM_AreaRBtnDown
.head 6 -  Call AddMsgToLog( "MTM_AreaRBtnDown", wParam, lParam )
.head 5 +  On MTM_AreaRBtnUp
.head 6 -  Call AddMsgToLog( "MTM_AreaRBtnUp", wParam, lParam )
.head 5 +  On MTM_AreaRBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_AreaRBtnDblClk", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_CornerLBtnDown
.head 6 -  Call AddMsgToLog( "MTM_CornerLBtnDown", wParam, lParam )
.head 5 +  On MTM_CornerLBtnUp
.head 6 -  Call AddMsgToLog( "MTM_CornerLBtnUp", wParam, lParam )
.head 5 +  On MTM_CornerLBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_CornerLBtnDblClk", wParam, lParam )
.head 5 +  On MTM_CornerRBtnDown
.head 6 -  Call AddMsgToLog( "MTM_CornerRBtnDown", wParam, lParam )
.head 5 +  On MTM_CornerRBtnUp
.head 6 -  Call AddMsgToLog( "MTM_CornerRBtnUp", wParam, lParam )
.head 5 +  On MTM_CornerRBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_CornerRBtnDblClk", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_ColHdrLBtnDown
.head 6 -  Call AddMsgToLog( "MTM_ColHdrLBtnDown", wParam, lParam )
.head 5 +  On MTM_ColHdrLBtnUp
.head 6 -  Call AddMsgToLog( "MTM_ColHdrLBtnUp", wParam, lParam )
.head 5 +  On MTM_ColHdrLBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_ColHdrLBtnDblClk", wParam, lParam )
.head 5 +  On MTM_ColHdrRBtnDown
.head 6 -  Call AddMsgToLog( "MTM_ColHdrRBtnDown", wParam, lParam )
.head 5 +  On MTM_ColHdrRBtnUp
.head 6 -  Call AddMsgToLog( "MTM_ColHdrRBtnUp", wParam, lParam )
.head 5 +  On MTM_ColHdrRBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_ColHdrRBtnDblClk", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_ColHdrSepLBtnDown
.head 6 -  Call AddMsgToLog( "MTM_ColHdrSepLBtnDown", wParam, lParam )
.head 5 +  On MTM_ColHdrSepLBtnUp
.head 6 -  Call AddMsgToLog( "MTM_ColHdrSepLBtnUp", wParam, lParam )
.head 5 +  On MTM_ColHdrSepLBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_ColHdrSepLBtnDblClk", wParam, lParam )
.head 6 -  Call MTblAutoSizeColumn( hWndForm, SalNumberToWindowHandle( wParam ), MTASC_SPLITROWS )
.head 5 +  On MTM_ColHdrSepRBtnDown
.head 6 -  Call AddMsgToLog( "MTM_ColHdrSepRBtnDown", wParam, lParam )
.head 5 +  On MTM_ColHdrSepRBtnUp
.head 6 -  Call AddMsgToLog( "MTM_ColHdrSepRBtnUp", wParam, lParam )
.head 5 +  On MTM_ColHdrSepRBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_ColHdrSepRBtnDblClk", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_RowHdrLBtnDown
.head 6 -  Call AddMsgToLog( "MTM_RowHdrLBtnDown", wParam, lParam )
.head 5 +  On MTM_RowHdrLBtnUp
.head 6 -  Call AddMsgToLog( "MTM_RowHdrLBtnUp", wParam, lParam )
.head 5 +  On MTM_RowHdrLBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_RowHdrLBtnDblClk", wParam, lParam )
.head 5 +  On MTM_RowHdrRBtnDown
.head 6 -  Call AddMsgToLog( "MTM_RowHdrRBtnDown", wParam, lParam )
.head 5 +  On MTM_RowHdrRBtnUp
.head 6 -  Call AddMsgToLog( "MTM_RowHdrRBtnUp", wParam, lParam )
.head 5 +  On MTM_RowHdrRBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_RowHdrRBtnDblClk", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_SplitBarLBtnDown
.head 6 -  Call AddMsgToLog( "MTM_SplitBarLBtnDown", wParam, lParam )
.head 5 +  On MTM_SplitBarLBtnUp
.head 6 -  Call AddMsgToLog( "MTM_SplitBarLBtnUp", wParam, lParam )
.head 5 +  On MTM_SplitBarLBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_SplitBarLBtnDblClk", wParam, lParam )
.head 5 +  On MTM_SplitBarRBtnDown
.head 6 -  Call AddMsgToLog( "MTM_SplitBarRBtnDown", wParam, lParam )
.head 5 +  On MTM_SplitBarRBtnUp
.head 6 -  Call AddMsgToLog( "MTM_SplitBarRBtnUp", wParam, lParam )
.head 5 +  On MTM_SplitBarRBtnDblClk
.head 6 -  Call AddMsgToLog( "MTM_SplitBarRBtnDblClk", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_ColMoved
.head 6 -  Call AddMsgToLog( "MTM_ColMoved", wParam, lParam )
.head 5 +  On MTM_ColPosChanged
.head 6 -  Call AddMsgToLog( "MTM_ColPosChanged", wParam, lParam )
.head 5 +  On MTM_ColSized
.head 6 -  Call AddMsgToLog( "MTM_ColSized", wParam, lParam )
.head 5 +  On MTM_Reset
.head 6 -  Call AddMsgToLog( "MTM_Reset", wParam, lParam )
.head 5 +  On MTM_RowDeleted
.head 6 -  Call AddMsgToLog( "MTM_RowDeleted", wParam, lParam )
.head 5 +  On MTM_RowInserted
.head 6 -  Call AddMsgToLog( "MTM_RowInserted", wParam, lParam )
.head 5 +  On MTM_RowsSwapped
.head 6 -  Call AddMsgToLog( "MTM_RowsSwapped", wParam, lParam )
.head 5 +  On MTM_SplitBarMoved
.head 6 -  Call AddMsgToLog( "MTM_SplitBarMoved", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_CollapseRow
.head 6 -  Call AddMsgToLog( "MTM_CollapseRow", wParam, lParam )
.head 5 +  On MTM_CollapseRowDone
.head 6 -  Call AddMsgToLog( "MTM_CollapseRowDone", wParam, lParam )
.head 5 +  On MTM_ExpandRow
.head 6 -  Call AddMsgToLog( "MTM_ExpandRow", wParam, lParam )
.head 5 +  On MTM_ExpandRowDone
.head 6 -  Call AddMsgToLog( "MTM_ExpandRowDone", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_QuerySortValue
.head 6 -  Return SalSendMsg( SalNumberToWindowHandle( wParam ), MTM_QuerySortValue, 0, lParam )
.head 5 +  On MTM_QuerySortString
.head 6 -  Return SalSendMsg( SalNumberToWindowHandle( wParam ), MTM_QuerySortString, 0, lParam )
.head 5 -  !
.head 5 +  On MTM_BtnClick
.head 6 -  Call AddMsgToLog( "MTM_BtnClick", wParam, lParam )
.head 5 +  On MTM_HyperlinkClick
.head 6 -  Call AddMsgToLog( "MTM_HyperlinkClick", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_Paint
.head 6 -  Call AddMsgToLog( "MTM_Paint", wParam, lParam )
.head 5 +  On MTM_PaintDone
.head 6 -  Call AddMsgToLog( "MTM_PaintDone", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_LoadChildRows
.head 6 -  Call AddMsgToLog( "MTM_LoadChildRows", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_ShowCellTip
.head 6 -  Call AddMsgToLog( "MTM_ShowCellTip", wParam, lParam )
.head 5 +  On MTM_ShowCellBtnTip
.head 6 -  Call AddMsgToLog( "MTM_ShowCellBtnTip", wParam, lParam )
.head 5 +  On MTM_ShowCellImageTip
.head 6 -  Call AddMsgToLog( "MTM_ShowCellImageTip", wParam, lParam )
.head 5 +  On MTM_ShowCellTextTip
.head 6 -  Call AddMsgToLog( "MTM_ShowCellTextTip", wParam, lParam )
.head 5 +  On MTM_ShowCellCompleteTextTip
.head 6 -  Call AddMsgToLog( "MTM_ShowCellCompleteTextTip", wParam, lParam )
.head 5 +  On MTM_ShowColHdrTip
.head 6 -  Call AddMsgToLog( "MTM_ShowColHdrTip", wParam, lParam )
.head 5 +  On MTM_ShowColHdrGrpTip
.head 6 -  Call AddMsgToLog( "MTM_ShowColHdrGrpTip", wParam, lParam )
.head 5 +  On MTM_ShowCornerTip
.head 6 -  Call AddMsgToLog( "MTM_ShowCornerTip", wParam, lParam )
.head 5 +  On MTM_ShowRowHdrTip
.head 6 -  Call AddMsgToLog( "MTM_ShowRowHdrTip", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_DrawItem
.head 6 -  Call AddMsgToLog( "MTM_DrawItem", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_QueryBestCellWidth
.head 6 -  Call AddMsgToLog( "MTM_QueryBestCellWidth", wParam, lParam )
.head 5 +  On MTM_QueryBestColHdrWidth
.head 6 -  Call AddMsgToLog( "MTM_QueryBestColHdrWidth", wParam, lParam )
.head 5 +  On MTM_QueryBestCellHeight
.head 6 -  Call AddMsgToLog( "MTM_QueryBestCellHeight", wParam, lParam )
.head 5 +  On MTM_QueryMaxColWidth
.head 6 -  Call AddMsgToLog( "MTM_QueryMaxColWidth", wParam, lParam )
.head 5 +  On MTM_QueryMaxRowHeight
.head 6 -  Call AddMsgToLog( "MTM_QueryMaxRowHeight", wParam, lParam )
.head 5 +  On MTM_QueryMinColWidth
.head 6 -  Call AddMsgToLog( "MTM_QueryMinColWidth", wParam, lParam )
.head 5 +  On MTM_QueryMinRowHeight
.head 6 -  Call AddMsgToLog( "MTM_QueryMinRowHeight", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_ColSelChanged
.head 6 -  Call AddMsgToLog( "MTM_ColSelChanged", wParam, lParam )
.head 5 +  On MTM_RowSelChanged
.head 6 -  Call AddMsgToLog( "MTM_RowSelChanged", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_FocusCellChanged
.head 6 -  Call AddMsgToLog( "MTM_FocusCellChanged", wParam, lParam )
.head 5 -  !
.head 5 +  On MTM_LButtonDown
.head 6 -  Call AddMsgToLog( "MTM_LButtonDown", wParam, lParam )
.head 3 +  Functional Class: CFont
.head 4 -  Description:
.head 4 -  Derived From
.head 4 -  Class Variables
.head 4 +  Instance Variables
.head 5 -  String: Name
.head 5 -  Number: Size
.head 5 -  Number: Enh
.head 4 -  Functions
.head 3 +  Custom Control Class: ccImage
.head 4 -  DLL Name:
.head 4 -  Display Settings
.head 5 -  DLL Name:
.head 5 -  MS Windows Class Name:
.head 5 -  Style:  Class Default
.head 5 -  ExStyle:  Class Default
.head 5 -  Title:
.head 5 -  Window Location and Size
.head 6 -  Left:
.head 6 -  Top:
.head 6 -  Width:  Class Default
.head 6 -  Width Editable? Class Default
.head 6 -  Height: Class Default
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Border? Class Default
.head 5 -  Etched Border? Class Default
.head 5 -  Hollow? Class Default
.head 5 -  Vertical Scroll? Class Default
.head 5 -  Horizontal Scroll? Class Default
.head 5 -  Tab Stop? Class Default
.head 5 -  Tile To Parent? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  DLL Settings
.head 4 -  List in Tool Palette? Yes
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Description:
.head 4 +  Derived From
.head 5 -  Class: CMImgCtl
.head 4 -  Class Variables
.head 4 -  Instance Variables
.head 4 +  Functions
.head 5 +  Function: OnCreate
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Call SetBackBrush( MIMG_BRUSH_DIAGCROSS, COLOR_Gray )
.head 7 -  Call SetAlignFlags( MIMG_ALIGN_HCENTER | MIMG_ALIGN_VCENTER, TRUE )
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call OnCreate( )
.head 3 +  Child Table Class: CImageTbl
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left:
.head 6 -  Top:
.head 6 -  Width:  5.867"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 1.976"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Class Default
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Yes
.head 5 -  Lines Per Row: 1
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 32500
.head 5 -  Discardable? No
.head 4 -  Next Class Child Key: 7
.head 4 -  List in Tool Palette? Yes
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Description:
.head 4 -  Derived From
.head 4 +  Contents
.head 5 +  Column: colImage
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 1
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Image
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? Yes
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colHandle
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 2
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Handle
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colType
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 3
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Type
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? Yes
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSize
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 5
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Size
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? Yes
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colBpp
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 7
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Bpp
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? Yes
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Class Variables
.head 4 -  Instance Variables
.head 4 +  Functions
.head 5 +  Function: OnCreate
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Call MTblSubClass( hWndForm )
.head 7 -  Call MTblSetFlags( hWndForm, MTBL_FLAG_CLIP_FOCUS_AREA, TRUE )
.head 7 -  Call MTblEnableMWheelScroll( hWndForm, TRUE )
.head 5 -  !
.head 5 +  Function: GetColorText
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  String:
.head 6 +  Parameters
.head 7 -  Number: p_nColor
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: sColor
.head 6 +  Actions
.head 7 +  If p_nColor = MIMG_COLOR_UNDEF
.head 8 -  Set sColor = "<undefined>"
.head 7 +  Else
.head 8 -  Set sColor = STRING_Null
.head 7 -  Return sColor
.head 5 +  Function: GetSizeText
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  String:
.head 6 +  Parameters
.head 7 -  Number: p_nWid
.head 7 -  Number: p_nHt
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Return SalNumberToStrX( p_nWid, 0 ) || " X " || SalNumberToStrX( p_nHt, 0 )
.head 5 +  Function: GetTypeText
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  String:
.head 6 +  Parameters
.head 7 -  Number: p_nType
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 +  Select Case p_nType
.head 8 +  Case MIMG_TYPE_UNKNOWN
.head 9 -  Return "<Unknown>"
.head 8 +  Case MIMG_TYPE_BMP
.head 9 -  Return "BMP"
.head 8 +  Case MIMG_TYPE_GIF
.head 9 -  Return "GIF"
.head 8 +  Case MIMG_TYPE_JPG
.head 9 -  Return "JPG"
.head 8 +  Case MIMG_TYPE_PNG
.head 9 -  Return "PNG"
.head 8 +  Case MIMG_TYPE_ICO
.head 9 -  Return "ICO"
.head 8 +  Case MIMG_TYPE_TIF
.head 9 -  Return "TIF"
.head 8 +  Case MIMG_TYPE_TGA
.head 9 -  Return "TGA"
.head 8 +  Case MIMG_TYPE_PCX
.head 9 -  Return "PCX"
.head 8 +  Case MIMG_TYPE_WBMP
.head 9 -  Return "WBMP"
.head 8 +  Case MIMG_TYPE_WMF
.head 9 -  Return "WMF"
.head 8 +  Default
.head 9 -  Return "<Unknown>"
.head 5 +  Function: ReadImage
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  Number: p_nImage
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bOk
.head 7 -  Number: nAttr
.head 7 -  Number: nHt
.head 7 -  Number: nRow
.head 7 -  Number: nTextColor
.head 7 -  Number: nType
.head 7 -  Number: nTrColor
.head 7 -  Number: nWid
.head 7 -  String: sText
.head 6 +  Actions
.head 7 -  Set nRow = SalTblQueryContext( hWndForm )
.head 7 -  !
.head 7 -  Call MTblSetCellImage( colImage, nRow, p_nImage, MTSI_REDRAW | MTSI_ALIGN_HCENTER | MTSI_ALIGN_VCENTER | MTSI_NOLEAD_LEFT | MTSI_NOLEAD_TOP )
.head 7 -  Set colHandle = p_nImage
.head 7 -  !
.head 7 -  Set nType = MImgGetType( p_nImage )
.head 7 -  Set colType = GetTypeText( nType )
.head 7 -  !
.head 7 +  If MImgGetSize( p_nImage, nWid, nHt )
.head 8 -  Set colSize = GetSizeText( nWid, nHt )
.head 7 -  !
.head 7 -  Set colBpp = MImgGetBpp( p_nImage )
.head 5 +  Function: ReadImages
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: n
.head 7 -  Number: nImages
.head 7 -  Number: nRow
.head 7 -  Number: naImages[*]
.head 6 +  Actions
.head 7 -  Call SalTblReset( hWndForm )
.head 7 -  !
.head 7 -  Set nImages = MImgEnum( naImages )
.head 7 +  While n < nImages
.head 8 -  Set nRow = SalTblInsertRow( hWndForm, TBL_MaxRow )
.head 8 +  If nRow != TBL_Error
.head 9 -  Call SalTblSetRowFlags( hWndForm, nRow, ROW_New, FALSE )
.head 9 -  Call ReadImage( naImages[n] )
.head 8 -  Set n = n + 1
.head 7 -  ! Call MTblAutoSizeColumn( hWndForm, hWndNULL, MTASC_ALLROWS )
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call OnCreate( )
.head 3 +  Functional Class: fcExcExp
.head 4 -  Description:
.head 4 -  Derived From
.head 4 -  Class Variables
.head 4 +  Instance Variables
.head 5 -  Number: Language
.head 5 -  String: ExcStartCell
.head 5 -  Number: ExcFlags
.head 5 -  Number: ExpFlags
.head 5 -  Number: RowFlagsOn
.head 5 -  Number: RowFlagsOff
.head 5 -  Number: ColFlagsOn
.head 5 -  Number: ColFlagsOff
.head 4 +  Functions
.head 5 +  Function: Assign
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  FunctionalVar: p
.head 8 -  Class: fcExcExp
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Set Language = p.Language
.head 7 -  Set ExcStartCell = p.ExcStartCell
.head 7 -  Set ExcFlags = p.ExcFlags
.head 7 -  Set ExpFlags = p.ExpFlags
.head 7 -  Set RowFlagsOn = p.RowFlagsOn
.head 7 -  Set RowFlagsOff = p.RowFlagsOff
.head 7 -  Set ColFlagsOn = p.ColFlagsOn
.head 7 -  Set ColFlagsOff = p.ColFlagsOff
.head 2 +  Default Classes
.head 3 -  MDI Window: cBaseMDI
.head 3 -  Form Window:
.head 3 -  Dialog Box:
.head 3 -  Table Window:
.head 3 -  Quest Window:
.head 3 -  Data Field:
.head 3 -  Spin Field:
.head 3 -  Multiline Field:
.head 3 -  Pushbutton:
.head 3 -  Radio Button:
.head 3 -  Option Button:
.head 3 -  Check Box:
.head 3 -  Child Table:
.head 3 -  Quest Child Window: cQuickDatabase
.head 3 -  List Box:
.head 3 -  Combo Box:
.head 3 -  Picture:
.head 3 -  Vertical Scroll Bar:
.head 3 -  Horizontal Scroll Bar:
.head 3 -  Column:
.head 3 -  Background Text:
.head 3 -  Group Box:
.head 3 -  Line:
.head 3 -  Frame:
.head 3 -  Custom Control:
.head 3 -  ActiveX:
.head 2 +  Application Actions
.head 3 +  On SAM_SqlError
.head 4 -  Set gnError = gnError
.head 1 +  Form Window: frmLOC2
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: LOC 2
.head 2 -  Icon File:
.head 2 -  Accessories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Automatically Created at Runtime? Yes
.head 3 -  Initial State: Normal
.head 3 -  Maximizable? No
.head 3 -  Minimizable? Yes
.head 3 -  Allow Child Docking? No
.head 3 -  Docking Orientation: All
.head 3 -  System Menu? Yes
.head 3 -  Resizable? No
.head 3 -  Window Location and Size
.head 4 -  Left: 10.063"
.head 4 -  Top: 1.292"
.head 4 -  Width:  12.333"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.94"
.head 4 -  Height Editable? Yes
.head 3 -  Form Size
.head 4 -  Width:  Default
.head 4 -  Height: Default
.head 4 -  Number of Pages: Dynamic
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 2 -  Description:
.head 2 -  Named Menus
.head 2 -  Menu
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Docking Toolbar? No
.head 4 -  Toolbar Docking Orientation: Top | Bottom
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Resizable? No
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Data Field: dfIn
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 1.033"
.head 6 -  Top: 0.31"
.head 6 -  Width:  4.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: RESULT
.head 4 -  Resource Id: 42032
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.183"
.head 5 -  Top: 0.595"
.head 5 -  Width:  0.85"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfOut
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 1.033"
.head 6 -  Top: 0.571"
.head 6 -  Width:  4.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: DETAIL
.head 4 -  Resource Id: 42033
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.183"
.head 5 -  Top: 0.333"
.head 5 -  Width:  0.85"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfLoc3
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 6.183"
.head 6 -  Top: 0.274"
.head 6 -  Width:  4.4"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: LOC1
.head 4 -  Resource Id: 2802
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 5.533"
.head 5 -  Top: 0.583"
.head 5 -  Width:  0.65"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfLoc1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 6.183"
.head 6 -  Top: 0.524"
.head 6 -  Width:  4.4"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: LOC3
.head 4 -  Resource Id: 2803
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 5.533"
.head 5 -  Top: 0.333"
.head 5 -  Width:  0.65"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Pushbutton: pbAction
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Action
.head 4 -  Window Location and Size
.head 5 -  Left: 10.833"
.head 5 -  Top: 0.06"
.head 5 -  Width:  1.15"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.702"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Salmon
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalHttpCockpit( 401, '', '', '', '', wsModuleNom, wsModuleLigne, '' )
.head 6 -  Call SalDisableWindow( hWndItem)
.head 6 -  Call SalHideWindow( hWndItem )
.head 6 -  Call SalEnableWindow( pbStop )
.head 6 -  Call SalShowWindow( pbStop )
.head 6 -  Call PalDtmTitre(  )
.head 6 -  Set gbKillTimer = FALSE
.head 6 -  Call SalTimerSet( hWndForm, nNoTimer, 250 )
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resGo , PIC_FormatIcon )
.head 6 -  Call SalShowWindow( pbAction )
.head 3 +  Pushbutton: pbStop
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Stop
.head 4 -  Window Location and Size
.head 5 -  Left: 10.833"
.head 5 -  Top: 0.071"
.head 5 -  Width:  1.15"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.702"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Green
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If SalIsWindowEnabled( hWndItem )
.head 7 -  Call PalHttpCockpit( 499, '', '', '', '', wsModuleNom, wsModuleLigne, '' )
.head 6 -  Call SalDisableWindow( hWndItem)
.head 6 -  Call SalHideWindow( hWndItem )
.head 6 -  Call SalEnableWindow( pbAction )
.head 6 -  Call SalShowWindow( pbAction )
.head 6 -  Call PalDtmTitre(  )
.head 6 -  Set gbKillTimer = TRUE
.head 6 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resStop , PIC_FormatIcon )
.head 6 -  Call SalDisableWindow( hWndItem )
.head 6 -  Call SalHideWindow( hWndItem )
.head 3 +  Pushbutton: pbQuit
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Quitter
.head 4 -  Window Location and Size
.head 5 -  Left: 10.833"
.head 5 -  Top: 4.881"
.head 5 -  Width:  1.167"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.714"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalSendMsg( pbStop, SAM_Click,0,0)
.head 6 -  Call SalModalDialog(dlgPW, hWndForm, 'MASTER', wbOkQuit)
.head 6 +  If wbOkQuit
.head 7 -  Call SalSendMsg( hWndForm, SAM_Close, 0,0)
.head 6 +  Else
.head 7 -  Call SalMessageBox('Mot de passe erroné !!','ERREUR', MB_Ok )
.head 7 -  ! Call SalSendMsg( pbAction, SAM_Click,0,0)
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resExitWin , PIC_FormatBitmap )
.head 3 +  Child Table: tblFiles
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.083"
.head 6 -  Top: 2.952"
.head 6 -  Width:  3.4"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 2.643"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 10000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colTraite
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Traité
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.55"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Check Box
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value: 1
.head 8 -  Uncheck Value: 0
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFile
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Fichier
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.633"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSize
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Taille
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  1.3"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDateC
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Date - Heure Création
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  2.45"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDate
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Date - Heure Copie
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Date/Time
.head 6 -  Justify: Center
.head 6 -  Width:  2.25"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFilePath
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Fichier + Path
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.367"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colIdElec
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Id EL
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 -  Message Actions
.head 3 +  Data Field: dfNbRestant
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 5.633"
.head 6 -  Top: 3.488"
.head 6 -  Width:  1.45"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: #0
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  ! Check Box: cbFichT
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Fichiers T
.head 4 -  Window Location and Size
.head 5 -  Left: 0.183"
.head 5 -  Top: 0.988"
.head 5 -  Width:  1.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.end
.head 4 +  Message Actions 
.head 5 +  On SAM_Create
.head 6 -  Set MyValue = TRUE
.head 3 +  Check Box: cbFichC
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: C
.head 4 -  Window Location and Size
.head 5 -  Left: 0.283"
.head 5 -  Top: 1.095"
.head 5 -  Width:  0.75"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set MyValue = TRUE
.head 3 +  Check Box: cbFich0
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: 0
.head 4 -  Window Location and Size
.head 5 -  Left: 0.283"
.head 5 -  Top: 1.774"
.head 5 -  Width:  0.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set MyValue = TRUE
.head 3 +  Check Box: cbFich1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: 1
.head 4 -  Window Location and Size
.head 5 -  Left: 0.283"
.head 5 -  Top: 2.131"
.head 5 -  Width:  0.65"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set MyValue = TRUE
.head 3 +  Check Box: cbFichSup
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Niv. Sup.
.head 4 -  Window Location and Size
.head 5 -  Left: 0.283"
.head 5 -  Top: 2.452"
.head 5 -  Width:  1.1"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set MyValue = TRUE
.head 3 +  Check Box: cbFichAutre
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: P ou D
.head 4 -  Window Location and Size
.head 5 -  Left: 0.283"
.head 5 -  Top: 1.417"
.head 5 -  Width:  0.95"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set MyValue = TRUE
.head 3 +  Data Field: dfDateDernier2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 5.783"
.head 6 -  Top: 0.988"
.head 6 -  Width:  3.15"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  ! Call SalDateToStr( dfDateDernier, wsTmp )
.head 6 -  Set wsTmp = dfDateDernier2
.head 6 -  Call PalSetApplParm( "DATE_LOC2_DF", wsTmp )
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 3 +  Data Field: dfDateDernierEU
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 2.533"
.head 6 -  Top: 1.131"
.head 6 -  Width:  3.15"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  Set wsTmp = dfDateDernierEU
.head 6 -  Call PalSetDateElection( "EU", wsTmp, 1 )
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 5 +  On SAM_Create
.head 6 -  Set whDateElec[1] = hWndItem
.head 3 +  Data Field: dfDateDernierCK
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 2.533"
.head 6 -  Top: 1.381"
.head 6 -  Width:  3.15"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  ! Call SalDateToStr( dfDateDernier, wsTmp )
.head 6 -  Set wsTmp = dfDateDernierCK
.head 6 -  Call PalSetDateElection( "CK", wsTmp, 2 )
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 5 +  On SAM_Create
.head 6 -  Set whDateElec[2] = hWndItem
.head 3 +  Data Field: dfDateDernierSE
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 2.533"
.head 6 -  Top: 1.631"
.head 6 -  Width:  3.15"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  ! Call SalDateToStr( dfDateDernier, wsTmp )
.head 6 -  Set wsTmp = dfDateDernierSE
.head 6 -  Call PalSetDateElection( "SE", wsTmp, 3 )
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalTimerKill( hWndForm,nNoTimer )
.head 5 +  On SAM_Create
.head 6 -  Set whDateElec[3] = hWndItem
.head 3 +  Data Field: dfDateDernierWL
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 2.533"
.head 6 -  Top: 1.881"
.head 6 -  Width:  3.15"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  ! Call SalDateToStr( dfDateDernier, wsTmp )
.head 6 -  Set wsTmp = dfDateDernierWL
.head 6 -  Call PalSetDateElection( "WL", wsTmp , 4)
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 5 +  On SAM_Create
.head 6 -  Set whDateElec[4] = hWndItem
.head 3 +  Data Field: dfDateDernierVL
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 2.533"
.head 6 -  Top: 2.131"
.head 6 -  Width:  3.15"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  ! Call SalDateToStr( dfDateDernier, wsTmp )
.head 6 -  Set wsTmp = dfDateDernierVL
.head 6 -  Call PalSetDateElection( "VL", wsTmp, 7 )
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 5 +  On SAM_Create
.head 6 -  Set whDateElec[7] = hWndItem
.head 3 +  Data Field: dfDateDernierBR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 2.533"
.head 6 -  Top: 2.381"
.head 6 -  Width:  3.15"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  ! Call SalDateToStr( dfDateDernier, wsTmp )
.head 6 -  Set wsTmp = dfDateDernierBR
.head 6 -  Call PalSetDateElection( "BR", wsTmp, 10 )
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 5 +  On SAM_Create
.head 6 -  Set whDateElec[10] = hWndItem
.head 3 +  Data Field: dfDateDernierDE
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 2.533"
.head 6 -  Top: 2.631"
.head 6 -  Width:  3.15"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  ! Call SalDateToStr( dfDateDernier, wsTmp )
.head 6 -  Set wsTmp = dfDateDernierDE
.head 6 -  Call PalSetDateElection( "DE", wsTmp, 12 )
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 5 +  On SAM_Create
.head 6 -  Set whDateElec[12] = hWndItem
.head 3 +  Data Field: dfDateDernier
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Date/Time
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 6.233"
.head 6 -  Top: 1.238"
.head 6 -  Width:  3.15"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  Call SalDateToStr( dfDateDernier, wsTmp )
.head 6 -  Call PalSetApplParm( "DATE_LOC2_DF", wsTmp )
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 3 -  Background Text: Date heure dernier traitement:
.head 4 -  Resource Id: 42034
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 2.633"
.head 5 -  Top: 0.917"
.head 5 -  Width:  3.1"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 3 -  Background Text: Format R
.head 4 -  Resource Id: 42035
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 6.05"
.head 5 -  Top: 0.929"
.head 5 -  Width:  0.933"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 3 -  Background Text: Elus / Rgénérés
.head 4 -  Resource Id: 42036
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 10.283"
.head 5 -  Top: 0.94"
.head 5 -  Width:  1.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 3 -  Background Text: Elections:
.head 4 -  Resource Id: 42037
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 1.6"
.head 5 -  Top: 0.917"
.head 5 -  Width:  1.033"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Blue
.head 4 -  Background Color: Light Gray
.head 3 +  Pushbutton: pbChgtPhase
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Validation
.head 4 -  Window Location and Size
.head 5 -  Left: 10.833"
.head 5 -  Top: 4.131"
.head 5 -  Width:  1.15"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.714"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: 3D Highlight Color
.head 4 -  Background Color: Charcoal
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set wbClickOn = FALSE
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalSendMsg( pbStop, SAM_Click, 0,0 )
.head 6 -  Call SalModalDialog( dlgGenereFile, hWndForm )
.head 6 -  Call PalCheckRepertoire(1)
.head 6 -  Call PalDtmTitre()
.head 6 +  ! If wbClickOn
.head 7 -  Call SalSendMsg( pbAction , SAM_Click, 0,0 )
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resAccepter , PIC_FormatIcon )
.head 3 +  Pushbutton: pbFormatR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Format R manuel
.head 4 -  Window Location and Size
.head 5 -  Left: 7.233"
.head 5 -  Top: 3.452"
.head 5 -  Width:  2.15"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Gray
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set wbFormatRManuel = TRUE
.head 6 -  Set wbResultat = TRUE
.head 6 +  If SalIsWindowEnabled( pbAction )
.head 7 -  Set gbKillTimer = FALSE
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 100 )
.head 3 -  ! Background Text: Format R :
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 2.833"
.head 5 -  Top: 5.726"
.head 5 -  Width:  0.9"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.end
.head 3 +  ! Check Box: cbFormatR_On
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Format R
.head 4 -  Window Location and Size
.head 5 -  Left: 3.683"
.head 5 -  Top: 6.702"
.head 5 -  Width:  1.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.end
.head 4 +  Message Actions 
.head 5 +  On SAM_Create
.head 6 -  Set MyValue = TRUE
.head 3 +  Data Field: dfTempsR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 5
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 7.233"
.head 6 -  Top: 3.202"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: 99:99
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalDisableWindow( hWndItem )
.head 3 +  Data Field: dfTempsEntreR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 5
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 8.383"
.head 6 -  Top: 3.202"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: 99:99
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  Call SalSetProfileString( 'DATABASE', 'INTERVAL_RESULT',  dfTempsEntreR, wsPathINI )
.head 6 -  Set wnPassage = 0
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 3 +  Pushbutton: pbFormatCoord
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Envoi Coord.
.head 4 -  Window Location and Size
.head 5 -  Left: 9.833"
.head 5 -  Top: 3.452"
.head 5 -  Width:  2.15"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Gray
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If cbCoordOn
.head 7 -  Set wbCoord = TRUE
.head 7 +  If SalIsWindowEnabled( pbAction )
.head 8 -  Call SalTimerSet( hWndForm, nNoTimer, 100 )
.head 3 +  Check Box: cbCoordOn
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Coordonnées
.head 4 -  Window Location and Size
.head 5 -  Left: 9.933"
.head 5 -  Top: 2.976"
.head 5 -  Width:  2.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: 3D Face Color
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set MyValue = FALSE
.head 3 +  Data Field: dfTempsCoord
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 5
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 9.833"
.head 6 -  Top: 3.202"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: 99:99
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalDisableWindow( hWndItem )
.head 3 +  Data Field: dfTempsEntreCoord
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 5
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.983"
.head 6 -  Top: 3.202"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: 99:99
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 -  Call SalSetProfileString( 'DATABASE', 'INTERVAL_COORD',  dfTempsEntreCoord, wsPathINI )
.head 6 -  Set wnPassageCoord = 0
.head 6 -  ! Call SalTimerSet( hWndForm, 4, 700 )
.head 5 +  On SAM_AnyEdit
.head 6 -  ! Call SalTimerKill( hWndForm, 4 )
.head 3 +  Data Field: dfLibelleR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.633"
.head 6 -  Top: 3.702"
.head 6 -  Width:  10.05"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.393"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 14
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Blue
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  ! Aide cockpit
.head 3 +  Pushbutton: pbF1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: F1
.head 4 -  Window Location and Size
.head 5 -  Left: 12.283"
.head 5 -  Top: 7.821"
.head 5 -  Width:  0.5"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: F1
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalSendMsg( pbStop, SAM_Click , 0,0)
.head 6 -  Call SalModalDialog( dlgCockpitAide, hWndForm , wsPathHTTP, wsPathTmp , '',  wsModuleNom, wsModuleLigne,
	wsPathTmp || '\\T_' || wsModuleNom || '_'||wsModuleLigne || '.SRV',  'T_' || wsModuleNom || '_'||wsModuleLigne || '.SRV' )
.head 6 -  Call SalSendMsg( pbAction, SAM_Click , 0,0)
.head 3 +  Data Field: dfEtatLoc2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.183"
.head 6 -  Top: 0.012"
.head 6 -  Width:  10.4"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? No
.head 5 -  Justify: Center
.head 5 -  Format: Uppercase
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Red
.head 5 -  Background Color: Maize
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  !
.head 3 +  Child Table: tblDiviseur
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65330000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 12.833"
.head 6 -  Top: 1.095"
.head 6 -  Width:  2.25"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 3.75"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 1000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colNoListe
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: No
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.4"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colRowListe
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Row
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.5"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDiv
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Div
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.617"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDivStrTri
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: QuotientTri
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.217"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 -  Message Actions
.head 3 +  Child Table: tblCdt_E
.data INHERITPROPS
0000: 0100
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6533000000 00
.enddata
.data CLASSPROPSSIZE
0000: 1900
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.183"
.head 6 -  Top: 1.274"
.head 6 -  Width:  6.35"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 3.798"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 32000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colNo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: No
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.4"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 -  On SAM_Create
.head 5 +  Column: colDateDeces
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Date deces
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.5"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 -  On SAM_Create
.head 5 +  Column: colVoix
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Voix
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVoixPot
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: I
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDevol
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: II
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colRestPot
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: III
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNoElu
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSexe
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Date deces
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.5"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 -  On SAM_Create
.head 5 +  Column: colNN
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: NN
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.4"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 -  On SAM_Create
.head 5 +  Column: colDevolNo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: PalDtmCdtElu
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  Number: nSiege
.head 7 -  Number: nChiffreElig
.head 7 -  Number: nPotEff
.head 7 -  Number: nPotSuppl
.head 7 -  Number: nIdListe
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nI
.head 7 -  Number: nJ
.head 7 -  Number: nK
.head 7 -  Number: nRow
.head 7 -  Number: nDiv
.head 7 -  Number: nCdt
.head 7 -  Boolean: bElu
.head 7 -  Long String: llsNN_Elu
.head 7 -  Number: nNN_DejaElu
.head 6 +  Actions
.head 7 +  If nSiege > 0
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select LIS_NBEFF from Listes where Lis_Id = :nIdListe into :nCdt ")
.head 8 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 -  Set nJ = -1
.head 8 +  While SalTblFindNextRow( tblCdt_E, nJ, 0,0 )
.head 9 -  Call SalTblSetContext( tblCdt_E, nJ )
.head 9 +  If tblCdt_E.colDateDeces = ''
.head 10 +  If nPotEff > 0 and nCdt != nSiege
.head 11 +  If tblCdt_E.colVoix >= nChiffreElig
.head 12 -  Set tblCdt_E.colVoixPot = 0
.head 11 +  Else
.head 12 +  If nPotEff >= nChiffreElig - tblCdt_E.colVoix
.head 13 -  Set tblCdt_E.colVoixPot = nChiffreElig - tblCdt_E.colVoix
.head 12 +  Else
.head 13 -  Set tblCdt_E.colVoixPot = nPotEff
.head 12 -  Set nPotEff = nPotEff - tblCdt_E.colVoixPot
.head 11 -  Set tblCdt_E.colRestPot = nPotEff
.head 11 -  Set tblCdt_E.colDevol = tblCdt_E.colVoix + tblCdt_E.colVoixPot
.head 10 +  Else
.head 11 -  Set tblCdt_E.colVoixPot = 0
.head 11 -  Set tblCdt_E.colDevol = tblCdt_E.colVoix
.head 11 -  Set tblCdt_E.colRestPot = 0
.head 10 -  Set tblCdt_E.colDevolNo = SalStrRightX( '0000000000' || SalNumberToStrX(tblCdt_E.colDevol, 0 ), 10) || "-"|| SalStrRightX( '000' || SalNumberToStrX(nCdt - tblCdt_E.colNo, 0 ), 3 )
.head 8 -  !
.head 8 -  ! Call SalTblSortRows( tblCdt_E, 5, TBL_SortDecreasing )
.head 8 -  Call SalTblSortRows( tblCdt_E, 10, TBL_SortDecreasing )
.head 8 -  !
.head 8 -  Set llsNN_Elu = ''
.head 8 -  Set nJ = 0
.head 8 +  While nJ < nSiege
.head 9 -  Call SalTblSetContext( tblCdt_E, nJ )
.head 9 -  Set tblCdt_E.colNoElu = nJ+1
.head 9 +  If SalStrTrimX( tblCdt_E.colNN ) != ''
.head 10 -  Set llsNN_Elu = llsNN_Elu || '|' || tblCdt_E.colNN ||'|'
.head 9 +  Else
.head 10 -  Set llsNN_Elu = llsNN_Elu || '|' || SalStrRightX( '000' || SalNumberToStrX( tblCdt_E.colNo, 0), 3) ||'|'
.head 9 -  Set nJ = nJ + 1
.head 8 -  !
.head 8 -  Call SalTblSortRows( tblCdt_E, 1, TBL_SortIncreasing )
.head 8 -  !
.head 8 -  Set nJ = -1
.head 8 +  While SalTblFindNextRow( tblCdtSuppl_E, nJ, 0,0 )
.head 9 -  Call SalTblSetContext( tblCdtSuppl_E, nJ )
.head 9 +  If tblCdtSuppl_E.colDateDeces = ''
.head 10 -  Set bElu = FALSE
.head 10 -  Set nNN_DejaElu = -1
.head 10 +  If tblCdtSuppl_E.colNN != ''
.head 11 -  Set nNN_DejaElu = SalStrScan( llsNN_Elu, '|' || tblCdtSuppl_E.colNN ||'|' )
.head 10 +  If nNN_DejaElu = -1 and SalStrTrimX( tblCdtSuppl_E.colNoEff ) != ''
.head 11 -  Set nNN_DejaElu = SalStrScan( llsNN_Elu, '|' || SalStrRightX( '000' || tblCdtSuppl_E.colNoEff,3) ||'|' )
.head 10 +  If nNN_DejaElu = -1
.head 11 -  Set bElu= TRUE
.head 10 +  If nPotSuppl > 0 and bElu
.head 11 +  If tblCdtSuppl_E.colVoix >= nChiffreElig
.head 12 -  Set tblCdtSuppl_E.colVoixPot = 0
.head 11 +  Else
.head 12 +  If nPotSuppl >= nChiffreElig - tblCdtSuppl_E.colVoix
.head 13 -  Set tblCdtSuppl_E.colVoixPot = nChiffreElig - tblCdtSuppl_E.colVoix
.head 12 +  Else
.head 13 -  Set tblCdtSuppl_E.colVoixPot = nPotSuppl
.head 12 -  Set nPotSuppl = nPotSuppl - tblCdtSuppl_E.colVoixPot
.head 11 -  Set tblCdtSuppl_E.colRestPot = nPotSuppl
.head 11 -  Set tblCdtSuppl_E.colDevol = tblCdtSuppl_E.colVoix + tblCdtSuppl_E.colVoixPot
.head 10 +  Else
.head 11 -  Set tblCdtSuppl_E.colVoixPot = 0
.head 11 -  Set tblCdtSuppl_E.colDevol = tblCdtSuppl_E.colVoix
.head 11 -  Set tblCdtSuppl_E.colRestPot = 0
.head 10 +  If bElu
.head 11 -  Set tblCdtSuppl_E.colTri = SalStrToNumber( SalNumberToStrX( tblCdtSuppl_E.colDevol, 0)  ||  SalStrRightX( '00'  || SalNumberToStrX(100- tblCdtSuppl_E.colNo,0), 2 ) )
.head 10 +  Else
.head 11 -  Set tblCdtSuppl_E.colTri = 0
.head 9 +  Else
.head 10 -  Set tblCdtSuppl_E.colTri =0
.head 8 -  !
.head 8 -  ! Call SalTblSortRows( tblCdtSuppl_E, 5, TBL_SortDecreasing )
.head 8 -  Call SalTblSortRows( tblCdtSuppl_E, 10, TBL_SortDecreasing )
.head 8 -  !
.head 8 -  Set nJ = -1
.head 8 -  Set nI = 1
.head 8 +  While SalTblFindNextRow( tblCdtSuppl_E, nJ, 0,0 )
.head 9 -  Call SalTblSetContext( tblCdtSuppl_E, nJ )
.head 9 -  Set bElu = FALSE
.head 9 +  If tblCdtSuppl_E.colVoix > 0
.head 10 -  Set nNN_DejaElu = -1
.head 10 +  If tblCdtSuppl_E.colNN != ''
.head 11 -  Set nNN_DejaElu = SalStrScan( llsNN_Elu, '|' || tblCdtSuppl_E.colNN ||'|' )
.head 10 +  If nNN_DejaElu = -1 and SalStrTrimX( tblCdtSuppl_E.colNoEff ) != ''
.head 11 -  Set nNN_DejaElu = SalStrScan( llsNN_Elu, '|' || SalStrRightX( '000' || tblCdtSuppl_E.colNoEff,3) ||'|' )
.head 10 +  If nNN_DejaElu = -1
.head 11 -  Set bElu= TRUE
.head 10 +  ! Else
.head 11 -  ! Call SalTblSetContext( tblCdt_E, tblCdtSuppl_E.colNoTitulaire-1 )
.head 11 +  ! If tblCdt_E.colNoElu = NUMBER_Null
.head 12 -  Set bElu = TRUE
.head 11 -  ! Call SalTblSetContext( tblCdtSuppl_E, nJ )
.head 9 +  If bElu
.head 10 -  Set tblCdtSuppl_E.colNoElu = nI
.head 10 -  Set nI = nI +1
.head 8 -  !
.head 8 -  Call SalTblSortRows( tblCdtSuppl_E, 1, TBL_SortIncreasing )
.head 8 -  !
.head 7 -  !
.head 4 +  Window Variables
.head 5 -  Number: tnNbCdt
.head 4 -  Message Actions
.head 3 +  Child Table: tblCdtSuppl_E
.data INHERITPROPS
0000: 0100
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6533000000 00
.enddata
.data CLASSPROPSSIZE
0000: 1900
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.183"
.head 6 -  Top: 1.274"
.head 6 -  Width:  6.35"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 3.798"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 32000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colNo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: No
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.4"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 -  On SAM_Create
.head 5 +  Column: colDateDeces
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Date deces
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.5"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 -  On SAM_Create
.head 5 +  Column: colVoix
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Voix
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colVoixPot
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: I
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDevol
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: II
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colRestPot
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: III
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNoElu
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNoEff
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: No
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.517"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 -  On SAM_Create
.head 5 +  Column: colNN
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: NN
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.4"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 -  On SAM_Create
.head 5 +  Column: colTri
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 +  Window Variables
.head 5 -  Number: tnNbCdt
.head 4 -  Message Actions
.head 3 +  ! Pushbutton: pbUpdateStat
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 6.883"
.head 5 -  Top: 5.845"
.head 5 -  Width:  1.15"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.571"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.end
.head 4 +  Message Actions 
.head 5 +  On SAM_Click
.head 6 -  Set wnPassageStat = 5000
.head 5 +  On SAM_Create
.head 6 -  Call VisWinSetStyle( hWndItem, BS_MULTILINE, TRUE )
.head 6 -  Call SalSetWindowText( hWndItem, "Update
Statitics
on DB" )
.head 3 -  Group Box: Log Format R
.head 4 -  Resource Id: 42038
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 3.533"
.head 5 -  Top: 4.024"
.head 5 -  Width:  7.15"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 1.595"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Blue
.head 4 -  Background Color: Default
.head 3 -  Group Box: Fichiers
.head 4 -  Resource Id: 60109
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.133"
.head 5 -  Top: 0.845"
.head 5 -  Width:  1.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 2.071"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Blue
.head 4 -  Background Color: Default
.head 3 -  Frame
.head 4 -  Resource Id: 42039
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 1.533"
.head 5 -  Top: 0.845"
.head 5 -  Width:  4.45"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 2.107"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Dark Gray
.head 4 -  Background Color: Light Gray
.head 3 +  Data Field: dfDateDernierEU_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 6.917"
.head 6 -  Top: 1.119"
.head 6 -  Width:  2.967"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whDateElecFR[1] = hWndItem
.head 3 +  Data Field: dfDateDernierCK_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 6.917"
.head 6 -  Top: 1.369"
.head 6 -  Width:  2.967"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whDateElecFR[2] = hWndItem
.head 3 +  Data Field: dfDateDernierSE_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 6.917"
.head 6 -  Top: 1.619"
.head 6 -  Width:  2.967"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whDateElecFR[3] = hWndItem
.head 3 +  Data Field: dfDateDernierWL_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 6.917"
.head 6 -  Top: 1.869"
.head 6 -  Width:  2.967"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whDateElecFR[4] = hWndItem
.head 3 +  Data Field: dfDateDernierVL_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 6.917"
.head 6 -  Top: 2.119"
.head 6 -  Width:  2.967"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whDateElecFR[7] = hWndItem
.head 3 +  Data Field: dfDateDernierBR_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 6.917"
.head 6 -  Top: 2.369"
.head 6 -  Width:  2.967"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whDateElecFR[10] = hWndItem
.head 3 +  Data Field: dfDateDernierDE_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 6.917"
.head 6 -  Top: 2.619"
.head 6 -  Width:  2.967"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Time
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whDateElecFR[12] = hWndItem
.head 3 -  Background Text: Date heure Format R
.head 4 -  Resource Id: 42040
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 7.017"
.head 5 -  Top: 0.929"
.head 5 -  Width:  2.517"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 3 +  Child Table: tblApp_1
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.183"
.head 6 -  Top: 6.417"
.head 6 -  Width:  13.8"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 2.964"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 10000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colGrpVis
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: GrpApp
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.967"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colGrp
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: GrpApp
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.767"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colInsBur
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: InsBur
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.017"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNoLis
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: NoLis
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  1.067"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEntId
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: EntId
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.967"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colLisId
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: LisId
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.017"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCELis
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: CELis
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCEEnt
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: CEEnt
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSiegePourvoir
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Sieges Max
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDivEl
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: DivEl
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colQuotEl
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: QuotEl
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSiegeDejaAcquis
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Sieges Acquis
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSiegeCompl
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: SiegesCompl
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSiegeParListe
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: SiegesCompl
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: PalPopulateTbl
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  String: sIns
.head 7 -  String: sInsEntite
.head 7 -  String: sBur
.head 7 -  String: sEl
.head 7 -  Receive Number: nASiege[*]
.head 7 -  Boolean: bExtrapolation
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: i
.head 7 -  Number: j
.head 7 -  String: lsGrpPrec
.head 7 -  Number: nSommeQuot
.head 7 -  Number: nSommeCE
.head 7 -  Number: nSommeSiege
.head 7 -  Number: nRow
.head 7 -  Number: lnSiegeReste
.head 7 -  Number: lnSiegeResteCalc
.head 7 -  Number: lnId
.head 7 -  Number: nQuotMax
.head 7 -  Number: nQuotMinParticipe
.head 7 -  Boolean: bAFaire
.head 6 +  Actions
.head 7 +  If bExtrapolation
.head 8 -  Set lsTableResultListes = ' RESULT_LISTES_'|| sEl ||'_EX '
.head 7 +  Else
.head 8 -  Set lsTableResultListes = ' RESULT_LISTES '
.head 7 -  Set nTypeApp = 1
.head 7 -  Call SalTblReset( tblApp_1 )
.head 7 -  Call SalTblReset( tblApp_2 )
.head 7 -  Call SalTblReset( tblApp_3 )
.head 7 -  !
.head 7 -  Set sInsEntiteApp = sIns
.head 7 -  Set sTypeBur = sBur
.head 7 -  Set sElExt = sEl
.head 7 -  ! !
.head 7 +  If sElExt = 'CK'
.head 8 -  Set nQuotMinParticipe = 0.33
.head 7 +  Else If sElExt = 'WL'
.head 8 -  Set nQuotMinParticipe = 0.66
.head 7 -  ! !
.head 7 -  ! !
.head 7 -  Set nSiegeReste[0] = 0
.head 7 -  Set nSiegeTotEntite[0] = 0
.head 7 -  Set nSiegeDejaAcquisTot[0] = 0
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select sum(ENT_NB_CDT_MAX )
	from entite
	where ENT_GRP_APP = :sInsEntiteApp and ENT_NIV_LETTRE = :sTypeBur and ENT_ELE_EXT = :sElExt
	into :nSiegeTotEntite[0] " )
.head 7 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 -  Call SqlCommit( ghSqlSecondaire)
.head 7 -  ! !
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ENT_ID
	from entite
	where ENT_GRP_APP = :sInsEntiteApp and ENT_NIV_LETTRE = :sTypeBur and ENT_ELE_EXT = :sElExt
	into :lnId " )
.head 7 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 -  Set nSiegeReste[ lnId ] = 0
.head 8 -  Set nSiegeTotEntite[ lnId ] = 0
.head 8 -  Set nSiegeDejaAcquisTot[lnId] = 0
.head 7 -  Call SqlCommit( ghSqlSecondaire)
.head 7 -  !
.head 7 -  Set sGrpPrec = ''
.head 7 -  Set nGrpPrec = NUMBER_Null
.head 7 -  Call SalTblPopulate( tblApp_1, ghSqlMain,
"Select LIS_NO,LIS_INSBUR, LIS_ENT_FK,@nullvalue(LIS_NOGROUPE, 'ZZZZ'),LIS_ID , sum( @nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0))
from Listes, " || lsTableResultListes ||"
where LIS_TYPEBUR = :sTypeBur and LIS_INSBURAPP = :sInsEntiteApp and Lis_Id = REL_LIS_FK and LIS_ELE_EXT = :sElExt
group by 1,2,3,4,5
order by 4,1,2
into :tblApp_1.colNoLis, :tblApp_1.colInsBur, :tblApp_1.colEntId, :tblApp_1.colGrp, :tblApp_1.colLisId, :tblApp_1.colCELis ", TBL_FillAll )
.head 7 -  !
.head 7 -  Set lnSiegeReste = nSiegeTotEntite[0] - nSiegeDejaAcquisTot[0]
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ENT_ID
	from entite
	where ENT_GRP_APP = :sInsEntiteApp and ENT_NIV_LETTRE = :sTypeBur and ENT_ELE_EXT = :sElExt
	into :lnId " )
.head 7 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 -  Set nSiegeReste[ lnId ] = nSiegeTotEntite[ lnId ]  - nSiegeDejaAcquisTot[lnId]
.head 7 -  Call SqlCommit( ghSqlSecondaire)
.head 7 -  !
.head 7 -  Call SalTblSetFlagsAnyRows( tblApp_3, ROW_Hidden, TRUE, ROW_New, 0 )
.head 7 -  !
.head 7 -  Set i = -1
.head 7 -  Set lsGrpPrec = ''
.head 7 -  Set nSommeQuot = 0
.head 7 -  Set nSommeSiege = 0
.head 7 -  Set nQuotMax = 0
.head 7 +  While SalTblFindNextRow( tblApp_1, i, 0,0 )
.head 8 -  Call SalTblSetContext( tblApp_1, i)
.head 8 +  If lsGrpPrec != tblApp_1.colGrpVis and i > 0
.head 9 +  If nQuotMax >= nQuotMinParticipe
.head 10 -  Set j = 1
.head 10 +  While j <= lnSiegeReste
.head 11 -  Set nRow = SalTblInsertRow( tblApp_2, TBL_MaxRow )
.head 11 -  Call SalTblSetContext( tblApp_2, nRow )
.head 11 -  Set tblApp_2.colGrp = lsGrpPrec
.head 11 -  Set tblApp_2.colCE = nSommeCE
.head 11 -  Set tblApp_2.colSiege = nSommeSiege
.head 11 -  Set tblApp_2.colDiviseur = tblApp_2.colSiege+j
.head 11 -  Set tblApp_2.colQuotient = tblApp_2.colCE/tblApp_2.colDiviseur
.head 11 +  If tblApp_1.colGrp = 'ZZZZ'
.head 12 -  Set tblApp_2.colLisIsole = 1
.head 11 +  Else
.head 12 -  Set tblApp_2.colLisIsole = 0
.head 11 -  Set tblApp_2.colOrdre = 99999
.head 11 -  Set j = j + 1
.head 9 -  !
.head 9 -  Set nSommeQuot = 0
.head 9 -  Set nSommeCE = 0
.head 9 -  Set nSommeSiege = 0
.head 9 -  Set nQuotMax = 0
.head 8 -  !
.head 8 +  If tblApp_1.colQuotEl > nQuotMax
.head 9 -  Set nQuotMax = tblApp_1.colQuotEl
.head 8 -  Set nSommeQuot = nSommeQuot + tblApp_1.colQuotEl
.head 8 -  Set nSommeCE = nSommeCE + tblApp_1.colCELis
.head 8 -  Set nSommeSiege = nSommeSiege + tblApp_1.colSiegeDejaAcquis
.head 8 -  Set lsGrpPrec = tblApp_1.colGrpVis
.head 7 +  If nQuotMax >= nQuotMinParticipe
.head 8 -  Set j = 1
.head 8 +  While j <= lnSiegeReste
.head 9 -  Set nRow = SalTblInsertRow( tblApp_2, TBL_MaxRow )
.head 9 -  Call SalTblSetContext( tblApp_2, nRow )
.head 9 -  Set tblApp_2.colGrp = lsGrpPrec
.head 9 -  Set tblApp_2.colCE = nSommeCE
.head 9 -  Set tblApp_2.colSiege = nSommeSiege
.head 9 -  Set tblApp_2.colDiviseur = tblApp_2.colSiege+j
.head 9 -  Set tblApp_2.colQuotient = tblApp_2.colCE/tblApp_2.colDiviseur
.head 9 +  If tblApp_1.colGrp = 'ZZZZ'
.head 10 -  Set tblApp_2.colLisIsole = 1
.head 9 +  Else
.head 10 -  Set tblApp_2.colLisIsole = 0
.head 9 -  Set tblApp_2.colOrdre = 99999
.head 9 -  Set j = j + 1
.head 7 -  !
.head 7 -  Call SalTblSortRows( tblApp_2, 6, TBL_SortDecreasing )
.head 7 -  !
.head 7 -  ! Listes isolées d'abord
.head 7 -  Set j = 0
.head 7 -  Set i = 1
.head 7 +  While j < lnSiegeReste
.head 8 -  Call SalTblSetContext( tblApp_2, j )
.head 8 +  If tblApp_2.colLisIsole = 1
.head 9 -  Set tblApp_2.colOrdre = i
.head 9 -  Set i = i + 1
.head 8 -  Set j = j + 1
.head 7 -  ! Listes Groupes ensuite
.head 7 -  Set j = 0
.head 7 +  While j < lnSiegeReste
.head 8 -  Call SalTblSetContext( tblApp_2, j )
.head 8 +  If tblApp_2.colLisIsole = 0
.head 9 -  Set tblApp_2.colOrdre = i
.head 9 -  Set i = i + 1
.head 8 -  Set j = j + 1
.head 7 -  !
.head 7 -  Call SalTblSortRows( tblApp_2, 7, TBL_SortIncreasing )
.head 7 -  !
.head 7 -  Set j = 0
.head 7 +  ! While j < lnSiegeReste
.head 8 -  Call SalTblSetContext( tblApp_2, j )
.head 8 -  Call tblApp_3.PalShowLine( tblApp_2.colGrp )
.head 8 +  If SalTblAnyRows( tblApp_3, 0, 0 )
.head 9 -  Set i = -1
.head 9 +  While SalTblFindNextRow( tblApp_3, i, 0, ROW_Hidden )
.head 10 -  Call SalTblSetContext( tblApp_3, i )
.head 10 +  If tblApp_3.colOrdre = 99999 and nSiegeReste[ tblApp_3.colEntId ] > 0
.head 11 -  Set tblApp_3.colOrdre = tblApp_2.colOrdre
.head 11 -  Set nSiegeReste[ tblApp_3.colEntId ] = nSiegeReste[ tblApp_3.colEntId ]-1
.head 11 -  Break 
.head 8 -  Set j = j + 1
.head 7 -  Set lnSiegeResteCalc = lnSiegeReste
.head 7 +  While lnSiegeResteCalc > 0 and j <= 100
.head 8 +  If SalTblSetContext( tblApp_2, j )
.head 9 -  Call tblApp_3.PalShowLine( tblApp_2.colGrp, bAFaire )
.head 9 +  If bAFaire
.head 10 +  If SalTblAnyRows( tblApp_3, 0, 0 )
.head 11 -  Set i = -1
.head 11 +  While SalTblFindNextRow( tblApp_3, i, 0, ROW_Hidden )
.head 12 -  Call SalTblSetContext( tblApp_3, i )
.head 12 +  If tblApp_3.colOrdre = 99999 and nSiegeReste[ tblApp_3.colEntId ] > 0
.head 13 -  Set lnSiegeResteCalc = lnSiegeResteCalc - 1 
.head 13 -  Set tblApp_3.colOrdre = lnSiegeReste - lnSiegeResteCalc
.head 13 -  Set nSiegeReste[ tblApp_3.colEntId ] = nSiegeReste[ tblApp_3.colEntId ]-1
.head 13 -  Break
.head 8 +  Else
.head 9 -  Break
.head 8 -  Set j = j + 1
.head 7 -  !
.head 7 -  Call SalTblSetFlagsAnyRows( tblApp_3, ROW_Hidden, FALSE, 0, 0 )
.head 7 -  Call SalTblSortRows( tblApp_3, 5, TBL_SortIncreasing )
.head 7 -  Call SalTblSetFlagsAnyRows( tblApp_3, ROW_Hidden, TRUE, 0, 0 )
.head 7 -  Set j = 0
.head 7 +  While j < lnSiegeReste
.head 8 -  Call SalTblSetContext( tblApp_3, j )
.head 8 -  Call SalTblSetRowFlags( tblApp_3, j, ROW_Hidden, FALSE )
.head 8 -  !
.head 8 -  Set i=-1
.head 8 +  While SalTblFindNextRow( tblApp_1, i, 0,0 )
.head 9 -  Call SalTblSetContext( tblApp_1, i )
.head 9 +  If tblApp_1.colGrpVis = tblApp_3.colGrp and tblApp_1.colEntId = tblApp_3.colEntId
.head 10 -  Set tblApp_1.colSiegeCompl = tblApp_1.colSiegeCompl +1
.head 10 -  Break
.head 8 -  !
.head 8 -  Set j = j + 1
.head 7 -  Set i=-1
.head 7 +  While SalTblFindNextRow( tblApp_1, i, 0,0 )
.head 8 -  Call SalTblSetContext( tblApp_1, i )
.head 8 -  Set tblApp_1.colSiegeParListe =tblApp_1.colSiegeDejaAcquis + tblApp_1.colSiegeCompl
.head 8 +  If tblApp_1.colInsBur != sInsEntite
.head 9 -  Call SalTblSetRowFlags( tblApp_1, i, ROW_Hidden, TRUE )
.head 8 +  ! Else
.head 9 -  Set nASiege[ SalStrToNumber( tblApp_1.colLisId ) ] = tblApp_1.colSiegeParListe
.head 7 -  Call SalTblSortRows( tblApp_1, 4, TBL_SortIncreasing )
.head 7 -  Set i=-1
.head 7 -  Set j = 0
.head 7 +  While SalTblFindNextRow( tblApp_1, i, 0,ROW_Hidden )
.head 8 -  Call SalTblSetContext( tblApp_1, i )
.head 8 -  Set nASiege[ j ] = tblApp_1.colSiegeParListe
.head 8 -  Set j = j +1
.head 7 -  !
.head 5 +  Function: PalPopulateTbl_GrpBR
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  String: sIns
.head 7 -  String: sInsEntite
.head 7 -  String: sBur
.head 7 -  String: sEl
.head 7 -  ! Boolean: bGrp_FR
.head 7 -  Receive Number: nASiege[*]
.head 7 -  Boolean: bExtrapolation
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: i
.head 7 -  Number: j
.head 7 -  Number: k
.head 7 -  String: lsGrpPrec
.head 7 -  Number: nSommeQuot
.head 7 -  Number: nSommeCE
.head 7 -  Number: nSommeSiege
.head 7 -  Number: nRow
.head 7 -  Number: lnSiegeReste
.head 7 -  Number: lnId
.head 7 -  Number: nQuotMax
.head 7 -  Number: nQuotMinParticipe
.head 7 -  ! String: lsRegLing
.head 7 -  Number: bGrp
.head 7 -  Number: nCEEnt
.head 7 -  Number: nCELis
.head 7 -  String: sNoLis
.head 7 -  String: sGrpLis
.head 7 -  String: sInPourSiege
.head 7 -  String: sInGrpListePourSiege
.head 7 -  String: sInListeNoPourSiege
.head 6 +  Actions
.head 7 -  Set nTypeApp = 2
.head 7 -  Set bGrp = 0
.head 7 +  While bGrp <= 1
.head 8 -  Call SalTblReset( tblApp_1 )
.head 8 -  Call SalTblReset( tblApp_2 )
.head 8 -  Call SalTblReset( tblApp_3 )
.head 8 -  Set nSommeQuot = 0
.head 8 -  Set nSommeCE = 0
.head 8 -  Set nSommeSiege =0
.head 8 -  Set lnSiegeReste = 0
.head 8 -  ! !
.head 8 -  Set sInsEntiteApp = sIns
.head 8 -  Set sTypeBur = sBur
.head 8 -  Set sElExt = sEl
.head 8 -  !
.head 8 -  Set nQuotMinParticipe = 0
.head 8 -  !
.head 8 -  Set nSiegeReste[0] = 0
.head 8 -  Set nSiegeTotEntite[0] = 0
.head 8 -  Set nSiegeDejaAcquisTot[0] = 0
.head 8 +  If bGrp
.head 9 -  Set nSiegeTotEntite[0] = 72
.head 9 -  Set lsRegLing = 'FF'
.head 8 +  Else
.head 9 -  Set nSiegeTotEntite[0] = 17
.head 9 -  Set lsRegLing = 'NN'
.head 8 -  !
.head 8 -  ! ! Calcul du CE par Grp linguistique
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire,
"Select sum( @nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0))
from result_Listes , listes
where LIS_TYPEBUR = :sTypeBur and LIS_INSBURAPP = :sInsEntiteApp and Lis_Id = REL_LIS_FK and LIS_ELE_EXT = :sElExt and LIS_REGLING =:lsRegLing
Into :nCEEnt " )
.head 8 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 -  Set sInGrpListePourSiege = ''
.head 8 -  Set sInListeNoPourSiege = ''
.head 8 -  Set sInPourSiege = ''
.head 8 +  If nCEEnt > 0
.head 9 -  ! Dtm des listes pouvant participé a la distrib des sieges
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire,
"Select @nullvalue(LIS_NOGROUPE, 'ZZ' || lis_NO), sum( @nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0))
from result_Listes , listes
where LIS_TYPEBUR = :sTypeBur and LIS_INSBURAPP = :sInsEntiteApp and Lis_Id = REL_LIS_FK and LIS_ELE_EXT = :sElExt and LIS_REGLING =:lsRegLing
group by 1
Into :sGrpLis, :nCELis " )
.head 9 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 10 +  If (nCELis / nCEEnt)*100 >= 5
.head 11 +  If SalStrLeftX( sGrpLis, 2 ) = 'ZZ'
.head 12 +  If sInListeNoPourSiege != ''
.head 13 -  Set sInListeNoPourSiege = sInListeNoPourSiege || ','
.head 12 -  Set sInListeNoPourSiege = sInListeNoPourSiege ||  "'" || SalStrMidX( sGrpLis, 2, SalStrLength( sGrpLis ) )  ||"'"
.head 11 +  Else
.head 12 +  If sInGrpListePourSiege != ''
.head 13 -  Set sInGrpListePourSiege = sInGrpListePourSiege || ','
.head 12 -  Set sInGrpListePourSiege = sInGrpListePourSiege || "'" || sGrpLis ||"'"
.head 9 -  !
.head 9 -  Set sInPourSiege = ''
.head 9 +  If sInListeNoPourSiege != ''
.head 10 -  Set sInPourSiege =" LIS_NO IN (" ||sInListeNoPourSiege  || ")"
.head 9 +  If sInGrpListePourSiege != ''
.head 10 +  If sInPourSiege != ''
.head 11 -  Set sInPourSiege = sInPourSiege ||' OR '
.head 10 -  Set sInPourSiege =sInPourSiege || " LIS_NOGROUPE IN (" || sInGrpListePourSiege  || ")"
.head 9 +  If sInPourSiege != ''
.head 10 -  Set sInPourSiege = " AND ( " || sInPourSiege || " ) "
.head 8 -  !
.head 8 -  ! !
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ENT_ID
	from entite
	where ENT_NIV_LETTRE = :sTypeBur and ENT_ELE_EXT = :sElExt
	into :lnId " )
.head 8 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 9 -  Set nSiegeReste[ lnId ] = 0
.head 9 -  Set nSiegeTotEntite[ lnId ] = 0
.head 9 -  Set nSiegeDejaAcquisTot[lnId] = 0
.head 8 -  !
.head 8 -  Set sGrpPrec = ''
.head 8 -  Set nGrpPrec = NUMBER_Null
.head 8 -  Call SalTblPopulate( tblApp_1, ghSqlMain,
"Select LIS_INSBUR, LIS_ENT_FK,@nullvalue(LIS_NOGROUPE, 'ZZ' || LIS_NO) , sum( @nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0))
from Listes, result_Listes
where LIS_TYPEBUR = :sTypeBur and LIS_INSBURAPP = :sInsEntiteApp and Lis_Id = REL_LIS_FK and LIS_ELE_EXT = :sElExt and LIS_REGLING =:lsRegLing
	"|| sInPourSiege || "
group by 1,2,3
order by 3,2
into  :tblApp_1.colInsBur, :tblApp_1.colEntId, :tblApp_1.colGrp, :tblApp_1.colCELis ", TBL_FillAll )
.head 8 -  ! Call SalTblPopulate( tblApp_1, ghSqlMain,
"Select LIS_NO,LIS_INSBUR, LIS_ENT_FK,@nullvalue(LIS_NOGROUPE, 'ZZZZ'),LIS_ID , sum( @nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0))
from Listes, result_Listes
where LIS_TYPEBUR = :sTypeBur and LIS_INSBURAPP = :sInsEntiteApp and Lis_Id = REL_LIS_FK and LIS_ELE_EXT = :sElExt and LIS_REGLING =:lsRegLing
	"|| sInPourSiege || "
group by 1,2,3,4,5
order by 4,1,2
into :tblApp_1.colNoLis, :tblApp_1.colInsBur, :tblApp_1.colEntId, :tblApp_1.colGrp, :tblApp_1.colLisId, :tblApp_1.colCELis ", TBL_FillAll )
.head 8 -  !
.head 8 -  Set lnSiegeReste = nSiegeTotEntite[0] - nSiegeDejaAcquisTot[0]
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ENT_ID
	from entite
	where ENT_NIV_LETTRE = :sTypeBur and ENT_ELE_EXT = :sElExt
	into :lnId " )
.head 8 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 9 -  Set nSiegeReste[ lnId ] = nSiegeTotEntite[ lnId ]  - nSiegeDejaAcquisTot[lnId]
.head 8 -  !
.head 8 -  Call SalTblSetFlagsAnyRows( tblApp_3, ROW_Hidden, TRUE, ROW_New, 0 )
.head 8 -  !
.head 8 -  Set i = -1
.head 8 -  Set lsGrpPrec = ''
.head 8 -  Set nSommeQuot = 0
.head 8 -  Set nSommeSiege = 0
.head 8 -  Set nQuotMax = 0
.head 8 +  While SalTblFindNextRow( tblApp_1, i, 0,0 )
.head 9 -  Call SalTblSetContext( tblApp_1, i)
.head 9 +  If lsGrpPrec != tblApp_1.colGrpVis and i > 0
.head 10 +  If nQuotMax >= nQuotMinParticipe
.head 11 -  Set j = 1
.head 11 +  While j <= lnSiegeReste
.head 12 -  Set nRow = SalTblInsertRow( tblApp_2, TBL_MaxRow )
.head 12 -  Call SalTblSetContext( tblApp_2, nRow )
.head 12 -  Set tblApp_2.colGrp = lsGrpPrec
.head 12 -  Set tblApp_2.colCE = nSommeCE
.head 12 -  Set tblApp_2.colSiege = nSommeSiege
.head 12 -  Set tblApp_2.colDiviseur = tblApp_2.colSiege+j
.head 12 -  Set tblApp_2.colQuotient = tblApp_2.colCE/tblApp_2.colDiviseur
.head 12 +  If tblApp_1.colGrp = 'ZZZZ'
.head 13 -  Set tblApp_2.colLisIsole = 1
.head 12 +  Else
.head 13 -  Set tblApp_2.colLisIsole = 0
.head 12 -  Set tblApp_2.colOrdre = 99999
.head 12 -  Set j = j + 1
.head 10 -  !
.head 10 -  Set nSommeQuot = 0
.head 10 -  Set nSommeCE = 0
.head 10 -  Set nSommeSiege = 0
.head 10 -  Set nQuotMax = 0
.head 9 -  !
.head 9 +  If tblApp_1.colQuotEl > nQuotMax
.head 10 -  Set nQuotMax = tblApp_1.colQuotEl
.head 9 -  Set nSommeQuot = nSommeQuot + tblApp_1.colQuotEl
.head 9 -  Set nSommeCE = nSommeCE + tblApp_1.colCELis
.head 9 -  Set nSommeSiege = nSommeSiege + tblApp_1.colSiegeDejaAcquis
.head 9 -  Set lsGrpPrec = tblApp_1.colGrpVis
.head 8 +  If nQuotMax >= nQuotMinParticipe
.head 9 -  Set j = 1
.head 9 +  While j <= lnSiegeReste
.head 10 -  Set nRow = SalTblInsertRow( tblApp_2, TBL_MaxRow )
.head 10 -  Call SalTblSetContext( tblApp_2, nRow )
.head 10 -  Set tblApp_2.colGrp = lsGrpPrec
.head 10 -  Set tblApp_2.colCE = nSommeCE
.head 10 -  Set tblApp_2.colSiege = nSommeSiege
.head 10 -  Set tblApp_2.colDiviseur = tblApp_2.colSiege+j
.head 10 -  Set tblApp_2.colQuotient = tblApp_2.colCE/tblApp_2.colDiviseur
.head 10 +  If tblApp_1.colGrp = 'ZZZZ'
.head 11 -  Set tblApp_2.colLisIsole = 1
.head 10 +  Else
.head 11 -  Set tblApp_2.colLisIsole = 0
.head 10 -  Set tblApp_2.colOrdre = 99999
.head 10 -  Set j = j + 1
.head 8 -  !
.head 8 -  Call SalTblSortRows( tblApp_2, 6, TBL_SortDecreasing )
.head 8 -  !
.head 8 -  ! Listes isolées d'abord
.head 8 -  Set j = 0
.head 8 -  Set i = 1
.head 8 +  While j < lnSiegeReste
.head 9 -  Call SalTblSetContext( tblApp_2, j )
.head 9 +  If tblApp_2.colLisIsole = 1
.head 10 -  Set tblApp_2.colOrdre = i
.head 10 -  Set i = i + 1
.head 9 -  Set j = j + 1
.head 8 -  ! Listes Groupes ensuite
.head 8 -  Set j = 0
.head 8 +  While j < lnSiegeReste
.head 9 -  Call SalTblSetContext( tblApp_2, j )
.head 9 +  If tblApp_2.colLisIsole = 0
.head 10 -  Set tblApp_2.colOrdre = i
.head 10 -  Set i = i + 1
.head 9 -  Set j = j + 1
.head 8 -  !
.head 8 -  Call SalTblSortRows( tblApp_2, 7, TBL_SortIncreasing )
.head 8 -  !
.head 8 -  Set j = 0
.head 8 +  While j < lnSiegeReste
.head 9 -  Call SalTblSetContext( tblApp_2, j )
.head 9 -  Call tblApp_3.PalShowLine_GrpBR( tblApp_2.colGrp )
.head 9 +  If SalTblAnyRows( tblApp_3, 0, 0 )
.head 10 -  Set i = -1
.head 10 +  While SalTblFindNextRow( tblApp_3, i, 0, ROW_Hidden )
.head 11 -  Call SalTblSetContext( tblApp_3, i )
.head 11 +  If tblApp_3.colOrdre = 99999 and nSiegeReste[ tblApp_3.colEntId ] > 0
.head 12 -  Set tblApp_3.colOrdre = tblApp_2.colOrdre
.head 12 -  Set nSiegeReste[ tblApp_3.colEntId ] = nSiegeReste[ tblApp_3.colEntId ]-1
.head 12 -  Break
.head 9 -  Set j = j + 1
.head 8 -  !
.head 8 -  Call SalTblSetFlagsAnyRows( tblApp_3, ROW_Hidden, FALSE, 0, 0 )
.head 8 -  Call SalTblSortRows( tblApp_3, 5, TBL_SortIncreasing )
.head 8 -  Call SalTblSetFlagsAnyRows( tblApp_3, ROW_Hidden, TRUE, 0, 0 )
.head 8 -  Set j = 0
.head 8 +  While j < lnSiegeReste
.head 9 -  Call SalTblSetContext( tblApp_3, j )
.head 9 -  Call SalTblSetRowFlags( tblApp_3, j, ROW_Hidden, FALSE )
.head 9 -  !
.head 9 -  Set i=-1
.head 9 +  While SalTblFindNextRow( tblApp_1, i, 0,0 )
.head 10 -  Call SalTblSetContext( tblApp_1, i )
.head 10 +  If tblApp_1.colGrpVis = tblApp_3.colGrp and tblApp_1.colEntId = tblApp_3.colEntId
.head 11 -  Set tblApp_1.colSiegeCompl = tblApp_1.colSiegeCompl +1
.head 11 -  Break
.head 9 -  !
.head 9 -  Set j = j + 1
.head 8 -  Set i=-1
.head 8 +  While SalTblFindNextRow( tblApp_1, i, 0,0 )
.head 9 -  Call SalTblSetContext( tblApp_1, i )
.head 9 -  Set tblApp_1.colSiegeParListe =tblApp_1.colSiegeDejaAcquis + tblApp_1.colSiegeCompl
.head 9 +  If tblApp_1.colInsBur != sInsEntite
.head 10 -  Call SalTblSetRowFlags( tblApp_1, i, ROW_Hidden, TRUE )
.head 9 +  Else
.head 10 -  ! Set nASiege[ SalStrToNumber( tblApp_1.colLisId ) ] = tblApp_1.colSiegeParListe
.head 10 +  If SalStrLeftX(tblApp_1.colGrp , 2 ) = 'ZZ'
.head 11 -  Call SqlPrepareAndExecute( ghSqlMain,
"Select LIS_ID
from Listes, result_Listes
where LIS_TYPEBUR = :sTypeBur and LIS_INSBURAPP = :sInsEntiteApp and Lis_Id = REL_LIS_FK and LIS_ELE_EXT = :sElExt and LIS_REGLING =:lsRegLing
	and LIS_NO = :tblApp_1.colNoLis
into  :lnId " )
.head 11 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 12 -  Set tblApp_1.colLisId = SalNumberToStrX( lnId , 0)
.head 12 -  Set nASiege[ SalStrToNumber( tblApp_1.colLisId ) ] = tblApp_1.colSiegeParListe
.head 10 +  Else
.head 11 -  ! Dtm des sièges au niveau du groupe
.head 11 -  Call SalTblReset( tblApp_4 )
.head 11 -  Call SqlPrepareAndExecute( ghSqlMain, "Select LIS_NO, LIS_ID , sum( @nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0))
from Listes, result_Listes
where LIS_TYPEBUR = :sTypeBur and LIS_INSBURAPP = :sInsEntiteApp and Lis_Id = REL_LIS_FK and LIS_ELE_EXT = :sElExt and LIS_REGLING =:lsRegLing
	and LIS_NOGROUPE = :tblApp_1.colGrp
Group by 1,2
order by 1
into  :sNoLis , :lnId , :nCELis " )
.head 11 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 12 -  Set j = 1
.head 12 +  While j <= tblApp_1.colSiegeParListe
.head 13 -  Set nRow = SalTblInsertRow( tblApp_4, TBL_MaxRow )
.head 13 -  Call SalTblSetContext( tblApp_4, nRow )
.head 13 -  Set tblApp_4.colNo = sNoLis
.head 13 -  Set tblApp_4.colDiviseur =  j
.head 13 -  Set tblApp_4.colFraction= nCELis / tblApp_4.colDiviseur
.head 13 -  Set tblApp_4.colLisId = lnId
.head 13 -  Set j = j + 1
.head 11 -  Call SalTblSortRows( tblApp_4, 3, TBL_SortDecreasing )
.head 11 -  Set j = -1
.head 11 -  Set k= 0
.head 11 +  While SalTblFindNextRow( tblApp_4, j, 0,0 ) and k < tblApp_1.colSiegeParListe
.head 12 -  Call SalTblSetContext( tblApp_4, j )
.head 12 -  Set nASiege[ tblApp_4.colLisId  ] = nASiege[ tblApp_4.colLisId  ] + 1
.head 12 -  Set k = k + 1
.head 8 -  !
.head 8 -  Set bGrp = bGrp +1
.head 8 -  !
.head 7 -  !
.head 4 +  Window Variables
.head 5 -  String: sGrpPrec
.head 5 -  Number: nGrpPrec
.head 5 -  Number: j
.head 5 -  Number: nRow
.head 5 -  Number: nTypeApp
.head 5 -  String: lsRegLing
.head 5 -  String: lsTableResultListes
.head 4 +  Message Actions
.head 5 +  On SAM_FetchRowDone
.head 6 +  If sElExt= 'BR'
.head 7 +  If lsRegLing = 'FF'
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire,
"Select sum( @nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0))
from  " || lsTableResultListes ||" , listes
where Lis_ent_FK = :tblApp_1.colEntId and Lis_Id = Rel_Lis_FK and LIS_RegLing = 'FF'
Into :tblApp_1.colCEEnt " )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire,
"Select sum( @nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0))
from  " || lsTableResultListes ||" , listes
where Lis_ent_FK = :tblApp_1.colEntId and Lis_Id = Rel_Lis_FK  and LIS_RegLing = 'NN'
Into :tblApp_1.colCEEnt " )
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire,
"Select sum( @nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0))
from  " || lsTableResultListes ||" , listes
where Lis_ent_FK = :tblApp_1.colEntId and Lis_Id = Rel_Lis_FK
Into :tblApp_1.colCEEnt " )
.head 6 +  If SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  ! If tblApp_1.colCEEnt>0
.head 8 +  If nTypeApp = 1
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ENT_NB_CDT_MAX
	from entite
	where ent_ins = :tblApp_1.colInsBur and ENT_NIV_LETTRE = :sTypeBur and ENT_ELE_EXT = :sElExt
	into :tblApp_1.colSiegePourvoir " )
.head 9 +  If SqlFetchNext( ghSqlSecondaire, Btmp )
.head 10 -  Set tblApp_1.colDivEl = tblApp_1.colCEEnt / tblApp_1.colSiegePourvoir
.head 10 -  Set tblApp_1.colQuotEl = tblApp_1.colCELis / tblApp_1.colDivEl
.head 10 -  Set tblApp_1.colSiegeDejaAcquis = SalNumberRound( tblApp_1.colQuotEl - 0.4999999999999)
.head 10 -  !
.head 10 -  Set nSiegeDejaAcquisTot[0] = nSiegeDejaAcquisTot[0] + tblApp_1.colSiegeDejaAcquis
.head 10 -  Set nSiegeDejaAcquisTot[tblApp_1.colEntId ] = nSiegeDejaAcquisTot[tblApp_1.colEntId] + tblApp_1.colSiegeDejaAcquis
.head 10 -  Set nSiegeTotEntite[tblApp_1.colEntId ] = tblApp_1.colSiegePourvoir
.head 8 +  Else
.head 9 -  Set tblApp_1.colSiegePourvoir = nSiegeTotEntite[0]
.head 9 -  Set tblApp_1.colDivEl = tblApp_1.colCEEnt / tblApp_1.colSiegePourvoir
.head 9 -  Set tblApp_1.colQuotEl = tblApp_1.colCELis / tblApp_1.colDivEl
.head 9 -  Set tblApp_1.colSiegeDejaAcquis = SalNumberRound( tblApp_1.colQuotEl - 0.4999999999999)
.head 9 -  !
.head 9 -  Set nSiegeDejaAcquisTot[0] = nSiegeDejaAcquisTot[0] + tblApp_1.colSiegeDejaAcquis
.head 9 -  Set nSiegeDejaAcquisTot[tblApp_1.colEntId ] = nSiegeDejaAcquisTot[tblApp_1.colEntId] + tblApp_1.colSiegeDejaAcquis
.head 9 -  Set nSiegeTotEntite[tblApp_1.colEntId ] = tblApp_1.colSiegePourvoir
.head 7 +  If tblApp_1.colCEEnt > 0
.head 8 +  If nTypeApp = 1
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ENT_NB_CDT_MAX
	from entite
	where ent_ins = :tblApp_1.colInsBur and ENT_NIV_LETTRE = :sTypeBur and ENT_ELE_EXT = :sElExt
	into :tblApp_1.colSiegePourvoir " )
.head 9 +  If SqlFetchNext( ghSqlSecondaire, Btmp )
.head 10 -  Set tblApp_1.colDivEl = tblApp_1.colCEEnt / tblApp_1.colSiegePourvoir
.head 10 -  Set tblApp_1.colQuotEl = tblApp_1.colCELis / tblApp_1.colDivEl
.head 10 -  Set tblApp_1.colSiegeDejaAcquis = SalNumberRound( tblApp_1.colQuotEl - 0.4999999999999)
.head 10 -  !
.head 10 -  Set nSiegeDejaAcquisTot[0] = nSiegeDejaAcquisTot[0] + tblApp_1.colSiegeDejaAcquis
.head 10 -  Set nSiegeDejaAcquisTot[tblApp_1.colEntId ] = nSiegeDejaAcquisTot[tblApp_1.colEntId] + tblApp_1.colSiegeDejaAcquis
.head 10 -  Set nSiegeTotEntite[tblApp_1.colEntId ] = tblApp_1.colSiegePourvoir
.head 8 +  Else
.head 9 -  Set tblApp_1.colSiegePourvoir = nSiegeTotEntite[0]
.head 9 -  Set tblApp_1.colDivEl = tblApp_1.colCEEnt / tblApp_1.colSiegePourvoir
.head 9 -  Set tblApp_1.colQuotEl = tblApp_1.colCELis / tblApp_1.colDivEl
.head 9 -  Set tblApp_1.colSiegeDejaAcquis = SalNumberRound( tblApp_1.colQuotEl - 0.4999999999999)
.head 9 -  !
.head 9 -  Set nSiegeDejaAcquisTot[0] = nSiegeDejaAcquisTot[0] + tblApp_1.colSiegeDejaAcquis
.head 9 -  Set nSiegeDejaAcquisTot[tblApp_1.colEntId ] = nSiegeDejaAcquisTot[tblApp_1.colEntId] + tblApp_1.colSiegeDejaAcquis
.head 9 -  Set nSiegeTotEntite[tblApp_1.colEntId ] = tblApp_1.colSiegePourvoir
.head 6 +  If SalStrLeftX( tblApp_1.colGrp, 2) = 'ZZ' and sElExt= 'BR'
.head 7 -  Set nGrpPrec = nGrpPrec + 1
.head 7 -  Set tblApp_1.colNoLis = SalStrToNumber( SalStrMidX( tblApp_1.colGrp, 2 , SalStrLength( tblApp_1.colGrp )) )
.head 7 -  ! Set tblApp_1.colGrpVis = SalNumberToChar( nGrpPrec )
.head 7 -  Set tblApp_1.colGrpVis = SalStrRightX( '00' || SalNumberToStrX( tblApp_1.colNoLis ,0) ,2) || ' - ' || tblApp_1.colInsBur
.head 7 -  Set sGrpPrec = tblApp_1.colGrpVis
.head 6 +  Else If tblApp_1.colGrp = 'ZZZZ' and  sElExt != 'BR' 
.head 7 -  Set nGrpPrec = nGrpPrec + 1
.head 7 -  Set tblApp_1.colGrpVis = SalNumberToChar( nGrpPrec )
.head 7 -  ! Set tblApp_1.colGrpVis = SalStrRightX( '00' || SalNumberToStrX(tblApp_1.colNoLis,0) ,2) || ' - ' || tblApp_1.colInsBur
.head 7 -  Set sGrpPrec = tblApp_1.colGrpVis
.head 6 +  Else
.head 7 +  If nTypeApp = 1
.head 8 -  Set tblApp_1.colGrpVis = tblApp_1.colGrp
.head 8 -  Set sGrpPrec =  tblApp_1.colGrp
.head 7 +  Else
.head 8 -  Set tblApp_1.colGrpVis = tblApp_1.colGrp || SalStrRightX( '00' || SalNumberToStrX(tblApp_1.colNoLis,0) ,2)
.head 8 -  Set sGrpPrec =  tblApp_1.colGrp
.head 7 -  Call SalStrFirstC( sGrpPrec, nGrpPrec )
.head 6 -  Set tblApp_1.colSiegeCompl=0
.head 6 -  Set tblApp_1.colSiegeParListe =0
.head 6 -  ! !
.head 6 -  Set j = 1
.head 6 +  While j <= 10
.head 7 -  Set nRow = SalTblInsertRow( tblApp_3, TBL_MaxRow )
.head 7 -  Call SalTblSetContext( tblApp_3, nRow )
.head 7 -  ! Call SalTblSetRowFlags( tblApp_3, nRow, ROW_New, FALSE )
.head 7 -  Set tblApp_3.colGrp = tblApp_1.colGrpVis
.head 7 -  Set tblApp_3.colDiviseur = tblApp_1.colSiegeDejaAcquis + j
.head 7 -  Set tblApp_3.colInsBur = tblApp_1.colInsBur
.head 7 -  Set tblApp_3.colFractionLoc = tblApp_1.colQuotEl / tblApp_3.colDiviseur
.head 7 -  Set tblApp_3.colOrdre = 99999
.head 7 -  Set tblApp_3.colEntId = tblApp_1.colEntId
.head 7 -  Set j = j + 1
.head 3 +  Child Table: tblApp_2
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.183"
.head 6 -  Top: 9.452"
.head 6 -  Width:  7.9"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 3.429"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 10000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colGrp
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Grp
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.917"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colLisIsole
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Lis.Isole
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.817"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCE
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: CE Grp
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSiege
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Sieges Grp
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  1.017"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDiviseur
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Diviseur
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colQuotient
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Quotient
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colOrdre
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Ordre
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.65"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 +  Window Variables
.head 5 -  Boolean: bAfaire
.head 4 +  Message Actions
.head 5 +  On SAM_RowHeaderClick
.head 6 -  Call tblApp_3.PalShowLine( tblApp_2.colGrp, bAfaire )
.head 3 +  Child Table: tblApp_3
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 8.267"
.head 6 -  Top: 9.476"
.head 6 -  Width:  5.267"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 3.393"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 10000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colGrp
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Grp
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.817"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colInsBur
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: InsBur
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.933"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDiviseur
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Div
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.683"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFractionLoc
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: FractLoc
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colOrdre
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Ordre
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.883"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEntId
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: EntId
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.883"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: PalShowLine
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  String: sGrp
.head 7 -  Receive Boolean: bAfaire
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: i
.head 6 +  Actions
.head 7 -  Set bAfaire = FALSE
.head 7 -  Call SalTblSetFlagsAnyRows( tblApp_3, ROW_Hidden, TRUE, 0, 0 )
.head 7 -  Set i = -1
.head 7 +  While SalTblFindNextRow( tblApp_3, i, ROW_Hidden,0 )
.head 8 -  Call SalTblSetContext( tblApp_3, i )
.head 8 +  If tblApp_3.colGrp = sGrp
.head 9 -  Call SalTblSetRowFlags( tblApp_3, i, ROW_Hidden, FALSE )
.head 9 +  If nSiegeReste[ tblApp_3.colEntId ] > 0
.head 10 -  Set bAfaire = TRUE
.head 8 +  Else
.head 9 -  Call SalTblSetRowFlags( tblApp_3, i, ROW_Hidden, TRUE )
.head 7 -  !
.head 7 -  Call SalTblSortRows( tblApp_3, 4, TBL_SortDecreasing )
.head 5 +  Function: PalShowLine_GrpBR
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  String: sGrp
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: i
.head 6 +  Actions
.head 7 -  Call SalTblSetFlagsAnyRows( tblApp_3, ROW_Hidden, TRUE, 0, 0 )
.head 7 -  Set i = -1
.head 7 +  While SalTblFindNextRow( tblApp_3, i, ROW_Hidden,0 )
.head 8 -  Call SalTblSetContext( tblApp_3, i )
.head 8 +  If tblApp_3.colGrp = sGrp
.head 9 -  Call SalTblSetRowFlags( tblApp_3, i, ROW_Hidden, FALSE )
.head 8 +  Else
.head 9 -  Call SalTblSetRowFlags( tblApp_3, i, ROW_Hidden, TRUE )
.head 7 -  !
.head 7 -  Call SalTblSortRows( tblApp_3, 4, TBL_SortDecreasing )
.head 4 -  Window Variables
.head 4 -  Message Actions
.head 3 +  Child Table: tblApp_4
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6537000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 18.683"
.head 6 -  Top: 4.464"
.head 6 -  Width:  4.05"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 3.619"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Arial Narrow
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: 10000
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colNo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: No
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.98"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colDiviseur
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Div
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.683"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFraction
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: FractLoc
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  1.26"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colLisId
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: EntId
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  0.883"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalTblSetTableFlags(hWndItem,TBL_Flag_SingleSelection,TRUE)
.head 3 -  !
.head 3 -  !
.head 3 +  Check Box: cbEU
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: EU
.head 4 -  Window Location and Size
.head 5 -  Left: 1.783"
.head 5 -  Top: 1.131"
.head 5 -  Width:  0.75"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElec[1] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set MyValue = TRUE
.head 6 +  Else If wParam = -1
.head 7 -  Set gbTrue = MyValue
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 5 +  On SAM_Click
.head 6 +  If wParam != 5
.head 7 -  Set MyValue = PalLibereActiveElection( 1, MyValue )
.head 6 +  If MyValue = TRUE
.head 7 -  Set cbEU_FR = TRUE
.head 6 +  Else
.head 7 -  Set cbEU_FR = FALSE
.head 6 -  Call SalSendMsg( cbEU_FR, SAM_Click, 0,0 )
.head 3 +  Check Box: cbCK
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: CK
.head 4 -  Window Location and Size
.head 5 -  Left: 1.783"
.head 5 -  Top: 1.381"
.head 5 -  Width:  0.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElec[2] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set MyValue = TRUE
.head 6 +  Else If wParam = -1
.head 7 -  Set gbTrue = MyValue
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 5 +  On SAM_Click
.head 6 +  If wParam != 5
.head 7 -  Set MyValue = PalLibereActiveElection( 2, MyValue )
.head 6 +  If MyValue = TRUE
.head 7 -  Set cbCK_FR = TRUE
.head 6 +  Else
.head 7 -  Set cbCK_FR = FALSE
.head 6 -  Call SalSendMsg( cbCK_FR, SAM_Click, 0,0 )
.head 3 +  Check Box: cbSE
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: SE
.head 4 -  Window Location and Size
.head 5 -  Left: 1.783"
.head 5 -  Top: 1.631"
.head 5 -  Width:  0.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElec[3] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set MyValue = TRUE
.head 6 +  Else If wParam = -1
.head 7 -  Set gbTrue = MyValue
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 5 +  On SAM_Click
.head 6 +  If wParam != 5
.head 7 -  Set MyValue = PalLibereActiveElection(3, MyValue )
.head 6 +  If MyValue = TRUE
.head 7 -  Set cbSE_FR = TRUE
.head 6 +  Else
.head 7 -  Set cbSE_FR = FALSE
.head 6 -  Call SalSendMsg( cbSE_FR, SAM_Click, 0,0 )
.head 3 +  Check Box: cbWL
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: WL
.head 4 -  Window Location and Size
.head 5 -  Left: 1.783"
.head 5 -  Top: 1.881"
.head 5 -  Width:  0.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElec[4] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set MyValue = TRUE
.head 6 +  Else If wParam = -1
.head 7 -  Set gbTrue = MyValue
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 5 +  On SAM_Click
.head 6 +  If wParam != 5
.head 7 -  Set MyValue = PalLibereActiveElection( 4, MyValue )
.head 6 +  If MyValue = TRUE
.head 7 -  Set cbWL_FR = TRUE
.head 6 +  Else
.head 7 -  Set cbWL_FR = FALSE
.head 6 -  Call SalSendMsg( cbWL_FR, SAM_Click, 0,0 )
.head 3 +  Check Box: cbVL
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: VL
.head 4 -  Window Location and Size
.head 5 -  Left: 1.783"
.head 5 -  Top: 2.131"
.head 5 -  Width:  0.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElec[7] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set MyValue = TRUE
.head 6 +  Else If wParam = -1
.head 7 -  Set gbTrue = MyValue
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 5 +  On SAM_Click
.head 6 +  If wParam != 5
.head 7 -  Set MyValue = PalLibereActiveElection( 7, MyValue )
.head 6 +  If MyValue = TRUE
.head 7 -  Set cbVL_FR = TRUE
.head 6 +  Else
.head 7 -  Set cbVL_FR = FALSE
.head 6 -  Call SalSendMsg( cbVL_FR, SAM_Click, 0,0 )
.head 3 +  Check Box: cbBR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: BR
.head 4 -  Window Location and Size
.head 5 -  Left: 1.783"
.head 5 -  Top: 2.381"
.head 5 -  Width:  0.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElec[10] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set MyValue = TRUE
.head 6 +  Else If wParam = -1
.head 7 -  Set gbTrue = MyValue
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 5 +  On SAM_Click
.head 6 +  If wParam != 5
.head 7 -  Set MyValue = PalLibereActiveElection( 10, MyValue )
.head 6 +  If MyValue = TRUE
.head 7 -  Set cbBR_FR = TRUE
.head 6 +  Else
.head 7 -  Set cbBR_FR = FALSE
.head 6 -  Call SalSendMsg( cbBR_FR, SAM_Click, 0,0 )
.head 3 +  Check Box: cbDE
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: DE
.head 4 -  Window Location and Size
.head 5 -  Left: 1.783"
.head 5 -  Top: 2.631"
.head 5 -  Width:  0.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElec[12] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set MyValue = TRUE
.head 6 +  Else If wParam = -1
.head 7 -  Set gbTrue = MyValue
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 5 +  On SAM_Click
.head 6 +  If wParam != 5
.head 7 -  Set MyValue = PalLibereActiveElection( 12, MyValue )
.head 6 +  If MyValue = TRUE
.head 7 -  Set cbDE_FR = TRUE
.head 6 +  Else
.head 7 -  Set cbDE_FR = FALSE
.head 6 -  Call SalSendMsg( cbDE_FR, SAM_Click, 0,0 )
.head 3 -  !
.head 3 -  !
.head 3 +  Check Box: cbEU_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ok
.head 4 -  Window Location and Size
.head 5 -  Left: 6.083"
.head 5 -  Top: 1.119"
.head 5 -  Width:  0.85"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecFR[1] = hWndItem
.head 5 +  On SAM_Click
.head 6 +  If MyValue = TRUE
.head 7 -  Call SalSetWindowText( hWndItem, "OUI" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_LightGray )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_DarkGreen )
.head 7 -  Call SalEnableWindow( pbREU )
.head 6 +  Else
.head 7 -  Call SalSetWindowText( hWndItem, "non" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_White )
.head 7 -  Call SalDisableWindow( pbREU )
.head 3 +  Check Box: cbCK_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ok
.head 4 -  Window Location and Size
.head 5 -  Left: 6.083"
.head 5 -  Top: 1.369"
.head 5 -  Width:  0.85"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecFR[2] = hWndItem
.head 5 +  On SAM_Click
.head 6 +  If MyValue = TRUE
.head 7 -  Call SalSetWindowText( hWndItem, "OUI" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_LightGray )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_DarkGreen )
.head 7 -  Call SalEnableWindow( pbRCK)
.head 6 +  Else
.head 7 -  Call SalSetWindowText( hWndItem, "non" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_White )
.head 7 -  Call SalDisableWindow( pbRCK )
.head 3 +  Check Box: cbSE_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ok
.head 4 -  Window Location and Size
.head 5 -  Left: 6.083"
.head 5 -  Top: 1.619"
.head 5 -  Width:  0.85"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecFR[3] = hWndItem
.head 5 +  On SAM_Click
.head 6 +  If MyValue = TRUE
.head 7 -  Call SalSetWindowText( hWndItem, "OUI" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_LightGray )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_DarkGreen )
.head 7 -  Call SalEnableWindow( pbRSE )
.head 6 +  Else
.head 7 -  Call SalSetWindowText( hWndItem, "non" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_White )
.head 7 -  Call SalDisableWindow( pbRSE )
.head 3 +  Check Box: cbWL_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ok
.head 4 -  Window Location and Size
.head 5 -  Left: 6.083"
.head 5 -  Top: 1.869"
.head 5 -  Width:  0.85"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecFR[4] = hWndItem
.head 5 +  On SAM_Click
.head 6 +  If MyValue = TRUE
.head 7 -  Call SalSetWindowText( hWndItem, "OUI" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_LightGray )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_DarkGreen )
.head 7 -  Call SalEnableWindow( pbRWL )
.head 6 +  Else
.head 7 -  Call SalSetWindowText( hWndItem, "non" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_White )
.head 7 -  Call SalDisableWindow( pbRWL )
.head 3 +  Check Box: cbVL_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ok
.head 4 -  Window Location and Size
.head 5 -  Left: 6.083"
.head 5 -  Top: 2.119"
.head 5 -  Width:  0.85"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecFR[7] = hWndItem
.head 5 +  On SAM_Click
.head 6 +  If MyValue = TRUE
.head 7 -  Call SalSetWindowText( hWndItem, "OUI" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_LightGray )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_DarkGreen )
.head 7 -  Call SalEnableWindow( pbRVL )
.head 6 +  Else
.head 7 -  Call SalSetWindowText( hWndItem, "non" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_White )
.head 7 -  Call SalDisableWindow( pbRVL )
.head 3 +  Check Box: cbBR_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ok
.head 4 -  Window Location and Size
.head 5 -  Left: 6.083"
.head 5 -  Top: 2.369"
.head 5 -  Width:  0.85"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecFR[10] = hWndItem
.head 5 +  On SAM_Click
.head 6 +  If MyValue = TRUE
.head 7 -  Call SalSetWindowText( hWndItem, "OUI" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_LightGray )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_DarkGreen )
.head 7 -  Call SalEnableWindow( pbRBR )
.head 6 +  Else
.head 7 -  Call SalSetWindowText( hWndItem, "non" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_White )
.head 7 -  Call SalDisableWindow( pbRBR )
.head 3 +  Check Box: cbDE_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ok
.head 4 -  Window Location and Size
.head 5 -  Left: 6.083"
.head 5 -  Top: 2.619"
.head 5 -  Width:  0.85"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecFR[12] = hWndItem
.head 5 +  On SAM_Click
.head 6 +  If MyValue = TRUE
.head 7 -  Call SalSetWindowText( hWndItem, "OUI" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_LightGray )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_DarkGreen )
.head 7 -  Call SalEnableWindow( pbRDE )
.head 6 +  Else
.head 7 -  Call SalSetWindowText( hWndItem, "non" )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 -  Call SalColorSet( hWndItem, COLOR_IndexWindowText, COLOR_White )
.head 7 -  Call SalDisableWindow( pbRDE )
.head 3 -  !
.head 3 -  !
.head 3 +  Check Box: cbEU_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: .
.head 4 -  Window Location and Size
.head 5 -  Left: 10.583"
.head 5 -  Top: 1.131"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Light Gray
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecElu[1] = hWndItem
.head 6 -  Call SalDisableWindow( hWndItem )
.head 5 +  On SAM_Click
.head 6 +  If cbEU_FR
.head 7 +  If MyValue = TRUE
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_DarkGreen )
.head 7 +  Else
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 +  If NOT PalDiffuseElus( 1, MyValue, 'EU' )
.head 8 +  If MyValue = TRUE
.head 9 -  Set MyValue = FALSE
.head 8 +  Else
.head 9 -  Set MyValue = TRUE
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 7 -  Call SalSetFocus( hWndNULL )
.head 3 +  Check Box: cbCK_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: .
.head 4 -  Window Location and Size
.head 5 -  Left: 10.583"
.head 5 -  Top: 1.381"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Light Gray
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecElu[2] = hWndItem
.head 6 -  Call SalDisableWindow( hWndItem )
.head 5 +  On SAM_Click
.head 6 +  If cbCK_FR
.head 7 +  ! If MyValue = TRUE
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_DarkGreen )
.head 7 +  ! Else
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 +  If NOT PalDiffuseElus( 2, MyValue, 'CK' )
.head 8 +  If MyValue = TRUE
.head 9 -  Set MyValue = FALSE
.head 8 +  Else
.head 9 -  Set MyValue = TRUE
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 7 -  Call SalSetFocus( hWndNULL )
.head 3 +  Check Box: cbSE_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: .
.head 4 -  Window Location and Size
.head 5 -  Left: 10.583"
.head 5 -  Top: 1.631"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Light Gray
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecElu[3] = hWndItem
.head 6 -  Call SalDisableWindow( hWndItem )
.head 5 +  On SAM_Click
.head 6 +  If cbSE_FR
.head 7 +  ! If MyValue = TRUE
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_DarkGreen )
.head 7 +  ! Else
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 +  If NOT PalDiffuseElus( 3, MyValue, 'SE' )
.head 8 +  If MyValue = TRUE
.head 9 -  Set MyValue = FALSE
.head 8 +  Else
.head 9 -  Set MyValue = TRUE
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 7 -  Call SalSetFocus( hWndNULL )
.head 3 +  Check Box: cbWL_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: .
.head 4 -  Window Location and Size
.head 5 -  Left: 10.583"
.head 5 -  Top: 1.881"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Light Gray
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecElu[4] = hWndItem
.head 6 -  Call SalDisableWindow( hWndItem )
.head 5 +  On SAM_Click
.head 6 +  If cbWL_FR
.head 7 +  ! If MyValue = TRUE
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_DarkGreen )
.head 7 +  ! Else
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 +  If NOT PalDiffuseElus( 4, MyValue, 'WL' )
.head 8 +  If MyValue = TRUE
.head 9 -  Set MyValue = FALSE
.head 8 +  Else
.head 9 -  Set MyValue = TRUE
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 7 -  Call SalSetFocus( hWndNULL )
.head 3 +  Check Box: cbVL_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: .
.head 4 -  Window Location and Size
.head 5 -  Left: 10.583"
.head 5 -  Top: 2.131"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Light Gray
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecElu[7] = hWndItem
.head 6 -  Call SalDisableWindow( hWndItem )
.head 5 +  On SAM_Click
.head 6 +  If cbVL_FR
.head 7 +  ! If MyValue = TRUE
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_DarkGreen )
.head 7 +  ! Else
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 +  If not PalDiffuseElus( 7, MyValue, 'VL' )
.head 8 +  If MyValue = TRUE
.head 9 -  Set MyValue = FALSE
.head 8 +  Else
.head 9 -  Set MyValue = TRUE
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 7 -  Call SalSetFocus( hWndNULL )
.head 3 +  Check Box: cbBR_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: .
.head 4 -  Window Location and Size
.head 5 -  Left: 10.583"
.head 5 -  Top: 2.381"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Light Gray
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecElu[10] = hWndItem
.head 6 -  Call SalDisableWindow( hWndItem )
.head 5 +  On SAM_Click
.head 6 +  If cbBR_FR
.head 7 +  ! If MyValue = TRUE
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_DarkGreen )
.head 7 +  ! Else
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 +  If NOT PalDiffuseElus( 10, MyValue, 'BR' )
.head 8 +  If MyValue = TRUE
.head 9 -  Set MyValue = FALSE
.head 8 +  Else
.head 9 -  Set MyValue = TRUE
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 7 -  Call SalSetFocus( hWndNULL )
.head 3 +  Check Box: cbDE_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: .
.head 4 -  Window Location and Size
.head 5 -  Left: 10.583"
.head 5 -  Top: 2.631"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Light Gray
.head 4 -  Background Color: Light Gray
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whCbElecElu[12] = hWndItem
.head 6 -  Call SalDisableWindow( hWndItem )
.head 5 +  On SAM_Click
.head 6 +  If cbDE_FR
.head 7 +  ! If MyValue = TRUE
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_DarkGreen )
.head 7 +  ! Else
.head 8 -  Call SalColorSet( hWndItem, COLOR_IndexWindow, COLOR_Salmon )
.head 7 +  If NOT PalDiffuseElus( 12, MyValue, 'DE' )
.head 8 +  If MyValue = TRUE
.head 9 -  Set MyValue = FALSE
.head 8 +  Else
.head 9 -  Set MyValue = TRUE
.head 6 +  Else
.head 7 -  Set MyValue = FALSE
.head 7 -  Call SalSetFocus( hWndNULL )
.head 3 +  Pushbutton: pbResetActif
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Reset Actif
.head 4 -  Window Location and Size
.head 5 -  Left: 10.183"
.head 5 -  Top: 0.238"
.head 5 -  Width:  1.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: F12
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set wbClickOn = FALSE
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalSendMsg( pbStop, SAM_Click, 0,0 )
.head 7 -  Set wbClickOn = TRUE
.head 6 -  Call SalModalDialog(dlgPW, hWndForm, 'VIDER', wbOk)
.head 6 +  If wbOk
.head 7 +  If SalMessageBox("Désirez-vous réinitailaiser les élections activées pas LOC2 ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 8 -  Call VisWaitCursor( TRUE )
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Update Election set  ELE_LOC2_ACTIF = 0 where ele_lettre in ('"|| VisStrSubstitute(gsGestionElectionType, ",", "','") ||"')" )
.head 8 -  Call SqlCommit( ghSqlMain )
.head 8 -  Call VisWaitCursor( FALSE)
.head 8 -  Call PalCheckRepertoire( 0 )
.head 8 -  Call PalNoteVersion(  )
.head 8 -  Call PalDtmTitre()
.head 6 +  Else
.head 7 -  Call SalMessageBox("Erreur de mot de passe", "Ereur", MB_Ok | MB_IconHand ) 
.head 6 -  !
.head 6 +  If wbClickOn
.head 7 -  Call SalSendMsg( pbAction , SAM_Click, 0,0 )
.head 3 +  Data Field: dfEU_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.033"
.head 6 -  Top: 1.167"
.head 6 -  Width:  0.45"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whMod_FR[1] = hWndItem
.head 3 +  Data Field: dfCK_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.033"
.head 6 -  Top: 1.417"
.head 6 -  Width:  0.45"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whMod_FR[2] = hWndItem
.head 3 +  Data Field: dfSE_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.033"
.head 6 -  Top: 1.667"
.head 6 -  Width:  0.45"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whMod_FR[3] = hWndItem
.head 3 +  Data Field: dfWL_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.033"
.head 6 -  Top: 1.917"
.head 6 -  Width:  0.45"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whMod_FR[4] = hWndItem
.head 3 +  Data Field: dfVL_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.033"
.head 6 -  Top: 2.167"
.head 6 -  Width:  0.45"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whMod_FR[7] = hWndItem
.head 3 +  Data Field: dfBR_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.033"
.head 6 -  Top: 2.417"
.head 6 -  Width:  0.45"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whMod_FR[10] = hWndItem
.head 3 +  Data Field: dfDE_FR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.033"
.head 6 -  Top: 2.667"
.head 6 -  Width:  0.45"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whMod_FR[12] = hWndItem
.head 3 +  Data Field: dfEU_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.783"
.head 6 -  Top: 1.167"
.head 6 -  Width:  0.25"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whElu_FR[1] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set cbEU_Elu = TRUE
.head 6 +  Else
.head 7 -  Set cbEU_Elu = FALSE
.head 3 +  Data Field: dfCK_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.783"
.head 6 -  Top: 1.417"
.head 6 -  Width:  0.25"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whElu_FR[2] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set cbCK_Elu = TRUE
.head 6 +  Else
.head 7 -  Set cbCK_Elu = FALSE
.head 3 +  Data Field: dfSE_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.783"
.head 6 -  Top: 1.667"
.head 6 -  Width:  0.25"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whElu_FR[3] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set cbSE_Elu = TRUE
.head 6 +  Else
.head 7 -  Set cbSE_Elu = FALSE
.head 3 +  Data Field: dfWL_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.783"
.head 6 -  Top: 1.917"
.head 6 -  Width:  0.25"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whElu_FR[4] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set cbWL_Elu = TRUE
.head 6 +  Else
.head 7 -  Set cbWL_Elu = FALSE
.head 3 +  Data Field: dfVL_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.783"
.head 6 -  Top: 2.167"
.head 6 -  Width:  0.25"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whElu_FR[7] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set cbVL_Elu = TRUE
.head 6 +  Else
.head 7 -  Set cbVL_Elu = FALSE
.head 3 +  Data Field: dfBR_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.783"
.head 6 -  Top: 2.417"
.head 6 -  Width:  0.25"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whElu_FR[10] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set cbBR_Elu = TRUE
.head 6 +  Else
.head 7 -  Set cbBR_Elu = FALSE
.head 3 +  Data Field: dfDE_Elu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.783"
.head 6 -  Top: 2.667"
.head 6 -  Width:  0.25"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.179"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Set whElu_FR[12] = hWndItem
.head 5 +  On SAM_AnyEdit
.head 6 +  If wParam = 1
.head 7 -  Set cbDE_Elu = TRUE
.head 6 +  Else
.head 7 -  Set cbDE_Elu = FALSE
.head 3 -  Frame
.head 4 -  Resource Id: 42041
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 5.983"
.head 5 -  Top: 0.845"
.head 5 -  Width:  6.1"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 2.107"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Gray
.head 4 -  Background Color: Light Gray
.head 3 -  Background Text: Format R
.head 4 -  Resource Id: 42042
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 7.783"
.head 5 -  Top: 3.0"
.head 5 -  Width:  0.95"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: 3D Face Color
.head 3 -  Background Text: Fichier(s) à traiter:
.head 4 -  Resource Id: 42043
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 3.6"
.head 5 -  Top: 3.512"
.head 5 -  Width:  1.833"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: 3D Face Color
.head 3 +  Data Field: dfVersionIR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 3
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 6.333"
.head 6 -  Top: 3.738"
.head 6 -  Width:  0.75"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: 3D Face Color
.head 5 -  Input Mask: 999
.head 4 +  Message Actions
.head 5 +  On SAM_Validate
.head 6 +  If SalStrToNumber(  dfVersionIR ) > SalStrToNumber(  gsVersionFichierOut )
.head 7 -  Set gsVersionFichierOut = dfVersionIR
.head 7 -  Call SalSetProfileString( 'VERSION', 'VERSION_FICHIER', gsVersionFichierOut, wsPathINI )
.head 6 +  Else
.head 7 -  Call SalMessageBox( "La version ne peut pas être inférieure à la précédente !!","ERREUR", MB_Ok | MB_IconHand )
.head 7 -  Set dfVersionIR = gsVersionFichierOut
.head 6 -  Set wnPassage = 0
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 5 +  On SAM_AnyEdit
.head 6 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 3 -  Background Text: Version Formats I / R:
.head 4 -  Resource Id: 31013
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 3.583"
.head 5 -  Top: 3.762"
.head 5 -  Width:  2.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: 3D Face Color
.head 3 +  Check Box: cbSaveHistoElu
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: SAUVE HISTO ELUS
.head 4 -  Window Location and Size
.head 5 -  Left: 2.133"
.head 5 -  Top: 6.06"
.head 5 -  Width:  2.55"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Blue
.head 4 -  Background Color: Maize
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set gbSauveEluHisto = cbSaveHistoElu
.head 3 +  Pushbutton: pbREU
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: R EU
.head 4 -  Window Location and Size
.head 5 -  Left: 11.433"
.head 5 -  Top: 1.131"
.head 5 -  Width:  0.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.2"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalGenereUnFormatR( 0, 1 )
.head 6 -  Set wbFormatRManuel = TRUE
.head 6 -  Set wbResultat = TRUE
.head 6 +  If SalIsWindowEnabled( pbAction )
.head 7 -  Set gbKillTimer = FALSE
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 100 )
.head 3 +  Pushbutton: pbRCK
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: R CK
.head 4 -  Window Location and Size
.head 5 -  Left: 11.433"
.head 5 -  Top: 1.381"
.head 5 -  Width:  0.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.2"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalGenereUnFormatR( 0, 2 )
.head 6 -  Set wbFormatRManuel = TRUE
.head 6 -  Set wbResultat = TRUE
.head 6 +  If SalIsWindowEnabled( pbAction )
.head 7 -  Set gbKillTimer = FALSE
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 100 )
.head 3 +  Pushbutton: pbRSE
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: R SE
.head 4 -  Window Location and Size
.head 5 -  Left: 11.433"
.head 5 -  Top: 1.631"
.head 5 -  Width:  0.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.2"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalGenereUnFormatR( 0, 3 )
.head 6 -  Set wbFormatRManuel = TRUE
.head 6 -  Set wbResultat = TRUE
.head 6 +  If SalIsWindowEnabled( pbAction )
.head 7 -  Set gbKillTimer = FALSE
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 100 )
.head 3 +  Pushbutton: pbRWL
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: R WL
.head 4 -  Window Location and Size
.head 5 -  Left: 11.433"
.head 5 -  Top: 1.881"
.head 5 -  Width:  0.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.2"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalGenereUnFormatR( 0, 4 )
.head 6 -  Set wbFormatRManuel = TRUE
.head 6 -  Set wbResultat = TRUE
.head 6 +  If SalIsWindowEnabled( pbAction )
.head 7 -  Set gbKillTimer = FALSE
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 100 )
.head 3 +  Pushbutton: pbRVL
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: R VL
.head 4 -  Window Location and Size
.head 5 -  Left: 11.433"
.head 5 -  Top: 2.131"
.head 5 -  Width:  0.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.2"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalGenereUnFormatR( 0, 7 )
.head 6 -  Set wbFormatRManuel = TRUE
.head 6 -  Set wbResultat = TRUE
.head 6 +  If SalIsWindowEnabled( pbAction )
.head 7 -  Set gbKillTimer = FALSE
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 100 )
.head 3 +  Pushbutton: pbRBR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: R BR
.head 4 -  Window Location and Size
.head 5 -  Left: 11.433"
.head 5 -  Top: 2.381"
.head 5 -  Width:  0.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.2"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalGenereUnFormatR( 0, 10 )
.head 6 -  Set wbFormatRManuel = TRUE
.head 6 -  Set wbResultat = TRUE
.head 6 +  If SalIsWindowEnabled( pbAction )
.head 7 -  Set gbKillTimer = FALSE
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 100 )
.head 3 +  Pushbutton: pbRDE
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: R DE
.head 4 -  Window Location and Size
.head 5 -  Left: 11.433"
.head 5 -  Top: 2.631"
.head 5 -  Width:  0.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.2"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalGenereUnFormatR( 0, 12 )
.head 6 -  Set wbFormatRManuel = TRUE
.head 6 -  Set wbResultat = TRUE
.head 6 +  If SalIsWindowEnabled( pbAction )
.head 7 -  Set gbKillTimer = FALSE
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 100 )
.head 3 +  ! Check Box: cbExtrapolation
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Extrapolation des élus
.head 4 -  Window Location and Size
.head 5 -  Left: 3.833"
.head 5 -  Top: 2.988"
.head 5 -  Width:  2.55"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Dark Red
.head 4 -  Background Color: Light Green
.end
.head 4 +  Message Actions 
.head 5 +  On SAM_Click
.head 6 -  Set wsTmp = SalNumberToStrX( cbExtrapolation, 0)
.head 6 -  Call PalSetApplParm( "EXTRAPOL", wsTmp )
.head 3 +  Check Box: cbMethodeStesud
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Extrapolation (Méthode Stésud)
.head 4 -  Window Location and Size
.head 5 -  Left: 3.633"
.head 5 -  Top: 3.095"
.head 5 -  Width:  3.35"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Jade
.head 4 -  Background Color: Light Green
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If cbMethodeStesud = TRUE
.head 7 -  ! Set cbExtrapolation = TRUE
.head 7 -  ! Set wsTmp = SalNumberToStrX( cbExtrapolation, 0)
.head 7 -  ! Call PalSetApplParm( "EXTRAPOL", wsTmp )
.head 6 -  Set wsTmp = SalNumberToStrX( cbMethodeStesud, 0)
.head 6 -  Call PalSetApplParm( "EXTRAPOL_STD", wsTmp )
.head 3 +  ! Pushbutton: pbCKExtrapol
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: CK Extrapol
.head 4 -  Window Location and Size
.head 5 -  Left: 4.183"
.head 5 -  Top: 5.31"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.end
.head 4 +  Message Actions 
.head 5 +  On SAM_Click
.head 6 -  Call PalEvolutionNivSup_VersEx_Stesud( 'CK', 'C', '' )
.head 3 +  Multiline Field: mlLogFormatR
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 60000
.head 5 -  String Type: Long String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Border? Yes
.head 5 -  Word Wrap? Yes
.head 5 -  Vertical Scroll? Yes
.head 5 -  Window Location and Size
.head 6 -  Left: 3.583"
.head 6 -  Top: 4.238"
.head 6 -  Width:  7.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 1.321"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Dark Blue
.head 5 -  Background Color: Light Gray
.head 4 -  Message Actions
.head 3 -  Frame
.head 4 -  Resource Id: 60110
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 3.583"
.head 5 -  Top: 2.952"
.head 5 -  Width:  3.45"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.536"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Corners: Square
.head 4 -  Border Style: Solid
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Default
.head 4 -  Background Color: Light Green
.head 2 +  Functions
.head 3 +  Function: PalNoteVersion
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call SalSetWindowText( frmLOC2, wsModuleNom ||' - '|| wsModuleLigne || '  -  '|| gsGestionElectionType ||'   Date EL: '|| gsDateEl || '   -  DB: '|| SqlDatabase ||'   -  Version: '|| VERSION || ' '|| DATE_VERSION  || ' ('|| wsPathINI ||')')
.head 5 -  !
.head 5 -  ! Call PalLoc2Actif( 1, hWndForm ,wsModuleNom ||' - '|| wsModuleLigne || '   El: '|| gsGestionElectionType )
.head 3 +  Function: PalLoc2Actif
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nType
.head 5 -  Window Handle: hWnd
.head 5 -  String: sTitre
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nNumero
.head 4 +  Actions
.head 5 -  Set nNumero = SalWindowHandleToNumber( hWnd )
.head 5 +  If nType = 1
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Insert into LOC2_ACTIF ( LOC2_H, LOC2_DESC, LOC2_HeureStart) values ( :nNumero, :sTitre, sysdatetime )")
.head 5 +  Else
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "delete from LOC2_ACTIF where Loc2_H = :nNumero ")
.head 5 -  Call SqlCommit( ghSqlMain )
.head 3 +  Function: PalPopulateTbl
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: lnFiles
.head 5 -  Number: lnAttrib[*]
.head 5 -  String: lsFiles[*]
.head 5 -  Number: lnSize[*]
.head 5 -  Date/Time: ldDateF[*]
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnRow
.head 5 -  Number: lnRep
.head 5 -  String: wsSousRep[10]
.head 5 -  Date/Time: ldDateDernierTraite
.head 5 -  Date/Time: ldDateModifFichier
.head 5 -  Number: nCentiemeSec
.head 5 -  String: lsExtFile
.head 5 -  Number: nIdElec
.head 5 -  String: lsExtFileTrt
.head 5 -  Boolean: bErr
.head 4 +  Actions
.head 5 -  Set lnRep = 0
.head 5 +  ! If cbFichT
.head 6 -  Set lnRep = lnRep+1
.head 6 -  Set wsSousRep[lnRep] = "\\T"
.head 5 +  If cbFichC
.head 6 -  Set lnRep = lnRep+1
.head 6 -  Set wsSousRep[lnRep] = "\\I"
.head 5 +  If cbFich0
.head 6 -  Set lnRep = lnRep+1
.head 6 -  Set wsSousRep[lnRep] = "\\0"
.head 5 +  If cbFich1
.head 6 -  Set lnRep = lnRep+1
.head 6 -  Set wsSousRep[lnRep] = "\\1"
.head 5 +  If cbFichSup
.head 6 -  Set lnRep = lnRep+1
.head 6 -  Set wsSousRep[lnRep] = "\\Sup"
.head 5 +  If cbFichAutre
.head 6 -  Set lnRep = lnRep+1
.head 6 -  Set wsSousRep[lnRep] = "\\Autres"
.head 5 -  !
.head 5 -  Call SalTblReset( tblFiles )
.head 5 -  !
.head 5 -  Set lnRow = -1
.head 5 -  Set wdDate1= SalDateCurrent(  )
.head 5 -  Set lnJ = 1
.head 5 +  While lnJ <= lnRep
.head 6 -  Set lnFiles = VisDosEnumFileInfo (dfIn || wsSousRep[lnJ] || "\\*.*", FA_Standard, lsFiles, lnSize, ldDateF, lnAttrib)
.head 6 -  Set lnI = 0
.head 6 +  If lnFiles > 0
.head 7 -  ! Set dfNbFichier = SalNumberToStrX( lnFiles, 0) ||" Fichier(s) à trouver ..."
.head 7 +  While lnI < lnFiles
.head 8 -  Call SalFileGetDateTime( dfIn || wsSousRep[lnJ] || "\\"|| lsFiles[lnI] , ldDateModifFichier )
.head 8 -  !
.head 8 +  If SalStrRightX( lsFiles[lnI], 3) != 'ERR'
.head 9 +  If PalVerifTraitementFile( lsFiles[lnI] , ldDateDernierTraite, nIdElec )
.head 10 +  ! If (ldDateDernierTraite = DATETIME_Null or ldDateF[lnI] > ldDateDernierTraite or ldDateModifFichier > ldDateDernierTraite ) and SalStrRightX( lsFiles[lnI], 3) != 'ERR'
.head 11 -  Set lnRow = SalTblInsertRow( tblFiles, TBL_MaxRow )
.head 11 -  Call SalTblSetContext( tblFiles, lnRow )
.head 11 -  Set tblFiles.colFile = lsFiles[lnI]
.head 11 -  Set tblFiles.colSize = lnSize[lnI]
.head 11 -  Set tblFiles.colDate = ldDateF[lnI]
.head 11 -  Set tblFiles.colIdElec = nIdElec
.head 11 -  Set tblFiles.colFilePath= dfIn || wsSousRep[lnJ] || "\\"|| lsFiles[lnI]
.head 11 -  Call SalFileGetDateTime( dfIn || wsSousRep[lnJ] || "\\"|| lsFiles[lnI] , tblFiles.colDateC )
.head 11 -  Set tblFiles.colTraite = 0
.head 10 +  If (ldDateDernierTraite = DATETIME_Null or ldDateF[lnI] > ldDateDernierTraite or ldDateModifFichier > ldDateDernierTraite  
	or SalStrLeftX( lsFiles[lnI], 2 ) = '0K' or SalStrLeftX( lsFiles[lnI], 2 ) = '1K' ) 
       and SalStrRightX( lsFiles[lnI], 3) != 'ERR'
.head 11 -  Set lnRow = SalTblInsertRow( tblFiles, TBL_MaxRow )
.head 11 -  Call SalTblSetContext( tblFiles, lnRow )
.head 11 -  Set tblFiles.colFile = lsFiles[lnI]
.head 11 -  Set tblFiles.colSize = lnSize[lnI]
.head 11 -  Set tblFiles.colDate = ldDateF[lnI]
.head 11 -  Set tblFiles.colIdElec = nIdElec
.head 11 -  Set tblFiles.colFilePath= dfIn || wsSousRep[lnJ] || "\\"|| lsFiles[lnI]
.head 11 -  Call SalFileGetDateTime( dfIn || wsSousRep[lnJ] || "\\"|| lsFiles[lnI] , tblFiles.colDateC )
.head 11 -  Set tblFiles.colTraite = 0
.head 8 -  Set lnI = lnI +1
.head 7 -  !
.head 6 -  Set lnJ = lnJ +1
.head 5 -  !
.head 5 -  Set dfNbRestant =  lnRow + 1
.head 5 -  !
.head 5 +  If SalTblAnyRows( tblFiles, 0,0)
.head 6 -  Call SalDisableWindow( frmLOC2 )
.head 6 -  Call SalTblSortRows( tblFiles, 4, TBL_SortIncreasing  )
.head 6 -  Set lnI = -1
.head 6 +  While SalTblFindNextRow( tblFiles, lnI, 0,0 )
.head 7 -  Call SalTblSetContext( tblFiles, lnI )
.head 7 -  Call SalTblSetFocusRow(  tblFiles, lnI )
.head 7 -  Call SalTblSetRowFlags( tblFiles, lnI, ROW_New, FALSE )
.head 7 -  Call SalTblSetRowFlags( tblFiles, lnI, ROW_Selected, TRUE )
.head 7 -  Call DispatchMessage(  )
.head 7 -  Set lsExtFileTrt=''
.head 7 -  Set bErr = FALSE
.head 7 +  If PalTraitementFile( tblFiles.colFilePath , tblFiles.colFile, lsExtFileTrt)
.head 8 -  Set bErr = FALSE
.head 8 +  If lsExtFileTrt != ''
.head 9 -  Set lsExtFileTrt = '.' || lsExtFileTrt
.head 8 -  Call SalTblSetRowFlags( tblFiles, lnI, ROW_Edited, TRUE )
.head 8 -  Call PalHttpCockpit( 490, '', '', '', PalDtmExtension(  tblFiles.colFile ), wsModuleNom, wsModuleLigne, tblFiles.colFile || lsExtFileTrt )
.head 8 +  If tblFiles.colDate > gdDateDernierFileElection[tblFiles.colIdElec]  or tblFiles.colDateC > gdDateDernierFileElection[tblFiles.colIdElec]
.head 9 +  If tblFiles.colDate > tblFiles.colDateC
.head 10 -  Set ldDateDernierTraite = tblFiles.colDate
.head 9 +  Else
.head 10 -  Set ldDateDernierTraite = tblFiles.colDateC
.head 9 -  Call SalDateToStr( ldDateDernierTraite, wsTmp )
.head 9 -  Call PalSetDateElection( SalStrRightX( tblFiles.colFile,2), wsTmp, tblFiles.colIdElec )
.head 9 -  !
.head 8 -  Call VisFileSetAttribute( tblFiles.colFile, FA_Hidden, TRUE )
.head 8 -  Call VisFileSetAttribute( tblFiles.colFile, FA_Archive, TRUE )
.head 7 +  Else
.head 8 -  Set bErr = TRUE
.head 8 -  Call VisFileDelete( tblFiles.colFilePath ||'.ERR' )
.head 8 -  Call VisFileRename( tblFiles.colFilePath, tblFiles.colFilePath ||'.ERR' )
.head 7 -  !
.head 7 -  ! Déplacement du fichier 0K dans \0\ARCH_0K
.head 7 +  If Not bErr
.head 8 +  If SalStrLeftX( tblFiles.colFile, 2 ) = '0K'
.head 9 +  If VisFileCopy(  tblFiles.colFilePath ||"*", dfIn || "\\0" ||"\\ARCH_0K" ) > 0
.head 10 -  Call VisFileDelete( tblFiles.colFilePath ||"*" )
.head 8 +  Else If SalStrLeftX( tblFiles.colFile, 2 ) = '1K'
.head 9 +  If VisFileCopy(  tblFiles.colFilePath ||"*", dfIn || "\\1" ||"\\ARCH_1K" ) > 0
.head 10 -  Call VisFileDelete( tblFiles.colFilePath ||"*" )
.head 7 -  !
.head 7 -  Call SalTblSetRowFlags( tblFiles, lnI, ROW_Selected, FALSE )
.head 7 -  Set dfNbRestant = dfNbRestant - 1
.head 6 -  Call SalEnableWindow( frmLOC2 )
.head 6 -  Set wnPassageLastFile = wnPassageStat
.head 5 +  If gsPhaseResult = '1'
.head 6 -  Set wnPassage = wnPassage + PalDtmIntervalleTempsEcoule( wdDate1)
.head 5 -  Call SalTimerSet( hWndForm, nNoTimer, 900 )
.head 3 +  Function: PalVerifTraitementFile
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sFile
.head 5 -  Receive Date/Time: rdDateDernier
.head 5 -  Receive Number: nIdElec
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsExtFile
.head 5 -  Number: lnId
.head 5 -  Boolean: bATraiter
.head 4 +  Actions
.head 5 -  Set bATraiter = FALSE
.head 5 -  Set lsExtFile = SalStrRightX( sFile , 2)
.head 5 +  If lsExtFile = 'BV'
.head 6 -  Set lsExtFile = 'VL'
.head 5 +  If SalIsWindowEnabled( pbFormatR )
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ELE_ID, ELE_D_RESULT from election where ELE_LETTRE =:lsExtFile and ELE_LOC2_ACTIF = 1
	into :lnId , :rdDateDernier")
.head 5 +  Else
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ELE_ID, ELE_LOC2_DATEDERNIER from election where ELE_LETTRE =:lsExtFile and ELE_LOC2_ACTIF = 1
	into :lnId , :rdDateDernier")
.head 5 +  If SqlFetchNext( ghSqlSecondaire, Btmp )
.head 6 -  Set gbTrue = FALSE
.head 6 -  !
.head 6 -  Call SqlCommit( ghSqlSecondaire)
.head 6 -  Call SalSendMsg( whCbElec[lnId], SAM_AnyEdit, -1, lParam )
.head 6 +  If gbTrue = 1
.head 7 -  Set nIdElec = lnId
.head 7 -  Set bATraiter = TRUE
.head 5 -  Return (bATraiter)
.head 3 +  Function: PalTraitementFile
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psFilePath
.head 5 -  String: psFile
.head 5 -  Receive String: psExtTrt
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFile
.head 5 -  String: lsTypeFile
.head 5 -  String: lsFile
.head 5 -  String: lsFileHisto
.head 5 -  String: lsFileCopie
.head 5 -  String: lsFileX7S
.head 5 -  String: lsDateHeure
.head 5 -  Long String: llsTraceAction
.head 5 -  Long String: llsErreur
.head 5 -  Boolean: bCopie
.head 5 -  Boolean: bContinue
.head 5 -  Number: lnI
.head 5 -  Number: lnNbFileNivSup
.head 5 -  String: sFileNivSup[20]
.head 5 -  String: sFilePathNivSup[20]
.head 4 +  Actions
.head 5 -  Set lsFile = psFilePath
.head 5 -  !
.head 5 -  Set lsTypeFile = SalStrLeftX( psFile, 1)
.head 5 -  !
.head 5 +  If lsTypeFile = 'D' or lsTypeFile = 'P' or lsTypeFile = 'L'
.head 6 +  If PalLireFormatF( psFilePath, psFile, 'I')
.head 7 -  Call SqlCommit( ghSqlErreur )
.head 7 -  Return TRUE
.head 5 +  Else If lsTypeFile = '0'
.head 6 +  If NOT PalVerifResult1K( psFile )
.head 7 +  If PalResultPartiel( psFilePath, psFile)
.head 8 -  Call SqlCommit( ghSqlErreur )
.head 8 -  Return TRUE
.head 6 +  Else
.head 7 -  Call SqlCommit( ghSqlErreur )
.head 7 -  Return TRUE
.head 5 +  Else If lsTypeFile = '1'
.head 6 +  If PalResultDefinitif( psFilePath, psFile)
.head 7 -  Call SqlCommit( ghSqlErreur )
.head 7 +  If wsT[1] != 'C'
.head 8 -  Set psExtTrt = 'X7S'
.head 8 -  Call VisFileCopy( psFilePath , gsPathLoc1Down || "\\" || psFile )
.head 8 -  ! Copie du fichier X7S
.head 8 +  If SalStrMidX( psFile, 2, 2) = '21'
.head 9 -  Set lsFileX7S = SalStrLeftX( psFile, SalStrLength( psFile )-3) || "_FR" || SalStrRightX( psFile, 3) ||".X7S"
.head 9 -  Call VisFileCopy(  dfIn || "\\X7S\\" || lsFileX7S , gsPathLoc1Down  || "\\" || lsFileX7S )
.head 9 -  Set lsFileX7S =SalStrLeftX( psFile, SalStrLength( psFile )-3) || "_NL" || SalStrRightX( psFile, 3) ||".X7S"
.head 8 +  Else
.head 9 -  Set lsFileX7S =  psFile ||".X7S"
.head 8 -  Call VisFileCopy(  dfIn || "\\X7S\\" || lsFileX7S , gsPathLoc1Down  || "\\" || lsFileX7S )
.head 7 -  Return TRUE
.head 5 +  Else If lsTypeFile = 'C'
.head 6 +  If PalLireFormatC( psFilePath, psFile)
.head 7 -  Call SqlCommit( ghSqlErreur )
.head 7 -  Call VisFileCopy( psFilePath , gsPathLoc1Down || "\\" || psFile )
.head 7 -  Return TRUE
.head 5 +  Else If lsTypeFile = '2' or lsTypeFile = 'S'
.head 6 -  Set lnNbFileNivSup = 1
.head 6 -  Set bContinue = TRUE
.head 6 +  If SalStrMidX( psFile, 1,1) = 'O'
.head 7 -  ! Apparentement - Il faut découper le fichier SO en x fichiers OC
	Exemple : pour SO21004.CK : on doit construire 3 fichiers OC21004.CK, OC24062.CK et OC25072.CK
.head 7 +  If PalDecoupeNivSupApp( psFilePath, psFile , sFilePathNivSup, sFileNivSup, lnNbFileNivSup )
.head 8 -  Set bContinue = TRUE
.head 7 +  Else
.head 8 -  Set bContinue = FALSE
.head 6 -  Set lnI = 1
.head 6 +  While lnI <= lnNbFileNivSup and bContinue
.head 7 +  If lnNbFileNivSup > 1
.head 8 -  Set psFile = sFileNivSup[lnI-1]
.head 8 -  Set psFilePath = sFilePathNivSup[lnI-1]
.head 7 +  If PalResultNiveauSup( psFilePath, psFile, llsErreur )
.head 8 -  Call SqlCommit( ghSqlErreur )
.head 8 +  If wsT[1] != 'C' and lnNbFileNivSup = 1
.head 9 -  Set psExtTrt = 'X7S'
.head 9 -  Call VisFileCopy( psFilePath , gsPathLoc1Down || "\\" || psFile )
.head 8 -  Set bContinue = TRUE
.head 7 +  Else
.head 8 -  Set bContinue = FALSE
.head 7 -  Set lnI = lnI + 1
.head 6 -  Return bContinue
.head 5 +  Else If lsTypeFile = 'A'
.head 6 -  ! Apparentement - Bxl
.head 6 -  Return TRUE
.head 5 -  !
.head 5 -  Call SqlCommit( ghSqlErreur )
.head 5 -  Return FALSE
.head 3 +  Function: PalLireFormatC
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psFilePath
.head 5 -  String: psFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: psIns
.head 5 -  Number: pnNbCdtMax
.head 5 -  Number: pnNoEl 
.head 5 -  String: lsEl
.head 5 -  String: sIns[5]
.head 5 -  String: lsNivLettre
.head 4 +  Actions
.head 5 +  If PalInitStruct(  )
.head 6 -  Set psIns = SalStrMidX( psFileName, 2,5)
.head 6 -  Set lsEl = SalStrRightX( psFileName, 2)
.head 6 -  Set lsNivLettre = SalStrMidX( psFileName, 1,1)
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_ID from Election where ELE_LETTRE = :lsEl 
	into :pnNoEl " )
.head 6 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  ! ERREUR
.head 7 -  Return (FALSE)
.head 6 +  ! If lsEl = 'SE'
.head 7 -  Set pnNoEl = 3
.head 6 +  ! Else If lsEl = 'CK'
.head 7 -  Set pnNoEl = 2
.head 6 +  ! Else
.head 7 -  ! ERREUR
.head 7 -  Return (FALSE)
.head 6 -  !
.head 6 -  Set wnIdEntiteEnCours = 999999
.head 6 -  Call PalSqlTrans( ghSqlMain, "Select ent_id from entite where ENT_INS = '"|| psIns||"' and ENT_ELE_FK = "|| SalNumberToStrX(pnNoEl,0)||" and ENT_NIV_LETTRE = '"|| lsNivLettre || "'
	into :wnIdEntiteEnCours  "  )
.head 6 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  !
.head 6 -  Set sIns[1] = psIns
.head 6 -  Set sIns[2] = ''
.head 6 +  If PalChargeFormatC( psFilePath, sIns, pnNoEl , '' , psFileName)
.head 7 +  If PalChargeCoord( lsEl, psIns, lsNivLettre, psFileName )
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 -  Return ( TRUE)
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute(  ghSqlMaj , "ROLLBACK ")
.head 8 -  Return ( FALSE)
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute(  ghSqlMaj , "ROLLBACK ")
.head 7 -  Return ( FALSE)
.head 5 +  Else
.head 6 -  ! ERREUR de structure
.head 6 -  Call PalHttpCockpit( 410, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 6 -  Return ( FALSE)
.head 3 +  Function: PalLireFormatF
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psFilePath
.head 5 -  String: psFileName
.head 5 -  String: sType
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: psIns
.head 5 -  Number: pnNbCdtMax
.head 5 -  Number: pnNoEl 
.head 5 -  String: lsEl
.head 5 -  String: sIns[5]
.head 5 -  String: lsNivLettre
.head 4 +  Actions
.head 5 +  If PalInitStruct(  )
.head 6 -  Set psIns = SalStrMidX( psFileName, 2,5)
.head 6 -  Set lsEl = SalStrRightX( psFileName, 2)
.head 6 -  Set lsNivLettre = SalStrMidX( psFileName, 1,1)
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_ID from Election where ELE_LETTRE = :lsEl 
	into :pnNoEl " )
.head 6 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  ! ERREUR
.head 7 -  Return (FALSE)
.head 6 +  ! If lsEl = 'SE'
.head 7 -  Set pnNoEl = 3
.head 6 +  ! Else If lsEl = 'CK'
.head 7 -  Set pnNoEl = 2
.head 6 +  ! Else
.head 7 -  ! ERREUR
.head 7 -  Return (FALSE)
.head 6 -  !
.head 6 -  Set wnIdEntiteEnCours = 999999
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ent_id, ent_Nb_Cdt_Max from entite where ENT_INS = '"|| psIns ||"' and ENT_ELE_FK = "|| SalNumberToStrX(pnNoEl,0)||" and ENT_NIV_LETTRE = '"|| lsNivLettre || "'
	into :wnIdEntiteEnCours ,:pnNbCdtMax "  )
.head 6 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 7 +  If pnNbCdtMax = 0 or pnNbCdtMax = NUMBER_Null
.head 8 -  Set pnNbCdtMax = 25
.head 6 +  Else
.head 7 -  ! ERREUR
.head 7 -  Call PalHttpCockpit( 411, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 7 -  Return (FALSE)
.head 6 -  ! Delete dans Erreur_EnCours pour cette entité
.head 6 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Delete from Erreur_EnCours where Err_ent_FK = :wnIdEntiteEnCours ")
.head 6 -  Call SqlCommit( ghSqlErreur )
.head 6 -  !
.head 6 -  ! Delete dans Listes et Cdts
.head 6 +  If sType = 'I'
.head 7 -  Call SqlPrepareAndExecute(  ghSqlMaj , "Delete from candidats where CDT_ELE_Ext = :lsEl and CDT_INSBur = :psIns ")
.head 7 -  Call SqlPrepareAndExecute(  ghSqlMaj , "Delete from listes where LIS_ELE_Ext = :lsEl and LIS_INSBur = :psIns ")
.head 6 -  !
.head 6 -  Set sIns[1] = psIns
.head 6 -  Set sIns[2] = ''
.head 6 +  If PalChargeFormatF( psFilePath, sIns, pnNbCdtMax, pnNoEl , '' , psFileName)
.head 7 +  If PalChargeListe( pnNoEl, psIns, pnNbCdtMax, psFileName )
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 -  Return ( TRUE)
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute(  ghSqlMaj , "ROLLBACK ")
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 -  Return ( FALSE)
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute(  ghSqlMaj , "ROLLBACK ")
.head 7 -  Call SqlCommit( ghSqlMaj )
.head 7 -  Return ( FALSE)
.head 5 +  Else
.head 6 -  Call PalHttpCockpit( 410, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Return ( FALSE)
.head 3 +  ! Function: PalPopulateTblDeplace
.head 4 -  Description: 
.head 4 -  Returns 
.head 4 -  Parameters 
.head 4 -  Static Variables 
.head 4 +  Local variables 
.head 5 -  Number: lnFiles
.head 5 -  Number: lnAttrib[*]
.head 5 -  String: lsFiles[*]
.head 5 -  Number: lnSize[*]
.head 5 -  Date/Time: ldDateF[*]
.head 5 -  Number: lnI
.head 5 -  Number: lnRow
.head 5 -  String: lsDebut
.head 5 -  String: lsFin
.head 5 -  String: lsIns
.head 5 -  Boolean: bCopie
.head 4 +  Actions 
.head 5 -  Set lnFiles = VisDosEnumFileInfo (dfIn ||"\\*.*", FA_Standard, lsFiles, lnSize, ldDateF, lnAttrib)
.head 5 -  Set lnI = 0
.head 5 +  If lnFiles > 0
.head 6 -  Call SalTblReset( tblFiles )
.head 6 +  While lnI < lnFiles
.head 7 +  If SalStrLeftX( lsFiles[lnI], 2 ) = '0K'
.head 8 -  Set bCopie= FALSE
.head 8 -  Set lsIns = SalStrMidX( lsFiles[lnI], 2, 5 )
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select * from entite where Ent_ins = :lsIns and @nullvalue( ENT_TYPEVOTE, 'M') != 'M' " )
.head 8 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 9 -  Set bCopie= FALSE
.head 8 +  Else 
.head 9 -  Set bCopie= TRUE
.head 7 +  Else 
.head 8 -  Set bCopie= TRUE
.head 7 +  If bCopie 
.head 8 -  Call PalMakeAllDir( dfIn ||"\\FileOk" )
.head 8 -  Call VisFileCopy(  dfIn||"\\"||lsFiles[lnI]  , dfIn ||"\\FileOk\\"|| lsFiles[lnI]  )
.head 7 -  Set lnI = lnI +1
.head 3 -  !
.head 3 +  Function: PalVerifResult1K
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: psIns
.head 5 -  String: lsInsListe
.head 5 -  String: lsInsListe2
.head 5 -  Number: pnNbCdtMax
.head 5 -  Number: pnNoEl 
.head 5 -  String: lsEl
.head 5 -  String: lsNivLettre
.head 5 -  String: sIns[5]
.head 5 -  Number: lnNivId
.head 5 -  String: sInsTot
.head 5 -  Number: lnNbBurDepFile
.head 5 -  Number: lnNbBurDepDejaRecus
.head 5 -  Boolean: bResetCanton
.head 4 +  Actions
.head 5 -  Set psIns = SalStrMidX( psFileName, 2,5)
.head 5 -  Set lsEl = SalStrRightX( psFileName, 2)
.head 5 -  Set lsNivLettre = SalStrUpperX(SalStrMidX( psFileName, 1,1))
.head 5 +  If lsNivLettre = 'K'
.head 6 -  Set lnNbBurDepFile = SalStrToNumber( SalStrMidX( psFileName, 8,3) )
.head 6 +  If lnNbBurDepFile != 0
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select RES_SIT_DEP from result_scrutin 
	where RES_ENT_INS = :psIns and RES_ELE_EXT = :lsEl and RES_NIV_LETTRE = :lsNivLettre and @nullvalue( RES_SIT_DEP,0) = 1 " )
.head 7 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 8 -  ! Deja recu le 1K
.head 8 -  Return (TRUE)
.head 7 +  Else
.head 8 -  ! Verification du nombre de bureaux déja reçus pour ne pas revenir en arrière
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select RES_BDEP_TRAIT  from result_scrutin 
	where RES_ENT_INS = :psIns and RES_ELE_EXT = :lsEl and RES_NIV_LETTRE = :lsNivLettre 
	into :lnNbBurDepDejaRecus ")
.head 8 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 9 +  If lnNbBurDepDejaRecus > lnNbBurDepFile
.head 10 -  ! Deja recu plus de bureaux dépouillés
.head 10 -  Return (TRUE)
.head 6 +  Else
.head 7 -  ! RESET des résultats du canton
.head 7 +  If SqlPrepareAndExecute( ghSqlMaj, "Update RESULT_Scrutin
	set RES_NB_VV=null, RES_NB_BE=null, RES_NB_VBN=null, RES_SIT_DEP=null, RES_BDEP_TRAIT=null, DATE_HEURE_MAJ=null, RES_NB_VV_E5=null, RES_NB_VBN_E5=null, RES_T_DEP=null
	Where RES_ELE_EXT = :lsEl and RES_ENT_INS = :psIns and RES_NIV_LETTRE = 'K' ")
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Update result_Listes
	set REL_SC1=null, REL_SC2=null, REL_SC3=null, REL_SC4=null
	Where REL_ELE_EXT = :lsEl and REL_ENT_INS = :psIns and REL_NIV_LETTRE = 'K' ")
.head 9 +  If SqlPrepareAndExecute( ghSqlMaj, "Update result_Cdt
	set REC_NB_VOIX=null
	Where REC_ELE_EXT = :lsEl and REC_ENT_INS = :psIns and REC_NIV_LETTRE = 'K' ")
.head 10 -  Call SqlCommit( ghSqlMaj )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK" )
.head 10 -  Call SqlCommit( ghSqlMaj )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK" )
.head 9 -  Call SqlCommit( ghSqlMaj )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK" )
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 7 -  !
.head 7 -  Return (TRUE)
.head 5 -  Return (FALSE)
.head 3 +  Function: PalResultPartiel
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psFilePath
.head 5 -  String: psFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: psIns
.head 5 -  String: lsInsListe
.head 5 -  String: lsInsListe2
.head 5 -  Number: pnNbCdtMax
.head 5 -  Number: pnNoEl 
.head 5 -  String: lsEl
.head 5 -  String: lsNivLettre
.head 5 -  String: sIns[5]
.head 5 -  Number: lnNivId
.head 5 -  String: sInsTot
.head 4 +  Actions
.head 5 +  If PalInitStruct(  )
.head 6 -  Set psIns = SalStrMidX( psFileName, 2,5)
.head 6 -  Set lsEl = SalStrRightX( psFileName, 2)
.head 6 -  Set lsNivLettre = SalStrUpperX(SalStrMidX( psFileName, 1,1))
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_ID from Election where ELE_LETTRE = :lsEl 
	into :pnNoEl " )
.head 6 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  ! ERREUR
.head 7 -  Call PalHttpCockpit( 433, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 7 -  Return (FALSE)
.head 6 -  Call SqlCommit( ghSqlMain)
.head 6 +  ! If lsEl = 'SE'
.head 7 -  Set pnNoEl = 3
.head 6 +  ! Else If lsEl = 'CK'
.head 7 -  Set pnNoEl = 2
.head 6 +  ! Else
.head 7 -  ! ERREUR
.head 7 -  Call PalHttpCockpit( 432, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 7 -  Return (FALSE)
.head 6 -  ! Call SqlPrepareAndExecute( ghSqlMain, "Select Niv_Id from Niveaux where Niv_Lettre = :lsNivLettre and NIV_ELE_FK =:pnNoEl  into :lnNivId ")
.head 6 +  ! If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  ! ERREUR
.head 7 -  Call PalHttpCockpit( 433, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 7 -  Return (FALSE)
.head 6 -  !
.head 6 -  Set lsInsListe2 = ''
.head 6 +  If (pnNoEl = 3 or pnNoEl = 1) and (SalStrLeftX(psIns,2) = '21' or SalStrLeftX(psIns,2) = '23' )
.head 7 -  Set lsInsListe = '12025'
.head 7 -  Set lsInsListe2 = '92094'
.head 7 -  ! Set pnNbCdtMax = 25
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ENT_NB_CDT_MAX from entite A 
where A.Ent_inS in (12025,92094 ) 
	and A.ENT_ELE_FK = :pnNoEl and  A.ENT_NIV_FK > :lnNivId and ENT_NB_CDT_MAX is not null	
Order by 1 desc
into :pnNbCdtMax "  )
.head 7 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  Else
.head 7 +  If pnNoEl = 2 or pnNoEl = 4 or pnNoEl = 7 or pnNoEl = 10 or pnNoEl = 12
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ent_ins, ENT_NB_CDT_MAX from entite A 
where A.Ent_inS = (Select B.ENT_INS_NIVSUP from entite B where  B.ENT_INS = :psIns and B.ENT_ELE_FK = :pnNoEl and B.ENT_NIV_LETTRE = :lsNivLettre ) 
	and A.ENT_ELE_FK = :pnNoEl and  A.ENT_NIV_FK > :lnNivId and ENT_NB_CDT_MAX is not null	
Order by 2 desc	
into :lsInsListe, :pnNbCdtMax "  )
.head 7 +  Else If pnNoEl = 3  or pnNoEl = 1
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ent_ins, ENT_NB_CDT_MAX from entite A 
where A.Ent_inS = (Select B.ENT_INS_NIVSUPSUP from entite B where  B.ENT_INS = :psIns and B.ENT_ELE_FK = :pnNoEl and B.ENT_NIV_LETTRE = :lsNivLettre ) 
	and A.ENT_ELE_FK = :pnNoEl and  A.ENT_NIV_FK-1 > :lnNivId and ENT_NB_CDT_MAX is not null	
Order by 2 desc	
into :lsInsListe, :pnNbCdtMax "  )
.head 7 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 8 +  If pnNbCdtMax = 0 or pnNbCdtMax = NUMBER_Null
.head 9 -  Set pnNbCdtMax = 25
.head 7 +  Else
.head 8 -  ! ERREUR
.head 8 -  Call PalHttpCockpit( 434, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 8 -  Return (FALSE)
.head 6 -  !
.head 6 -  Set sIns[1] = lsInsListe
.head 6 -  Set sIns[2] = lsInsListe2
.head 6 +  If lsInsListe2 != ''
.head 7 -  Set sInsTot = psIns
.head 6 +  Else
.head 7 -  Set sInsTot = ''
.head 6 +  If PalChargeFormatF( psFilePath, sIns, pnNbCdtMax, pnNoEl , sInsTot , psFileName)
.head 7 +  If PalUpdateResultat( 'P', lsNivLettre , psIns, lsEl, psFileName)
.head 8 -  Call SalColorSet(  whMod_FR[pnNoEl], COLOR_IndexWindow, COLOR_Red )
.head 8 -  Call SalColorSet(  whMod_FR[pnNoEl], COLOR_IndexWindowText, COLOR_Red )
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 -  Return ( TRUE)
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute(  ghSqlMaj , "ROLLBACK ")
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 -  Return ( FALSE)
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute(  ghSqlMaj , "ROLLBACK ")
.head 7 -  Call SqlCommit( ghSqlMaj )
.head 7 -  Return ( FALSE)
.head 5 +  Else
.head 6 -  ! ERREUR
.head 6 -  Call PalHttpCockpit( 430, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Return ( FALSE)
.head 3 +  Function: PalResultDefinitif
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psFilePath
.head 5 -  String: psFileName
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: psIns
.head 5 -  String: lsInsListe
.head 5 -  Number: pnNbCdtMax
.head 5 -  Number: pnNoEl 
.head 5 -  String: lsEl
.head 5 -  String: lsNivLettre
.head 5 -  String: sIns[5]
.head 5 -  Number: lnNivId
.head 5 -  String: lsInsListe2
.head 4 +  Actions
.head 5 +  If PalInitStruct(  )
.head 6 -  Set psIns = SalStrMidX( psFileName, 2,5)
.head 6 -  Set lsEl = SalStrRightX( psFileName, 2)
.head 6 -  Set lsNivLettre = SalStrMidX( psFileName, 1,1)
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_ID from Election where ELE_LETTRE = :lsEl 
	into :pnNoEl " )
.head 6 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  ! ERREUR
.head 7 -  Call PalHttpCockpit( 432, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 7 -  Return (FALSE)
.head 6 -  !
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Niv_Id from Niveaux where Niv_Lettre = :lsNivLettre and NIV_ELE_FK =:pnNoEl  into :lnNivId ")
.head 6 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  ! ERREUR
.head 7 -  Call PalHttpCockpit( 433, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 7 -  Return (FALSE)
.head 6 -  !
.head 6 -  Set lsInsListe2 = ''
.head 6 +  If (pnNoEl = 3 or pnNoEl = 1) and (SalStrLeftX(psIns,2) = '21' or SalStrLeftX(psIns,2) = '23' )
.head 7 -  Set lsInsListe = '12025'
.head 7 -  Set lsInsListe2 = '92094'
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ENT_NB_CDT_MAX from entite A 
where A.Ent_inS in (12025,92094 ) 
	and A.ENT_ELE_FK = :pnNoEl and  A.ENT_NIV_FK > :lnNivId and ENT_NB_CDT_MAX is not null	
Order by 1 desc
into :pnNbCdtMax "  )
.head 7 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  Else
.head 7 +  If pnNoEl = 2 or pnNoEl = 4 or pnNoEl = 7 or pnNoEl = 10 or pnNoEl = 12
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ent_ins, ENT_NB_CDT_MAX from entite A 
where A.Ent_inS = (Select B.ENT_INS_NIVSUP from entite B where  B.ENT_INS = :psIns and B.ENT_ELE_FK = :pnNoEl and B.ENT_NIV_LETTRE = :lsNivLettre ) 
	and A.ENT_ELE_FK = :pnNoEl and  A.ENT_NIV_FK > :lnNivId and ENT_NB_CDT_MAX is not null	
Order by 2 desc
into :lsInsListe, :pnNbCdtMax "  )
.head 7 +  Else If pnNoEl = 3 or pnNoEl = 1
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ent_ins, ENT_NB_CDT_MAX from entite A 
where A.Ent_inS = (Select B.ENT_INS_NIVSUPSUP from entite B where  B.ENT_INS = :psIns and B.ENT_ELE_FK = :pnNoEl and B.ENT_NIV_LETTRE = :lsNivLettre ) 
	and A.ENT_ELE_FK = :pnNoEl and  A.ENT_NIV_FK-1 > :lnNivId and ENT_NB_CDT_MAX is not null	
Order by 2 desc
into :lsInsListe, :pnNbCdtMax "  )
.head 7 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 8 +  If pnNbCdtMax = 0 or pnNbCdtMax = NUMBER_Null
.head 9 -  Set pnNbCdtMax = 25
.head 7 +  Else
.head 8 -  ! ERREUR
.head 8 -  Call PalHttpCockpit( 434, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 8 -  Return (FALSE)
.head 6 -  !
.head 6 -  Set sIns[1] = lsInsListe
.head 6 -  Set sIns[2] = lsInsListe2
.head 6 +  If PalChargeFormatF( psFilePath, sIns, pnNbCdtMax, pnNoEl , psIns, psFileName )
.head 7 +  If PalUpdateResultat( 'D', lsNivLettre , psIns, lsEl, psFileName)
.head 8 -  Call SalColorSet(  whMod_FR[pnNoEl], COLOR_IndexWindow, COLOR_Red )
.head 8 -  Call SalColorSet(  whMod_FR[pnNoEl], COLOR_IndexWindowText, COLOR_Red )
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 -  Return ( TRUE)
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute(  ghSqlMaj , "ROLLBACK ")
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 -  Return ( FALSE)
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute(  ghSqlMaj , "ROLLBACK ")
.head 7 -  Call SqlCommit( ghSqlMaj )
.head 7 -  Return ( FALSE)
.head 5 +  Else
.head 6 -  ! ERREUR
.head 6 -  Call PalHttpCockpit( 431, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Return ( FALSE)
.head 3 +  Function: PalResultNiveauSup
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psFilePath
.head 5 -  String: psFileName
.head 5 -  Receive Long String: llsErreurAffiche
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: psIns
.head 5 -  String: lsInsListe
.head 5 -  Number: pnNbCdtMax
.head 5 -  Number: pnNoEl 
.head 5 -  String: lsEl
.head 5 -  String: lsNivLettre
.head 5 -  String: sIns[5]
.head 5 -  Number: lnNivId
.head 5 -  String: lsInsListe2
.head 5 -  Long String: llsErreur
.head 5 -  Long String: llsErreur2
.head 4 +  Actions
.head 5 +  If PalInitStruct(  )
.head 6 -  Set psIns = SalStrMidX( psFileName, 2,5)
.head 6 -  Set lsEl = SalStrRightX( psFileName, 2)
.head 6 -  Set lsNivLettre = SalStrMidX( psFileName, 1,1)
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_ID from Election where ELE_LETTRE = :lsEl 
	into :pnNoEl " )
.head 6 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  ! ERREUR
.head 7 -  Call PalHttpCockpit( 432, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 7 -  Return (FALSE)
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Niv_Id from Niveaux where Niv_Lettre = :lsNivLettre and NIV_ELE_FK =:pnNoEl  into :lnNivId ")
.head 6 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  ! ERREUR
.head 7 -  Call PalHttpCockpit( 433, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 7 -  Return (FALSE)
.head 6 -  !
.head 6 -  Set lsInsListe2 = ''
.head 6 -  Set wnIdEntiteEnCours = 999999
.head 6 +  If (pnNoEl = 3 or pnNoEl = 1) and (SalStrLeftX(psIns,2) = '21' or SalStrLeftX(psIns,2) = '23' )
.head 7 -  Set lsInsListe = '12025'
.head 7 -  Set lsInsListe2 = '92094'
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ent_id, ENT_NB_CDT_MAX from entite A 
where A.Ent_inS in (12025,92094 ) 
	and A.ENT_ELE_FK = :pnNoEl and  A.ENT_NIV_FK >= :lnNivId and ENT_NB_CDT_MAX is not null	
Order by 2 desc
into :wnIdEntiteEnCours , :pnNbCdtMax "  )
.head 7 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  Else
.head 7 +  If pnNoEl = 2 or pnNoEl = 4 or pnNoEl = 7 or pnNoEl = 10 or pnNoEl = 12
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ent_ins, ENT_NB_CDT_MAX , ent_id 
from entite A 
where A.Ent_inS = (Select B.ENT_INS_NIVSUP from entite B where  B.ENT_INS = :psIns and B.ENT_ELE_FK = :pnNoEl and B.ENT_NIV_LETTRE = 'K' ) 
	and A.ENT_ELE_FK = :pnNoEl and ENT_NB_CDT_MAX is not null	
Order by 2 desc
into :lsInsListe, :pnNbCdtMax, :wnIdEntiteEnCours "  )
.head 7 +  Else If pnNoEl = 3 or pnNoEl = 1
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ent_ins, ENT_NB_CDT_MAX ,ent_id 
from entite A 
where A.Ent_inS = (Select B.ENT_INS_NIVSUPSUP from entite B where  B.ENT_INS = :psIns and B.ENT_ELE_FK = :pnNoEl and B.ENT_NIV_LETTRE = 'K' ) 
	and A.ENT_ELE_FK = :pnNoEl  and ENT_NB_CDT_MAX is not null	
Order by 2 desc
into :lsInsListe, :pnNbCdtMax , :wnIdEntiteEnCours"  )
.head 7 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 8 +  If pnNbCdtMax = 0 or pnNbCdtMax = NUMBER_Null
.head 9 -  Set pnNbCdtMax = 25
.head 7 +  Else
.head 8 -  ! ERREUR
.head 8 -  Call PalHttpCockpit( 434, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 8 -  Return (FALSE)
.head 6 -  !
.head 6 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Delete from Erreur_EnCours where Err_ent_FK = :wnIdEntiteEnCours ")
.head 6 -  Call SqlCommit( ghSqlErreur )
.head 6 -  !
.head 6 -  Set sIns[1] = lsInsListe
.head 6 -  Set sIns[2] = lsInsListe2
.head 6 +  If PalChargeFormatF( psFilePath, sIns, pnNbCdtMax, pnNoEl , psIns, psFileName )
.head 7 +  If NOT PalVerifResultNivSup( pnNoEl, lsEl , lsNivLettre, psIns, llsErreur , llsErreur2 )
.head 8 -  ! ERREUR
.head 8 -  Call PalHttpCockpit( 435, '', '1', '
' || llsErreur, PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 8 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :psFileName, 0, :llsErreur ) ")
.head 8 -  Call SqlCommit( ghSqlErreur )
.head 8 -  Set llsErreurAffiche = llsErreur
.head 8 +  If llsErreur2 != ''
.head 9 -  Call PalHttpCockpit( 438, '', '1', psFileName || '
' || llsErreur2, PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 9 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :psFileName, 0, :llsErreur2 ) ")
.head 9 -  Call SqlCommit( ghSqlErreur )
.head 9 -  Set llsErreurAffiche = llsErreurAffiche || "
"|| SalStrRepeatX( "=", 40) ||"
Comparaison avec fichiers niv. inf. 
"|| llsErreur2
.head 8 -  Return ( FALSE)
.head 7 +  Else
.head 8 -  Call SqlCommit(  ghSqlMaj )
.head 7 -  Return ( TRUE)
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute(  ghSqlMaj , "ROLLBACK ")
.head 7 -  Call SqlCommit( ghSqlMaj )
.head 7 -  Return ( FALSE)
.head 5 +  Else
.head 6 -  ! ERREUR
.head 6 -  Call PalHttpCockpit( 431, '', '1', '', PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Return ( FALSE)
.head 3 +  Function: PalDecoupeNivSupApp
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psFilePath
.head 5 -  String: psFile
.head 5 -  Receive String: psNewFilePath[20]
.head 5 -  Receive String: psNewFile[20]
.head 5 -  Receive Number: nNbNewFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 5 -  File Handle: hNewFile[20]
.head 5 -  String: sPath
.head 5 -  String: sInsFile
.head 5 -  String: sLigneH
.head 5 -  String: sEntite
.head 5 -  String: sElection
.head 5 -  Long String: sBuffer
.head 5 -  Boolean: bContinue
.head 5 -  Number: lnI
.head 5 -  Boolean: bLigneGOk
.head 5 -  String: sNewEntite[20]
.head 4 +  Actions
.head 5 +  If SalFileOpen( hFile, psFilePath, OF_Read | OF_Text )
.head 6 -  Set sPath = wsPathTmp ||'\\'
.head 6 -  Set sElection = SalStrRightX( psFile, 2)
.head 6 -  !
.head 6 -  Set sInsFile = ''
.head 6 -  Call SalFileSeek( hFile, FILE_SeekBegin , 0 )
.head 6 +  While SalFileGetStr( hFile, sBuffer , 1000 )
.head 7 +  If SalStrLeftX( sBuffer, 3 ) = '"S"'
.head 8 -  Set sEntite = SalStrMidX( sBuffer, 9, 5 )
.head 8 +  If SalStrScan( sInsFile, sEntite ) = -1
.head 9 +  If sInsFile != ''
.head 10 -  Set sInsFile = sInsFile ||"#"
.head 9 -  Set sInsFile = sInsFile || sEntite
.head 6 -  !
.head 6 +  If sInsFile != ''
.head 7 -  Set bContinue= TRUE
.head 7 -  Set nNbNewFile = SalStrTokenize( sInsFile, '', '#', sNewEntite )
.head 7 -  Set lnI = 0
.head 7 +  While lnI < nNbNewFile
.head 8 -  Set psNewFile[lnI] = 'OC'|| sNewEntite[lnI] || '.' || sElection
.head 8 -  Set psNewFilePath[lnI] = sPath || psNewFile[lnI] 
.head 8 -  Call VisFileDelete( psNewFilePath[lnI] ||"*" )
.head 8 +  If NOT SalFileOpen( hNewFile[lnI], psNewFilePath[lnI], OF_Create | OF_ReadWrite | OF_Text )
.head 9 -  ! ERREUR 437
.head 9 -  ! Call SalMessageBox( "Erreur de création du fichier : " || psNewFilePath[lnI], "ERR", MB_Ok )
.head 9 -  Call PalErrLog( psFile, 437, "Erreur de création du fichier : " || psNewFilePath[lnI], '0', '1', 1 )
.head 9 -  Set bContinue= FALSE
.head 9 -  Break
.head 8 -  Set lnI = lnI + 1
.head 7 +  If bContinue
.head 8 -  Call SalFileSeek( hFile, FILE_SeekBegin , 0 )
.head 8 -  Set bLigneGOk = FALSE
.head 8 +  While SalFileGetStr( hFile, sBuffer , 1000 )
.head 9 +  If SalStrLeftX( sBuffer, 3 ) = '"G"' and NOT bLigneGOk
.head 10 -  Set bLigneGOk = TRUE
.head 10 -  Set lnI = 0
.head 10 +  While lnI < nNbNewFile
.head 11 -  Call SalFilePutStr( hNewFile[lnI], sBuffer )
.head 11 -  Set lnI = lnI + 1
.head 9 +  Else If SalStrLeftX( sBuffer, 3 ) != '"H"' and SalStrLeftX( sBuffer, 3 ) != '"G"' 
.head 10 -  Set sEntite = SalStrMidX( sBuffer, 9, 5 )
.head 10 -  Set lnI = 0
.head 10 +  While lnI < nNbNewFile
.head 11 +  If sNewEntite[lnI] = sEntite
.head 12 -  Call SalFilePutStr( hNewFile[lnI], sBuffer )
.head 12 -  Break
.head 11 -  Set lnI = lnI + 1
.head 7 -  Set lnI = 0
.head 7 +  While lnI < nNbNewFile
.head 8 -  Call SalFileClose(  hNewFile[lnI] )
.head 8 -  Set lnI = lnI + 1
.head 6 -  !
.head 6 -  Call SalFileClose( hFile )
.head 5 +  Else
.head 6 -  Call SqlCommit(  ghSqlMaj )
.head 5 -  Return bContinue
.head 3 -  !
.head 3 +  Function: PalInitStruct
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: i
.head 5 -  Number: j
.head 5 -  Number: k
.head 4 +  Actions
.head 5 -  !
.head 5 -  ! Set wsG[0] = ''
.head 5 -  ! Set wsS[0] = ''
.head 5 -  ! Set wsS[20] = ''
.head 5 -  ! Set wsS[1] = ''
.head 5 -  Set i = 0
.head 5 +  While i <= 200
.head 6 +  If i < 20
.head 7 -  Set wsG[i] = ''
.head 6 +  If i < 100
.head 7 -  Set wsS[i] = ''
.head 7 -  Set wsB[i] = ''
.head 7 -  Set wsA[0,i] = ''
.head 7 -  Set wsA[1,i] = ''
.head 7 -  Set wsA[2,i] = ''
.head 6 -  Set wsL[i, 0] = ''
.head 6 -  Set wsL[i, 1] = ''
.head 6 +  If i < 100 
.head 7 -  Set wsCo[i, 0] = ''
.head 7 -  Set wsCo[i, 1] = ''
.head 7 -  Set wsCo[i, 2] = ''
.head 7 -  Set wsCo[i, 3] = ''
.head 7 -  Set wsCo[i, 4] = ''
.head 7 -  Set wsCo[i, 5] = ''
.head 6 +  ! While j <= 200
.head 7 -  Set j = j + 1
.head 6 -  Set j = 0
.head 6 -  Set k=0
.head 6 +  While k <= 90
.head 7 -  Set wsC[i,j, k] = ''
.head 7 -  Set wsSuppl[ i,j,k] = ''
.head 7 -  Set k= k +1
.head 6 -  Set i = i + 1
.head 5 -  Return (TRUE)
.head 3 +  Function: PalChargeFormatF
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sFile
.head 5 -  String: sIns[5]
.head 5 -  Number: nSiege
.head 5 -  Number: nNoEl
.head 5 -  String: sInsTot
.head 5 -  String: sFileNameSeul
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 5 -  Boolean: bContinue
.head 5 -  Number: nIndice
.head 5 -  Long String: sBuffer
.head 5 -  Long String: sErrCaract
.head 5 -  String: sDonnee[*]
.head 5 -  String: sBuffer2
.head 5 -  String: sTmp
.head 5 -  String: lsTypeF
.head 5 -  Long String: sErreur
.head 5 -  Long String: sErreurAffich
.head 5 -  Number: nSiegeSuppl
.head 5 -  Number: i
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnK
.head 5 -  Number: nNo
.head 5 -  Number: nLigne
.head 5 -  Number: nLongNom
.head 5 -  Number: nLongNomListe
.head 5 -  Boolean: bOk
.head 5 -  Boolean: lbPW_Suppl
.head 5 -  String: sSexeE[250, 100]
.head 5 -  String: sSexeS[250, 100]
.head 5 -  Number: nHommeE[*]
.head 5 -  Number: nFemmeE[*]
.head 5 -  Number: nHommeS[*]
.head 5 -  Number: nFemmeS[*]
.head 5 -  Number: lnChar
.head 5 -  String: lsTmp
.head 5 -  String: lsNoListeParticuliere
.head 5 -  Boolean: wbDonneeProvisoire
.head 5 -  Boolean: bSenatBHV
.head 5 -  Number: nIndiceBHV
.head 5 -  String: sGrpLingprec
.head 5 -  Number: lnTentative
.head 4 +  Actions
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Delete from Erreur_EnCours  where Err_ent_FK = :wnIdEntiteEnCours ")
.head 5 -  Call SqlCommit( ghSqlErreur )
.head 5 -  Set sErreur = ''
.head 5 -  Set nLongNom = 25
.head 5 -  Set nLongNomListe = 18
.head 5 -  Set bContinue = TRUE
.head 5 -  Set nIndice = 0
.head 5 -  Set nLigne = 0
.head 5 +  If nNoEl = 2 or nNoEl = 3 or nNoEl = 1
.head 6 +  If nSiege < 12
.head 7 -  Set nSiegeSuppl = 6
.head 6 +  Else
.head 7 -  Set nSiegeSuppl = SalNumberRound(  ( nSiege /2)+0.49999 ) + 1
.head 5 +  Else If nNoEl = 12
.head 6 -  Set nSiegeSuppl = 0
.head 5 +  Else
.head 6 +  If nSiege < 4
.head 7 -  Set nSiegeSuppl = 4
.head 6 +  Else If nSiege > 16
.head 7 -  Set nSiegeSuppl = 16
.head 6 +  Else
.head 7 -  Set nSiegeSuppl = nSiege
.head 5 -  !
.head 5 -  Set bSenatBHV = FALSE
.head 5 +  If nNoEl = 3 or nNoEl = 1
.head 6 +  If SalStrLeftX( sInsTot, 2)  = '21' or SalStrLeftX( sInsTot, 2)  = '23'
.head 7 -  Set bSenatBHV = TRUE
.head 5 +  Else If nNoEl = 10
.head 6 -  Set bSenatBHV = TRUE
.head 5 -  !
.head 5 -  Set sGrpLingprec = ''
.head 5 -  Set lnTentative = 0
.head 5 +  While NOT SalFileOpen( hFile, sFile, OF_Read | OF_Text ) and lnTentative < 3
.head 6 -  Call SalPause(250)
.head 6 -  Set lnTentative = lnTentative + 1
.head 5 -  Call SalFileClose( hFile )
.head 5 +  If SalFileOpen( hFile, sFile, OF_Read | OF_Text )
.head 6 -  Call DispatchMessage(  )
.head 6 +  While SalFileGetStr( hFile, sBuffer, 5000 ) and bContinue
.head 7 -  Call DispatchMessage(  )
.head 7 +  If SalStrTrimX( sBuffer ) != ''
.head 8 -  Set lnI = 0
.head 8 +  While lnI < 100
.head 9 -  Set sDonnee[lnI] = ""
.head 9 -  Set lnI =lnI + 1
.head 8 +  If NOT PalStrTokenize( sBuffer, sDonnee)
.head 9 -  ! Erreur de structure
.head 9 -  Set sErreur = gsMessage[19] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 9 -  Set bContinue = FALSE
.head 8 +  If bContinue
.head 9 +  If sDonnee[0] = 'G'
.head 10 -  Set wnNoListeProvisoire = 0
.head 10 +  If wsG[0] = ''
.head 11 -  Set wsG[0] = sDonnee[1]
.head 11 +  If wsG[0] = 'CK' and nNoEl = 2
.head 12 -  Set lsTypeF = 'C'
.head 11 +  Else If wsG[0] = 'SE' and nNoEl = 3
.head 12 -  Set lsTypeF = 'L'
.head 11 +  Else If wsG[0] = 'WL' and nNoEl = 4
.head 12 -  Set lsTypeF = 'C'
.head 11 +  Else If (wsG[0] = 'VL' or (wsG[0] = 'BV' and SalStrRightX(SalStrLeftX( sFileNameSeul,4),2)='21') ) and nNoEl = 7
.head 12 -  Set lsTypeF = 'C'
.head 11 +  Else If wsG[0] = 'BR' and nNoEl = 10
.head 12 -  Set lsTypeF = 'R'
.head 11 +  Else If (wsG[0] = 'BV' or wsG[0] = 'VL') and nNoEl = 11
.head 12 -  Set lsTypeF = 'C'
.head 11 +  Else If wsG[0] = 'DE' and nNoEl = 12
.head 12 -  Set lsTypeF = 'G'
.head 11 +  Else If wsG[0] = 'EU' and nNoEl = 1
.head 12 -  Set lsTypeF = 'L'
.head 11 +  Else
.head 12 -  ! Le type d'élection est erroné
.head 12 -  Set sErreur = gsMessage[20] ||'
' || sFileNameSeul ||'
'|| sBuffer
.head 12 -  Set bContinue = FALSE
.head 10 +  Else
.head 11 -  ! Cette ligne est en double dans le fichier
.head 11 -  Set sErreur = gsMessage[21] ||'
' || sFileNameSeul  ||'
'|| sBuffer
.head 11 -  Set bContinue = FALSE
.head 10 -  !
.head 10 +  If bContinue
.head 11 +  If sDonnee[2]  != gsDateEl
.head 12 -  ! La date d'élection ne correpond pas à celle du logiciel
.head 12 -  Set sErreur = gsMessage[22] ||'
' || sFileNameSeul
.head 12 -  ! ATTENTION : A remettre à FALSE quand tout sera OK
.head 12 -  Set bContinue = TRUE
.head 9 +  Else If sDonnee[0] = 'S'
.head 10 +  If wsS[0] = '' or ( bSenatBHV )
.head 11 +  If lsTypeF = sDonnee[1]
.head 12 +  If sIns[1] = sDonnee[2] or (sIns[2] = sDonnee[2] and bSenatBHV )
.head 13 +  If sInsTot !=''
.head 14 +  If sInsTot != sDonnee[6]
.head 15 -  ! Le code INS de l'entité de totalisation ne correspond pas
.head 15 -  Set sErreur = gsMessage[10] ||'
' || sFileNameSeul  ||'
'|| sBuffer
.head 15 -  Set bContinue = FALSE
.head 13 +  If bContinue
.head 14 +  If (nSiege = SalStrToNumber(sDonnee[3] )) or ( nSiege >= SalStrToNumber(sDonnee[3] ) and bSenatBHV )
.head 15 +  If bSenatBHV and ((sDonnee[2] = sIns[2] and nNoEl != 10) or ( nNoEl = 10 and sDonnee[8] != sGrpLingprec and sGrpLingprec != '')  )
.head 16 -  Set nIndiceBHV = 20
.head 15 +  Else
.head 16 -  Set nIndiceBHV = 0
.head 15 -  Set wsS[0+nIndiceBHV] = sDonnee[2]
.head 15 -  Set wsS[1+nIndiceBHV] = sDonnee[3]
.head 15 +  If nNoEl != 12
.head 16 +  If ( nSiegeSuppl = SalStrToNumber(sDonnee[4] ) ) or ( nSiegeSuppl >= SalStrToNumber(sDonnee[4] ) and bSenatBHV )
.head 17 -  Set wsS[2+nIndiceBHV] = sDonnee[4]
.head 16 +  Else
.head 17 -  ! Le nombre de sièges à pourvoir n'est pas identique entre le fichier et le logiciel
.head 17 -  Set sErreur =  gsMessage[12] ||" : " || gsMessage[11] ||'
' || sFileNameSeul ||'
'|| sBuffer
.head 17 -  Set bContinue = FALSE
.head 15 +  Else
.head 16 -  Set wsS[2] = ''
.head 15 -  Set wsS[4+nIndiceBHV] = lsTypeF
.head 15 -  Set wsS[6+nIndiceBHV] = sDonnee[6]
.head 15 -  Set wsS[7+nIndiceBHV] = sDonnee[7]
.head 15 -  Set wsS[8+nIndiceBHV] = sDonnee[8]
.head 15 -  Set wsS[9+nIndiceBHV] = sDonnee[9]
.head 15 -  Set wsS[10+nIndiceBHV] = sDonnee[10]
.head 15 -  Set wsS[11+nIndiceBHV] = sDonnee[11]
.head 15 -  ! Check SUM
.head 15 +  If SalStrLeftX( sFileNameSeul, 2 ) = '1K'
.head 16 -  Set wsS[12+nIndiceBHV] = sDonnee[12]
.head 15 +  Else
.head 16 -  Set wsS[12+nIndiceBHV] = ''
.head 15 -  ! E5
.head 15 -  Set wsS[13+nIndiceBHV] = sDonnee[13]
.head 15 -  Set wsS[14+nIndiceBHV] = sDonnee[14]
.head 14 +  Else
.head 15 -  ! Le nombre de sièges à pourvoir n'est pas identique entre le fichier et le logiciel
.head 15 -  Set sErreur = gsMessage[11] ||'
' || sFileNameSeul  ||'
'|| sBuffer
.head 15 -  Set bContinue = FALSE
.head 14 -  !
.head 14 +  If nNoEl = 10
.head 15 -  Set sGrpLingprec = sDonnee[8]
.head 12 +  Else
.head 13 -  ! Le code INS de l'entité ne correspond pas au choix
.head 13 -  Set sErreur = gsMessage[10] ||'
' || sFileNameSeul  ||'
'|| sBuffer
.head 13 -  Set bContinue = FALSE
.head 11 +  Else
.head 12 -  ! Ce type d'élection ne correpond pas à l'enregistrement général
.head 12 -  Set sErreur = gsMessage[20] ||'
' || sFileNameSeul  ||'
'|| sBuffer
.head 12 -  Set bContinue = FALSE
.head 10 +  Else
.head 11 -  ! Cette ligne est en double dans le fichier
.head 11 -  Set sErreur = gsMessage[21] ||'
' || sFileNameSeul ||'
'|| sBuffer
.head 11 -  Set bContinue = FALSE
.head 9 +  Else If sDonnee[0] = 'L'
.head 10 +  If lsTypeF = sDonnee[1]
.head 11 +  If sIns[1] = sDonnee[2] or (sIns[2] = sDonnee[2] and bSenatBHV )
.head 12 +  ! If SalStrLength( sDonnee[3]) > 1
.head 13 +  If sErreur != ''
.head 14 -  Set sErreur = sErreur || '
'
.head 13 -  ! Le nom du groupe est > à 1 car.
.head 13 -  Set sErreur = sErreur ||  PalTraductMsg( 'FoF16') ||' ' || sDonnee[3] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 12 +  If sInsTot !=''
.head 13 +  If sInsTot != sDonnee[14]
.head 14 -  ! Le code INS de l'entité de totalisation ne correspond pas
.head 14 -  Set sErreur = gsMessage[10] ||'
' || sFileNameSeul ||'
'|| sBuffer
.head 14 -  Set bContinue = FALSE
.head 12 -  !
.head 12 +  If sDonnee[4] = ''
.head 13 -  Set sDonnee[4] = PalDtmNoListeProvisoire( sDonnee[3] )
.head 13 -  Set wbDonneeProvisoire = TRUE
.head 12 +  Else
.head 13 -  Set wbDonneeProvisoire = FALSE
.head 12 -  !
.head 12 +  If wsL[ SalStrToNumber( sDonnee[4] ) , 0 ] = ''
.head 13 +  If SalStrLength( sDonnee[5]) <= nLongNomListe and SalStrTrimX( sDonnee[5]) != ''
.head 14 +  ! If NOT PalCaractere437( PalConverWin437( sDonnee[5] ) , sErrCaract )
.head 15 +  If sErreur != ''
.head 16 -  Set sErreur = sErreur || '
'
.head 15 -  ! Caractères ne repondent pas au code page 437
.head 15 -  Set sErreur = sErreur ||  gsMessage[14] ||': ' || sErrCaract ||'
' || sBuffer||'
'
.head 14 -  !
.head 14 -  Set nHommeE[SalStrToNumber( sDonnee[4] ) ] = 0
.head 14 -  Set nFemmeE[SalStrToNumber( sDonnee[4] ) ] = 0
.head 14 -  Set nHommeS[SalStrToNumber( sDonnee[4] ) ] = 0
.head 14 -  Set nFemmeS[SalStrToNumber( sDonnee[4] ) ] = 0
.head 14 -  !
.head 14 -  Set wsL[ SalStrToNumber( sDonnee[4] ) , 0 ] = sDonnee[5]
.head 14 +  If SalStrToNumber( sDonnee[6] ) > 0 and SalStrToNumber( sDonnee[6] ) <= nSiege
.head 15 -  Set wsL[ SalStrToNumber( sDonnee[4] ) , 1 ] = sDonnee[6]
.head 15 -  ! Ctrl des suppléants sauf pour Conseil Germano (pas de suppl)
.head 15 +  If nNoEl != 12
.head 16 +  If SalStrToNumber( sDonnee[7] ) > 0 and SalStrToNumber( sDonnee[7] ) <= SalStrToNumber(wsS[2])
.head 17 -  Set wsL[ SalStrToNumber( sDonnee[4] ) , 2 ] = sDonnee[7]
.head 17 -  !
.head 17 -  Set lnJ = 0
.head 17 +  While lnJ < 31
.head 18 -  Set wsL[ SalStrToNumber( sDonnee[4] ) , 10+lnJ ] = sDonnee[lnJ]
.head 18 -  Set lnJ = lnJ + 1
.head 16 +  Else
.head 17 -  ! Le nombre de suppléant est erroné
.head 17 -  Set sErreur = gsMessage[16] ||'
' || sFileNameSeul  ||'
'|| sBuffer
.head 17 -  Set bContinue = FALSE
.head 16 -  !
.head 15 +  Else
.head 16 -  Set lnJ = 0
.head 16 +  While lnJ < 31
.head 17 -  Set wsL[ SalStrToNumber( sDonnee[4] ) , 10+lnJ ] = sDonnee[lnJ]
.head 17 -  Set lnJ = lnJ + 1
.head 14 +  Else
.head 15 -  ! Le nombre de cdt de la liste est > au nombre de sièges ou est nul
.head 15 -  Set sErreur = gsMessage[15] ||'
' || sFileNameSeul ||'
'|| sBuffer
.head 15 -  Set bContinue = FALSE
.head 13 +  Else
.head 14 -  ! Le nombre de caractère du sigle de la liste est >à (25 ou 18) ou vide
.head 14 -  Set sTmp = gsMessage[13]
.head 14 +  If nLongNomListe != 25
.head 15 -  Set sTmp = VisStrSubstitute( sTmp , '25', SalNumberToStrX( nLongNomListe,0) )
.head 14 -  Set sErreur = sTmp ||'
' || sFileNameSeul ||'
'|| sBuffer
.head 14 -  Set bContinue = FALSE
.head 12 +  Else
.head 13 -  ! Cette ligne est en double dans le fichier
.head 13 -  Set sErreur = gsMessage[21] ||'
' || sFileNameSeul ||'
'|| sBuffer
.head 13 -  Set bContinue = FALSE
.head 11 +  Else
.head 12 -  ! L'entité ne correspond pas au choix
.head 12 -  Set sErreur = gsMessage[10] ||'
' || sFileNameSeul  ||'
'|| sBuffer
.head 12 -  Set bContinue = FALSE
.head 10 +  Else
.head 11 -  ! Ce type d'élection ne correpond pas à l'enregistrement général
.head 11 -  Set sErreur = gsMessage[20] ||'
' || sFileNameSeul ||'
'|| sBuffer
.head 11 -  Set bContinue = FALSE
.head 9 +  Else If sDonnee[0] = 'C'
.head 10 +  If lsTypeF = sDonnee[1]
.head 11 +  If sIns[1] = sDonnee[2] or (sIns[2] = sDonnee[2] and bSenatBHV )
.head 12 +  If wbDonneeProvisoire
.head 13 -  Set sDonnee[4] = PalDtmNoListeProvisoire( sDonnee[3] )
.head 12 +  If wsL[ SalStrToNumber( sDonnee[4] ) , 0 ] != ''
.head 13 +  ! If SalStrLength( sDonnee[3]) > 1
.head 14 +  If sErreur != ''
.head 15 -  Set sErreur = sErreur || '
'
.head 14 -  ! Le nom du groupe est > à 1 car.
.head 14 -  Set sErreur = sErreur ||  PalTraductMsg( 'FoF16') ||' ' || sDonnee[3] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 13 -  !
.head 13 +  If sDonnee[5] = 'E'
.head 14 -  ! ! ! Parité Hommes / Femmes
.head 14 +  If sDonnee[10] = 'M'
.head 15 -  Set nHommeE[SalStrToNumber( sDonnee[4] ) ]  = nHommeE[SalStrToNumber( sDonnee[4] ) ]  + 1
.head 14 +  Else If sDonnee[10] = 'F'
.head 15 -  Set nFemmeE[SalStrToNumber( sDonnee[4] ) ]  = nFemmeE[SalStrToNumber( sDonnee[4] ) ]  + 1
.head 14 +  Else
.head 15 +  If sErreur != ''
.head 16 -  Set sErreur = sErreur || '
'
.head 15 -  ! Le sexe du candidat est erroné
.head 15 -  Set sErreur = sErreur || gsMessage[25]  ||' ' || sDonnee[3] ||'
' || sFileNameSeul
.head 14 -  Set sSexeE[SalStrToNumber( sDonnee[4] ) , SalStrToNumber( sDonnee[6] )]  = sDonnee[10]
.head 14 -  !
.head 14 +  If SalStrToNumber( sDonnee[6] ) > 0 and SalStrToNumber( sDonnee[6] ) <= nSiege and SalStrToNumber( sDonnee[6] ) <= SalStrToNumber( wsL[ SalStrToNumber( sDonnee[4] ) , 1 ] )
.head 15 +  If sDonnee[6] = '1'
.head 16 -  Set bContinue = TRUE
.head 15 +  Else If wsC[ SalStrToNumber( sDonnee[4] ), SalStrToNumber( sDonnee[6] )-1 , 0 ] != '' or wsC[ SalStrToNumber( sDonnee[4] ), SalStrToNumber( sDonnee[6] )-1 ,1 ] != ''
.head 16 -  Set bContinue = TRUE
.head 15 +  Else
.head 16 -  ! Erreur dans la succession des numéros de candidats
.head 16 -  Set sErreur = gsMessage[27] ||'
' || sFileNameSeul
.head 16 -  Set bContinue = FALSE
.head 15 +  If bContinue
.head 16 -  Set lsTmp = sDonnee[28]
.head 16 +  If NOT PalCaractere437( lsTmp , sErrCaract )
.head 17 +  If sErreur != ''
.head 18 -  Set sErreur = sErreur || '
'
.head 17 -  ! Caractères ne repondent pas au code page 437
.head 17 -  Set sErreur = sErreur ||  gsMessage[35] ||': ' || sErrCaract
.head 16 +  Else
.head 17 -  Set sDonnee[28] = lsTmp
.head 16 -  Set lsTmp = sDonnee[29]
.head 16 +  If NOT PalCaractere437( lsTmp , sErrCaract )
.head 17 +  If sErreur != ''
.head 18 -  Set sErreur = sErreur || '
'
.head 17 -  ! Caractères ne repondent pas au code page 437
.head 17 -  Set sErreur = sErreur ||  gsMessage[35] ||': ' || sErrCaract 
.head 16 +  Else
.head 17 -  Set sDonnee[29] = lsTmp
.head 16 -  Set lnJ = 0
.head 16 +  While lnJ < 31
.head 17 -  Set wsC[ SalStrToNumber( sDonnee[4] ), SalStrToNumber( sDonnee[6] ) , lnJ ] = sDonnee[lnJ]
.head 17 -  Set lnJ = lnJ + 1
.head 14 +  Else
.head 15 -  ! Le nombre de cdt de la liste est > au nombre de cdts indiqué dans la ligne de type L ou est nul
.head 15 -  Set sErreur = gsMessage[26] ||'
' || sFileNameSeul 
.head 15 -  Set bContinue = FALSE
.head 13 +  Else If sDonnee[5] = 'S'
.head 14 -  ! ! ! Parité Hommes / Femmes
.head 14 +  If sDonnee[10] = 'M'
.head 15 -  Set nHommeS[SalStrToNumber( sDonnee[4] ) ]  = nHommeS[SalStrToNumber( sDonnee[4] ) ]  + 1
.head 14 +  Else If sDonnee[10] = 'F'
.head 15 -  Set nFemmeS[SalStrToNumber( sDonnee[4] ) ]  = nFemmeS[SalStrToNumber( sDonnee[4] ) ]  + 1
.head 14 +  Else
.head 15 +  If sErreur != ''
.head 16 -  Set sErreur = sErreur || '
'
.head 15 -  ! Le sexe du candidat est erroné
.head 15 -  Set sErreur = sErreur || gsMessage[25]  ||' ' || sDonnee[3] ||'
' || sFileNameSeul
.head 14 -  Set sSexeS[SalStrToNumber( sDonnee[4] ), SalStrToNumber( sDonnee[6] ) ]  = sDonnee[10]
.head 14 -  ! !
.head 14 +  If SalStrToNumber( sDonnee[6] ) > 0 and SalStrToNumber( sDonnee[6] ) <= nSiegeSuppl and SalStrToNumber( sDonnee[6] ) <= SalStrToNumber( wsL[ SalStrToNumber( sDonnee[4] ) , 2 ] )
.head 15 +  If sDonnee[6] = '1'
.head 16 -  Set bContinue = TRUE
.head 15 +  Else If wsSuppl[ SalStrToNumber( sDonnee[4] ), SalStrToNumber( sDonnee[6] )-1 , 0 ] != '' or wsSuppl[ SalStrToNumber( sDonnee[4] ), SalStrToNumber( sDonnee[6] )-1 ,1 ] != ''
.head 16 -  Set bContinue = TRUE
.head 15 +  Else
.head 16 -  ! Erreur dans la succession des numéros de candidats
.head 16 -  Set sErreur = gsMessage[12]||" : " || gsMessage[27] ||'
' || sFileNameSeul
.head 16 -  Set bContinue = FALSE
.head 15 +  If bContinue
.head 16 -  Set lsTmp = sDonnee[28]
.head 16 +  If NOT PalCaractere437( lsTmp , sErrCaract )
.head 17 +  If sErreur != ''
.head 18 -  Set sErreur = sErreur || '
'
.head 17 -  ! Caractères ne repondent pas au code page 437
.head 17 -  Set sErreur = sErreur ||  'SUPPL. '|| gsMessage[35] ||': ' || sErrCaract
.head 16 +  Else
.head 17 -  Set sDonnee[28] = lsTmp
.head 16 -  Set lsTmp = sDonnee[29]
.head 16 +  If NOT PalCaractere437( lsTmp , sErrCaract )
.head 17 +  If sErreur != ''
.head 18 -  Set sErreur = sErreur || '
'
.head 17 -  ! Caractères ne repondent pas au code page 437
.head 17 -  Set sErreur = sErreur ||  'SUPPL. '||  gsMessage[35] ||': ' || sErrCaract 
.head 16 +  Else
.head 17 -  Set sDonnee[29] = lsTmp
.head 16 -  Set lnJ = 0
.head 16 +  While lnJ < 32
.head 17 -  Set wsSuppl[ SalStrToNumber( sDonnee[4] ), SalStrToNumber( sDonnee[6] ) , lnJ ] = sDonnee[lnJ]
.head 17 -  Set lnJ = lnJ + 1
.head 14 +  Else
.head 15 -  ! Le nombre de cdt de la liste est > au nombre de cdts indiqué dans la ligne de type L ou est nul
.head 15 -  Set sErreur = gsMessage[12] ||' : '|| gsMessage[26] ||'
' || sFileNameSeul 
.head 15 -  Set bContinue = FALSE
.head 13 +  Else
.head 14 -  ! Le type de candidat est erroné
.head 14 -  Set sErreur = gsMessage[24] ||'
' || sFileNameSeul ||'
'|| sBuffer
.head 14 -  Set bContinue = FALSE
.head 12 +  Else
.head 13 -  ! Pas de ligne de type "L" pour ce candidat
.head 13 -  Set sErreur = gsMessage[23] ||'
' || sFileNameSeul  ||'
'|| sBuffer
.head 13 -  Set bContinue = FALSE
.head 11 +  Else
.head 12 -  ! L'entité ne correspond pas au choix
.head 12 -  Set sErreur = gsMessage[10] ||'
' || sFileNameSeul  ||'
'|| sBuffer
.head 12 -  Set bContinue = FALSE
.head 10 +  Else
.head 11 -  ! Ce type d'élection ne correpond pas à l'enregistrement général
.head 11 -  Set sErreur = gsMessage[20] ||'
' || sFileNameSeul  ||'
'|| sBuffer
.head 11 -  Set bContinue = FALSE
.head 9 +  Else If sDonnee[0] = 'H'
.head 10 -  Set lnK = 0
.head 10 +  While lnK < 6
.head 11 -  Set wsH[lnK] = sDonnee[lnK]
.head 11 -  Set lnK = lnK + 1
.head 9 +  Else If sDonnee[0] = 'T'
.head 10 -  Set lnK = 0
.head 10 +  While lnK < 6
.head 11 -  Set wsT[lnK] = sDonnee[lnK]
.head 11 -  Set lnK = lnK + 1
.head 9 +  Else
.head 10 -  ! Ce type de ligne n'existe pas !!
.head 10 -  Set sErreur = gsMessage[17] ||'
' || sFileNameSeul  ||'
'|| sBuffer
.head 10 -  Set bContinue = FALSE
.head 6 -  Call SalFileClose( hFile )
.head 5 +  Else
.head 6 -  Set sErreur = gsMessage[18] ||'
' || sFileNameSeul ||'
'|| sFile
.head 6 -  Set bContinue = FALSE
.head 5 -  !
.head 5 +  If bContinue
.head 6 +  If SalStrLeftX( sFileNameSeul, 1) != '0'
.head 7 -  Set lnI = 1
.head 7 +  While lnI <= 200
.head 8 +  If wsL[ lnI , 0 ] != ''
.head 9 +  If sSexeE[lnI, 1] = sSexeE[lnI, 2]
.head 10 +  If sErreur != ''
.head 11 -  Set sErreur = sErreur || '
'
.head 10 -  ! Erreur de parité dans cette liste sur les 2 premiers candidats effectifs
.head 10 -  Set sErreur = sErreur ||  gsMessage[28] ||  '  - ' || wsL[lnI,0]
.head 9 +  If nSiegeSuppl > 0
.head 10 +  If sSexeS[lnI, 1] = sSexeS[lnI, 2]
.head 11 +  If sErreur != ''
.head 12 -  Set sErreur = sErreur || '
'
.head 11 -  ! Erreur de parité dans cette liste sur les 2 premiers candidats suppléants
.head 11 -  Set sErreur = sErreur ||  gsMessage[29] ||  '  - ' || wsL[lnI,0]
.head 9 +  If SalNumberAbs( nHommeE[lnI] - nFemmeE[lnI] ) > 1
.head 10 +  If sErreur != ''
.head 11 -  Set sErreur = sErreur || '
'
.head 10 -  ! Erreur de parité dans cette liste
.head 10 -  Set sErreur = sErreur ||  gsMessage[30] || '  - ' || wsL[lnI,0]
.head 9 +  If nSiegeSuppl > 0
.head 10 +  If SalNumberAbs( nHommeS[lnI] - nFemmeS[lnI] ) > 1
.head 11 +  If sErreur != ''
.head 12 -  Set sErreur = sErreur || '
'
.head 11 -  ! Erreur de parité dans cette liste
.head 11 -  Set sErreur = sErreur ||  gsMessage[12]||" :" || gsMessage[30] || '  - ' || wsL[lnI,0]
.head 8 -  Set lnI = lnI + 1
.head 5 -  !
.head 5 +  If sErreur != '' and NOT bContinue
.head 6 +  If SalFileOpen( hFile, gsPathErreurFF || sFileNameSeul || '.LOG' , OF_Create | OF_Text | OF_ReadWrite )
.head 7 -  Call SalFilePutStr( hFile, sErreur )
.head 7 -  Call SalFileClose( hFile )
.head 5 +  Else
.head 6 -  Call VisFileDelete(  gsPathErreurFF || sFileNameSeul || '.LOG')
.head 5 +  If sErreur != '' and bContinue
.head 6 -  ! Warning
.head 6 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 6 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 0, :sErreur ) ")
.head 6 -  Call SqlCommit( ghSqlErreur )
.head 5 +  Else If not bContinue
.head 6 -  ! Erreur
.head 6 -  Call PalHttpCockpit( 416, '', '1', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 6 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur ) ")
.head 6 -  Call SqlCommit( ghSqlErreur )
.head 5 -  Return ( bContinue )
.head 3 +  Function: PalChargeFormatC
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sFile
.head 5 -  String: sIns[5]
.head 5 -  Number: nNoEl
.head 5 -  String: sInsTot
.head 5 -  String: sFileNameSeul
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 5 -  Boolean: bContinue
.head 5 -  Number: nIndice
.head 5 -  Long String: sBuffer
.head 5 -  Long String: sErrCaract
.head 5 -  String: sDonnee[*]
.head 5 -  String: sBuffer2
.head 5 -  String: sTmp
.head 5 -  String: lsTypeF
.head 5 -  Long String: sErreur
.head 5 -  Long String: sErreurAffich
.head 5 -  Number: nSiegeSuppl
.head 5 -  Number: i
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnK
.head 5 -  Number: nNo
.head 5 -  Number: nLigne
.head 5 -  Number: nLongNom
.head 5 -  Number: nLongNomListe
.head 5 -  Boolean: bOk
.head 5 -  Boolean: lbPW_Suppl
.head 5 -  String: sSexeE[250, 100]
.head 5 -  String: sSexeS[250, 100]
.head 5 -  Number: nHommeE[*]
.head 5 -  Number: nFemmeE[*]
.head 5 -  Number: nHommeS[*]
.head 5 -  Number: nFemmeS[*]
.head 5 -  Number: lnChar
.head 5 -  String: lsTmp
.head 5 -  String: lsNoListeParticuliere
.head 5 -  Boolean: wbDonneeProvisoire
.head 5 -  Boolean: bSenatBHV
.head 5 -  Number: nIndiceBHV
.head 5 -  Number: lnTentative
.head 4 +  Actions
.head 5 -  Call DispatchMessage(  )
.head 5 -  Set sErreur = ''
.head 5 -  Set nLongNom = 25
.head 5 -  Set nLongNomListe = 25
.head 5 -  Set bContinue = TRUE
.head 5 -  Set nIndice = 0
.head 5 -  Set nLigne = 0
.head 5 -  !
.head 5 -  Set lsTypeF = SalStrMidX( sFileNameSeul, 1,1)
.head 5 -  !
.head 5 -  Set lnTentative = 0
.head 5 +  While NOT SalFileOpen( hFile, sFile, OF_Read | OF_Text ) and lnTentative < 3
.head 6 -  Call SalPause(250)
.head 6 -  Set lnTentative = lnTentative + 1
.head 5 -  Call SalFileClose( hFile )
.head 5 +  If SalFileOpen( hFile, sFile, OF_Read | OF_Text )
.head 6 -  Call DispatchMessage(  )
.head 6 +  While SalFileGetStr( hFile, sBuffer, 5000 ) and bContinue
.head 7 -  Call DispatchMessage(  )
.head 7 +  If SalStrTrimX( sBuffer ) != ''
.head 8 -  Set lnI = 0
.head 8 +  While lnI < 100
.head 9 -  Set sDonnee[lnI] = ""
.head 9 -  Set lnI =lnI + 1
.head 8 +  If NOT PalStrTokenize( sBuffer, sDonnee)
.head 9 -  ! Erreur de structure
.head 9 -  Set sErreur = gsMessage[19] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 9 -  Set bContinue = FALSE
.head 8 +  If bContinue
.head 9 +  If sDonnee[0] = 'G'
.head 10 -  Set wnNoListeProvisoire = 0
.head 10 +  If wsG[0] = ''
.head 11 -  Set wsG[0] = sDonnee[1]
.head 11 +  If wsG[0] = 'CK' and nNoEl = 2
.head 12 -  Set bContinue = TRUE
.head 11 +  Else If wsG[0] = 'SE' and nNoEl = 3
.head 12 -  Set bContinue = TRUE
.head 11 +  Else If wsG[0] = 'EU' and nNoEl = 1
.head 12 -  Set bContinue = TRUE
.head 11 +  Else If wsG[0] = 'WL' and nNoEl = 4
.head 12 -  Set bContinue = TRUE
.head 11 +  Else If wsG[0] = 'VL' and nNoEl = 7
.head 12 -  Set bContinue = TRUE
.head 11 +  Else If wsG[0] = 'BR' and nNoEl = 10
.head 12 -  Set bContinue = TRUE
.head 11 +  Else If wsG[0] = 'BV' and nNoEl = 11
.head 12 -  Set bContinue = TRUE
.head 11 +  Else If wsG[0] = 'DE' and nNoEl = 12
.head 12 -  Set bContinue = TRUE
.head 11 +  Else
.head 12 -  ! Le type d'élection est erroné
.head 12 -  Set sErreur = gsMessage[20] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 12 -  Set bContinue = FALSE
.head 10 +  Else
.head 11 -  ! Cette ligne est en double dans le fichier
.head 11 -  Set sErreur = gsMessage[21] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 11 -  Set bContinue = FALSE
.head 10 -  !
.head 10 +  If bContinue
.head 11 +  If sDonnee[2]  != gsDateEl
.head 12 -  ! La date d'élection ne correpond pas à celle du logiciel
.head 12 -  Set sErreur = gsMessage[22] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 12 -  ! ATTENTION : A remettre à FALSE quand tout sera OK
.head 12 -  Set bContinue = TRUE
.head 9 +  Else If sDonnee[0] = 'B'
.head 10 +  If wsB[0] = ''
.head 11 +  If lsTypeF = sDonnee[1]
.head 12 +  If sIns[1] = sDonnee[2] 
.head 13 +  If bContinue
.head 14 -  Set lnI = 0
.head 14 +  While lnI < 6
.head 15 -  Set wsB[lnI] = sDonnee[lnI]
.head 15 -  Set lnI =lnI + 1
.head 12 +  Else
.head 13 -  ! Le code INS de l'entité ne correspond pas au choix
.head 13 -  Set sErreur = gsMessage[10] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 13 -  Set bContinue = FALSE
.head 11 +  Else
.head 12 -  ! Ce type d'élection ne correpond pas à l'enregistrement général
.head 12 -  Set sErreur = gsMessage[20] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 12 -  Set bContinue = FALSE
.head 10 +  Else
.head 11 -  ! Cette ligne est en double dans le fichier
.head 11 -  Set sErreur = gsMessage[21] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 11 -  Set bContinue = FALSE
.head 9 +  Else If sDonnee[0] = 'A'
.head 10 +  If lsTypeF = sDonnee[1]
.head 11 +  If sIns[1] = sDonnee[2] 
.head 12 +  If sDonnee[3] != ''
.head 13 +  If sDonnee[3] = 'C'
.head 14 -  ! Adresse ordinaire
.head 14 -  Set lnK = 0
.head 13 +  Else If sDonnee[3] = 'B'
.head 14 -  ! Adresse jour des élections
.head 14 -  Set lnK = 1
.head 13 +  Else
.head 14 -  Set lnK = -1
.head 14 -  ! Type d'adresse inconnue
.head 14 -  Set sErreur = gsMessage[113] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 14 -  ! Warning
.head 14 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 14 -  ! Insert dans Erreur_EnCours pour cette entité
.head 14 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur)  ")
.head 14 -  Set sErreur = ''
.head 13 +  If lnK >=0
.head 14 +  If wsA[ lnK, 0 ] = ''
.head 15 -  Set lnI = 0
.head 15 +  While lnI < 15
.head 16 -  Set wsA[lnK, lnI] = sDonnee[lnI]
.head 16 -  Set lnI =lnI + 1
.head 14 +  Else
.head 15 -  ! Cette ligne est en double dans le fichier
.head 15 -  Set sErreur = gsMessage[21] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 12 +  Else
.head 13 -  ! Donnee vide pour cette ligne !!
.head 13 -  Set sErreur = gsMessage[112] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 12 -  !
.head 11 +  Else
.head 12 -  ! L'entité ne correspond pas au choix
.head 12 -  Set sErreur = gsMessage[10] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 12 -  Set bContinue = FALSE
.head 10 +  Else
.head 11 -  ! Ce type d'élection ne correpond pas à l'enregistrement général
.head 11 -  Set sErreur = gsMessage[20] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 11 -  Set bContinue = FALSE
.head 9 +  Else If sDonnee[0] = 'C'
.head 10 +  If lsTypeF = sDonnee[1]
.head 11 +  If sIns[1] = sDonnee[2] 
.head 12 +  If sDonnee[3] != ''
.head 13 +  If sDonnee[3] = '1'
.head 14 -  ! Président
.head 14 +  If sDonnee[20] = ''
.head 15 -  ! NN obligatoire
.head 15 -  Set sErreur = gsMessage[110] ||" : Président  NN" ||' - ' || sFileNameSeul ||' - ' || sBuffer
.head 15 -  ! Warning
.head 15 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 15 -  ! Insert dans Erreur_EnCours pour cette entité
.head 15 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur ) ")
.head 15 -  Set sErreur = ''
.head 14 +  If sDonnee[8] = ''
.head 15 -  ! Tél1 obligatoire
.head 15 -  Set sErreur = gsMessage[110] ||" : Président  Tél1" ||' - ' || sFileNameSeul ||' - ' || sBuffer
.head 15 -  ! Warning
.head 15 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 15 -  ! Insert dans Erreur_EnCours pour cette entité
.head 15 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur ) ")
.head 15 -  Set sErreur = ''
.head 13 +  If sDonnee[3] = '2'
.head 14 -  ! Secrétaire
.head 14 +  If sDonnee[20] = ''
.head 15 -  ! NN obligatoire
.head 15 -  Set sErreur = gsMessage[110] ||" : Secrétaire  NN" ||' - ' || sFileNameSeul ||' - ' || sBuffer
.head 15 -  ! Warning
.head 15 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 15 -  ! Insert dans Erreur_EnCours pour cette entité
.head 15 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur  )")
.head 15 -  Set sErreur = ''
.head 14 +  If sDonnee[8] = ''
.head 15 -  ! Tél1 obligatoire
.head 15 -  Set sErreur = gsMessage[110] ||" : Secrétaire  Tél1" ||' - ' || sFileNameSeul ||' - ' || sBuffer
.head 15 -  ! Warning
.head 15 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 15 -  ! Insert dans Erreur_EnCours pour cette entité
.head 15 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur ) ")
.head 15 -  Set sErreur = ''
.head 13 +  If sDonnee[3] = '3'
.head 14 -  ! Personne de contact
.head 14 +  If sDonnee[8] = ''
.head 15 -  ! Tél1 obligatoire
.head 15 -  Set sErreur = gsMessage[110] ||" : Pers. Contact  Tél1" ||' - ' || sFileNameSeul ||' - ' || sBuffer
.head 15 -  ! Warning
.head 15 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 15 -  ! Insert dans Erreur_EnCours pour cette entité
.head 15 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur)  ")
.head 15 -  Set sErreur = ''
.head 13 +  If sDonnee[3] = '5'
.head 14 -  ! Responsable de transmission
.head 14 +  If sDonnee[8] = ''
.head 15 -  ! Tél1 obligatoire
.head 15 -  Set sErreur = gsMessage[110] ||" : Resp. Transmission  Tél1" ||' - ' || sFileNameSeul ||' - ' || sBuffer
.head 15 -  ! Warning
.head 15 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 15 -  ! Insert dans Erreur_EnCours pour cette entité
.head 15 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur ) ")
.head 15 -  Set sErreur = ''
.head 13 -  !
.head 13 -  Set lnK = SalStrToNumber( sDonnee[3] )
.head 13 -  !
.head 13 +  If lnK >0 and lnK<8
.head 14 +  If wsCo[ lnK, 0 ] = ''
.head 15 -  Set lnI = 0
.head 15 +  While lnI < 22
.head 16 -  Set wsCo[lnK, lnI] = sDonnee[lnI]
.head 16 -  Set lnI =lnI + 1
.head 15 -  !
.head 15 +  If SalStrLength( wsCo[lnK, 15] ) > 4
.head 16 -  Set wsCo[lnK, 15]  = SalStrRightX( wsCo[lnK, 15] , 4 )
.head 15 -  !
.head 14 +  Else
.head 15 -  ! Cette ligne est en double dans le fichier
.head 15 -  Set sErreur = gsMessage[21] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 13 +  Else
.head 14 -  ! Type de contact inconnu
.head 14 -  Set sErreur = gsMessage[111] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 12 +  Else
.head 13 -  ! Donnee vide pour cette ligne !!
.head 13 -  Set sErreur = gsMessage[112] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 12 -  !
.head 11 +  Else
.head 12 -  ! L'entité ne correspond pas au choix
.head 12 -  Set sErreur = gsMessage[10] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 12 -  Set bContinue = FALSE
.head 10 +  Else
.head 11 -  ! Ce type d'élection ne correpond pas à l'enregistrement général
.head 11 -  Set sErreur = gsMessage[20] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 11 -  Set bContinue = FALSE
.head 9 +  Else If sDonnee[0] = 'H'
.head 10 -  Set lnK = 0
.head 10 +  While lnK < 6
.head 11 -  Set wsH[lnK] = sDonnee[lnK]
.head 11 -  Set lnK = lnK + 1
.head 9 +  Else
.head 10 -  ! Ce type de ligne n'existe pas !!
.head 10 -  Set sErreur = gsMessage[17] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 10 -  Set bContinue = FALSE
.head 7 +  If sErreur != '' and bContinue
.head 8 -  Set sErreur = VisStrSubstitute( sErreur , "
", " - " )
.head 8 -  ! Warning
.head 8 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 8 -  ! Insert dans Erreur_EnCours pour cette entité
.head 8 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur ) ")
.head 8 -  Set sErreur = ''
.head 6 -  Call SalFileClose( hFile )
.head 5 +  Else
.head 6 -  Set sErreur = gsMessage[18] ||'
' || sFileNameSeul
.head 6 -  Set bContinue = FALSE
.head 5 -  !
.head 5 -  ! Controle si au moins 1 président, 1 secrétaire, 1 resp de transmisson et 1 personne de contact
.head 5 +  If bContinue
.head 6 +  If wsCo[1,0] = ''
.head 7 -  Set sErreur = "Aucun président encodé"
.head 7 -  ! Warning
.head 7 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 7 -  ! Insert dans Erreur_EnCours pour cette entité
.head 7 -  Call SqlPrepareAndExecute(  ghSqlErreur, "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur)  ")
.head 7 -  Set sErreur = ''
.head 6 +  If wsCo[2,0] = ''
.head 7 -  Set sErreur = "Aucun secrétaire encodé"
.head 7 -  ! Warning
.head 7 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 7 -  ! Insert dans Erreur_EnCours pour cette entité
.head 7 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur ) ")
.head 7 -  Set sErreur = ''
.head 6 +  If wsCo[3,0] = ''
.head 7 -  Set sErreur = "Aucun Resp. de transmission encodé"
.head 7 -  ! Warning
.head 7 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 7 -  ! Insert dans Erreur_EnCours pour cette entité
.head 7 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur ) ")
.head 7 -  Set sErreur = ''
.head 6 +  If wsCo[5,0] = ''
.head 7 -  Set sErreur = "Aucune personne de contact encodée"
.head 7 -  ! Warning
.head 7 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 7 -  ! Insert dans Erreur_EnCours pour cette entité
.head 7 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur)  ")
.head 7 -  Set sErreur = ''
.head 6 -  ! Controle si au moins une adresse
.head 6 +  If wsA[0,0] = '' and wsA[1,0] = ''
.head 7 -  Set sErreur = "Aucune Adresse de bureau encodée"
.head 7 -  ! Warning
.head 7 -  Call PalHttpCockpit( 415, '1', '', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 7 -  ! Insert dans Erreur_EnCours pour cette entité
.head 7 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur) ")
.head 7 -  Call SqlCommit( ghSqlErreur )
.head 7 -  Set sErreur = ''
.head 5 -  !
.head 5 +  If not bContinue
.head 6 -  Set sErreur = VisStrSubstitute( sErreur , "
", " - " )
.head 6 -  ! ERREUR
.head 6 -  Call PalHttpCockpit( 416, '', '1', sErreur , PalDtmExtension(  sFileNameSeul ), wsModuleNom, wsModuleLigne, sFileNameSeul )
.head 6 -  ! Insert dans Erreur_EnCours pour cette entité
.head 6 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFileNameSeul, 1, :sErreur ) ")
.head 6 -  Call SqlCommit( ghSqlErreur )
.head 5 -  Return ( bContinue )
.head 3 +  Function: PalChargeListe
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: pnNoEl
.head 5 -  String: psIns
.head 5 -  Number: pnNbCdtMax
.head 5 -  String: sFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsSelect
.head 5 -  Long String: lsInsert
.head 5 -  Long String: lsInsertValues
.head 5 -  Long String: lsErr
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnK
.head 5 -  String: lsNoListe
.head 5 -  String: lsNoCdt
.head 5 -  String: lsElExt
.head 5 -  Long String: llsMsg
.head 5 -  String: sErreur
.head 5 -  Boolean: lbExist
.head 5 -  !
.head 5 -  Boolean: bContinue
.head 5 -  Number: lnNoElFK
.head 5 -  Number: lnNivElFK
.head 5 -  Number: lnEntiteFK
.head 5 -  String: lsLisID
.head 5 -  String: lsCdtID
.head 5 -  String: lsNomFormatF
.head 5 -  String: lsArrayColListe[*]
.head 5 -  String: lsArrayColCdt[*]
.head 5 -  String: lsNoGroupe
.head 5 -  String: lsEtat
.head 5 -  String: lsEntite
.head 4 +  Actions
.head 5 -  Set bContinue = TRUE
.head 5 -  ! ENT_NIV_LETTRE = 2d array au niveau S ( wsS[4] )
.head 5 -  Set lsSelect = "Select  NIV_ELE_FK,NIV_ELE_EXT,NIV_ID from Niveaux where NIV_LETTRE = :wsS[4] and NIV_ELE_EXT = :wsG[0] into :lnNoElFK, :lsElExt, :lnNivElFK "
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, lsSelect )
.head 5 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Set lsErr=  "Aucune election de ce type"
.head 6 -  ! ERREUR
.head 6 -  Call PalHttpCockpit( 420, '', '1', lsErr , PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 6 -  Return ( FALSE)
.head 5 -  ! Comparaison no election
.head 5 +  If lnNoElFK != pnNoEl
.head 6 -  Set lsErr = "Election non concordante"
.head 6 -  ! ERREUR
.head 6 -  Call PalHttpCockpit( 421, '', '1', lsErr , PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 6 -  Return ( FALSE)
.head 5 -  ! Rech FK entité
.head 5 -  Set lsSelect = "select ENT_ID, ENT_FORMAT_F from entite where ENT_INS=:psIns and ent_ele_fk = :lnNoElFK and ENT_NIV_FK =:lnNivElFK into :lnEntiteFK, :lsNomFormatF "
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, lsSelect )
.head 5 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Set lsErr = "Aucune entite pour ce type d'élection"
.head 6 -  ! ERREUR
.head 6 -  Call PalHttpCockpit( 420, '', '1', lsErr , PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 6 -  Return ( FALSE)
.head 5 -  Set lnI = 0
.head 5 -  Set lsSelect = "select Name from Syscolumns where TBNAME='LISTES' and colNo >= 8 order by ColNo into :lsArrayColListe[lnI] "
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, lsSelect )
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Set lnI = lnI +1
.head 5 -  Set lnI = 0
.head 5 -  Set lsSelect = "select Name from Syscolumns where TBNAME='CANDIDATS' and colNo >= 8 order by ColNo into :lsArrayColCdt[lnI] "
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, lsSelect )
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Set lnI = lnI +1
.head 5 -  !
.head 5 -  ! Vérification complete du format F
.head 5 +  ! If NOT PalControleDoubleCandidature( psIns, wsS[4], lsElExt, sFile )
.head 6 -  Set bContinue = FALSE
.head 5 -  !
.head 5 -  ! Insertion Listes et Cdts
.head 5 +  If bContinue
.head 6 -  ! Insertions des listes
.head 6 -  Set lnI = 1
.head 6 +  While lnI < 200 and bContinue
.head 7 +  If wsL[lnI, 0] != ''
.head 8 +  If PalNextValueApplParm( "LIS_ID", lsLisID )
.head 9 -  Set lsNoGroupe = PalDtmGroupeListe( wsL[lnI,15] , lsElExt )
.head 9 -  Set lsInsert =  "Insert into Listes
( LIS_ID,LIS_ELE_FK,LIS_ELE_EXT,LIS_ENT_FK,LIS_STATUS,LIS_FORMAT_F,LIS_GRL_FK "
.head 9 -  Set lsInsertValues =  "( :lsLisID, :lnNoElFK, :lsElExt, :lnEntiteFK, :wsL[lnI,18],:lsNomFormatF, :lsNoGroupe "
.head 9 -  Set lnJ = 0
.head 9 +  While lnJ < 31
.head 10 +  If wsL[lnI,lnJ+10] != ""
.head 11 -  Set lsInsert =  lsInsert || ", " || lsArrayColListe[lnJ] 
.head 11 -  Set lsInsertValues =  lsInsertValues || ", :wsL[lnI,"|| SalNumberToStrX( lnJ+10,0) ||"]"
.head 10 -  Set lnJ = lnJ +1
.head 9 -  Set lsInsert =  lsInsert || " ) 
values 
"|| lsInsertValues ||" )"
.head 9 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert )
.head 10 -  Set lsErr = "Erreur INSERT dans liste"
.head 10 -  Set bContinue = FALSE
.head 8 +  Else
.head 9 -  ! erreur dans l'attribution de l'ID de la liste
.head 9 -  Set lsErr = "Erreur dans l'attribution de l'ID de la liste"
.head 9 -  Set bContinue = FALSE
.head 8 -  ! Insertions des CDTs
.head 8 -  Set lnK = 1
.head 8 +  While lnK <= SalStrToNumber( wsL[lnI,16] ) and bContinue
.head 9 +  If PalNextValueApplParm( "CDT_ID", lsCdtID )
.head 10 -  Set lsInsert =  "Insert into Candidats
( CDT_ID,CDT_ELE_FK,CDT_ELE_EXT,CDT_ENT_FK,CDT_LIS_FK,CDT_STATUS,CDT_FORMAT_F "
.head 10 -  Set lsInsertValues =  "( :lsCdtID, :lnNoElFK, :lsElExt, :lnEntiteFK,:lsLisID,:wsL[lnI,18],:lsNomFormatF"
.head 10 -  Set lnJ = 0
.head 10 +  While lnJ < 32
.head 11 +  If wsC[lnI,lnK,lnJ] != ""
.head 12 -  Set lsInsert =  lsInsert || ", " || lsArrayColCdt[lnJ] 
.head 12 -  Set lsInsertValues =  lsInsertValues || ", :wsC[lnI,lnK,"|| SalNumberToStrX( lnJ,0) ||"]"
.head 11 -  Set lnJ = lnJ +1
.head 10 -  Set lsInsert =  lsInsert || " ) 
values 
"|| lsInsertValues ||" )"
.head 10 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert )
.head 11 -  Set lsErr = "Erreur INSERT dans Cdt"
.head 11 -  Set bContinue = FALSE
.head 9 +  Else
.head 10 -  Set lsErr = "Erreur dans l'attribution de l'ID du Cdt Eff."
.head 10 -  Set bContinue = FALSE
.head 9 -  Set lnK = lnK +1
.head 8 -  ! Insertions des Suppléants
.head 8 -  Set lnK = 1
.head 8 +  While lnK <= SalStrToNumber( wsL[lnI,17] ) and bContinue
.head 9 +  If PalNextValueApplParm( "CDT_ID", lsCdtID )
.head 10 -  Set lsInsert =  "Insert into Candidats
( CDT_ID,CDT_ELE_FK,CDT_ELE_EXT,CDT_ENT_FK,CDT_LIS_FK,CDT_STATUS,CDT_FORMAT_F "
.head 10 -  Set lsInsertValues =  "( :lsCdtID, :lnNoElFK, :lsElExt, :lnEntiteFK,:lsLisID,:wsL[lnI,18],:lsNomFormatF"
.head 10 -  Set lnJ = 0
.head 10 +  While lnJ < 32
.head 11 +  If wsSuppl[lnI,lnK,lnJ] != ""
.head 12 -  Set lsInsert =  lsInsert || ", " || lsArrayColCdt[lnJ] 
.head 12 -  Set lsInsertValues =  lsInsertValues || ", :wsSuppl[lnI,lnK,"|| SalNumberToStrX( lnJ,0) ||"]"
.head 11 -  Set lnJ = lnJ +1
.head 10 -  Set lsInsert =  lsInsert || " ) 
values 
"|| lsInsertValues ||" )"
.head 10 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert )
.head 11 -  Set lsErr = "Erreur dans l'attribution de l'ID du Cdt Suppl."
.head 11 -  Set bContinue = FALSE
.head 9 +  Else
.head 10 -  Set lsErr = "Erreur dans l'attribution de l'ID du Suppléant"
.head 10 -  Set bContinue = FALSE
.head 9 -  Set lnK = lnK + 1
.head 7 -  Set lnI = lnI +1 
.head 5 +  If bContinue
.head 6 -  Set lsEtat = SalStrLeftX(sFile, 1)
.head 6 -  Set lsEntite = SalStrMidX(sFile, 1, 9)
.head 6 -  Set lsInsert =  "Update Entite set ent_status = :lsEtat 
where Ent_Ins = :psIns and  ENT_ELE_EXT = :lsElExt and ENT_FORMAT_F = :lsEntite"
.head 6 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert )
.head 7 -  Set lsErr = "Erreur dans la mise à jour du STATUS dans ENTITE."
.head 7 -  Set bContinue = FALSE
.head 5 +  If NOT bContinue
.head 6 -  ! ERREUR
.head 6 -  Call PalHttpCockpit( 420, '', '1', lsErr , PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 6 -  ! Insert dans Erreur_EnCours pour cette entité
.head 6 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFile, 1, :lsErr)  ")
.head 5 -  ! Vérification des doubles candidatures
.head 5 -  Call PalCtrlDoubleCandidature( psIns, lnEntiteFK, sFile )
.head 5 -  Return (bContinue)
.head 3 -  !
.head 3 +  ! Function: PalControleDoubleCandidature
.head 4 -  Description: 
.head 4 +  Returns 
.head 5 -  Boolean: 
.head 4 +  Parameters 
.head 5 -  String: sIns
.head 5 -  String: sNiveau
.head 5 -  String: sElect
.head 5 -  String: sFile
.head 4 -  Static Variables 
.head 4 +  Local variables 
.head 5 -  File Handle: hFile
.head 5 -  Long String: sErreurParListe
.head 5 -  Long String: sErreur
.head 5 -  Long String: sErreurAffich
.head 5 -  Long String: sWarning
.head 5 -  Long String: sWarningParListe
.head 5 -  String: lsTmp
.head 5 -  String: lsDateEl
.head 5 -  String: sErrCaract
.head 5 -  Number: lnMax
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnK
.head 5 -  Number: lnL
.head 5 -  Number: nSiegeMax
.head 5 -  Number: nSupplMax
.head 5 -  Number: nSiege
.head 5 -  Number: nSuppl
.head 5 -  String: sSexeE[250, 100]
.head 5 -  String: sSexeS[250, 100]
.head 5 -  Number: nHommeE[*]
.head 5 -  Number: nFemmeE[*]
.head 5 -  Number: nHommeS[*]
.head 5 -  Number: nFemmeS[*]
.head 5 -  Boolean: bContinue
.head 5 -  Number: nNoEl
.head 5 -  !
.head 5 -  String: lsCdtNom
.head 5 -  String: lsCdtType
.head 5 -  String: lsCdtNo
.head 5 -  String: lsLisNo
.head 5 -  String: lsLisSigle
.head 5 -  String: lsInsBur
.head 5 -  String: lsElect
.head 5 -  String: lsTypeBur
.head 5 -  !
.head 4 +  Actions 
.head 5 -  Call VisWaitCursor( TRUE )
.head 5 -  !
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_ID from Election where ELE_LETTRE = :sElect 
	into :nNoEl " )
.head 5 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  ! ERREUR
.head 6 -  Return (FALSE)
.head 5 +  ! If sElect = 'CK'
.head 6 -  Set nNoEl = 2
.head 5 +  ! Else If sElect = 'SE'
.head 6 -  Set nNoEl = 3
.head 5 +  ! Else
.head 6 -  Call SalMessageBox( gsMessage[3] || ' : ' || sElect , gsMessage[3], MB_Ok)
.head 6 -  Return FALSE
.head 5 -  !
.head 5 -  Set lnI = 1
.head 5 -  Set lnMax = 200
.head 5 -  !
.head 5 -  Set nSiegeMax = SalStrToNumber( wsS[1] )
.head 5 +  If nNoEl != 12
.head 6 -  Set nSupplMax = SalStrToNumber( wsS[2] )
.head 5 -  !
.head 5 +  While lnI <= lnMax
.head 6 +  If wsL[ lnI , 0 ] != ''
.head 7 -  Set sErreurParListe = ''
.head 7 -  Set sWarningParListe = ''
.head 7 -  ! Controle Cdt Eff
.head 7 -  Set lnJ = 1
.head 7 +  While lnJ <= SalStrToNumber( wsL[lnI,16] )
.head 8 +  If wsC[lnI, lnJ, 30] != ''
.head 9 -  ! Controle du NN par rapport aux autres listes
.head 9 -  Call SqlPrepareAndExecute( ghSqlMain, "select CDT_CONNUCOMME, CDT_TYPECDT,CDT_NOORDRE, LIS_NO,LIS_SIGLE,LIS_INSBUR, LIS_ELE_EXT, LIS_TYPEBUR   from candidats, Listes
	 where CDT_INSBUR != :sIns and CDT_NN = :wsC[lnI,lnJ,30] and CDT_LIS_FK = lis_id 
	Into :lsCdtNom, :lsCdtType, :lsCdtNo,:lsLisNo, :lsLisSigle,:lsInsBur, :lsElect, :lsTypeBur ")
.head 9 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 10 +  If sErreurParListe != ''
.head 11 -  Set sErreurParListe = sErreurParListe || '
'
.head 10 -  Set sErreurParListe = sErreurParListe || 'E - ' || SalNumberToStrX( lnJ,0) ||": "|| wsC[lnI,lnJ,9] ||": ("||wsC[lnI, lnJ, 30]||") "||VisStrSubstitute( "double candidature avec la liste XXX", 'XXX' , lsLisSigle ) ||'  (N° '|| lsLisNo ||') - '|| 
	lsCdtType || ' - ' || lsCdtNo || ' - Bur '|| lsInsBur ||' ' || lsElect || ' ' || lsTypeBur
.head 8 -  Set lnJ = lnJ +1
.head 7 -  !
.head 7 -  ! Controle Cdt Suppl
.head 7 -  Set lnJ = 1
.head 7 +  While lnJ <= SalStrToNumber( wsL[lnI,17] )
.head 8 -  !
.head 8 +  If wsSuppl[lnI, lnJ, 30] != ''
.head 9 -  Call SqlPrepareAndExecute( ghSqlMain, "select CDT_CONNUCOMME, CDT_TYPECDT,CDT_NOORDRE, LIS_NO,LIS_SIGLE,LIS_INSBUR, LIS_ELE_EXT, LIS_TYPEBUR   from candidats, Listes
	 where CDT_INSBUR != :sIns and CDT_NN = :wsSuppl[lnI,lnJ,30] and CDT_LIS_FK = lis_id 
	Into :lsCdtNom, :lsCdtType, :lsCdtNo,:lsLisNo, :lsLisSigle,:lsInsBur, :lsElect, :lsTypeBur ")
.head 9 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 10 +  If sErreurParListe != ''
.head 11 -  Set sErreurParListe = sErreurParListe || '
'
.head 10 -  Set sErreurParListe = sErreurParListe || 'S - ' || SalNumberToStrX( lnJ,0) ||": "|| wsSuppl[lnI,lnJ,9] ||": ("||wsSuppl[lnI, lnJ, 30]||") "||VisStrSubstitute( "double candidature avec la liste XXX", 'XXX' , lsLisSigle ) ||'  (N° '|| lsLisNo ||') - '|| 
	lsCdtType || ' - ' || lsCdtNo || ' - Bur '|| lsInsBur ||' ' || lsElect || ' ' || lsTypeBur
.head 8 -  Set lnJ = lnJ +1
.head 7 -  !
.head 7 -  ! Si erreur par liste - affichage
.head 7 +  If sErreurParListe != ""
.head 8 +  If sErreur != ''
.head 9 -  Set sErreur = sErreur || '
'
.head 8 -  Set sErreur = sErreur || "==" || wsL[lnI,0] || "==
"|| sErreurParListe
.head 6 -  Set lnI = lnI +1
.head 5 -  !
.head 5 -  Call VisWaitCursor( FALSE)
.head 5 +  If sErreur != ''
.head 6 -  Call PalHttpCockpit( 417, '', '1', sErreur , PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 6 -  ! Insert dans Erreur_EnCours pour cette entité
.head 6 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info )
	 values (:wnIdEntiteEnCours, :sFile, 1, :sErreur ) ")
.head 5 -  Return TRUE
.head 3 +  Function: PalCtrlDoubleCandidature
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sIns
.head 5 -  Number: nIdEntite
.head 5 -  String: sFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsNN
.head 5 -  Number: lnNb
.head 5 -  Long String: sErreur
.head 5 -  String: lsCdtNom
.head 5 -  String: lsCdtType
.head 5 -  String: lsCdtNo
.head 5 -  String: lsLisNo
.head 5 -  String: lsLisSigle
.head 5 -  String: lsInsBur
.head 5 -  String: lsElect
.head 5 -  String: lsTypeBur
.head 5 -  Number: nIdEntite2[*]
.head 5 -  Number: nIdPrec
.head 5 -  Number: nI
.head 5 -  String: lsElectNN
.head 5 -  Boolean: bErreur
.head 5 -  String: sInElection
.head 4 +  Actions
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from ERREUR_ENCOURS where ERR_CTRL_CDT = 1 and (Err_Ent_FK = :nIdEntite or ERR_CTRL_ID =:nIdEntite) " )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Set sErreur = ''
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "select CDT_NN, count(*)  from candidats A
where @length(CDT_NN) > 0 and A.CDT_ENT_FK != :nIdEntite
	and cdt_NN in ( select B.Cdt_NN from candidats B where  B.CDT_ENT_FK= :nIdEntite and @length(B.CDT_NN)>0  )
group by 1
into :lsNN, :lnNb " )
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select LIS_ELE_EXT
	from candidats, Listes, entite
	where CDT_NN = :lsNN and Cdt_lis_Fk = Lis_Id  and Lis_ent_Fk = Ent_Id and ent_id = :nIdEntite 
	into :lsElectNN " )
.head 6 +  If SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  If lsElectNN = 'EU'
.head 8 -  ! Uniquement EU
.head 8 -  Set sInElection = "('EU')"
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select *
	from candidats, Listes, entite
	where CDT_NN = :lsNN and Cdt_lis_Fk = Lis_Id  and Lis_ent_Fk = Ent_Id and ent_id != :nIdEntite and Lis_Ele_ext in "|| sInElection  )
.head 7 +  Else If lsElectNN = 'CK' or lsElectNN = 'SE'
.head 8 -  ! Uniquement CK et SE
.head 8 -  Set sInElection = "('CK','SE')"
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select *
	from candidats, Listes, entite
	where CDT_NN = :lsNN and Cdt_lis_Fk = Lis_Id  and Lis_ent_Fk = Ent_Id and ent_id != :nIdEntite and Lis_Ele_ext in "|| sInElection  )
.head 7 +  Else If lsElectNN = 'WL' or lsElectNN = 'VL'  or lsElectNN = 'BV'
.head 8 -  ! Pour les régionales
.head 8 -  Set sInElection = "('WL','VL','BV')"
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select *
	from candidats, Listes, entite
	where CDT_NN = :lsNN and Cdt_lis_Fk = Lis_Id  and Lis_ent_Fk = Ent_Id and ent_id != :nIdEntite and Lis_Ele_ext  in "|| sInElection  )
.head 7 +  Else If lsElectNN = 'WL' or lsElectNN = 'VL' or lsElectNN = 'BR' or lsElectNN = 'BV'
.head 8 -  ! Pour BR
.head 8 -  Set sInElection = "('BR')"
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select *
	from candidats, Listes, entite
	where CDT_NN = :lsNN and Cdt_lis_Fk = Lis_Id  and Lis_ent_Fk = Ent_Id and ent_id != :nIdEntite and Lis_Ele_ext  in "|| sInElection  )
.head 7 +  Else If lsElectNN = 'DE'
.head 8 -  ! Pour  DE
.head 8 -  Set sInElection = "('DE')"
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select *
	from candidats, Listes, entite
	where CDT_NN = :lsNN and Cdt_lis_Fk = Lis_Id  and Lis_ent_Fk = Ent_Id and ent_id != :nIdEntite and Lis_Ele_ext in "|| sInElection )
.head 7 +  Else
.head 8 -  Set sInElection = ""
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select *
	from candidats
	where CDT_NN = '000' " )
.head 7 +  If SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 -  Set sErreur = ""
.head 8 -  Set nI = 0
.head 8 -  Set nIdEntite2[nI] = NUMBER_Null
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select CDT_CONNUCOMME, CDT_TYPECDT,CDT_NOORDRE, LIS_NO,LIS_SIGLE,LIS_INSBUR, LIS_ELE_EXT, LIS_TYPEBUR , ENT_ID
	from candidats, Listes, entite
	where CDT_NN = :lsNN and Cdt_lis_Fk = Lis_Id  and Lis_ent_Fk = Ent_Id
	order by Ent_id
	Into :lsCdtNom, :lsCdtType, :lsCdtNo,:lsLisNo, :lsLisSigle,:lsInsBur, :lsElect, :lsTypeBur , :nIdEntite2[nI] ")
.head 8 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 9 -  Set bErreur = FALSE
.head 9 +  If (lsElect = 'CK' and lsElectNN= 'SE') or (lsElect = 'SE' and lsElectNN = 'CK' ) 
.head 10 -  Set bErreur = TRUE
.head 9 +  Else
.head 10 +  If lsElect != lsElectNN
.head 11 -  Set bErreur = TRUE
.head 10 +  Else
.head 11 -  Set bErreur = FALSE
.head 9 +  If bErreur
.head 10 +  If sErreur != ''
.head 11 -  Set sErreur = sErreur ||"
"
.head 10 -  Set sErreur = sErreur || lsLisSigle || " (n°"|| lsLisNo ||") - "|| lsElect || " " || lsInsBur || " : "||  lsCdtNom || " - " || lsCdtType ||" " || lsCdtNo
.head 10 -  Set nI = nI + 1
.head 10 -  Set nIdEntite2[nI] = NUMBER_Null
.head 8 +  If sErreur != ''
.head 9 -  Set sErreur ="DOUBLE CANDIDATURE : "|| lsNN ||"
" || sErreur
.head 9 -  ! ERREUR
.head 9 -  Call PalHttpCockpit( 417, '', '1', sErreur , PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 9 -  ! Insert dans Erreur_EnCours pour cette entité
.head 9 -  ! Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info, ERR_CTRL_CDT, ERR_CTRL_ID )
	 values (:wnIdEntiteEnCours, :sFile, 1, :sErreur , 1, :wnIdEntiteEnCours ) ")
.head 9 -  ! Call SqlCommit( ghSqlErreur )
.head 9 -  ! Insert dans Erreur_EnCours pour les entités qui en découlent
.head 9 -  Set nI = 0
.head 9 -  Set nIdPrec = NUMBER_Null
.head 9 +  While nIdEntite2[nI] != NUMBER_Null and nIdEntite2[nI] != 0
.head 10 +  If nIdPrec != nIdEntite2[nI]
.head 11 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Insert into Erreur_EnCours (Err_ent_FK , Err_File, Err_Type , Err_Info, ERR_CTRL_CDT, ERR_CTRL_ID )
	 values (:nIdEntite2[nI], :sFile, 1, :sErreur , 1, :wnIdEntiteEnCours ) ")
.head 11 -  Call SqlCommit( ghSqlErreur )
.head 10 -  Set nIdPrec = nIdEntite2[nI]
.head 10 -  Set nI = nI + 1
.head 5 -  !
.head 5 -  Return TRUE
.head 3 -  !
.head 3 +  Function: PalChargeCoord
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psEl
.head 5 -  String: psIns
.head 5 -  String: psTypeBur
.head 5 -  String: sFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsSelect
.head 5 -  Long String: lsInsert
.head 5 -  Long String: lsInsertValues
.head 5 -  Long String: lsErr
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnK
.head 5 -  String: lsNoListe
.head 5 -  String: lsNoCdt
.head 5 -  String: lsElExt
.head 5 -  Long String: llsMsg
.head 5 -  String: sErreur
.head 5 -  !
.head 5 -  Boolean: bContinue
.head 5 -  Number: lnNoElFK
.head 5 -  Number: lnNivElFK
.head 5 -  Number: lnEntiteFK
.head 5 -  String: lsLisID
.head 5 -  String: lsCdtID
.head 5 -  String: lsNomFormatF
.head 5 -  String: lsArrayColListe[*]
.head 5 -  String: lsArrayColCdt[*]
.head 5 -  String: lsNoGroupe
.head 5 -  String: lsEtat
.head 5 -  String: lsEntite
.head 5 -  String: lsNbBurConnu
.head 5 -  String: lsNbBUrDepConnu
.head 5 -  String: lsTypeVote
.head 4 +  Actions
.head 5 -  Set bContinue = TRUE
.head 5 +  If gsPhaseResult != '1'
.head 6 -  Call SqlPrepareAndExecute(  ghSqlMaj , "Select CB_NbBV, CB_NbBurDep from Coord_Bureau where CB_Elect = :psEl and CB_TypeBur = :psTypeBur and CB_Ins = :psIns
	into :lsNbBurConnu, :lsNbBUrDepConnu ")
.head 6 -  Call SqlFetchNext( ghSqlMaj, Btmp )
.head 6 -  Call SqlPrepareAndExecute(  ghSqlMaj , "Delete from Coord_Bureau where CB_Elect = :psEl and CB_TypeBur = :psTypeBur and CB_Ins = :psIns ")
.head 5 -  ! Call SqlPrepareAndExecute(  ghSqlMaj , "Delete from Coord_Bureau where CB_Elect = :psEl and CB_TypeBur = :psTypeBur and CB_Ins = :psIns ")
.head 5 -  Call SqlPrepareAndExecute(  ghSqlMaj , "Delete from Coord_Adresse where CA_Elect = :psEl and CA_TypeBur = :psTypeBur and CA_Ins = :psIns ")
.head 5 -  Call SqlPrepareAndExecute(  ghSqlMaj , "Delete from Coord_Contact where CC_Elect = :psEl and CC_TypeBur = :psTypeBur and CC_Ins = :psIns ")
.head 5 -  !
.head 5 -  ! Insertion des coordonnées
.head 5 -  ! Bureau
.head 5 -  ! If bContinue 
.head 5 +  If bContinue and gsPhaseResult != '1'
.head 6 +  If wsB[0] != '' or TRUE
.head 7 -  Set lsInsert =  "Insert into Coord_Bureau
(  CB_TypeBur, CB_Ins, CB_NbBV, CB_NbBurDep, CB_NbElect, CB_Elect) "
.head 7 -  Set lsInsertValues =  " values ( :wsB[1], :wsB[2], :wsB[3], :wsB[4],:wsB[5], :psEl ) "
.head 7 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert || lsInsertValues )
.head 8 -  Set lsErr = "Erreur INSERT dans Coord_Bureau "
.head 8 -  Set bContinue = FALSE
.head 5 -  ! Adresse
.head 5 +  If bContinue
.head 6 -  Set lnI = 0
.head 6 +  While lnI <= 1 and bContinue
.head 7 +  If wsA[lnI,0] != '' and bContinue
.head 8 -  Set lsInsert =  "Insert into Coord_Adresse
(  CA_TypeBur, CA_Ins,  CA_TypeAdr, CA_Lieu, CA_Adresse,CA_CP, CA_Commune,
	CA_Tel1, CA_Tel2, CA_Fax1, CA_Fax2, CA_Mail1, CA_Mail2, CA_Info, CA_Elect ) "
.head 8 -  Set lsInsertValues =  ""
.head 8 -  Set lnJ = 1
.head 8 +  While lnJ <= 14
.head 9 -  Set lsInsertValues =  lsInsertValues || ":wsA["|| SalNumberToStrX( lnI,0)||","|| SalNumberToStrX( lnJ,0)||"],"
.head 9 -  Set lnJ = lnJ +1
.head 8 -  Set lsInsert =  lsInsert || " 
values ( "|| lsInsertValues ||" :psEl )"
.head 8 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert )
.head 9 -  Set lsErr = "Erreur INSERT dans Coord_Adresse "
.head 9 -  Set bContinue = FALSE
.head 7 -  Set lnI = lnI +1
.head 5 -  ! Contacts
.head 5 +  If bContinue
.head 6 -  Set lnI = 1
.head 6 +  While lnI <= 8 and bContinue
.head 7 +  If wsCo[lnI,0] != '' and bContinue
.head 8 -  Set lsInsert =  "Insert into Coord_Contact
(  CC_TypeBur, CC_Ins, CC_TypeCo,CC_Nom, CC_Prenom,CC_Sexe, CC_Fct, CC_Tel1, CC_Tel2,
	CC_Fax1, CC_Fax2, CC_Mail1, CC_Mail2, CC_Adr, CC_CP, CC_Commune, CC_TelPrive, CC_FaxPrive, CC_GsmPrive,
	CC_NN, CC_Info, CC_Elect ) "
.head 8 -  Set lsInsertValues =  ""
.head 8 -  Set lnJ = 1
.head 8 +  While lnJ <= 21
.head 9 -  Set lsInsertValues =  lsInsertValues || ":wsCo["|| SalNumberToStrX( lnI,0)||","|| SalNumberToStrX( lnJ,0)||"],"
.head 9 -  ! Set lsInsertValues =  lsInsertValues || "'"|| wsCo[lnI,lnJ]||"',"
.head 9 -  Set lnJ = lnJ +1
.head 8 -  Set lsInsert =  lsInsert || " 
values ("|| lsInsertValues ||" :psEl )"
.head 8 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert  )
.head 9 -  Set lsErr = "Erreur INSERT dans Coord_Contact "
.head 9 -  Set bContinue = FALSE
.head 7 -  Set lnI = lnI +1
.head 5 +  If bContinue
.head 6 +  If gsPhaseResult != '1'
.head 7 -  Set lsEntite = SalStrMidX(sFile, 1, 9)
.head 7 -  ! Contrôle du nombre de bureaux de depouillement / Votes en fonction du type de vote (Vote papier ou électronnique)
.head 7 -  Set lsTypeVote = ''
.head 7 +  If SalStrUpperX( SalStrLeftX( lsEntite , 1) )= 'K'
.head 8 -  Call SqlPrepareAndExecute( ghSqlMaj, "select ENT_TYPEVOTE 
	from entite where ent_ins = :psIns and ent_niv_lettre = 'K' and ent_ele_ext= :psEl 
	into :lsTypeVote ")
.head 8 -  Call SqlFetchNext( ghSqlMaj, Btmp )
.head 8 +  If lsTypeVote != ''
.head 9 -  Set wsB[4] = wsB[3]
.head 7 -  !
.head 7 +  If wsB[5] != '' and wsB[4] != ''
.head 8 -  Set lsInsert =  "Update Entite set ENT_BURDEP_TOT = :wsB[4] ,ENT_INSCRITS_BB = :wsB[5]
where Ent_Ins = :psIns and  ENT_ELE_EXT = :psEl and ENT_FORMAT_F = :lsEntite "
.head 8 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert )
.head 9 -  Set lsErr = "Erreur dans la mise à jour de ENT_BURDEP_TOT ou ENT_INSCRITS_BB  dans ENTITE."
.head 9 -  Set bContinue = FALSE
.head 7 +  Else
.head 8 -  Set lsInsert =  "Update Coord_Bureau set CB_NbBV= :lsNbBurConnu , CB_NbBurDep = :lsNbBUrDepConnu
where CB_Elect = :psEl and CB_TypeBur = :psTypeBur and CB_Ins = :psIns "
.head 8 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert )
.head 9 -  Set lsErr = "Erreur dans la mise à jour de ENT_BURDEP_TOT ou ENT_INSCRITS_BB  dans ENTITE."
.head 9 -  Set bContinue = FALSE
.head 5 +  If NOT bContinue
.head 6 -  ! ERREUR
.head 6 -  Call PalHttpCockpit( 420, '', '1', lsErr , PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 5 -  Return (bContinue)
.head 3 +  Function: PalUpdateResultat
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sType
.head 5 -  String: sNiv
.head 5 -  String: sIns
.head 5 -  String: sExtElec
.head 5 -  String: sFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bContinue
.head 5 -  Long String: lsUpdate
.head 5 -  String: lsSitDep
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Boolean: bSenatBHV
.head 5 -  Date/Time: ldDate
.head 5 -  String: lsTypeVote
.head 5 -  String: lsNbBurDep
.head 4 +  Actions
.head 5 -  Set bContinue = TRUE
.head 5 -  Set bSenatBHV = FALSE
.head 5 -  Set wnCheckSumDtm[0] = NUMBER_Null
.head 5 -  ! Set wnCheckSumDtm = PalDtmCheckSumListe( wnCheckSumDtm, tblListe_R.colSC1 )
.head 5 -  ! Update Result_Scrutin
.head 5 +  If SalStrLeftX( sFile, 1)  = '1'
.head 6 -  Set lsSitDep =  '1'
.head 5 +  Else
.head 6 -  Set lsSitDep =  '0'
.head 5 -  Set ldDate = SalDateCurrent(  )
.head 5 -  !
.head 5 -  ! Contrôle du nombre de bureaux de depouillement / Votes en fonction du type de vote (Vote papier ou électronnique)
.head 5 -  Set lsTypeVote = ''
.head 5 +  ! If sNiv = 'K' and sType != 'P'
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "select ENT_TYPEVOTE , ENT_BURDEP_TOT
	from entite where ent_ins = :sIns and ent_niv_lettre = 'K' and ent_ele_ext= :sExtElec 
	into :lsTypeVote , :lsNbBurDep ")
.head 6 -  Call SqlFetchNext( ghSqlMaj, Btmp )
.head 6 -  Call SqlCommit( ghSqlMaj)
.head 6 +  If lsTypeVote != ''
.head 7 +  If SalStrToNumber( lsNbBurDep ) > 0
.head 8 -  Set wsT[3] = lsNbBurDep
.head 8 -  Set wsT[4] = lsNbBurDep
.head 5 +  If sNiv = 'K'
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "select ENT_TYPEVOTE , ENT_BURDEP_TOT
	from entite where ent_ins = :sIns and ent_niv_lettre = 'K' and ent_ele_ext= :sExtElec 
	into :lsTypeVote , :lsNbBurDep ")
.head 6 -  Call SqlFetchNext( ghSqlMaj, Btmp )
.head 6 -  Call SqlCommit( ghSqlMaj)
.head 6 +  If lsTypeVote != ''
.head 7 +  If SalStrToNumber( lsNbBurDep ) > 0
.head 8 -  Set wsT[3] = lsNbBurDep
.head 8 -  Set wsT[4] = lsNbBurDep
.head 5 -  !
.head 5 +  If (sExtElec = 'SE' or sExtElec = 'EU') and (SalStrLeftX( sIns ,2 ) = '21' or SalStrLeftX( sIns ,2 ) = '23' )
.head 6 -  Set bSenatBHV = TRUE
.head 5 +  Else If sExtElec = 'BR'
.head 6 -  Set bSenatBHV = TRUE
.head 5 -  Set lsUpdate = "Update RESULT_SCRUTIN 
	set RES_NB_VV = :wsS[7], RES_NB_BE = :wsS[9],RES_NB_VBN = :wsS[10], RES_NB_VV_E5 = :wsS[13], RES_NB_VBN_E5 = :wsS[14],
		RES_SIT_DEP = :lsSitDep, RES_BDEP_TRAIT =:wsT[3], RES_BDEP_TOT=:wsT[4], date_heure_maj = :ldDate, RES_T_DEP = :wsT[1]
	Where RES_ENT_INS = :sIns and RES_NIV_LETTRE = :sNiv and RES_ELE_EXT = :sExtElec "
.head 5 +  If bSenatBHV
.head 6 -  Set wsS[12] = SalNumberToStrX( SalStrToNumber( wsS[12] )+SalStrToNumber( wsS[32] ), 0)
.head 6 +  If sExtElec = 'BR'
.head 7 -  Set wsS[7] = SalNumberToStrX( SalStrToNumber( wsS[7] )+SalStrToNumber( wsS[27] ) , 0)
.head 6 +  Else
.head 7 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsUpdate || " and RES_ENT_INS_SUP = '12025' " )
.head 8 -  Set bContinue = FALSE
.head 8 -  ! ERREUR
.head 8 -  Call PalHttpCockpit( 440, '', '1', lsUpdate, PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 7 +  Else
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 -  Set lsUpdate = "Update RESULT_SCRUTIN 
	set RES_NB_VV = :wsS[27], RES_NB_BE = :wsS[29],RES_NB_VBN = :wsS[30], RES_NB_VV_E5 = :wsS[33], RES_NB_VBN_E5 = :wsS[34],
		RES_SIT_DEP = :lsSitDep, RES_BDEP_TOT =:wsT[4], RES_BDEP_TRAIT=:wsT[3], date_heure_maj = :ldDate, RES_T_DEP = :wsT[1]
	Where RES_ENT_INS = :sIns and RES_NIV_LETTRE = :sNiv and RES_ELE_EXT = :sExtElec and RES_ENT_INS_SUP = '92094' "
.head 5 -  !
.head 5 +  If bContinue
.head 6 +  If SqlPrepareAndExecute( ghSqlMaj, lsUpdate) 
.head 7 -  Call SqlCommit( ghSqlMaj )
.head 7 -  ! Check sum global
.head 7 +  If bSenatBHV and sExtElec != 'BR'
.head 8 -  Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsS[7] ) + SalStrToNumber( wsS[27] ) )
.head 7 +  Else
.head 8 -  Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsS[7] ) )
.head 7 -  Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsS[9] ) )
.head 7 +  If bSenatBHV and sExtElec != 'BR'
.head 8 -  Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsS[10] )+SalStrToNumber( wsS[10] ) )
.head 8 -  ! Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsS[10] ) )
.head 7 +  Else
.head 8 -  Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsS[10] ) )
.head 7 -  ! Check sum global sur toutes les SC des listes
.head 7 -  Set lnI = 0
.head 7 +  While lnI <= 99
.head 8 +  If wsL[lnI, 0] != ''
.head 9 -  ! Check sum global
.head 9 -  Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsL[lnI,25] ) )
.head 9 -  Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsL[lnI,26] ) )
.head 9 -  Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsL[lnI,28] ) )
.head 9 -  Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsL[lnI,27] ) )
.head 9 -  !
.head 8 -  Set lnI = lnI +1
.head 7 -  Set lnI = 0
.head 7 +  While lnI <= 99
.head 8 +  If wsL[lnI, 0] != ''
.head 9 -  Set wnCheckSumDtm[lnI] = NUMBER_Null
.head 9 -  Set lsUpdate = "Update RESULT_LISTES 
	set 	REL_SC1	 = :wsL[lnI,25],
		REL_SC2 = :wsL[lnI,26],
		REL_SC3	 = :wsL[lnI,27],
		REL_SC4 = :wsL[lnI,28]
	Where REL_ENT_INS = :sIns and REL_NIV_LETTRE = :sNiv and REL_LIS_NO = :wsL[lnI,14] and REL_ELE_EXT = :sExtElec "
.head 9 +  If SqlPrepareAndExecute( ghSqlMaj, lsUpdate)
.head 10 -  Call SqlCommit( ghSqlMaj )
.head 10 -  ! Check sum Liste
.head 10 -  Set wnCheckSumDtm[lnI] = PalDtmCheckSumListe( wnCheckSumDtm[lnI], SalStrToNumber( wsL[lnI,25] ) )
.head 10 -  Set wnCheckSumDtm[lnI] = PalDtmCheckSumListe( wnCheckSumDtm[lnI], SalStrToNumber( wsL[lnI,26] ) )
.head 10 -  Set wnCheckSumDtm[lnI] = PalDtmCheckSumListe( wnCheckSumDtm[lnI], SalStrToNumber( wsL[lnI,28] ) )
.head 10 -  Set wnCheckSumDtm[lnI] = PalDtmCheckSumListe( wnCheckSumDtm[lnI], SalStrToNumber( wsL[lnI,27] ) )
.head 10 +  If sType != 'P'
.head 11 -  ! Update candidats
.head 11 -  ! effectifs
.head 11 -  Set lnJ = 1
.head 11 +  While lnJ <= SalStrToNumber( wsL[lnI, 16] ) and bContinue
.head 12 -  Set lsUpdate = "Update RESULT_CDT
	set 	REC_Nb_VOIX = :wsC[lnI,lnJ,20]
	Where REC_ENT_INS = :sIns and REC_NIV_LETTRE = :sNiv and REC_LIS_NO = :wsL[lnI,14] and REC_CDT_NO = :lnJ and REC_CDT_TYPE = 'E' and REC_ELE_EXT = :sExtElec "
.head 12 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsUpdate)
.head 13 -  Set bContinue = FALSE
.head 13 -  ! ERREUR
.head 13 -  Call PalHttpCockpit( 440, '', '1', lsUpdate, PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 13 -  Call SqlPrepareAndExecute( ghSqlMaj, 'ROLLBACK' )
.head 12 +  Else
.head 13 -  Call SqlCommit( ghSqlMaj )
.head 13 -  ! Check sum global
.head 13 -  Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsC[lnI,lnJ,20]  ) )
.head 13 -  ! Check sum Liste
.head 13 -  Set wnCheckSumDtm[lnI] = PalDtmCheckSumListe( wnCheckSumDtm[lnI], SalStrToNumber( wsC[lnI,lnJ,20] ) )
.head 12 -  Set lnJ = lnJ +1
.head 11 -  ! suppléants
.head 11 -  Set lnJ = 1
.head 11 +  While lnJ <= SalStrToNumber( wsL[lnI, 17] ) and bContinue
.head 12 -  Set lsUpdate =  "Update RESULT_CDT
	set 	REC_Nb_VOIX = :wsSuppl[lnI,lnJ,20]
	Where REC_ENT_INS = :sIns and REC_NIV_LETTRE = :sNiv and REC_LIS_NO = :wsL[lnI,14] and REC_CDT_NO = :lnJ and REC_CDT_TYPE = 'S' and REC_ELE_EXT = :sExtElec "
.head 12 +  If NOT SqlPrepareAndExecute( ghSqlMaj,lsUpdate )
.head 13 -  Set bContinue = FALSE
.head 13 -  ! ERREUR
.head 13 -  Call PalHttpCockpit( 440, '', '1', lsUpdate, PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 13 -  Call SqlPrepareAndExecute( ghSqlMaj, 'ROLLBACK' )
.head 12 +  Else
.head 13 -  Call SqlCommit( ghSqlMaj )
.head 13 -  ! Check sum global
.head 13 -  Set wnCheckSumDtm[0] = PalDtmCheckSumListe( wnCheckSumDtm[0], SalStrToNumber( wsSuppl[lnI,lnJ,20]  ) )
.head 13 -  ! Check sum Liste
.head 13 -  Set wnCheckSumDtm[lnI] = PalDtmCheckSumListe( wnCheckSumDtm[lnI], SalStrToNumber( wsSuppl[lnI,lnJ,20] ) )
.head 12 -  Set lnJ = lnJ +1
.head 10 +  Else
.head 11 -  Set lsUpdate = "Update RESULT_CDT
	set 	REC_Nb_VOIX = null
	Where REC_ENT_INS = :sIns and REC_NIV_LETTRE = :sNiv and REC_LIS_NO = :wsL[lnI,14] and REC_ELE_EXT = :sExtElec "
.head 11 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsUpdate)
.head 12 -  Set bContinue = FALSE
.head 12 -  ! ERREUR
.head 12 -  Call PalHttpCockpit( 440, '', '1', lsUpdate, PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 12 -  Call SqlPrepareAndExecute( ghSqlMaj, 'ROLLBACK' )
.head 11 +  Else
.head 12 -  Call SqlCommit( ghSqlMaj )
.head 9 +  Else
.head 10 -  Set bContinue = FALSE
.head 10 -  ! ERREUR
.head 10 -  Call PalHttpCockpit( 440, '', '1', lsUpdate, PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 10 -  Call SqlPrepareAndExecute( ghSqlMaj, 'ROLLBACK' )
.head 9 -  !
.head 9 +  If bContinue
.head 10 +  If wsL[lnI,40] != ''
.head 11 +  If wnCheckSumDtm[lnI] != SalStrToNumber( wsL[lnI,40] )
.head 12 -  ! Warning
.head 12 -  Call PalHttpCockpit( 441, '1', '', "CTRL CHECK-SUM : Liste "|| SalNumberToStrX( lnI, 0 ) || " - " || wsL[lnI,5] || ": Check Sum File : "|| wsL[lnI,30] || " - Check Sum calculé : "|| SalNumberToStrX( wnCheckSumDtm[lnI], 0 )  , 
	PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 10 -  !
.head 10 -  Set lsUpdate = "Update RESULT_LISTES 
	set 	REL_CHECK_SUM = :wnCheckSumDtm[lnI]
	Where REL_ENT_INS = :sIns and REL_NIV_LETTRE = :sNiv and REL_LIS_NO = :wsL[lnI,14] and REL_ELE_EXT = :sExtElec "
.head 10 -  Call SqlPrepareAndExecute( ghSqlMaj, lsUpdate)
.head 10 -  Call SqlCommit( ghSqlMaj )
.head 8 -  Set lnI = lnI +1
.head 7 -  !
.head 7 +  If bContinue
.head 8 +  If wsS[12] != ''
.head 9 +  If wnCheckSumDtm[0] != SalStrToNumber( wsS[12] )
.head 10 -  ! Warning
.head 10 -  Call PalHttpCockpit( 441, '1', '', "CTRL CHECK-SUM : Check Sum File : "|| wsS[12] || " - Check Sum calculé : "|| SalNumberToStrX( wnCheckSumDtm[0] , 0 )  , 
	PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 8 -  Set lsUpdate = "Update RESULT_SCRUTIN 
	set RES_CHECK_SUM = :wnCheckSumDtm[0]
	Where RES_ENT_INS = :sIns and RES_NIV_LETTRE = :sNiv and RES_ELE_EXT = :sExtElec "
.head 8 -  Call SqlPrepareAndExecute( ghSqlMaj, lsUpdate)
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 6 +  Else
.head 7 -  ! ERREUR
.head 7 -  Call PalHttpCockpit( 440, '', '1', lsUpdate, PalDtmExtension(  sFile ), wsModuleNom, wsModuleLigne, sFile )
.head 7 -  Set bContinue = FALSE
.head 5 +  If bContinue
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 5 +  Else
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, 'ROLLBACK' )
.head 5 -  Return (bContinue)
.head 3 +  Function: PalVerifResultNivSup
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nNoEl
.head 5 -  String: sEl
.head 5 -  String: sNiveau
.head 5 -  String: sIns
.head 5 -  Receive Long String: llsErreur
.head 5 -  Receive Long String: llsErreur2
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsWhere
.head 5 -  String: lsVV
.head 5 -  String: lsBE
.head 5 -  String: lsVBN
.head 5 -  String: lsE5
.head 5 -  String: lsVBN_E5 
.head 5 -  String: lsSC1
.head 5 -  String: lsSC2 
.head 5 -  String: lsSC3 
.head 5 -  String: lsSC4
.head 5 -  String: lsVoix
.head 5 -  String: lsIns2
.head 5 -  Number: lnNoListe
.head 5 -  Number: lnNoCdt
.head 5 -  Boolean: bOk
.head 5 -  Boolean: bTest
.head 5 -  Number: nCtrl
.head 5 -  String: lsFileData
.head 5 -  File Handle: hFile
.head 5 -  File Handle: hFile1K_Detail
.head 5 -  String: lsPkZip
.head 5 -  String: lsFileSearch
.head 5 -  String: lsFileSearch2
.head 5 -  String: lsFileInf[*]
.head 5 -  String: lsFileInf2[*]
.head 5 -  Number: nFiles
.head 5 -  Number: nFiles2
.head 5 -  Number: nRet
.head 5 -  Number: nIndice
.head 5 -  String: lsInsFileCompare
.head 5 -  String: lsNivFileCompare
.head 5 -  String: lsEntiteFileCompare
.head 5 -  String: lsPathOrigFileCompare
.head 5 -  Long String: llsErreur3
.head 4 +  Actions
.head 5 -  Call SalShowWindow( dfLibelleR )
.head 5 -  Set dfLibelleR = "Vérification Niv. Sup. " || sNiveau || sIns || "." || sEl
.head 5 -  Call SalBringWindowToTop( dfLibelleR )
.head 5 -  Call DispatchMessage(  )
.head 5 -  Set llsErreur = ''
.head 5 -  Set bOk = TRUE
.head 5 -  Set bTest = FALSE
.head 5 +  If nNoEl = 2
.head 6 +  If sNiveau = 'C'
.head 7 -  Set lsWhere = 'ENT_DEP_LISTE = ' || sIns
.head 7 -  Set bTest = TRUE
.head 7 -  Set nCtrl = 1
.head 6 +  Else If sNiveau = 'O'
.head 7 -  Set lsWhere = "ENT_DEP_LISTE in ('21004','24062','25072') "
.head 7 -  Set bTest = TRUE
.head 7 -  Set nCtrl = 1
.head 5 +  Else If nNoEl = 3
.head 6 +  If sNiveau = 'L'
.head 7 -  Set lsWhere = " Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and Lis_Ent_Fk = :wnIdEntiteEnCours ) "
.head 7 +  If sIns = '92094'
.head 8 -  Set lsIns2 = '12025'
.head 7 +  Else
.head 8 -  Set lsIns2 = '92094'
.head 7 -  Set bTest = TRUE
.head 7 -  Set nCtrl = 2
.head 6 +  If sNiveau = 'P'
.head 7 -  Set lsWhere = " ENT_INS not like '%999' and ENT_INS_NIVSUP = " || sIns
.head 7 -  Set bTest = TRUE
.head 7 -  Set nCtrl = 1
.head 5 +  Else If nNoEl = 1
.head 6 +  If sNiveau = 'L'
.head 7 -  Set lsWhere = " Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and Lis_Ent_Fk = :wnIdEntiteEnCours ) "
.head 7 +  If sIns = '92094'
.head 8 -  Set lsIns2 = '12025,63023'
.head 7 +  Else If sIns = '12025'
.head 8 -  Set lsIns2 = '92094,63023'
.head 7 +  Else
.head 8 -  Set lsIns2 = '92094,12025'
.head 7 -  Set bTest = TRUE
.head 7 -  Set nCtrl = 2
.head 6 +  If sNiveau = 'P'
.head 7 -  Set lsWhere = 'ENT_INS_NIVSUP = ' || sIns
.head 7 -  Set bTest = TRUE
.head 7 -  Set nCtrl = 1
.head 5 +  Else If nNoEl = 4
.head 6 +  If sNiveau = 'C'
.head 7 -  Set lsWhere = 'ENT_DEP_LISTE = ' || sIns
.head 7 -  Set bTest = TRUE
.head 7 -  Set nCtrl = 1
.head 5 +  Else If nNoEl = 7
.head 6 +  If sNiveau = 'C'
.head 7 -  Set lsWhere = 'ENT_DEP_LISTE = ' || sIns
.head 7 -  Set bTest = TRUE
.head 7 -  Set nCtrl = 1
.head 5 +  Else If nNoEl = 10
.head 6 +  If sNiveau = 'R'
.head 7 -  Set lsWhere = 'ENT_DEP_LISTE = ' || sIns
.head 7 -  Set bTest = TRUE
.head 7 -  Set nCtrl = 1
.head 5 +  Else If nNoEl = 11
.head 6 +  If sNiveau = 'C'
.head 7 -  Set lsWhere = 'ENT_DEP_LISTE = ' || sIns
.head 7 -  Set bTest = TRUE
.head 7 -  Set nCtrl = 1
.head 5 +  Else If nNoEl = 12
.head 6 +  If sNiveau = 'G'
.head 7 -  Set lsWhere = 'ENT_DEP_LISTE = ' || sIns
.head 7 -  Set bTest = TRUE
.head 7 -  Set nCtrl = 1
.head 5 -  ! ! Verification que tous les cantons sont complets ou définitifs
.head 5 +  If bTest
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select  *
	From Result_Scrutin, ENTITE
	Where Ent_id = RES_ENT_FK and ENT_Ele_Ext = :sEl and Ent_Niv_Lettre = 'K' and @nullvalue(RES_T_DEP,'P') not in ('C','D') and " || lsWhere  )
.head 6 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  Set bTest = FALSE
.head 7 +  If llsErreur!= ''
.head 8 -  Set llsErreur = llsErreur ||"
"
.head 7 -  Set llsErreur = llsErreur || "L'ensemble des cantons pour ce niveaux ne sont pas complets ou définitifs !!!
Il est donc impossible d'avoir déjà les résultats de ce niveau supérieur !!!"
.head 5 -  !
.head 5 +  If bTest
.head 6 -  ! 1. Contrôle de la ligne S
.head 6 +  If nCtrl = 1
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select  sum(@nullvalue(RES_NB_VV,0)),sum(@nullvalue(RES_NB_BE,0)),sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_NB_VV_E5,0)), sum(@nullvalue(RES_NB_VBN_E5,0))
	From Result_Scrutin, ENTITE
	Where Ent_id = RES_ENT_FK and ENT_Ele_Ext = :sEl and Ent_Niv_Lettre = 'K' and " || lsWhere ||"
   Into :lsVV , :lsBE, :lsVBN, :lsE5, :lsVBN_E5 " )
.head 6 +  Else If nCtrl = 2
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select  sum(@nullvalue(RES_NB_VV,0)),sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0)) ,0,0
	From Result_Scrutin
	Where  RES_ELE_EXT= :sEl and RES_ENT_INS_SUP not in ("|| lsIns2 ||") And 
	"|| lsWhere ||"
   Into :lsVV , :lsBE, :lsVBN, :lsE5, :lsVBN_E5 " )
.head 6 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  !
.head 6 +  If nNoEl = 3 and sNiveau = 'P' and sIns = '21004'
.head 7 -  Set wsS[7] = SalNumberToStrX( SalStrToNumber( wsS[7]  ) + SalStrToNumber( wsS[27] ) , 0 )
.head 6 -  !
.head 6 +  If wsS[7] != lsVV
.head 7 +  If llsErreur!= ''
.head 8 -  Set llsErreur = llsErreur ||"
"
.head 7 -  Set llsErreur = llsErreur || "Diff. entre les nombres de votes enregistrés du fichier ("|| wsS[7] ||") et celui déterminé par les niv. inf. ("|| lsVV ||") "
.head 6 -  !
.head 6 -  !
.head 6 +  If nNoEl = 3 and sNiveau = 'L'
.head 7 -  ! PAS de calcul des BE et VBN
.head 6 +  Else If nNoEl = 3 and sNiveau = 'P' and sIns = '21004'
.head 7 -  ! PAS de calcul des BE et VBN
.head 6 +  Else
.head 7 +  If SalNumberToStrX(SalStrToNumber(  wsS[9]),0)!= lsBE
.head 8 +  If llsErreur!= ''
.head 9 -  Set llsErreur = llsErreur ||"
"
.head 8 -  Set llsErreur = llsErreur || "Diff. entre les nombres de votes type Belge du fichier ("|| wsS[9] ||") et celui déterminé par les niv. inf. ("|| lsBE ||") "
.head 7 +  If SalNumberToStrX(SalStrToNumber(  wsS[10]) ,0)!= lsVBN
.head 8 +  If llsErreur!= ''
.head 9 -  Set llsErreur = llsErreur ||"
"
.head 8 -  Set llsErreur = llsErreur || "Diff. entre les nombres de votes blancs et nuls du fichier ("|| wsS[10] ||") et celui déterminé par les niv. inf. ("|| lsVBN ||") "
.head 6 -  ! NON déterminé aux niveaux supérieurs
.head 6 +  ! If SalNumberToStrX(SalStrToNumber(  wsS[13]),0) != lsE5
.head 7 +  If llsErreur!= ''
.head 8 -  Set llsErreur = llsErreur ||"
"
.head 7 -  Set llsErreur = llsErreur || "Diff. entre les nombres de votes E5 du fichier ("|| wsS[13] ||") et celui déterminé par les niv. inf. ("|| lsE5 ||") "
.head 6 +  ! If SalNumberToStrX(SalStrToNumber(  wsS[14]),0) != lsVBN_E5
.head 7 +  If llsErreur!= ''
.head 8 -  Set llsErreur = llsErreur ||"
"
.head 7 -  Set llsErreur = llsErreur || "Diff. entre les nombres de votes E5 blancs et nuls du fichier ("|| wsS[14] ||") et celui déterminé par les niv. inf. ("|| lsVBN_E5 ||") "
.head 6 -  !
.head 6 -  ! 2. Contrôle des lignes L
.head 6 +  If nCtrl = 1
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select REL_LIS_NO,sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from result_listes, ENTITE
	Where Ent_id = REL_ENT_FK and ENT_Ele_Ext = :sEl and Ent_Niv_Lettre = 'K' and " || lsWhere ||"
	group by 1
	order by 1
	into :lnNoListe, :lsSC1, :lsSC2, :lsSC3, :lsSC4 " )
.head 6 +  Else If nCtrl = 2
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select REL_LIS_NO,sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from result_listes, Listes
	Where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sEl ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :wnIdEntiteEnCours 
	group by 1
	order by 1
	into :lnNoListe, :lsSC1, :lsSC2, :lsSC3, :lsSC4 " )
.head 6 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 7 +  If SalNumberToStrX(SalStrToNumber(  wsL[lnNoListe, 25]),0) != lsSC1
.head 8 +  If llsErreur!= ''
.head 9 -  Set llsErreur = llsErreur ||"
"
.head 8 -  Set llsErreur = llsErreur || "Liste n° "|| SalNumberToStrX( lnNoListe,0) ||" : Diff. entre la SC1 du fichier ("|| wsL[lnNoListe, 25] ||") et celui déterminé par les niv. inf. ("|| lsSC1 ||") "
.head 7 +  If SalNumberToStrX(SalStrToNumber(  wsL[lnNoListe, 26]),0) != lsSC2
.head 8 +  If llsErreur!= ''
.head 9 -  Set llsErreur = llsErreur ||"
"
.head 8 -  Set llsErreur = llsErreur || "Liste n° "|| SalNumberToStrX( lnNoListe,0) ||" : Diff. entre la SC2 du fichier ("|| wsL[lnNoListe, 26] ||") et celui déterminé par les niv. inf. ("|| lsSC2 ||") "
.head 7 +  If SalNumberToStrX(SalStrToNumber(  wsL[lnNoListe, 27]),0) != lsSC3
.head 8 +  If llsErreur!= ''
.head 9 -  Set llsErreur = llsErreur ||"
"
.head 8 -  Set llsErreur = llsErreur || "Liste n° "|| SalNumberToStrX( lnNoListe,0) ||" : Diff. entre la SC3 du fichier ("|| wsL[lnNoListe, 27] ||") et celui déterminé par les niv. inf. ("|| lsSC3 ||") "
.head 7 +  If SalNumberToStrX(SalStrToNumber(  wsL[lnNoListe, 28]),0) != lsSC4
.head 8 +  If llsErreur!= ''
.head 9 -  Set llsErreur = llsErreur ||"
"
.head 8 -  Set llsErreur = llsErreur || "Liste n° "|| SalNumberToStrX( lnNoListe,0) ||" : Diff. entre la SC4 du fichier ("|| wsL[lnNoListe, 28] ||") et celui déterminé par les niv. inf. ("|| lsSC4 ||") "
.head 7 -  !
.head 7 -  ! 3. Contrôle des lignes C eff
.head 7 +  If nCtrl = 1
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire , "Select REC_CDT_NO, sum( @nullvalue( REC_NB_VOIX,0) )
	from result_cdt, ENTITE
	Where Ent_id = REC_ENT_FK and ENT_Ele_Ext = :sEl  and Ent_Niv_Lettre = 'K' and REC_LIS_NO = :lnNoListe and REC_CDT_TYPE = 'E' and " || lsWhere ||"
	group by 1
	order by 1
	into :lnNoCdt, :lsVoix  " )
.head 7 +  Else If nCtrl = 2
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire , "Select REC_CDT_NO, sum( @nullvalue( REC_NB_VOIX,0) )
	from result_cdt, result_Scrutin
	Where RES_ELE_EXT = :sEl  and RES_ENT_INS_SUP not in ("|| lsIns2 ||") and RES_ENT_FK = REC_ENT_FK and REC_LIS_NO = :lnNoListe and REC_CDT_TYPE = 'E' and 
	" || lsWhere ||"
	group by 1
	order by 1
	into :lnNoCdt, :lsVoix  " )
.head 7 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  If SalNumberToStrX(SalStrToNumber(  wsC[lnNoListe,lnNoCdt,20]),0) != lsVoix
.head 9 +  If llsErreur!= ''
.head 10 -  Set llsErreur = llsErreur ||"
"
.head 9 -  Set llsErreur = llsErreur || "Liste n° "|| SalNumberToStrX( lnNoListe,0) ||" -  Eff. "|| SalNumberToStrX( lnNoCdt,0) ||" : Diff. entre le nb de voix du fichier ("|| wsC[lnNoListe,lnNoCdt,20] ||") et celui déterminé par les niv. inf. ("|| lsVoix ||") "
.head 7 -  !
.head 7 -  ! 4. Contrôle des lignes C suppl
.head 7 +  If nCtrl = 1
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire , "Select REC_CDT_NO, sum( @nullvalue( REC_NB_VOIX,0) )
	from result_cdt, ENTITE
	Where Ent_id = REC_ENT_FK and ENT_Ele_Ext = :sEl  and Ent_Niv_Lettre = 'K' and REC_LIS_NO = :lnNoListe and REC_CDT_TYPE = 'S' and " || lsWhere ||"
	group by 1
	order by 1
	into :lnNoCdt, :lsVoix  " )
.head 7 +  Else If nCtrl = 2
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire , "Select REC_CDT_NO, sum( @nullvalue( REC_NB_VOIX,0) )
	from result_cdt, result_Scrutin
	Where RES_ELE_EXT = :sEl  and RES_ENT_INS_SUP not in ("|| lsIns2 ||") and RES_ENT_FK = REC_ENT_FK and REC_LIS_NO = :lnNoListe and REC_CDT_TYPE = 'S' and 
	" || lsWhere ||"
	group by 1
	order by 1
	into :lnNoCdt, :lsVoix  " )
.head 7 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  If SalNumberToStrX(SalStrToNumber(  wsSuppl[lnNoListe,lnNoCdt,20]),0) != lsVoix
.head 9 +  If llsErreur!= ''
.head 10 -  Set llsErreur = llsErreur ||"
"
.head 9 -  Set llsErreur = llsErreur || "Liste n° "|| SalNumberToStrX( lnNoListe,0) ||" -  Suppl. "|| SalNumberToStrX( lnNoCdt,0) ||" : Diff. entre le nb de voix du fichier ("|| wsSuppl[lnNoListe,lnNoCdt,20] ||") et celui déterminé par les niv. inf. ("|| lsVoix ||") "
.head 6 -  !
.head 5 -  !
.head 5 +  If llsErreur != ''
.head 6 -  Set bOk = FALSE
.head 5 +  Else
.head 6 -  Set bOk = TRUE
.head 5 -  !
.head 5 -  ! ANALYSE DU FICHIER DATA correpondant - identification du(des) cantons différents
.head 5 +  If NOT bOk
.head 6 -  Set dfLibelleR = "Comparaison de fichiers ..."
.head 6 -  Call DispatchMessage(  )
.head 6 -  Set llsErreur2 = ''
.head 6 +  If TRUE
.head 7 -  Set lsFileData = 'Data_' || sNiveau || sIns || '_' ||  sEl ||'.ZIP'
.head 7 +  If SalFileOpen( hFile, dfIn || '\\data\\'|| lsFileData , OF_Exist )
.head 8 -  Call PalMakeAllDir( dfIn || "\\DATA\\CTRL" )
.head 8 -  Call SalGetProfileString( 'PATH', 'PKZIP',  '', lsPkZip, wsPathINI )
.head 8 +  If lsPkZip = ''
.head 9 -  Set llsErreur2 = "WZUNZIP.EXE not found"
.head 8 +  Else
.head 9 +  If SalStrScan( SalStrUpperX(lsPkZip), "ZIP.EXE" ) != -1
.head 10 -  Call VisFileDelete( dfIn || "\\DATA\\CTRL\\*.*" )
.head 10 -  Set lsPkZip = VisStrSubstitute( SalStrUpperX( lsPkZip ), "WZZIP", "WZUNZIP" )
.head 10 -  Call SalLoadAppAndWait( lsPkZip|| " -e " || dfIn || '\\data\\'|| lsFileData  || " "|| dfIn || "\\DATA\\CTRL" ,  Window_NotVisible, nRet )
.head 10 -  Set lsFileSearch2 = ''
.head 10 +  If (sNiveau = 'C' and (sEl = 'CK' or sEl = 'VL' or sEl ='WL') ) or
   (sNiveau = 'P' and (sEl = 'SE' or sEl = 'SE')) or
   (sNiveau = 'R' and sEl = 'BR') or (sNiveau = 'G' and sEl = 'DE') 
.head 11 -  Set lsFileSearch = '1K'
.head 10 +  Else If (sNiveau = 'O' and (sEl = 'CK' or sEl = 'WL'))
.head 11 -  Set lsFileSearch = 'SC'
.head 10 +  Else If (sNiveau = 'L' and (sEl = 'SE' or sEl = 'EU'))
.head 11 -  Set lsFileSearch = '2P'
.head 11 +  If sEl = 'SE'
.head 12 -  Set lsFileSearch2 = '1K'
.head 10 -  !
.head 10 -  Set nFiles = VisDosEnumFiles( dfIn || "\\DATA\\CTRL\\"|| lsFileSearch ||"*."|| sEl, FA_Standard, lsFileInf )
.head 10 +  If lsFileSearch2 != ''
.head 11 -  Set nFiles2 = VisDosEnumFiles( dfIn || "\\DATA\\CTRL\\"|| lsFileSearch2 ||"*."|| sEl, FA_Standard, lsFileInf2 )
.head 11 +  If nFiles2 > 0
.head 12 -  Set nIndice = 0 
.head 12 +  While nIndice < nFiles2
.head 13 -  Set lsFileInf[nFiles] = lsFileInf2[nIndice]
.head 13 -  Set nFiles = nFiles+1
.head 13 -  Set nIndice = nIndice +1
.head 10 -  !
.head 10 +  If nFiles > 0
.head 11 -  Set llsErreur2 = ''
.head 11 -  Set nIndice  = 0
.head 11 +  While nIndice < nFiles
.head 12 -  Set lsFileSearch = SalStrLeftX(  lsFileInf[nIndice], 2 )
.head 12 +  If lsFileSearch = '1K'
.head 13 -  ! Recherche du fichier 1K dans DETAIL\1
.head 13 -  Set lsPathOrigFileCompare = dfIn || '\\1\\ARCH_1K\\'
.head 12 +  Else
.head 13 -  ! Recherche du fichier niv inf dans DETAIL\Sup
.head 13 -  Set lsPathOrigFileCompare = dfIn || '\\SUP\\'
.head 12 -  !
.head 12 -  ! Recherche du fichier dans le Path Original
.head 12 +  If SalFileOpen( hFile1K_Detail , lsPathOrigFileCompare ||  lsFileInf[nIndice] , OF_Exist )
.head 13 -  Set dfLibelleR = "Comparaison de fichiers ("||  lsFileInf[nIndice] ||") - "|| SalNumberToStrX( nIndice+1, 0 ) ||" / " || SalNumberToStrX( nFiles, 0 )
.head 13 -  Call DispatchMessage(  )
.head 13 +  If NOT PalCompareFichier( nNoEl, sEl, lsFileSearch, lsPathOrigFileCompare ||  lsFileInf[nIndice],  dfIn || "\\DATA\\CTRL\\"||  lsFileInf[nIndice] , lsFileInf[nIndice], llsErreur3 )
.head 14 +  If llsErreur3 != ''
.head 15 -  Set lsInsFileCompare = SalStrMidX( lsFileInf[nIndice], 2, 5 )
.head 15 -  Set lsNivFileCompare = SalStrRightX( lsFileSearch,1 )
.head 15 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ENT_NOM_FF from ENTITE
	Where ent_ins = :lsInsFileCompare and ent_niv_lettre= :lsNivFileCompare  and ent_Ele_ext = :sEl 
	Into :lsEntiteFileCompare " )
.head 15 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 15 +  If llsErreur2 != ''
.head 16 -  Set llsErreur2 = llsErreur2 ||'

'
.head 15 -  Set llsErreur2 = llsErreur2 || lsEntiteFileCompare ||"
"|| llsErreur3
.head 12 +  Else
.head 13 +  If llsErreur2 != ''
.head 14 -  Set llsErreur2 = llsErreur2 ||'
'
.head 13 -  Set llsErreur2 = llsErreur2 || "FILE "|| lsFileInf[nIndice] ||" NOT FOUND in "|| lsPathOrigFileCompare
.head 12 -  Set nIndice = nIndice + 1
.head 10 +  Else
.head 11 -  Set llsErreur2 = "FILE "|| lsFileSearch ||" NOT FOUND in "|| dfIn || '\\data\\'|| lsFileData
.head 9 +  Else
.head 10 -  Set llsErreur2 = "UNZIP not good : "|| lsPkZip
.head 7 +  Else
.head 8 -  Set llsErreur2 = "FILE DATA NOT FOUND : "|| dfIn || '\\'|| lsFileData 
.head 5 -  !
.head 5 -  Call SalHideWindow( dfLibelleR )
.head 5 -  Return bOk
.head 3 +  Function: PalCompareFichier
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nNoEl
.head 5 -  String: sEl
.head 5 -  String: sTypeFile
.head 5 -  String: sPathFile1
.head 5 -  String: sPathFile2
.head 5 -  String: sFileNomSeul
.head 5 -  Receive Long String: llsErreur
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: psIns
.head 5 -  String: lsInsListe
.head 5 -  Number: pnNbCdtMax
.head 5 -  Number: pnNoEl 
.head 5 -  String: lsEl
.head 5 -  String: lsNivLettre
.head 5 -  String: sIns[5]
.head 5 -  Number: lnNivId
.head 5 -  String: lsInsListe2
.head 5 -  !
.head 5 -  Boolean: bContinue
.head 5 -  Boolean: bContinueL
.head 5 -  Number: i
.head 5 -  Number: j
.head 5 -  Number: k
.head 5 -  String: lsG_F1[20]
.head 5 -  String: lsS_F1[100]
.head 5 -  String: lsL_F1[250, 100]
.head 5 -  String: lsC_F1[250,250,100]
.head 5 -  String: lsSuppl_F1[250,250,100]
.head 5 -  String: lsG_F2[20]
.head 5 -  String: lsS_F2[100]
.head 5 -  String: lsL_F2[250, 100]
.head 5 -  String: lsC_F2[250,250,100]
.head 5 -  String: lsSuppl_F2[250,250,100]
.head 5 -  Boolean: bCtrlBulletins
.head 4 +  Actions
.head 5 +  If PalInitStruct(  )
.head 6 -  Set psIns = SalStrMidX( sFileNomSeul, 2,5)
.head 6 -  Set lsEl = SalStrRightX( sFileNomSeul, 2)
.head 6 -  Set lsNivLettre = SalStrMidX( sFileNomSeul, 1,1)
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_ID from Election where ELE_LETTRE = :lsEl 
	into :pnNoEl " )
.head 6 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  Set llsErreur = "Election non trouvée : "|| lsEl
.head 7 -  Return (FALSE)
.head 6 -  !
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Niv_Id from Niveaux where Niv_Lettre = :lsNivLettre and NIV_ELE_FK =:pnNoEl  into :lnNivId ")
.head 6 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  Set llsErreur = "Niveaux non trouvé : "|| lsNivLettre || ' - ' || lsEl
.head 7 -  Return (FALSE)
.head 6 -  !
.head 6 -  Set lsInsListe2 = ''
.head 6 +  If (pnNoEl = 3 or pnNoEl = 1) and (SalStrLeftX(psIns,2) = '21' or SalStrLeftX(psIns,2) = '23' )
.head 7 -  Set lsInsListe = '12025'
.head 7 -  Set lsInsListe2 = '92094'
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ENT_NB_CDT_MAX from entite A 
where A.Ent_inS in (12025,92094 ) 
	and A.ENT_ELE_FK = :pnNoEl and  A.ENT_NIV_FK > :lnNivId and ENT_NB_CDT_MAX is not null	
Order by 1 desc
into :pnNbCdtMax "  )
.head 7 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  Else
.head 7 +  If pnNoEl = 2 or pnNoEl = 4 or pnNoEl = 7 or pnNoEl = 10 or pnNoEl = 12
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ent_ins, ENT_NB_CDT_MAX from entite A 
where A.Ent_inS = (Select B.ENT_INS_NIVSUP from entite B where  B.ENT_INS = :psIns and B.ENT_ELE_FK = :pnNoEl and B.ENT_NIV_LETTRE = :lsNivLettre ) 
	and A.ENT_ELE_FK = :pnNoEl and  A.ENT_NIV_FK > :lnNivId and ENT_NB_CDT_MAX is not null	
Order by 2 desc
into :lsInsListe, :pnNbCdtMax "  )
.head 7 +  Else If pnNoEl = 3 or pnNoEl = 1
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ent_ins, ENT_NB_CDT_MAX from entite A 
where A.Ent_inS = (Select B.ENT_INS_NIVSUPSUP from entite B where  B.ENT_INS = :psIns and B.ENT_ELE_FK = :pnNoEl and B.ENT_NIV_LETTRE = :lsNivLettre ) 
	and A.ENT_ELE_FK = :pnNoEl and  A.ENT_NIV_FK-1 > :lnNivId and ENT_NB_CDT_MAX is not null	
Order by 2 desc
into :lsInsListe, :pnNbCdtMax "  )
.head 7 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 8 +  If pnNbCdtMax = 0 or pnNbCdtMax = NUMBER_Null
.head 9 -  Set pnNbCdtMax = 25
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select B.ENT_DEP_LISTE from entite B where  B.ENT_INS = :psIns and B.ENT_ELE_FK = :pnNoEl and B.ENT_NIV_LETTRE = :lsNivLettre 
into :lsInsListe"  )
.head 8 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 9 +  If pnNbCdtMax = 0 or pnNbCdtMax = NUMBER_Null
.head 10 -  Set pnNbCdtMax = 99
.head 8 +  Else
.head 9 -  Set llsErreur = "Entité non trouvée : "|| psIns || ' - ' || lsNivLettre || ' - ' || lsEl 
.head 9 -  Return (FALSE)
.head 6 -  !
.head 6 +  If pnNbCdtMax = 0 or pnNbCdtMax = NUMBER_Null
.head 7 -  Set pnNbCdtMax = 99
.head 6 -  Set sIns[1] = lsInsListe
.head 6 -  Set sIns[2] = lsInsListe2
.head 6 +  If PalChargeFormatF_Sup( sPathFile1, sIns, pnNbCdtMax, pnNoEl , psIns, sFileNomSeul )
.head 7 -  Set i = 0
.head 7 +  While i <= 99
.head 8 +  If i < 20
.head 9 -  Set lsG_F1[i] = wsG[i] 
.head 8 -  Set lsS_F1[i] = wsS[i]
.head 8 -  Set j = 0
.head 8 +  If wsL[i,0] != ''
.head 9 +  While j <= 70
.head 10 +  If wsL[i,0] != ''
.head 11 -  Set lsL_F1[i,j] = wsL[i, j] 
.head 11 -  Set k=0
.head 11 +  While k <= 25
.head 12 -  Set lsC_F1[i,j,k] = wsC[i,j, k]
.head 12 -  Set lsSuppl_F1[i,j,k] = wsSuppl[ i,j,k]
.head 12 -  Set k= k +1
.head 10 -  Set j= j +1
.head 8 +  ! If TRUE
.head 9 +  While j <= 99
.head 10 +  If TRUE
.head 11 -  Set lsL_F1[i,j] = wsL[i, j] 
.head 11 -  Set k=0
.head 11 +  While k <= 99
.head 12 -  Set lsC_F1[i,j,k] = wsC[i,j, k]
.head 12 -  Set k= k +1
.head 11 -  Set k=0
.head 11 +  While k <= 99
.head 12 -  Set lsSuppl_F1[i,j,k] = wsSuppl[ i,j,k]
.head 12 -  Set k= k +1
.head 10 -  Set j= j +1
.head 8 -  Set i = i + 1
.head 8 -  Set lsL_F1[i,0] = ''
.head 7 -  !
.head 7 +  If PalInitStruct(  )
.head 8 +  If PalChargeFormatF_Sup( sPathFile2, sIns, pnNbCdtMax, pnNoEl , psIns, sFileNomSeul )
.head 9 -  Set i = 0
.head 9 +  While i <= 99
.head 10 +  If i < 20
.head 11 -  Set lsG_F2[i] = wsG[i] 
.head 10 -  Set lsS_F2[i] = wsS[i]
.head 10 -  Set j = 0
.head 10 +  If wsL[i,0] != ''
.head 11 +  While j <= 70
.head 12 +  If wsL[i,0] != ''
.head 13 -  Set lsL_F2[i,j] = wsL[i, j] 
.head 13 -  Set k=0
.head 13 +  While k <= 25
.head 14 -  Set lsC_F2[i,j,k] = wsC[i,j, k]
.head 14 -  Set lsSuppl_F2[i,j,k] = wsSuppl[ i,j,k]
.head 14 -  Set k= k +1
.head 12 -  Set j= j +1
.head 10 +  ! If TRUE
.head 11 +  While j <= 99
.head 12 +  If TRUE
.head 13 -  Set lsL_F2[i,j] = wsL[i, j] 
.head 13 -  Set k=0
.head 13 +  While k <= 99
.head 14 -  Set lsC_F2[i,j,k] = wsC[i,j, k]
.head 14 -  Set k= k +1
.head 13 -  Set k=0
.head 13 +  While k <= 99
.head 14 -  Set lsSuppl_F2[i,j,k] = wsSuppl[ i,j,k]
.head 14 -  Set k= k +1
.head 12 -  Set j= j +1
.head 10 -  Set i = i + 1
.head 10 -  Set lsL_F2[i,0] = ''
.head 9 -  !
.head 9 -  Set bCtrlBulletins = TRUE
.head 9 +  If sIns[2] != ''
.head 10 +  If lsS_F1[2] = lsS_F2[2]  and lsS_F1[22] = lsS_F2[22]
.head 11 -  Set bCtrlBulletins = TRUE
.head 10 +  Else
.head 11 -  Set bCtrlBulletins = FALSE
.head 9 -  !
.head 9 -  ! Comparaison des 2 arrays
.head 9 -  Set llsErreur = ''
.head 9 -  Set bContinue = TRUE
.head 9 +  If lsS_F1[2] = lsS_F2[2]
.head 10 +  If bCtrlBulletins
.head 11 +  If lsS_F1[7] != lsS_F2[7]
.head 12 -  ! Bulletins valables
.head 12 +  If llsErreur != ''
.head 13 -  Set llsErreur = llsErreur ||'
'
.head 12 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Bulletins valables : FF Detail : " || lsS_F1[7] || "  <>  FF NivSup : "|| lsS_F2[7]
.head 11 +  If lsS_F1[9] != lsS_F2[9]
.head 12 -  ! Bulletins Enreg
.head 12 +  If llsErreur != ''
.head 13 -  Set llsErreur = llsErreur ||'
'
.head 12 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Bulletins Enreg. : FF Detail : " || lsS_F1[9] || "  <>  FF NivSup : "|| lsS_F2[9]
.head 11 +  If lsS_F1[10] != lsS_F2[10]
.head 12 -  ! Bulletins blancs & nuls
.head 12 +  If llsErreur != ''
.head 13 -  Set llsErreur = llsErreur ||'
'
.head 12 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Bulletins blancs & nuls : FF Detail : " || lsS_F1[10] || "  <>  FF NivSup : "|| lsS_F2[10]
.head 10 +  If lsS_F1[12] != '' or lsS_F2[12] != ''
.head 11 +  If lsS_F2[12] != '0'
.head 12 +  If lsS_F1[12] != lsS_F2[12]
.head 13 -  ! Check Sum du fichier
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Check Sum du fichier : FF Detail : " || lsS_F1[12] || "  <>  FF NivSup : "|| lsS_F2[12]
.head 12 +  Else
.head 13 -  ! Set bContinue = FALSE
.head 9 -  !
.head 9 +  If bContinue
.head 10 +  If lsS_F1[22] = lsS_F2[22]
.head 11 +  If bCtrlBulletins
.head 12 +  If lsS_F1[27] != lsS_F2[27]
.head 13 -  ! Bulletins valables (2è Ligne S)
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Bulletins valables : FF Detail : " || lsS_F1[27] || "  <>  FF NivSup : "|| lsS_F2[27]
.head 12 +  If lsS_F1[29] != lsS_F2[29]
.head 13 -  ! Bulletins Enreg
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Bulletins Enreg. : FF Detail : " || lsS_F1[29] || "  <>  FF NivSup : "|| lsS_F2[29]
.head 12 +  If lsS_F1[30] != lsS_F2[30]
.head 13 -  ! Bulletins blancs & nuls
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Bulletins blancs & nuls : FF Detail : " || lsS_F1[30] || "  <>  FF NivSup : "|| lsS_F2[30]
.head 11 +  If lsS_F1[32] != '' or lsS_F2[32] != ''
.head 12 +  If lsS_F2[32] != '0'
.head 13 +  If lsS_F1[32] != lsS_F2[32]
.head 14 -  ! Check Sum du fichier
.head 14 +  If llsErreur != ''
.head 15 -  Set llsErreur = llsErreur ||'
'
.head 14 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Check Sum du fichier : FF Detail : " || lsS_F1[32] || "  <>  FF NivSup : "|| lsS_F2[32]
.head 13 +  Else
.head 14 -  ! Set bContinue = FALSE
.head 9 -  !
.head 9 +  If bContinue
.head 10 +  If lsS_F1[2] = lsS_F2[22]
.head 11 +  If bCtrlBulletins
.head 12 +  If lsS_F1[7] != lsS_F2[27]
.head 13 -  ! Bulletins valables (2è Ligne S)
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Bulletins valables : FF Detail : " || lsS_F1[7] || "  <>  FF NivSup : "|| lsS_F2[27]
.head 12 +  If lsS_F1[9] != lsS_F2[29]
.head 13 -  ! Bulletins Enreg
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Bulletins Enreg. : FF Detail : " || lsS_F1[9] || "  <>  FF NivSup : "|| lsS_F2[29]
.head 12 +  If lsS_F1[10] != lsS_F2[30]
.head 13 -  ! Bulletins blancs & nuls
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Bulletins blancs & nuls : FF Detail : " || lsS_F1[10] || "  <>  FF NivSup : "|| lsS_F2[30]
.head 11 +  If lsS_F1[12] != '' or lsS_F2[32] != ''
.head 12 +  If lsS_F2[32] != '0'
.head 13 +  If lsS_F1[12] != lsS_F2[32]
.head 14 -  ! Check Sum du fichier
.head 14 +  If llsErreur != ''
.head 15 -  Set llsErreur = llsErreur ||'
'
.head 14 -  Set llsErreur = llsErreur || sFileNomSeul || "     - Check Sum du fichier : FF Detail : " || lsS_F1[12] || "  <>  FF NivSup : "|| lsS_F2[22]
.head 13 +  Else
.head 14 -  ! Set bContinue = FALSE
.head 9 -  !
.head 9 +  If bContinue
.head 10 -  Set i = 0
.head 10 +  While i <= 100
.head 11 +  If lsL_F2[i,0] != '' and lsL_F1[i,12]=lsL_F2[i,12]
.head 12 -  Set bContinueL = TRUE
.head 12 +  If lsL_F1[i,25] != lsL_F2[i,25]
.head 13 -  ! SC1
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || " - Liste n° "|| SalNumberToStrX( i, 0) || " (" || lsL_F1[i,15] ||")
	     - SC1 : FF Detail : " || lsL_F1[i,25]  || "  <>  FF NivSup : "|| lsL_F2[i,25] 
.head 12 +  If lsL_F1[i,26] != lsL_F2[i,26]
.head 13 -  ! SC2
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || " - Liste n° "|| SalNumberToStrX( i, 0) || " (" || lsL_F1[i,15] ||")
	     - SC2 : FF Detail : " || lsL_F1[i,26]  || "  <>  FF NivSup : "|| lsL_F2[i,26] 
.head 12 +  If lsL_F1[i,27] != lsL_F2[i,27]
.head 13 -  ! SC3
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || " - Liste n° "|| SalNumberToStrX( i, 0) || " (" || lsL_F1[i,15] ||")
	     - SC3 : FF Detail : " || lsL_F1[i,27]  || "  <>  FF NivSup : "|| lsL_F2[i,27] 
.head 12 +  If lsL_F1[i,28] != lsL_F2[i,28]
.head 13 -  ! SC4
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || " - Liste n° "|| SalNumberToStrX( i, 0) || " (" || lsL_F1[i,15] ||")
	     - SC4 : FF Detail : " || lsL_F1[i,28]  || "  <>  FF NivSup : "|| lsL_F2[i,28] 
.head 12 +  If lsL_F1[i,29] != lsL_F2[i,29]
.head 13 -  ! CE
.head 13 +  If llsErreur != ''
.head 14 -  Set llsErreur = llsErreur ||'
'
.head 13 -  Set llsErreur = llsErreur || sFileNomSeul || " - Liste n° "|| SalNumberToStrX( i, 0) || " (" || lsL_F1[i,15] ||")
	     - CE : FF Detail : " || lsL_F1[i,29]  || "  <>  FF NivSup : "|| lsL_F2[i,29] 
.head 12 +  If lsL_F1[i,40] != '' or lsL_F2[i,40] != ''
.head 13 +  If lsL_F2[i,40] != '0'
.head 14 +  If lsL_F1[i,40] != lsL_F2[i,40]
.head 15 -  ! Check Sum Liste
.head 15 +  If llsErreur != ''
.head 16 -  Set llsErreur = llsErreur ||'
'
.head 15 -  Set llsErreur = llsErreur || sFileNomSeul || " - Liste n° "|| SalNumberToStrX( i, 0) || " (" || lsL_F1[i,15] ||")
	     - Check Sum Liste : FF Detail : " || lsL_F1[i,40]  || "  <>  FF NivSup : "|| lsL_F2[i,40] 
.head 14 +  Else
.head 15 -  ! Set bContinueL = FALSE
.head 12 +  If bContinueL
.head 13 -  ! Eff
.head 13 -  Set j = 0
.head 13 +  While j <= SalStrToNumber( lsL_F1[i,16] )
.head 14 +  If lsC_F1[i,j,20] != lsC_F2[i,j,20] 
.head 15 +  If llsErreur != ''
.head 16 -  Set llsErreur = llsErreur ||'
'
.head 15 -  Set llsErreur = llsErreur || sFileNomSeul || " - Liste n° "|| SalNumberToStrX( i, 0) || " (" || lsL_F1[i,15] ||") - Eff. "|| SalNumberToStrX( j, 0) || " : " || lsC_F1[i,j,9] ||"
	    - Voix : FF Detail : " || 
 lsC_F1[i,j,20]  || "  <>  FF NivSup : "||  lsC_F2[i,j,20]
.head 14 -  Set j= j +1
.head 13 -  ! Suppl
.head 13 -  Set j = 0
.head 13 +  While j <= SalStrToNumber( lsL_F1[i,17] )
.head 14 +  If lsSuppl_F1[i,j,20] != lsSuppl_F2[i,j,20] 
.head 15 +  If llsErreur != ''
.head 16 -  Set llsErreur = llsErreur ||'
'
.head 15 -  Set llsErreur = llsErreur || sFileNomSeul || " - Liste n° "|| SalNumberToStrX( i, 0) || " (" || lsL_F1[i,15] ||") - Suppl. "|| SalNumberToStrX( j, 0) || " : " || lsSuppl_F1[i,j,9] ||"
	    - Voix : FF Detail : " || 
 lsSuppl_F1[i,j,20]  || "  <>  FF NivSup : "||  lsSuppl_F2[i,j,20]
.head 14 -  Set j= j +1
.head 11 -  Set i = i + 1
.head 9 -  !
.head 9 +  If llsErreur != ''
.head 10 -  Return ( FALSE)
.head 9 +  Else
.head 10 -  Return ( TRUE)
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute(  ghSqlMaj , "ROLLBACK ")
.head 9 -  Set llsErreur = "Erreur dans le chargement du format F  : "|| sPathFile2
.head 9 -  Call SqlCommit( ghSqlMaj )
.head 9 -  Return ( FALSE)
.head 7 +  Else
.head 8 -  Set llsErreur = "Erreur d'initialisation de structure"
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 -  Return ( FALSE)
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute(  ghSqlMaj , "ROLLBACK ")
.head 7 -  Set llsErreur = "Erreur dans le chargement du format F  : "|| sPathFile1
.head 7 -  Call SqlCommit( ghSqlMaj )
.head 7 -  Return ( FALSE)
.head 5 +  Else
.head 6 -  Set llsErreur = "Erreur d'initialisation de structure"
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Return ( FALSE)
.head 3 +  Function: PalChargeFormatF_Sup
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sFile
.head 5 -  String: sIns[5]
.head 5 -  Number: nSiege
.head 5 -  Number: nNoEl
.head 5 -  String: sInsTot
.head 5 -  String: sFileNameSeul
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 5 -  Boolean: bContinue
.head 5 -  Number: nIndice
.head 5 -  Long String: sBuffer
.head 5 -  Long String: sErrCaract
.head 5 -  String: sDonnee[*]
.head 5 -  String: sBuffer2
.head 5 -  String: sTmp
.head 5 -  String: lsTypeF
.head 5 -  Long String: sErreur
.head 5 -  Long String: sErreurAffich
.head 5 -  Number: nSiegeSuppl
.head 5 -  Number: i
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnK
.head 5 -  Number: nNo
.head 5 -  Number: nLigne
.head 5 -  Number: nLongNom
.head 5 -  Number: nLongNomListe
.head 5 -  Boolean: bOk
.head 5 -  Boolean: lbPW_Suppl
.head 5 -  String: sSexeE[250, 100]
.head 5 -  String: sSexeS[250, 100]
.head 5 -  Number: nHommeE[*]
.head 5 -  Number: nFemmeE[*]
.head 5 -  Number: nHommeS[*]
.head 5 -  Number: nFemmeS[*]
.head 5 -  Number: lnChar
.head 5 -  String: lsTmp
.head 5 -  String: lsNoListeParticuliere
.head 5 -  Boolean: wbDonneeProvisoire
.head 5 -  Boolean: bSenatBHV
.head 5 -  Number: nIndiceBHV
.head 5 -  String: sGrpLingprec
.head 5 -  Number: lnTentative
.head 4 +  Actions
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute(  ghSqlErreur , "Delete from Erreur_EnCours  where Err_ent_FK = :wnIdEntiteEnCours ")
.head 5 -  Call SqlCommit( ghSqlErreur )
.head 5 -  Set sErreur = ''
.head 5 -  Set nLongNom = 25
.head 5 -  Set nLongNomListe = 18
.head 5 -  Set bContinue = TRUE
.head 5 -  Set nIndice = 0
.head 5 -  Set nLigne = 0
.head 5 +  If nNoEl = 2 or nNoEl = 3 or nNoEl = 1
.head 6 +  If nSiege < 12
.head 7 -  Set nSiegeSuppl = 6
.head 6 +  Else
.head 7 -  Set nSiegeSuppl = SalNumberRound(  ( nSiege /2)+0.49999 ) + 1
.head 5 +  Else If nNoEl = 12
.head 6 -  Set nSiegeSuppl = 0
.head 5 +  Else
.head 6 +  If nSiege < 4
.head 7 -  Set nSiegeSuppl = 4
.head 6 +  Else If nSiege > 16
.head 7 -  Set nSiegeSuppl = 16
.head 6 +  Else
.head 7 -  Set nSiegeSuppl = nSiege
.head 5 -  !
.head 5 -  Set bSenatBHV = FALSE
.head 5 +  If nNoEl = 3 or nNoEl = 1
.head 6 +  If SalStrLeftX( sInsTot, 2)  = '21' or SalStrLeftX( sInsTot, 2)  = '23'
.head 7 -  Set bSenatBHV = TRUE
.head 5 +  Else If nNoEl = 10
.head 6 -  Set bSenatBHV = TRUE
.head 5 -  !
.head 5 -  Set sGrpLingprec = ''
.head 5 -  Set lnTentative = 0
.head 5 +  While NOT SalFileOpen( hFile, sFile, OF_Read | OF_Text ) and lnTentative < 3
.head 6 -  Call SalPause(250)
.head 6 -  Set lnTentative = lnTentative + 1
.head 5 -  Call SalFileClose( hFile )
.head 5 +  If SalFileOpen( hFile, sFile, OF_Read | OF_Text )
.head 6 -  Call DispatchMessage(  )
.head 6 +  While SalFileGetStr( hFile, sBuffer, 5000 ) and bContinue
.head 7 -  Call DispatchMessage(  )
.head 7 +  If SalStrTrimX( sBuffer ) != ''
.head 8 -  Set lnI = 0
.head 8 +  While lnI < 100
.head 9 -  Set sDonnee[lnI] = ""
.head 9 -  Set lnI =lnI + 1
.head 8 +  If NOT PalStrTokenize( sBuffer, sDonnee)
.head 9 -  ! Erreur de structure
.head 9 -  Set sErreur = gsMessage[19] ||'
' || sFileNameSeul ||'
' || sBuffer
.head 9 -  Set bContinue = FALSE
.head 8 +  If bContinue
.head 9 +  If sDonnee[0] = 'G'
.head 10 -  Set wnNoListeProvisoire = 0
.head 10 +  If wsG[0] = ''
.head 11 -  Set wsG[0] = sDonnee[1]
.head 11 +  If wsG[0] = 'CK' and nNoEl = 2
.head 12 -  Set lsTypeF = 'C'
.head 11 +  Else If wsG[0] = 'SE' and nNoEl = 3
.head 12 -  Set lsTypeF = 'L'
.head 11 +  Else If wsG[0] = 'WL' and nNoEl = 4
.head 12 -  Set lsTypeF = 'C'
.head 11 +  Else If (wsG[0] = 'VL' or (wsG[0] = 'BV' and SalStrRightX(SalStrLeftX( sFileNameSeul,4),2)='21') ) and nNoEl = 7
.head 12 -  Set lsTypeF = 'C'
.head 11 +  Else If wsG[0] = 'BR' and nNoEl = 10
.head 12 -  Set lsTypeF = 'R'
.head 11 +  Else If (wsG[0] = 'BV' or wsG[0] = 'VL') and nNoEl = 11
.head 12 -  Set lsTypeF = 'C'
.head 11 +  Else If wsG[0] = 'DE' and nNoEl = 12
.head 12 -  Set lsTypeF = 'G'
.head 11 +  Else If wsG[0] = 'EU' and nNoEl = 1
.head 12 -  Set lsTypeF = 'L'
.head 11 +  Else
.head 12 -  ! Le type d'élection est erroné
.head 12 -  Set sErreur = gsMessage[20] ||'
' || sFileNameSeul 
.head 12 -  Set bContinue = FALSE
.head 10 +  Else
.head 11 -  ! Cette ligne est en double dans le fichier
.head 11 -  Set sErreur = gsMessage[21] ||'
' || sFileNameSeul
.head 11 -  Set bContinue = FALSE
.head 10 -  !
.head 10 +  If bContinue
.head 11 +  If sDonnee[2]  != gsDateEl
.head 12 -  ! La date d'élection ne correpond pas à celle du logiciel
.head 12 -  Set sErreur = gsMessage[22] ||'
' || sFileNameSeul
.head 12 -  ! ATTENTION : A remettre à FALSE quand tout sera OK
.head 12 -  Set bContinue = TRUE
.head 9 +  Else If sDonnee[0] = 'S'
.head 10 +  If TRUE
.head 11 +  If TRUE
.head 12 +  If TRUE
.head 13 +  If TRUE
.head 14 +  If bSenatBHV and ((sDonnee[2] = sIns[2] and nNoEl != 10) or ( nNoEl = 10 and sDonnee[8] != sGrpLingprec and sGrpLingprec != '')  )
.head 15 -  Set nIndiceBHV = 20
.head 14 +  Else
.head 15 -  Set nIndiceBHV = 0
.head 14 -  Set wsS[0+nIndiceBHV] = sDonnee[2]
.head 14 -  Set wsS[1+nIndiceBHV] = sDonnee[3]
.head 14 +  If nNoEl != 12
.head 15 -  Set wsS[2+nIndiceBHV] = sDonnee[4]
.head 14 +  Else
.head 15 -  Set wsS[2] = ''
.head 14 -  Set wsS[4+nIndiceBHV] = lsTypeF
.head 14 -  Set wsS[6+nIndiceBHV] = sDonnee[6]
.head 14 -  Set wsS[7+nIndiceBHV] = sDonnee[7]
.head 14 -  Set wsS[8+nIndiceBHV] = sDonnee[8]
.head 14 -  Set wsS[9+nIndiceBHV] = sDonnee[9]
.head 14 -  Set wsS[10+nIndiceBHV] = sDonnee[10]
.head 14 -  Set wsS[11+nIndiceBHV] = sDonnee[11]
.head 14 -  ! Check SUM
.head 14 +  If SalStrLeftX( sFileNameSeul, 2 ) = '1K'
.head 15 -  Set wsS[12+nIndiceBHV] = sDonnee[12]
.head 14 +  Else
.head 15 -  Set wsS[12+nIndiceBHV] = ''
.head 14 -  ! E5
.head 14 -  Set wsS[13+nIndiceBHV] = sDonnee[13]
.head 14 -  Set wsS[14+nIndiceBHV] = sDonnee[14]
.head 14 -  !
.head 14 +  If nNoEl = 10
.head 15 -  Set sGrpLingprec = sDonnee[8]
.head 9 +  Else If sDonnee[0] = 'L'
.head 10 +  If TRUE
.head 11 +  If TRUE
.head 12 -  !
.head 12 +  If sDonnee[4] = ''
.head 13 -  Set sDonnee[4] = PalDtmNoListeProvisoire( sDonnee[3] )
.head 13 -  Set wbDonneeProvisoire = TRUE
.head 12 +  Else
.head 13 -  Set wbDonneeProvisoire = FALSE
.head 12 -  !
.head 12 +  If TRUE
.head 13 +  If TRUE
.head 14 -  !
.head 14 -  Set wsL[ SalStrToNumber( sDonnee[4] ) , 0 ] = sDonnee[5]
.head 14 +  If TRUE
.head 15 -  Set wsL[ SalStrToNumber( sDonnee[4] ) , 1 ] = sDonnee[6]
.head 15 -  ! Ctrl des suppléants sauf pour Conseil Germano (pas de suppl)
.head 15 +  If nNoEl != 12
.head 16 +  If TRUE
.head 17 -  Set wsL[ SalStrToNumber( sDonnee[4] ) , 2 ] = sDonnee[7]
.head 17 -  !
.head 17 -  Set lnJ = 0
.head 17 +  While lnJ < 31
.head 18 -  Set wsL[ SalStrToNumber( sDonnee[4] ) , 10+lnJ ] = sDonnee[lnJ]
.head 18 -  Set lnJ = lnJ + 1
.head 16 -  !
.head 15 +  Else
.head 16 -  Set lnJ = 0
.head 16 +  While lnJ < 31
.head 17 -  Set wsL[ SalStrToNumber( sDonnee[4] ) , 10+lnJ ] = sDonnee[lnJ]
.head 17 -  Set lnJ = lnJ + 1
.head 9 +  Else If sDonnee[0] = 'C'
.head 10 +  If TRUE
.head 11 +  If TRUE
.head 12 +  If wbDonneeProvisoire
.head 13 -  Set sDonnee[4] = PalDtmNoListeProvisoire( sDonnee[3] )
.head 12 +  If TRUE
.head 13 +  If sDonnee[5] = 'E'
.head 14 +  If TRUE
.head 15 +  If TRUE
.head 16 -  Set lsTmp = sDonnee[28]
.head 16 +  If NOT PalCaractere437( lsTmp , sErrCaract )
.head 17 +  If sErreur != ''
.head 18 -  Set sErreur = sErreur || '
'
.head 17 -  ! Caractères ne repondent pas au code page 437
.head 17 -  Set sErreur = sErreur ||  gsMessage[35] ||': ' || sErrCaract
.head 16 +  Else
.head 17 -  Set sDonnee[28] = lsTmp
.head 16 -  Set lsTmp = sDonnee[29]
.head 16 +  If NOT PalCaractere437( lsTmp , sErrCaract )
.head 17 +  If sErreur != ''
.head 18 -  Set sErreur = sErreur || '
'
.head 17 -  ! Caractères ne repondent pas au code page 437
.head 17 -  Set sErreur = sErreur ||  gsMessage[35] ||': ' || sErrCaract 
.head 16 +  Else
.head 17 -  Set sDonnee[29] = lsTmp
.head 16 -  Set lnJ = 0
.head 16 +  While lnJ < 31
.head 17 -  Set wsC[ SalStrToNumber( sDonnee[4] ), SalStrToNumber( sDonnee[6] ) , lnJ ] = sDonnee[lnJ]
.head 17 -  Set lnJ = lnJ + 1
.head 13 +  Else If sDonnee[5] = 'S'
.head 14 +  If TRUE
.head 15 +  If TRUE
.head 16 -  Set lsTmp = sDonnee[28]
.head 16 +  If NOT PalCaractere437( lsTmp , sErrCaract )
.head 17 +  If sErreur != ''
.head 18 -  Set sErreur = sErreur || '
'
.head 17 -  ! Caractères ne repondent pas au code page 437
.head 17 -  Set sErreur = sErreur ||  'SUPPL. '|| gsMessage[35] ||': ' || sErrCaract
.head 16 +  Else
.head 17 -  Set sDonnee[28] = lsTmp
.head 16 -  Set lsTmp = sDonnee[29]
.head 16 +  If NOT PalCaractere437( lsTmp , sErrCaract )
.head 17 +  If sErreur != ''
.head 18 -  Set sErreur = sErreur || '
'
.head 17 -  ! Caractères ne repondent pas au code page 437
.head 17 -  Set sErreur = sErreur ||  'SUPPL. '||  gsMessage[35] ||': ' || sErrCaract 
.head 16 +  Else
.head 17 -  Set sDonnee[29] = lsTmp
.head 16 -  Set lnJ = 0
.head 16 +  While lnJ < 32
.head 17 -  Set wsSuppl[ SalStrToNumber( sDonnee[4] ), SalStrToNumber( sDonnee[6] ) , lnJ ] = sDonnee[lnJ]
.head 17 -  Set lnJ = lnJ + 1
.head 9 +  Else If sDonnee[0] = 'H'
.head 10 -  Set lnK = 0
.head 10 +  While lnK < 6
.head 11 -  Set wsH[lnK] = sDonnee[lnK]
.head 11 -  Set lnK = lnK + 1
.head 9 +  Else If sDonnee[0] = 'T'
.head 10 -  Set lnK = 0
.head 10 +  While lnK < 6
.head 11 -  Set wsT[lnK] = sDonnee[lnK]
.head 11 -  Set lnK = lnK + 1
.head 6 -  Call SalFileClose( hFile )
.head 5 +  Else
.head 6 -  Set sErreur = gsMessage[18] ||'
' || sFileNameSeul ||'
'|| sFile
.head 6 -  Set bContinue = FALSE
.head 5 -  !
.head 5 +  If bContinue
.head 6 +  If SalStrLeftX( sFileNameSeul, 1) != '0'
.head 7 -  Set lnI = 1
.head 7 +  While lnI <= 200
.head 8 +  If wsL[ lnI , 0 ] != ''
.head 9 +  If sSexeE[lnI, 1] = sSexeE[lnI, 2]
.head 10 +  If sErreur != ''
.head 11 -  Set sErreur = sErreur || '
'
.head 10 -  ! Erreur de parité dans cette liste sur les 2 premiers candidats effectifs
.head 10 -  Set sErreur = sErreur ||  gsMessage[28] ||  '  - ' || wsL[lnI,0]
.head 9 +  If nSiegeSuppl > 0
.head 10 +  If sSexeS[lnI, 1] = sSexeS[lnI, 2]
.head 11 +  If sErreur != ''
.head 12 -  Set sErreur = sErreur || '
'
.head 11 -  ! Erreur de parité dans cette liste sur les 2 premiers candidats suppléants
.head 11 -  Set sErreur = sErreur ||  gsMessage[29] ||  '  - ' || wsL[lnI,0]
.head 9 +  If SalNumberAbs( nHommeE[lnI] - nFemmeE[lnI] ) > 1
.head 10 +  If sErreur != ''
.head 11 -  Set sErreur = sErreur || '
'
.head 10 -  ! Erreur de parité dans cette liste
.head 10 -  Set sErreur = sErreur ||  gsMessage[30] || '  - ' || wsL[lnI,0]
.head 9 +  If nSiegeSuppl > 0
.head 10 +  If SalNumberAbs( nHommeS[lnI] - nFemmeS[lnI] ) > 1
.head 11 +  If sErreur != ''
.head 12 -  Set sErreur = sErreur || '
'
.head 11 -  ! Erreur de parité dans cette liste
.head 11 -  Set sErreur = sErreur ||  gsMessage[12]||" :" || gsMessage[30] || '  - ' || wsL[lnI,0]
.head 8 -  Set lnI = lnI + 1
.head 5 -  !
.head 5 -  Return ( bContinue )
.head 3 -  !
.head 3 +  Function: PalStrTokenize
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  String: psLine
.head 5 -  Receive String: psLineTokens[*]
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: lnCount
.head 5 -  Number: lnNumberOfChar
.head 5 -  Number: lnCountToken
.head 5 -  String: wsLeftChar
.head 4 +  Actions
.head 5 -  Set lnNumberOfChar = SalStrLength( psLine )
.head 5 +  While lnCount <  lnNumberOfChar
.head 6 -  Set wsLeftChar = SalStrLeftX( psLine, 1 )
.head 6 +  If wsLeftChar = '"'
.head 7 -  Set psLine = SalStrRightX( psLine, SalStrLength( psLine ) - 1 )
.head 7 -  Set wsLeftChar = SalStrLeftX( psLine, 1 )
.head 7 -  !
.head 7 +  While wsLeftChar != '"' and  lnCount <  lnNumberOfChar
.head 8 -  Set psLineTokens[ lnCountToken ] = psLineTokens[ lnCountToken ] || wsLeftChar
.head 8 -  Set psLine = SalStrRightX( psLine, SalStrLength( psLine ) - 1 )
.head 8 -  Set wsLeftChar = SalStrLeftX( psLine, 1 )
.head 8 -  Set lnCount = lnCount + 1
.head 7 -  !
.head 7 +  If SalStrLength( psLine ) > 0
.head 8 -  Set psLine = SalStrRightX( psLine, SalStrLength( psLine ) - 1 )
.head 8 -  Set wsLeftChar = SalStrLeftX( psLine, 1 )
.head 8 +  If SalStrLength( psLine ) > 0
.head 9 -  !
.head 9 +  If wsLeftChar =','
.head 10 -  Set psLine = SalStrRightX( psLine, SalStrLength( psLine ) - 1 )
.head 10 -  Set wsLeftChar = SalStrLeftX( psLine, 1 )
.head 9 +  Else
.head 10 -  ! Erreur
.head 10 -  Return ( FALSE)
.head 8 -  Set lnCountToken = lnCountToken + 1
.head 7 +  Else
.head 8 -  ! Erreur
.head 8 -  Return ( FALSE)
.head 6 +  Else
.head 7 +  If lnCount= 0
.head 8 -  ! Erreur
.head 8 -  Return ( FALSE)
.head 7 -  Set psLine = SalStrRightX( psLine, SalStrLength( psLine ) - 1 )
.head 6 -  Set lnCount = lnCount + 1
.head 5 -  Return (lnCountToken)
.head 3 +  Function: PalTraductMsg
.head 4 -  Description: Traduction des messages suivant la langue du logiciel
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: sNoMsg
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sTrad
.head 5 -  Number: nRet
.head 4 +  Actions
.head 5 -  Call SqlPrepareAndExecute( ghSqlMsg, "Select Msg_F from Message where No_msg = :sNoMsg into :sTrad ")
.head 5 +  If Not SqlFetchNext( ghSqlMsg, nRet )
.head 6 -  Return (sNoMsg)
.head 5 +  Else
.head 6 -  Return (sTrad)
.head 3 +  Function: PalCaractere437
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sIn
.head 5 -  Receive Long String: lsReturn
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  String: sRef
.head 5 -  Number: i
.head 5 -  Number: nCar
.head 4 +  Actions
.head 5 -  Set bOk = TRUE
.head 5 -  Set sRef = sIn
.head 5 -  Set lsReturn =''
.head 5 -  Set i = 0
.head 5 +  While TRUE
.head 6 -  Set nCar = SalStrLop( sIn )
.head 6 +  If nCar = 0
.head 7 -  Break
.head 6 +  Else
.head 7 +  If NOT ((nCar >= 32 and nCar<=33) or (nCar>=35 and nCar <=154)  or (nCar >=159 and nCar <=165) or nCar = 225)
.head 8 -  Set bOk = FALSE
.head 8 -  Set lsReturn = lsReturn || SalNumberToChar( nCar ) || ' : pos.' || SalNumberToStrX( i+1, 0) ||'
'
.head 6 -  Set i = i +1
.head 5 +  If lsReturn != ''
.head 6 -  Set lsReturn = sRef || '
' || lsReturn
.head 5 -  Return bOk
.head 3 +  Function: PalConver437Win
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: sIn
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: wsConversion
.head 4 +  Actions
.head 5 -  Set wsConversion = SalStrRepeatX(' ', SalStrLength( sIn))
.head 5 -  Call OemToCharA( sIn , wsConversion )
.head 5 -  Return ( wsConversion )
.head 3 +  Function: PalConverWin437
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: sIn
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: wsConversion
.head 4 +  Actions
.head 5 -  Set wsConversion = SalStrRepeatX(' ', SalStrLength( sIn))
.head 5 -  Call CharToOemA( sIn, wsConversion )
.head 5 -  Return ( wsConversion )
.head 3 +  Function: PalCompteNbLigne
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Long String: sIn
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nLigne
.head 5 -  String: sArray[*]
.head 4 +  Actions
.head 5 -  Set nLigne = SalStrTokenize( sIn, '', '
', sArray )
.head 5 -  Return (nLigne)
.head 3 +  Function: date_transforme
.head 4 -  Description: Formatte la date ssyymmjj --> jj/mm/ssyy avec '/' comme séparateur
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: date_in
.head 5 -  String: separat
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: date_tmp
.head 4 +  Actions
.head 5 -  Set date_tmp=SalStrRightX(date_in,2)||separat||SalStrMidX(date_in,4,2)||separat||SalStrLeftX(date_in,4)
.head 5 -  Return date_tmp
.head 3 +  Function: date_separa
.head 4 -  Description: Formatte la date ssyy-mm-jj --> jj/mm/ssyy avec '/' comme séparateur
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: date_in
.head 5 -  String: separat
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: date_tmp
.head 4 +  Actions
.head 5 -  Set date_tmp=SalStrMidX(date_in,8,2)||separat||SalStrMidX(date_in,5,2)||separat||SalStrLeftX(date_in,4)
.head 5 -  Return date_tmp
.head 3 +  Function: PalDateConstuct
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Date/Time:
.head 4 +  Parameters
.head 5 -  String: sDateIn
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Date/Time: dDateOut
.head 5 -  Number: lnAnnee
.head 5 -  Number: lnMois
.head 5 -  Number: lnJour
.head 5 -  Number: lnHeure
.head 5 -  Number: lnMinute
.head 5 -  Number: lnSeconde
.head 4 +  Actions
.head 5 -  Set lnAnnee = SalStrToNumber( SalStrLeftX( sDateIn, 4) )
.head 5 -  Set lnMois = SalStrToNumber( SalStrMidX( sDateIn, 5,2) )
.head 5 -  Set lnJour = SalStrToNumber( SalStrMidX( sDateIn, 8,2) )
.head 5 -  Set lnHeure = SalStrToNumber( SalStrMidX( sDateIn, 11,2) )
.head 5 -  Set lnMinute = SalStrToNumber( SalStrMidX( sDateIn, 14,2) )
.head 5 -  Set lnSeconde = SalStrToNumber( SalStrMidX( sDateIn, 17,2) )
.head 5 -  Set dDateOut = SalDateConstruct( lnAnnee, lnMois, lnJour, lnHeure, lnMinute, lnSeconde )
.head 5 -  Return (dDateOut)
.head 3 +  Function: PalDtmExtension
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: sFile
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nCar
.head 5 -  String: sExt
.head 5 -  String: sCaract
.head 4 +  Actions
.head 5 -  Set sCaract = ''
.head 5 -  Set nCar = SalStrLength( sFile )
.head 5 +  While sCaract != '.' and nCar > 0
.head 6 -  Set sCaract = SalStrMidX( sFile, nCar-1, 1)
.head 6 +  If sCaract != '.'
.head 7 -  Set sExt = sCaract || sExt
.head 6 -  Set nCar = nCar -1
.head 5 -  Set sExt = SalStrUpperX( sExt )
.head 5 -  Return (sExt )
.head 3 +  Function: PalDtmIntervalleTempsEcoule
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Date/Time: d1
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Date/Time: d2
.head 5 -  Number: h1
.head 5 -  Number: m1
.head 5 -  Number: n1
.head 5 -  Number: s1
.head 5 -  Number: h2
.head 5 -  Number: m2
.head 5 -  Number: n2
.head 5 -  Number: s2
.head 5 -  String: s
.head 4 +  Actions
.head 5 -  Call SalDateToStr( d1, s )
.head 5 -  ! 2008-01-01-15:22:23.230000
.head 5 -  Set n1 = SalStrToNumber( SalStrMidX( s, 17, 5) )
.head 5 -  Set m1 = SalStrToNumber( SalStrMidX( s, 14, 2) ) * 60
.head 5 -  Set h1 = SalStrToNumber( SalStrMidX( s, 11, 2) ) * 60 * 60
.head 5 -  !
.head 5 -  Set d2 = SalDateCurrent(  )
.head 5 -  Call SalDateToStr( d2, s )
.head 5 -  Set n2 = SalStrToNumber( SalStrMidX( s, 17, 5) )
.head 5 -  Set m2 = SalStrToNumber( SalStrMidX( s, 14, 2) ) * 60
.head 5 -  Set h2 = SalStrToNumber( SalStrMidX( s, 11, 2) ) * 60 * 60
.head 5 +  If h1 > h2
.head 6 -  Set h2 = h2 + 24 * 60 * 60
.head 5 +  Else
.head 6 +  If m1 > m2 and n1 > n2
.head 7 -  Set n2 = n2 + 60
.head 5 -  Set s2 = n2 + m2 + h2
.head 5 -  Set s1 = n1 + m1 + h1
.head 5 -  !
.head 5 -  Return (s2-s1)
.head 3 -  !
.head 3 +  Function: PalDtmGroupeListe
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  String:
.head 4 +  Parameters
.head 5 -  String: psSigleIn
.head 5 -  String: psElect
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sPhon
.head 5 -  String: sNoGrpLis
.head 5 -  Number: nTri
.head 4 +  Actions
.head 5 -  Set sPhon = PalTransPhonetique( psSigleIn )
.head 5 +  If psElect = 'BV'
.head 6 -  Set psElect = 'VL'
.head 5 -  Call SqlPrepareAndExecute(ghSqlMain, "Select GRL_Id from Groupe_Listes where GRL_Phon = :sPhon and GRL_id != 0 and GRL_El = :psElect
	into :sNoGrpLis" )
.head 5 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If PalNextValueApplParm( "GRL_ID", sNoGrpLis )
.head 7 -  Call SqlPrepareAndExecute(ghSqlMain, "Select @nullvalue(Max(GRL_Tri),0)+1 from Groupe_Listes where GRL_id != 0 and GRL_El = :psElect
	into :nTri" )
.head 7 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 7 +  If nTri = NUMBER_Null
.head 8 -  Set nTri = 1
.head 7 +  If SqlPrepareAndExecute(ghSqlMain, "Insert into Groupe_Listes( GRL_Id ,GRL_Nom, GRL_Phon, GRL_el, GRL_Tri)
	Values(:sNoGrpLis, :psSigleIn, :sPhon, :psElect , :nTri ) " )
.head 8 -  Call SqlCommit( ghSqlMain )
.head 7 +  Else
.head 8 -  Set sNoGrpLis = '0'
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Rollback" )
.head 6 +  Else
.head 7 -  Set sNoGrpLis = '0'
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Rollback" )
.head 5 -  Return (sNoGrpLis )
.head 3 +  Function: PalCheckRepertoire
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nType
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsElect
.head 5 -  Number: lnI
.head 5 -  Number: lnActif
.head 5 -  Number: lnId
.head 5 -  Date/Time: ldDate
.head 5 -  Date/Time: ldDateR
.head 5 -  Date/Time: ldDateFR
.head 5 -  String: lsTmp
.head 5 -  String: lsPhaseResult
.head 5 -  Boolean: bAumoins1
.head 5 -  Number: lnDiffuseElu
.head 5 -  Number: lnNbFormatR
.head 4 +  Actions
.head 5 -  ! !
.head 5 -  Call PalGetApplParm( "DATE_LOC2_DF", lsTmp )
.head 5 -  Set lnI = 0
.head 5 +  While lnI <= 20
.head 6 -  Set gbGestionElectionType[lnI] = 0
.head 6 -  Set wbFormatRPourEL[lnI] = 0
.head 6 -  Set gdDateDernierFileElection[lnI] = DATETIME_Null
.head 6 -  Set wbExtrapolElection[lnI] = NUMBER_Null
.head 6 -  Call SalSetWindowText( whCbElecElu[lnI], " - "  )
.head 6 -  Set lnI = lnI +1
.head 5 -  Set lnI = 0
.head 5 -  Set gsPhaseResult = '1' 
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "Select sum(ELE_LOC2_RESULT) / count(*)  from election
	where ELE_LETTRE in ( '" || VisStrSubstitute( gsGestionElectionType, ",", "','" ) ||"' )
	into :gsPhaseResult " )
.head 5 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 5 +  If gsPhaseResult != '1'
.head 6 -  Set gsPhaseResult = '0'
.head 5 -  Set bAumoins1 = FALSE
.head 5 +  While lnI <= SalStrLength( gsGestionElectionType)
.head 6 -  Set lsElect = SalStrMidX( gsGestionElectionType, lnI, 2 )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_ID, Ele_Loc2_Actif, Ele_Loc2_DateDernier, Ele_Loc2_Result , Ele_D_result, ELE_D_FORMATR , ELE_LOC2_ELUDIFFUSE, ELE_NB_FormatR
	from election 
	where ELE_LETTRE = :lsElect
	into :lnId , :lnActif, :ldDate, :lsPhaseResult , :ldDateR, :ldDateFR, :lnDiffuseElu, :lnNbFormatR" )
.head 6 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  Call SalEnableWindow(  whCbElec[lnId] )
.head 7 -  Call SalEnableWindow(  whCbElecFR[lnId] )
.head 7 +  If lnActif = 0 or nType = 1
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Update election set Ele_Loc2_Actif=1 where ELE_Id = :lnId" )
.head 8 -  Call SqlCommit( ghSqlMain )
.head 8 -  Set gbGestionElectionType[lnId] = 1
.head 8 -  Set wbFormatRPourEL[lnId] = 1
.head 8 -  Set bAumoins1 = TRUE
.head 8 +  If gsPhaseResult = '1'
.head 9 -  Set gdDateDernierFileElection[lnId] = ldDateR
.head 9 +  If ldDateFR = DATETIME_Null
.head 10 -  Set ldDateFR = 2000-01-01
.head 10 -  Call SqlPrepareAndExecute( ghSqlMain, "Update election 
	Set ELE_D_FORMATR = 2000-01-01 
	where ELE_LETTRE = :lsElect " )
.head 10 -  Call SqlCommit( ghSqlMain )
.head 9 -  Call SalDateToStr( ldDateFR, lsTmp )
.head 9 -  Call SalSetWindowText( whDateElecFR[lnId], lsTmp )
.head 9 -  Call SalDateToStr( ldDateR, lsTmp )
.head 9 -  Call SalEnableWindow( whCbElecFR[lnId] )
.head 9 -  Call SalEnableWindow( whCbElecElu[lnId] )
.head 9 -  Call SalSetWindowText( whCbElecElu[lnId], SalNumberToStrX(lnNbFormatR, 0)  )
.head 9 +  If lnDiffuseElu = 1
.head 10 -  Call SalColorSet( whElu_FR[lnId], COLOR_IndexWindow, COLOR_DarkGreen )
.head 10 -  Call SalColorSet( whElu_FR[lnId], COLOR_IndexWindowText, COLOR_DarkGreen )
.head 10 -  Call SalColorSet( whCbElecElu[lnId], COLOR_IndexWindow, COLOR_DarkGreen )
.head 10 -  Call SalColorSet( whCbElecElu[lnId], COLOR_IndexWindowText, COLOR_White )
.head 10 -  Call SalSendMsg( whElu_FR[lnId] , SAM_AnyEdit, 1, 0 )
.head 9 +  Else
.head 10 -  Call SalColorSet( whElu_FR[lnId], COLOR_IndexWindow, COLOR_Salmon )
.head 10 -  Call SalColorSet( whElu_FR[lnId], COLOR_IndexWindowText, COLOR_Salmon )
.head 10 -  Call SalColorSet( whCbElecElu[lnId], COLOR_IndexWindow, COLOR_Salmon )
.head 10 -  Call SalColorSet( whCbElecElu[lnId], COLOR_IndexWindowText, COLOR_Black )
.head 10 -  Call SalSendMsg( whElu_FR[lnId] , SAM_AnyEdit, 0, 0 )
.head 8 +  Else
.head 9 +  If ldDate != DATETIME_Null
.head 10 -  Set gdDateDernierFileElection[lnId] = ldDate
.head 10 -  Call SalDateToStr( ldDate, lsTmp )
.head 9 +  Else
.head 10 -  Call PalSetDateElection( lsElect, lsTmp, lnId)
.head 10 -  Set gdDateDernierFileElection[lnId] = SalStrToDate( lsTmp )
.head 9 -  Call SalDisableWindow( whCbElecFR[lnId] )
.head 9 -  Call SalClearField( whDateElecFR[lnId] )
.head 9 -  Call SalColorSet( whElu_FR[lnId], COLOR_IndexWindow, COLOR_Gray )
.head 9 -  Call SalColorSet( whElu_FR[lnId], COLOR_IndexWindowText, COLOR_Gray )
.head 9 -  Call SalColorSet( whCbElecElu[lnId], COLOR_IndexWindow, COLOR_Gray )
.head 9 -  Call SalColorSet( whCbElecElu[lnId], COLOR_IndexWindowText, COLOR_Gray )
.head 9 -  Call SalSetWindowText( whCbElecElu[lnId], " - "  )
.head 9 -  Call SalSendMsg( whElu_FR[lnId] , SAM_AnyEdit, 0, 0 )
.head 9 -  Call SalDisableWindow( whCbElecElu[lnId] )
.head 8 -  Call SalEnableWindow( whDateElec[lnId]  )
.head 8 -  Call SalSetWindowText( whDateElec[lnId] , lsTmp )
.head 8 -  Call SalSendMsg( whCbElec[lnId] , SAM_AnyEdit, 1, 0 )
.head 8 +  If SalIsWindowEnabled(  whCbElec[lnId] )
.head 9 -  Call SalSendMsg( whCbElec[lnId] , SAM_Click, 5, 0 )
.head 7 +  Else
.head 8 -  Call SalClearField( whDateElec[lnId] )
.head 8 -  Call SalDisableWindow( whDateElec[lnId]  )
.head 8 -  Set gbGestionElectionType[lnId] = 0
.head 8 -  Set wbFormatRPourEL[lnId] = 0
.head 8 -  Call SalSendMsg( whCbElec[lnId] , SAM_AnyEdit, 0, 0 )
.head 8 -  Call SalSendMsg( whCbElec[lnId] , SAM_Click, 5, 0 )
.head 8 -  Call SalDisableWindow( whCbElecFR[lnId] )
.head 8 -  Call SalColorSet( whElu_FR[lnId], COLOR_IndexWindow, COLOR_Gray )
.head 8 -  Call SalColorSet( whElu_FR[lnId], COLOR_IndexWindowText, COLOR_Gray )
.head 8 -  Call SalColorSet( whCbElecElu[lnId], COLOR_IndexWindow, COLOR_Gray )
.head 8 -  Call SalColorSet( whCbElecElu[lnId], COLOR_IndexWindowText, COLOR_Gray )
.head 8 -  Call SalSendMsg( whElu_FR[lnId] , SAM_AnyEdit, 0, 0 )
.head 8 -  Call SalDisableWindow( whCbElecElu[lnId] )
.head 7 -  !
.head 7 +  If gbGestionElectionType[lnId] and lsPhaseResult != '1'
.head 8 -  Set gsPhaseResult = '0'
.head 6 -  Set lnI = lnI +3
.head 5 -  !
.head 5 -  Set lnI = 0
.head 5 +  While lnI <= 20
.head 6 +  If gbGestionElectionType[lnI] = 0 and whCbElec[lnI] != hWndNULL
.head 7 -  Call SalSendMsg( whCbElec[lnI], SAM_Click, 0,0 )
.head 7 -  Call SalDisableWindow(  whCbElec[lnI] )
.head 7 -  Call SalDisableWindow(  whCbElecFR[lnI] )
.head 6 -  Set lnI = lnI +1
.head 5 -  !
.head 5 +  If NOT bAumoins1
.head 6 -  Set gsPhaseResult = '0'
.head 5 -  !
.head 5 +  If gsPhaseResult = '1'
.head 6 -  Call SalEnableWindow( pbFormatR )
.head 6 -  Set cbFichAutre = FALSE
.head 6 -  Call SalDisableWindow( cbFichAutre )
.head 6 -  Set cbFichC = FALSE
.head 6 -  Call SalEnableWindow( cbFichC )
.head 6 -  ! Set cbFichT = FALSE
.head 6 -  ! Call SalDisableWindow( cbFichT )
.head 6 -  Set cbFich0 = TRUE
.head 6 -  Call SalEnableWindow( cbFich0 )
.head 6 -  Set cbFich1 = TRUE
.head 6 -  Call SalEnableWindow( cbFich1 )
.head 6 -  Set cbFichSup = FALSE
.head 6 -  Call SalEnableWindow( cbFichSup )
.head 6 -  Call SalEnableWindow( pbREU )
.head 6 -  Call SalEnableWindow( pbRSE )
.head 6 -  Call SalEnableWindow( pbRCK )
.head 6 -  Call SalEnableWindow( pbRWL )
.head 6 -  Call SalEnableWindow( pbRVL )
.head 6 -  Call SalEnableWindow( pbRBR )
.head 6 -  Call SalEnableWindow( pbRDE )
.head 5 +  Else
.head 6 -  Call SalDisableWindow( pbFormatR )
.head 6 -  Set cbFichAutre = TRUE
.head 6 -  Call SalEnableWindow( cbFichAutre )
.head 6 -  Set cbFichC = TRUE
.head 6 -  Call SalEnableWindow( cbFichC )
.head 6 -  ! Set cbFichT = FALSE
.head 6 -  ! Call SalEnableWindow( cbFichT )
.head 6 -  Set cbFich0 = FALSE
.head 6 -  Call SalDisableWindow( cbFich0 )
.head 6 -  Set cbFich1 = FALSE
.head 6 -  Call SalDisableWindow( cbFich1 )
.head 6 -  Set cbFichSup = FALSE
.head 6 -  Call SalDisableWindow( cbFichSup )
.head 6 -  Call SalDisableWindow( pbREU )
.head 6 -  Call SalDisableWindow( pbRSE )
.head 6 -  Call SalDisableWindow( pbRCK )
.head 6 -  Call SalDisableWindow( pbRWL )
.head 6 -  Call SalDisableWindow( pbRVL )
.head 6 -  Call SalDisableWindow( pbRBR )
.head 6 -  Call SalDisableWindow( pbRDE )
.head 5 -  !
.head 3 +  Function: PalLibereElection
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nId
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: lnI
.head 5 -  String: lsElection
.head 4 +  Actions
.head 5 +  If nId = NUMBER_Null
.head 6 -  Set lnI = 0
.head 5 +  Else
.head 6 -  Set lnI = nId
.head 5 +  While lnI <= 25
.head 6 +  If gbGestionElectionType[lnI] = 1
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_LETTRE
	from election 
	where ELE_ID = :lnI
	into :lsElection" )
.head 7 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 7 +  If SalStrScan( gsGestionElectionType ||',' , lsElection ||',' ) != -1
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Update election set Ele_Loc2_Actif=0 where ELE_Id = :lnI " )
.head 7 -  Call SqlCommit( ghSqlMain )
.head 6 -  Set lnI = lnI +1
.head 6 +  If nId != NUMBER_Null
.head 7 -  Break
.head 3 +  Function: PalLibereActiveElection
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nId
.head 5 -  Number: bValeur
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: lnI
.head 5 -  String: lsTmp
.head 5 -  String: lsElection
.head 4 +  Actions
.head 5 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 5 +  If bValeur = 1
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ele_Loc2_Actif from Election where Ele_Loc2_Actif=0 and ELE_Id = :nId " )
.head 6 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 -  Call SalMessageBox( 'Cette élection est déjà traitée par un autre EXE Loc2 !' , 'Message', MB_Ok )
.head 7 +  If SalIsWindowEnabled( pbStop )
.head 8 -  Call SalTimerSet( hWndForm, nNoTimer, 350 )
.head 7 -  Return FALSE
.head 5 -  !
.head 5 -  ! Verification si on gère cette élection
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_LETTRE
	from election 
	where ELE_ID = :nId
	into :lsElection" )
.head 5 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 5 +  If SalStrScan( gsGestionElectionType ||',' , lsElection ||',' ) != -1 and SalIsWindowEnabled( whCbElec[nId] )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Update election set Ele_Loc2_Actif=:bValeur where ELE_Id = :nId " )
.head 6 -  Call SqlCommit( ghSqlMain )
.head 5 -  Set gbGestionElectionType[nId] = bValeur
.head 5 -  Set wbFormatRPourEL[lnI] = bValeur
.head 5 +  If bValeur = 0
.head 6 -  Call SalClearField( whDateElec[nId] )
.head 6 -  Call SalDisableWindow( whDateElec[nId]  )
.head 5 +  Else
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_LOC2_DATEDERNIER from Election 
	where ELE_Id = :nId
	into :gdDateDernierFileElection[nId] " )
.head 6 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If gdDateDernierFileElection[nId] = DATETIME_Null
.head 7 -  Set gdDateDernierFileElection[nId] = SalStrToDate( '1901-01-01' )
.head 6 -  Call SalEnableWindow( whDateElec[nId]  )
.head 6 -  Call SalDateToStr( gdDateDernierFileElection[nId], lsTmp )
.head 6 -  Call SalSetWindowText( whDateElec[nId] , lsTmp )
.head 5 -  !
.head 5 -  ! Set gsGestionElectionType = ''
.head 5 -  ! Set lnI = 1
.head 5 +  ! While lnI <= 20
.head 6 +  If gbGestionElectionType[lnI]
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_Lettre from Election 
	where ELE_Id = :lnI
	into :lsTmp " )
.head 7 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 8 +  If gsGestionElectionType != ''
.head 9 -  Set gsGestionElectionType = gsGestionElectionType || ','
.head 8 -  Set gsGestionElectionType = gsGestionElectionType || lsTmp
.head 6 -  Set lnI = lnI +1
.head 5 -  !
.head 5 -  Call PalNoteVersion(  )
.head 5 +  If SalIsWindowEnabled( pbStop )
.head 6 -  Call SalTimerSet( hWndForm, nNoTimer, 250 )
.head 5 -  Return bValeur
.head 3 +  Function: PalSetDateElection
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sElec
.head 5 -  String: sDate
.head 5 -  Number: nId
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nPhaseResult
.head 4 +  Actions
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ele_Loc2_Result from election  where ELE_Id = :nId into :nPhaseResult " )
.head 5 -  Call SqlFetchNext( ghSqlMain, Btmp)
.head 5 +  If nPhaseResult = 1
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Update election set ELE_D_RESULT= "|| sDate ||" where ELE_Id = :nId " )
.head 5 +  Else
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Update election set Ele_Loc2_DateDernier= "|| sDate ||" where ELE_Id = :nId " )
.head 5 -  Call SqlCommit( ghSqlMain )
.head 5 -  Set gdDateDernierFileElection[nId] = SalStrToDate( sDate )
.head 5 -  Call SalSetWindowText( whDateElec[nId], sDate )
.head 3 +  Function: PalGenereUnFormatR
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nType
.head 5 -  Number: nEl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nI
.head 4 +  Actions
.head 5 +  If nType = 0
.head 6 -  Set nI = 0
.head 6 +  While nI <= 20
.head 7 +  If nI = nEl
.head 8 -  Set wbFormatRPourEL[nI] = 1
.head 7 +  Else
.head 8 -  Set wbFormatRPourEL[nI] = 0
.head 7 -  Set nI = nI +1
.head 5 +  Else
.head 6 -  Set nI = 0
.head 6 +  While nI <= 20
.head 7 -  Set wbFormatRPourEL[nI] = gbGestionElectionType[nI]
.head 7 -  Set nI = nI +1
.head 3 -  !
.head 3 +  Function: PalDtmResult
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsDateNewResult
.head 5 -  String: lsSitCantonGlob
.head 5 -  Number: nBurDep
.head 5 -  Number: nCantonComplet
.head 5 -  String: lsDiffuseEluElection
.head 5 -  Boolean: lbBHV_canton
.head 5 -  Date/Time: ldDate1
.head 5 -  Date/Time: ldDate2
.head 5 -  Date/Time: ldDate3
.head 5 -  String: lsNoSequR
.head 5 -  Number: lnSecondeEcoulee
.head 5 -  Boolean: bResultOk
.head 4 +  Actions
.head 5 -  ! Call SalSendMsg( pbStop, SAM_Click, 0,0 )
.head 5 -  Set bResultOk = FALSE
.head 5 -  Call PalGetApplParm( "RESULT", wsDateResult )
.head 5 -  Call SalDateToStr( SalDateCurrent(  ), lsDateNewResult )
.head 5 -  Call PalGetApplParm( "ELU_DIFFUSE", wsDiffuseElus )
.head 5 -  !
.head 5 -  ! EU (1)
.head 5 +  If gbGestionElectionType[1] and cbEU_FR and wbFormatRPourEL[1]
.head 6 -  Set dfLibelleR = 'Génération des Formats R ... < EU >'
.head 6 -  Set wbSituationZeroResult = PalDtmSituationResult( 'EU' )
.head 6 -  Call PalResultDate( "EU", 1, wsDateResult )
.head 6 -  Call PalGetDiffuseElu( "EU", wsDiffuseElus )
.head 6 -  Call DispatchMessage(  )
.head 6 +  If wbFormatRManuel or wbSituationZeroResult or PalVerifExecutionFormatR( "EU", wsDateResult )
.head 7 -  Set bResultOk = TRUE
.head 7 +  If NOT SalIsWindowVisible( dfLibelleR )
.head 8 -  Call SalShowWindow( dfLibelleR )
.head 8 -  Call SalBringWindowToTop( dfLibelleR )
.head 8 -  Call DispatchMessage(  )
.head 7 -  Call PalHttpCockpit( 451, '', '', 'EU', 'EU', wsModuleNom, wsModuleLigne, '' )
.head 7 -  Set ldDate1 = SalDateCurrent(  )
.head 7 -  Set gsIN_NivSup = ''
.head 7 -  Set dfLibelleR = 'Evolution des Cantons ... < EU >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionCantons( 'EU' , nBurDep, nCantonComplet, lsSitCantonGlob )
.head 7 -  Set lsNoSequR = SalStrRightX( '0000' || SalNumberToStrX(SalStrToNumber(SalGetWindowTextX(whCbElecElu[1]))+1 , 0), 4)
.head 7 -  Set wsEnveloppeR_Glob = "R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || 
	SalStrRightX('000' || SalNumberToStrX( nCantonComplet,0) , 3)|| "_"|| lsNoSequR ||"_"|| 'EU' 
.head 7 -  !
.head 7 -  Set dfLibelleR = 'Niveaux supérieurs ... < EU >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionNivProv( 'EU', 'P', gsIN_NivSup )
.head 7 -  Call PalEvolutionNivSup( 'EU', 'L', '' )
.head 7 -  Call PalEvolutionNivInterm( 'EU', 'L', '' )
.head 7 -  Set dfLibelleR = 'Niveau Royaume ... < EU >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalResultatListes_Royaume( lsSitCantonGlob , 'EU' )
.head 7 -  Set dfLibelleR = 'Hit-parade ... < EU >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionHitParadeCdt( 'EU', 'L', '' )
.head 7 -  Call PalEvolutionHitParadeCdt( 'EU', 'C', gsIN_NivSup )
.head 7 -  Call PalResultatHitParadeCdt( 'EU', 'R', '00000', NUMBER_Null )
.head 7 -  Set dfLibelleR = 'Analyse détaillée ... < EU >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionAnalyseDetail( 'EU', 'P', gsIN_NivSup )
.head 7 -  Call PalEvolutionAnalyseDetail( 'EU', 'R', '' )
.head 7 +  If wsDiffuseElus = '1' or wbSituationZeroResult
.head 8 -  Call PalResultatSiege_NivRoyaume( 'EU' )
.head 7 -  Set ldDate3 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate3 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 455, '', '', 'EU (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')', 'EU', wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 7 -  ! Création de la MAP des sièges niveau royaume
.head 7 -  Call PalCreateRSRmap ('EU')
.head 7 -  !
.head 7 -  Call PalZipResultat( 'EU' , nBurDep, nCantonComplet, wsEnveloppeR_Glob)
.head 7 -  Call PalResultDate( "EU", 2, lsDateNewResult )
.head 7 -  Set ldDate2 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate2 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 459, '', '', 'EU (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')', 'EU', wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 6 -  Call SalColorSet(  whMod_FR[1], COLOR_IndexWindow, COLOR_DarkGreen )
.head 6 -  Call SalColorSet(  whMod_FR[1], COLOR_IndexWindowText, COLOR_DarkGreen )
.head 5 -  !
.head 5 -  ! CK (2)
.head 5 +  If gbGestionElectionType[2] and cbCK_FR and wbFormatRPourEL[2]
.head 6 -  Set dfLibelleR = 'Génération des Formats R ... < CK >'
.head 6 -  Set wbSituationZeroResult = PalDtmSituationResult( 'CK' )
.head 6 -  Call PalResultDate( "CK", 1, wsDateResult )
.head 6 -  Call PalGetDiffuseElu( "CK", wsDiffuseElus )
.head 6 -  Call DispatchMessage(  )
.head 6 +  If wbFormatRManuel or wbSituationZeroResult or PalVerifExecutionFormatR( "CK", wsDateResult )
.head 7 -  ! Pour la chambre à BHV : vérification si au moins un canton sur BXL et HV
.head 7 +  If wsDiffuseElus = '1' and wsDiffuseElusCK_BHV != '1'
.head 8 -  Set wsDiffuseElusCK_BHV = '0'
.head 8 -  Set lbBHV_canton = FALSE
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select *
	from Result_scrutin
	where res_ent_ins like '21%' and Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= '21004' and ENT_ELE_EXT = 'CK' and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 8 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 9 -  Set lbBHV_canton = TRUE
.head 8 +  If lbBHV_canton
.head 9 -  Call SqlPrepareAndExecute( ghSqlMain, "Select *
	from Result_scrutin
	where res_ent_ins like '23%' and Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= '21004' and ENT_ELE_EXT = 'CK' and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 9 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 10 -  Set lbBHV_canton = TRUE
.head 9 +  Else
.head 10 -  Set lbBHV_canton = FALSE
.head 8 -  !
.head 8 +  If NOT lbBHV_canton
.head 9 -  Set wsDiffuseElusCK_BHV = '0'
.head 8 +  Else
.head 9 -  Set wsDiffuseElusCK_BHV = '1'
.head 7 -  !
.head 7 -  Set bResultOk = TRUE
.head 7 +  If NOT SalIsWindowVisible( dfLibelleR )
.head 8 -  Call SalShowWindow( dfLibelleR )
.head 8 -  Call SalBringWindowToTop( dfLibelleR )
.head 8 -  Call DispatchMessage(  )
.head 7 -  Call PalHttpCockpit( 451, '', '', 'CK', 'CK', wsModuleNom, wsModuleLigne, '' )
.head 7 -  Set ldDate1 = SalDateCurrent(  )
.head 7 -  Set gsIN_NivSup = ''
.head 7 -  Set dfLibelleR = 'Evolution des Cantons ... < CK >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionCantons( 'CK', nBurDep, nCantonComplet, lsSitCantonGlob )
.head 7 -  Set lsNoSequR = SalStrRightX( '0000' || SalNumberToStrX(SalStrToNumber(SalGetWindowTextX(whCbElecElu[2]))+1 , 0), 4)
.head 7 -  Set wsEnveloppeR_Glob = "R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || 
	SalStrRightX('000' || SalNumberToStrX( nCantonComplet,0) , 3)|| "_"|| lsNoSequR|| "_"|| 'CK' 
.head 7 -  Set dfLibelleR = 'Niveaux Circonscriptions ... < CK >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionNivSup( 'CK', 'C', gsIN_NivSup )
.head 7 -  Set dfLibelleR = 'Niveau Apparentement ... < CK >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionNivInterm( 'CK', 'O', gsIN_NivSup )
.head 7 -  ! Set dfLibelleR = 'Niveaux Régions ... < CK >'
.head 7 -  ! Call DispatchMessage(  )
.head 7 -  ! Call PalEvolutionNivRegionsSpeciales( 'CK', 'G', '' )
.head 7 -  Set dfLibelleR = 'Niveau Royaume ... < CK >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalResultatListes_Royaume( lsSitCantonGlob, 'CK' )
.head 7 -  Set dfLibelleR = 'Hit-parade ... < CK >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionHitParadeCdt( 'CK', 'C', gsIN_NivSup )
.head 7 -  Call PalResultatHitParadeCdt( 'CK', 'R', '00000', NUMBER_Null )
.head 7 -  Set dfLibelleR = 'Analyse détaillée ... < CK >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionAnalyseDetail( 'CK', 'C', gsIN_NivSup )
.head 7 -  Call PalEvolutionAnalyseDetail( 'CK', 'R' , '' )
.head 7 -  ! Pour la chambre à BHV : vérification si au moins un canton sur BXL et HV
.head 7 +  ! If wsDiffuseElus = '1' and wsDiffuseElusCK_BHV != '1'
.head 8 -  Set wsDiffuseElusCK_BHV = '0'
.head 8 -  Set lbBHV_canton = FALSE
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select *
	from Result_scrutin
	where res_ent_ins like '21%' and Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= '21004' and ENT_ELE_EXT = 'CK' and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 8 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 9 -  Set lbBHV_canton = TRUE
.head 8 +  If lbBHV_canton
.head 9 -  Call SqlPrepareAndExecute( ghSqlMain, "Select *
	from Result_scrutin
	where res_ent_ins like '23%' and Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= '21004' and ENT_ELE_EXT = 'CK' and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 9 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 10 -  Set lbBHV_canton = TRUE
.head 9 +  Else 
.head 10 -  Set lbBHV_canton = FALSE
.head 8 -  !
.head 8 +  If NOT lbBHV_canton
.head 9 -  Set wsDiffuseElusCK_BHV = '0'
.head 8 +  Else 
.head 9 -  Set wsDiffuseElusCK_BHV = '1'
.head 7 +  If wsDiffuseElus = '1' or wbSituationZeroResult
.head 8 -  Set dfLibelleR = 'Diffusion des sièges ... < CK >'
.head 8 -  Call DispatchMessage(  )
.head 8 -  Call PalResultatSiege_NivRoyaume( 'CK' )
.head 7 -  Set ldDate3 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate3 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 455, '', '', 'CK (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')', 'CK', wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 7 -  ! Création de la MAP des sièges niveau royaume
.head 7 -  Call PalCreateRSRmap ('CK')
.head 7 -  !
.head 7 -  Call PalZipResultat( 'CK' , nBurDep, nCantonComplet, wsEnveloppeR_Glob)
.head 7 -  Call PalResultDate( "CK", 2, lsDateNewResult )
.head 7 -  Set ldDate2 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate2 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 459, '', '', 'CK (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')', 'CK', wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 6 -  Call SalColorSet(  whMod_FR[2], COLOR_IndexWindow, COLOR_DarkGreen )
.head 6 -  Call SalColorSet(  whMod_FR[2], COLOR_IndexWindowText, COLOR_DarkGreen )
.head 5 -  !
.head 5 -  ! SE (3)
.head 5 +  If gbGestionElectionType[3] and cbSE_FR and wbFormatRPourEL[3]
.head 6 -  Set dfLibelleR = 'Génération des Formats R ... < SE >'
.head 6 -  Set wbSituationZeroResult = PalDtmSituationResult( 'SE' )
.head 6 -  Call PalResultDate( "SE", 1, wsDateResult )
.head 6 -  Call PalGetDiffuseElu( "SE", wsDiffuseElus )
.head 6 -  Call DispatchMessage(  )
.head 6 +  If wbFormatRManuel or wbSituationZeroResult or PalVerifExecutionFormatR( "SE", wsDateResult )
.head 7 -  Set bResultOk = TRUE
.head 7 +  If NOT SalIsWindowVisible( dfLibelleR )
.head 8 -  Call SalShowWindow( dfLibelleR )
.head 8 -  Call SalBringWindowToTop( dfLibelleR )
.head 8 -  Call DispatchMessage(  )
.head 7 -  Call PalHttpCockpit( 451, '', '', 'SE', 'SE', wsModuleNom, wsModuleLigne, '' )
.head 7 -  Set ldDate1 = SalDateCurrent(  )
.head 7 -  Set gsIN_NivSup = ''
.head 7 -  Set dfLibelleR = 'Evolution des Cantons ... < SE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionCantons( 'SE' , nBurDep, nCantonComplet, lsSitCantonGlob )
.head 7 -  Set lsNoSequR = SalStrRightX( '0000' || SalNumberToStrX(SalStrToNumber(SalGetWindowTextX(whCbElecElu[3]))+1 , 0), 4)
.head 7 -  Set wsEnveloppeR_Glob = "R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || 
	SalStrRightX('000' || SalNumberToStrX( nCantonComplet,0) , 3)|| "_"|| lsNoSequR|| "_"|| 'SE' 
.head 7 -  Set dfLibelleR = 'Niveaux Provinces ... < SE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionNivProv( 'SE', 'P', gsIN_NivSup )
.head 7 -  Set dfLibelleR = 'Niveaux Circonscriptions ... < SE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionNivInterm( 'SE', 'L', gsIN_NivSup )
.head 7 -  Set dfLibelleR = 'Niveaux Collèges ... < SE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionNivSup( 'SE', 'L', gsIN_NivSup)
.head 7 -  Set dfLibelleR = 'Niveau Royaume ... < SE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalResultatListes_Royaume( lsSitCantonGlob , 'SE' )
.head 7 -  Set dfLibelleR = 'Hit-parade ... < SE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionHitParadeCdt( 'SE', 'L', gsIN_NivSup )
.head 7 -  Call PalEvolutionHitParadeCdt( 'SE', 'C', gsIN_NivSup )
.head 7 -  Call PalResultatHitParadeCdt( 'SE', 'R', '00000', NUMBER_Null )
.head 7 -  Set dfLibelleR = 'Analyse détaillée ... < SE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionAnalyseDetail( 'SE', 'P', gsIN_NivSup )
.head 7 -  Call PalEvolutionAnalyseDetail( 'SE', 'R', '' )
.head 7 +  If wsDiffuseElus = '1' or wbSituationZeroResult
.head 8 -  Set dfLibelleR = 'Diffusion des sièges ... < SE >'
.head 8 -  Call DispatchMessage(  )
.head 8 -  Call PalResultatSiege_NivRoyaume( 'SE' )
.head 7 -  Set ldDate3 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate3 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 455, '', '', 'SE (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')', 'SE', wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 7 -  ! Création de la MAP des sièges niveau royaume
.head 7 -  Call PalCreateRSRmap ('SE')
.head 7 -  !
.head 7 -  Call PalZipResultat( 'SE' , nBurDep, nCantonComplet, wsEnveloppeR_Glob)
.head 7 -  Call PalResultDate( "SE", 2, lsDateNewResult )
.head 7 -  Set ldDate2 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate2 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 459, '', '','SE (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')', 'SE',  wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 6 -  Call SalColorSet(  whMod_FR[3], COLOR_IndexWindow, COLOR_DarkGreen )
.head 6 -  Call SalColorSet(  whMod_FR[3], COLOR_IndexWindowText, COLOR_DarkGreen )
.head 5 -  !
.head 5 -  ! WL (4)
.head 5 +  If gbGestionElectionType[4] and cbWL_FR and wbFormatRPourEL[4]
.head 6 -  Set dfLibelleR = 'Génération des Formats R ... < WL >'
.head 6 -  Set wbSituationZeroResult =  PalDtmSituationResult( 'WL' )
.head 6 -  Call PalResultDate( "WL", 1, wsDateResult )
.head 6 -  Call PalGetDiffuseElu( "WL", wsDiffuseElus )
.head 6 -  Call DispatchMessage(  )
.head 6 +  If wbFormatRManuel or wbSituationZeroResult or PalVerifExecutionFormatR( "WL", wsDateResult )
.head 7 -  Set bResultOk = TRUE
.head 7 +  If NOT SalIsWindowVisible( dfLibelleR )
.head 8 -  Call SalShowWindow( dfLibelleR )
.head 8 -  Call SalBringWindowToTop( dfLibelleR )
.head 8 -  Call DispatchMessage(  )
.head 7 -  Call PalHttpCockpit( 451, '', '', 'WL', 'WL', wsModuleNom, wsModuleLigne, '' )
.head 7 -  Set ldDate1 = SalDateCurrent(  )
.head 7 -  Set gsIN_NivSup = ''
.head 7 -  Set dfLibelleR = 'Evolution des Cantons ... < WL >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionCantons( 'WL' , nBurDep, nCantonComplet, lsSitCantonGlob )
.head 7 -  Set lsNoSequR = SalStrRightX( '0000' || SalNumberToStrX(SalStrToNumber(SalGetWindowTextX(whCbElecElu[4]))+1 , 0), 4)
.head 7 -  Set wsEnveloppeR_Glob = "R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || 
	SalStrRightX('000' || SalNumberToStrX( nCantonComplet,0) , 3)|| "_"|| lsNoSequR|| "_"|| 'WL' 
.head 7 -  Set dfLibelleR = 'Niveaux supérieurs ... < WL >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionNivSup( 'WL', 'C', gsIN_NivSup )
.head 7 -  Call PalEvolutionNivInterm( 'WL', 'P', gsIN_NivSup )
.head 7 -  Set dfLibelleR = 'Niveau Royaume ... < WL >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalResultatListes_Royaume( lsSitCantonGlob , 'WL' )
.head 7 -  Set dfLibelleR = 'Hit-parade ... < WL >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionHitParadeCdt( 'WL', 'C' , gsIN_NivSup )
.head 7 -  Call PalResultatHitParadeCdt( 'WL', 'R', '00000', NUMBER_Null )
.head 7 -  Set dfLibelleR = 'Analyse détaillée ... < WL >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionAnalyseDetail( 'WL', 'C', gsIN_NivSup )
.head 7 -  Call PalEvolutionAnalyseDetail( 'WL', 'R', '' )
.head 7 +  If wsDiffuseElus = '1' or wbSituationZeroResult
.head 8 -  Call PalResultatSiege_NivRoyaume( 'WL' )
.head 7 -  Set ldDate3 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate3 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 455, '', '', 'WL (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')', 'WL', wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 7 -  ! Création de la MAP des sièges niveau royaume
.head 7 -  Call PalCreateRSRmap ('WL')
.head 7 -  !
.head 7 -  Call PalZipResultat( 'WL' , nBurDep, nCantonComplet, wsEnveloppeR_Glob)
.head 7 -  Call PalResultDate( "WL", 2, lsDateNewResult )
.head 7 -  Set ldDate2 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate2 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 459, '', '',  'WL (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')','WL', wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 6 -  Call SalColorSet(  whMod_FR[4], COLOR_IndexWindow, COLOR_DarkGreen )
.head 6 -  Call SalColorSet(  whMod_FR[4], COLOR_IndexWindowText, COLOR_DarkGreen )
.head 5 -  !
.head 5 -  ! VL (7)
.head 5 +  If gbGestionElectionType[7] and cbVL_FR and wbFormatRPourEL[7]
.head 6 -  Set dfLibelleR = 'Génération des Formats R ... < VL >'
.head 6 -  Set wbSituationZeroResult =  PalDtmSituationResult( 'VL' )
.head 6 -  Call PalResultDate( "VL", 1, wsDateResult )
.head 6 -  Call PalGetDiffuseElu( "VL", wsDiffuseElus )
.head 6 -  Call DispatchMessage(  )
.head 6 +  If wbFormatRManuel or wbSituationZeroResult or PalVerifExecutionFormatR( "VL", wsDateResult )
.head 7 -  Set bResultOk = TRUE
.head 7 +  If NOT SalIsWindowVisible( dfLibelleR )
.head 8 -  Call SalShowWindow( dfLibelleR )
.head 8 -  Call SalBringWindowToTop( dfLibelleR )
.head 8 -  Call DispatchMessage(  )
.head 7 -  Call PalHttpCockpit( 451, '', '', 'VL', 'VL', wsModuleNom, wsModuleLigne, '' )
.head 7 -  Set ldDate1 = SalDateCurrent(  )
.head 7 -  Set gsIN_NivSup = ''
.head 7 -  Set dfLibelleR = 'Evolution des Cantons ... < VL >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionCantons( 'VL' , nBurDep, nCantonComplet, lsSitCantonGlob )
.head 7 -  Set lsNoSequR = SalStrRightX( '0000' || SalNumberToStrX(SalStrToNumber(SalGetWindowTextX(whCbElecElu[7]))+1 , 0), 4)
.head 7 -  Set wsEnveloppeR_Glob = "R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || 
	SalStrRightX('000' || SalNumberToStrX( nCantonComplet,0) , 3)|| "_"|| lsNoSequR|| "_"|| 'VL' 
.head 7 -  Set dfLibelleR = 'Niveaux supérieurs ... < VL >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionNivSup( 'VL', 'C', gsIN_NivSup )
.head 7 -  Set dfLibelleR = 'Niveau Royaume ... < VL >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalResultatListes_Royaume( lsSitCantonGlob , 'VL' )
.head 7 -  Set dfLibelleR = 'Hit-parade ... < VL >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionHitParadeCdt( 'VL', 'C', gsIN_NivSup )
.head 7 -  Call PalResultatHitParadeCdt( 'VL', 'R', '00000', NUMBER_Null )
.head 7 -  Set dfLibelleR = 'Analyse détaillée ... < VL >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionAnalyseDetail( 'VL', 'C', gsIN_NivSup )
.head 7 -  Call PalEvolutionAnalyseDetail( 'VL', 'R', '' )
.head 7 -  !
.head 7 -  !
.head 7 +  If wsDiffuseElus = '1' or wbSituationZeroResult
.head 8 -  Call PalResultatSiege_NivRoyaume( 'VL' )
.head 7 -  Set ldDate3 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate3 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 455, '', '', 'VL (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')', 'VL', wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 7 -  ! Création de la MAP des sièges niveau royaume
.head 7 -  Call PalCreateRSRmap ('VL')
.head 7 -  !
.head 7 -  Call PalZipResultat( 'VL' , nBurDep, nCantonComplet, wsEnveloppeR_Glob)
.head 7 -  Call PalResultDate( "VL", 2, lsDateNewResult )
.head 7 -  Set ldDate2 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate2 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 459, '', '', 'VL (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')','VL',  wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 6 -  Call SalColorSet(  whMod_FR[7], COLOR_IndexWindow, COLOR_DarkGreen )
.head 6 -  Call SalColorSet(  whMod_FR[7], COLOR_IndexWindowText, COLOR_DarkGreen )
.head 5 -  !
.head 5 -  ! BR (10)
.head 5 +  If gbGestionElectionType[10] and cbBR_FR and wbFormatRPourEL[10]
.head 6 -  Set dfLibelleR = 'Génération des Formats R ... < BR >'
.head 6 -  Set wbSituationZeroResult =  PalDtmSituationResult( 'BR' )
.head 6 -  Call PalResultDate( "BR", 1, wsDateResult )
.head 6 -  Call PalGetDiffuseElu( "BR", wsDiffuseElus )
.head 6 -  Call DispatchMessage(  )
.head 6 +  If wbFormatRManuel or wbSituationZeroResult or PalVerifExecutionFormatR( "BR", wsDateResult )
.head 7 -  Set bResultOk = TRUE
.head 7 +  If NOT SalIsWindowVisible( dfLibelleR )
.head 8 -  Call SalShowWindow( dfLibelleR )
.head 8 -  Call SalBringWindowToTop( dfLibelleR )
.head 8 -  Call DispatchMessage(  )
.head 7 -  Call PalHttpCockpit( 451, '', '', 'BR', 'BR', wsModuleNom, wsModuleLigne, '' )
.head 7 -  Set ldDate1 = SalDateCurrent(  )
.head 7 -  Set dfLibelleR = 'Evolution des Cantons ... < BR >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionCantons( 'BR' , nBurDep, nCantonComplet, lsSitCantonGlob )
.head 7 -  Set lsNoSequR = SalStrRightX( '0000' || SalNumberToStrX(SalStrToNumber(SalGetWindowTextX(whCbElecElu[10]))+1 , 0), 4)
.head 7 -  Set wsEnveloppeR_Glob = "R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || 
	SalStrRightX('000' || SalNumberToStrX( nCantonComplet,0) , 3)|| "_"|| lsNoSequR|| "_"|| 'BR' 
.head 7 -  Set dfLibelleR = 'Niveaux supérieurs ... < BR >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionNivSup( 'BR', 'R', '' )
.head 7 -  Set dfLibelleR = 'Niveau Royaume ... < BR >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalResultatListes_Royaume( lsSitCantonGlob , 'BR' )
.head 7 -  Set dfLibelleR = 'Hit-parade ... < BR >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionHitParadeCdt( 'BR', 'R', '' )
.head 7 -  Set dfLibelleR = 'Analyse détaillée ... < BR >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionAnalyseDetail( 'BR', 'R', '' )
.head 7 -  !
.head 7 +  If wsDiffuseElus = '1' or wbSituationZeroResult
.head 8 -  Call PalResultatSiege_NivRoyaume( 'BR' )
.head 7 -  Set ldDate3 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate3 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 455, '', '', 'BR (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')', 'BR', wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 7 -  ! Création de la MAP des sièges niveau royaume
.head 7 -  Call PalCreateRSRmap ('BR')
.head 7 -  !
.head 7 -  Call PalZipResultat( 'BR' , nBurDep, nCantonComplet, wsEnveloppeR_Glob)
.head 7 -  Call PalResultDate( "BR", 2, lsDateNewResult )
.head 7 -  Set ldDate2 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate2 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 459, '', '', 'BR (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')', 'BR', wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob)
.head 6 -  Call SalColorSet(  whMod_FR[10], COLOR_IndexWindow, COLOR_DarkGreen )
.head 6 -  Call SalColorSet(  whMod_FR[10], COLOR_IndexWindowText, COLOR_DarkGreen )
.head 5 -  !
.head 5 -  ! DE (12)
.head 5 +  If gbGestionElectionType[12] and cbDE_FR and wbFormatRPourEL[12]
.head 6 -  Set dfLibelleR = 'Génération des Formats R ... < DE >'
.head 6 -  Set wbSituationZeroResult =  PalDtmSituationResult( 'DE' )
.head 6 -  Call PalResultDate( "DE", 1, wsDateResult )
.head 6 -  Call PalGetDiffuseElu( "DE", wsDiffuseElus )
.head 6 -  Call DispatchMessage(  )
.head 6 +  If wbFormatRManuel or wbSituationZeroResult or PalVerifExecutionFormatR( "DE", wsDateResult )
.head 7 -  Set bResultOk = TRUE
.head 7 +  If NOT SalIsWindowVisible( dfLibelleR )
.head 8 -  Call SalShowWindow( dfLibelleR )
.head 8 -  Call SalBringWindowToTop( dfLibelleR )
.head 8 -  Call DispatchMessage(  )
.head 7 -  Call PalHttpCockpit( 451, '', '', 'DE', 'DE', wsModuleNom, wsModuleLigne, '' )
.head 7 -  Set ldDate1 = SalDateCurrent(  )
.head 7 -  Set dfLibelleR = 'Evolution des Cantons ... < DE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionCantons( 'DE' , nBurDep, nCantonComplet, lsSitCantonGlob )
.head 7 -  Set lsNoSequR = SalStrRightX( '0000' || SalNumberToStrX(SalStrToNumber(SalGetWindowTextX(whCbElecElu[12]))+1 , 0), 4)
.head 7 -  Set wsEnveloppeR_Glob = "R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || 
	SalStrRightX('000' || SalNumberToStrX( nCantonComplet,0) , 3)|| "_"|| lsNoSequR|| "_"|| 'DE' 
.head 7 -  Set dfLibelleR = 'Niveaux supérieurs ... < DE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionNivSup( 'DE', 'G' , '')
.head 7 -  Set dfLibelleR = 'Niveau Royaume ... < DE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalResultatListes_Royaume( lsSitCantonGlob , 'DE' )
.head 7 -  Set dfLibelleR = 'Hit-parade ... < DE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionHitParadeCdt( 'DE', 'G', '' )
.head 7 -  Set dfLibelleR = 'Analyse détaillée ... < DE >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call PalEvolutionAnalyseDetail( 'DE', 'G', '' )
.head 7 -  !
.head 7 +  If wsDiffuseElus = '1' or wbSituationZeroResult
.head 8 -  Call PalResultatSiege_NivRoyaume( 'DE' )
.head 7 -  Set ldDate3 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate3 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 455, '', '', 'DE (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')', 'DE', wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 7 -  ! Création de la MAP des sièges niveau royaume
.head 7 -  Call PalCreateRSRmap ('DE')
.head 7 -  !
.head 7 -  Call PalZipResultat( 'DE' , nBurDep, nCantonComplet, wsEnveloppeR_Glob)
.head 7 -  Call PalResultDate( "DE", 2, lsDateNewResult )
.head 7 -  !
.head 7 -  Set ldDate2 = SalDateCurrent(  )
.head 7 -  Set lnSecondeEcoulee = SalNumberRound(  (ldDate2 - ldDate1) * 60 * 60 * 24 )
.head 7 -  Call PalHttpCockpit( 459, '', '', 'DE (' || SalNumberToStrX( lnSecondeEcoulee , 0) ||')',  'DE',wsModuleNom, wsModuleLigne, wsEnveloppeR_Glob )
.head 6 -  Call SalColorSet(  whMod_FR[12], COLOR_IndexWindow, COLOR_DarkGreen )
.head 6 -  Call SalColorSet(  whMod_FR[12], COLOR_IndexWindowText, COLOR_DarkGreen )
.head 5 -  !
.head 5 -  Set wbResultat = FALSE
.head 5 -  !
.head 5 -  Call PalSetApplParm( "RESULT", lsDateNewResult )
.head 5 -  Call SalHideWindow( dfLibelleR )
.head 5 -  Set wbFormatRManuel = FALSE
.head 5 -  Call PalGenereUnFormatR( 1, NUMBER_Null )
.head 5 -  Call DispatchMessage(  )
.head 5 -  !
.head 5 -  Return bResultOk
.head 3 -  !
.head 3 +  Function: PalDtmSituationResult
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sEl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: lnBurTot
.head 5 -  Number: lnBurTrait
.head 5 -  Number: lnFormatR
.head 4 +  Actions
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "select sum(@nullvalue(RES_SIT_DEP,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) 
	from result_scrutin 
	where RES_NIV_LETTRE= 'K' and RES_ELE_EXT = :sEl
	into :lnBurTot, :lnBurTrait " )
.head 5 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 5 -  Call SqlCommit( ghSqlMain)
.head 5 +  If lnBurTot = 0 and lnBurTrait = 0
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select @nullvalue(ELE_NB_FORMATR,0)
	from election
	where ELE_LETTRE = :sEl
	into :lnFormatR " )
.head 6 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Call SqlCommit( ghSqlMain)
.head 6 +  If lnFormatR = 0
.head 7 -  Return TRUE
.head 6 +  Else
.head 7 -  Return FALSE
.head 5 +  Else
.head 6 -  Return FALSE
.head 3 +  Function: PalVerifExecutionFormatR
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: sDateR
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Date/Time: dDateResult
.head 4 +  Actions
.head 5 -  Set dDateResult = PalDateConstuct( sDateR )
.head 5 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select *  
	from result_scrutin 
	where RES_NIV_LETTRE= 'K' and RES_ELE_EXT = :sExtElec and DATE_HEURE_MAJ >= :dDateResult " )
.head 5 +  If SqlFetchNext( ghSqlSecondaire, Btmp )
.head 6 -  Call SqlCommit( ghSqlSecondaire)
.head 6 -  Return TRUE
.head 5 +  Else
.head 6 -  Call SqlCommit( ghSqlSecondaire)
.head 6 -  Return FALSE
.head 3 +  Function: PalEvolutionCantons
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  Receive Number: nBureauDep
.head 5 -  Receive Number: nCantonDef
.head 5 -  Receive String: sSitCantonGlob
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnNbCantonTraites
.head 5 -  String: lsIns
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsSitCanton
.head 5 -  String: lsSitDepLettre
.head 5 -  String: lsDateMaj
.head 5 -  Date/Time: ldDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Date/Time: dDateResult
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnNbBurDepBxl
.head 5 -  Number: lnNbBurTotBxl
.head 5 -  Number: lnNbCanComplet
.head 5 -  String: lsIdEntite
.head 5 -  String: lsInsDepListe
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  !
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  !
.head 6 -  Call VisFileDelete( wsPathResult ||"\\RER*." || sExtElec )
.head 6 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\RER00000."|| sExtElec ,  OF_Create | OF_ReadWrite | OF_Text )
.head 7 +  If wsDateResult = ''
.head 8 -  Set wsDateResult = '2000-01-01'
.head 7 -  Set dDateResult = PalDateConstuct( wsDateResult )
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes C
.head 7 -  Set lnNbBurDep = 0
.head 7 -  Set lnNbCanDef = 0
.head 7 -  Set lnNbCanTot = 0
.head 7 -  Set lnNbCantonTraites = 0
.head 7 -  Set lnNbCanComplet = 0
.head 7 -  Set lsInsPrec = ''
.head 7 -  Set gsIN_NivSup = ''
.head 7 -  Set lnI = 1
.head 7 -  Call SqlPrepareAndExecute( lhSql, "select res_ent_ins,RES_SIT_DEP,RES_BDEP_TOT,RES_BDEP_TRAIT, date_heure_maj, RES_T_DEP , RES_ENT_FK
	from result_scrutin 
	where RES_NIV_LETTRE= 'K' and RES_ELE_EXT = :sExtElec
	Order by 1
	into :lsIns, :lnSitDep, :lnNbBurTot, :lnNbBurTrait, :ldDateMaj, :lsSitDepLettre , :lsIdEntite " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If lsIns != lsInsPrec
.head 9 -  Set lnNbCanTot = lnNbCanTot + 1
.head 9 +  If ldDateMaj = DATETIME_Null
.head 10 -  Call SalDateToStr( dDateResult, lsDateMaj )
.head 9 +  Else
.head 10 -  Call SalDateToStr( ldDateMaj, lsDateMaj )
.head 9 -  ! Set lsHeureMaj = SalStrMidX( lsDateMaj, 11, 8)
.head 9 -  Set lsHeureMaj = VisStrSubstitute( SalStrMidX( lsDateMaj, 11, 8), '.', ':')
.head 9 -  Set lsDateMaj = date_separa( lsDateMaj, '/' )
.head 9 +  If lnSitDep = 1 and lnNbBurTot = lnNbBurTrait
.head 10 +  If lsSitDepLettre = 'D'
.head 11 -  Set lsSitCanton = 'D'
.head 11 -  Set lnNbCanDef = lnNbCanDef + 1
.head 10 +  Else
.head 11 -  Set lsSitCanton = lsSitDepLettre
.head 10 +  If lsSitDepLettre = 'D' or lsSitDepLettre = 'C'
.head 11 -  Set lnNbCanComplet = lnNbCanComplet + 1
.head 10 -  Set lnNbCantonTraites = lnNbCantonTraites +1
.head 9 +  Else If lnSitDep = NUMBER_Null
.head 10 -  Set lsSitCanton = ''
.head 9 +  Else
.head 10 -  Set lsSitCanton = 'P'
.head 10 -  Set lnNbCantonTraites = lnNbCantonTraites +1
.head 9 +  If lnNbBurTot = NUMBER_Null or lnNbBurTot = 0
.head 10 +  If lnNbBurTrait > 0
.head 11 +  If lsSitCanton = 'P' or lsSitCanton = ''
.head 12 -  Set lnNbBurTot = lnNbBurTrait + 1
.head 12 -  Set lsSitCanton = 'P'
.head 11 +  Else If lsSitCanton = 'D'
.head 12 -  Set lnNbBurTot = lnNbBurTrait
.head 11 -  !
.head 9 -  !
.head 9 +  If lnNbBurTot = NUMBER_Null or wbSituationZeroResult
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select ENT_BURDEP_TOT
	from ENTITE 
	where ENT_NIV_LETTRE= 'K' and ENT_ELE_EXT = :sExtElec and ent_Ins = :lsIns
	into :lnNbBurTot " )
.head 10 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 9 -  !
.head 9 -  Set lsBuffer[lnI] = '"C","'|| lsIns ||'","'|| sExtElec ||'","'|| lsSitCanton ||'","'|| SalNumberToStrX( lnNbBurTrait,0) ||'","'|| SalNumberToStrX( lnNbBurTot,0) ||'","'||lsDateMaj ||'","'|| lsHeureMaj || '","'|| lsIdEntite ||'"'
.head 9 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 9 -  Set lnNbBurDep = lnNbBurDep + lnNbBurTrait
.head 9 -  !
.head 9 +  If (ldDateMaj > dDateResult or ldDateMaj = DATETIME_Null) or wbSituationZeroResult
.head 10 +  If ldDateMaj = DATETIME_Null and NOT wbSituationZeroResult
.head 11 +  If SqlPrepareAndExecute( ghSqlMaj, "Update result_scrutin set date_heure_maj = :dDateResult 
	where RES_NIV_LETTRE= 'K' and RES_ELE_EXT = :sExtElec and RES_ENT_INS = :lsIns and date_heure_maj is null")
.head 12 -  Call SqlCommit( ghSqlMaj )
.head 10 -  Call PalResultatListes_Canton( lsSitCanton, sExtElec, lsIns , lsIdEntite)
.head 10 -  !
.head 10 +  If SalStrScan( gsIN_NivSup, "#" || SalStrLeftX( lsIns,1) || "#" ) = -1
.head 11 +  If gsIN_NivSup = ''
.head 12 -  Set gsIN_NivSup = gsIN_NivSup || "#" 
.head 11 -  Set gsIN_NivSup = gsIN_NivSup || SalStrLeftX( lsIns,1) || "#" 
.head 9 -  !
.head 9 -  Set lnI = lnI +1
.head 8 -  Set lsInsPrec = lsIns
.head 7 -  !
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  !
.head 7 +  If gsIN_NivSup != ''
.head 8 -  Set gsIN_NivSup =  "-" || gsIN_NivSup ||"!"
.head 8 -  Set gsIN_NivSup = VisStrSubstitute( gsIN_NivSup , '-#', ' (')
.head 8 -  Set gsIN_NivSup = VisStrSubstitute( gsIN_NivSup, '#!', ' )')
.head 8 -  Set gsIN_NivSup = VisStrSubstitute( gsIN_NivSup, '#', ',')
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 +  If lnNbCanComplet = lnNbCanTot
.head 8 -  Set lsSitCanton = 'D'
.head 7 +  Else If lnNbCanComplet = 0 or lnNbCanComplet = NUMBER_Null
.head 8 +  If lnNbBurDep = 0 or lnNbBurDep = NUMBER_Null
.head 9 -  Set lsSitCanton = ''
.head 8 +  Else
.head 9 -  Set lsSitCanton = 'P'
.head 7 +  Else
.head 8 -  Set lsSitCanton = 'P'
.head 7 -  !
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)), sum(@nullvalue(RES_BDEP_TOT,0))  from result_scrutin where RES_ELE_EXT = :sExtElec 
	into :lnNbBurDep, :lnNbBurTot " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  !
.head 7 +  If (sExtElec = 'SE' or sExtElec = 'EU')
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0))/2  , sum(@nullvalue(RES_BDEP_TOT,0))/2  
	from result_scrutin where RES_ELE_EXT = :sExtElec  and @left(RES_ENT_INS,2) in ('21','23') 
	into :lnNbBurDepBxl, :lnNbBurTotBxl " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Set lnNbBurDep = lnNbBurDep - lnNbBurDepBxl
.head 8 -  Set lnNbBurTot = lnNbBurTot - lnNbBurTotBxl
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  !
.head 7 -  ! Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| lsSitCanton ||'","'|| SalNumberToStrX( lnNbBurDep,0)   ||'","'|| SalNumberToStrX( lnNbCanDef,0)   ||'","XXXX","'|| sDate ||'","'|| sHeure || '"'
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| lsSitCanton ||'","'|| SalNumberToStrX( lnNbBurDep,0)   ||'","'|| SalNumberToStrX( lnNbCanComplet,0)   ||'","XXXX","'|| sDate ||'","'|| sHeure || '"'
.head 7 -  Call PalMajHistoGraphiqueEvolution( sExtElec, "", NUMBER_Null, "R",  lnNbBurDep, lnNbBurTot, lnNbCantonTraites, lnNbCanTot , lnNbCanComplet, lnNbCanDef)
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 -  Set lnJ = 0
.head 7 +  While lnJ < lnI
.head 8 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 8 -  Set lnJ = lnJ + 1
.head 7 -  !
.head 7 -  !
.head 7 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 6 -  Set nBureauDep = lnNbBurDep
.head 6 -  Set sSitCantonGlob = lsSitCanton
.head 6 -  ! Set nCantonDef = lnNbCanDef
.head 6 -  Set nCantonDef = lnNbCanComplet
.head 3 +  Function: PalGetDiffuseElu
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sElection
.head 5 -  Receive String: sDiffuse
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Set sDiffuse = '0'
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "Select  ELE_LOC2_ELUDIFFUSE from election where ele_lettre = :sElection
	into :sDiffuse ")
.head 5 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 5 -  Call SqlCommit( ghSqlMain)
.head 3 +  Function: PalResultDate
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sElection
.head 5 -  Number: nType
.head 5 -  Receive String: sDate
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: lnId
.head 5 -  Number: lnNbFR
.head 4 +  Actions
.head 5 +  If nType = 1
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select  ELE_ID , ELE_D_FORMATR from election where ele_lettre = :sElection
	into :lnId, :sDate ")
.head 6 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Call SqlCommit( ghSqlMain)
.head 5 +  Else
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select  ELE_ID,@nullvalue(ELE_NB_FORMATR,0)   from election where ele_lettre = :sElection
	into :lnId, :lnNbFR ")
.head 6 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Update election set  ELE_D_FORMATR = "|| sDate || " ,  ELE_NB_FORMATR=@nullvalue(ELE_NB_FORMATR,0)+1 where ele_lettre = :sElection ")
.head 6 -  Call SqlCommit( ghSqlMain)
.head 6 -  Call SalSetWindowText( whDateElecFR[lnId], sDate )
.head 6 -  Call SalSetWindowText( whCbElecElu[lnId], SalNumberToStrX( lnNbFR+1, 0 ) )
.head 3 -  !
.head 3 +  Function: PalResultatListes_Royaume
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sSitCanton
.head 5 -  String: sExtElec
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBNB_BBE1E2E5_Bxl
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBNB_E3E4_Bxl
.head 5 -  Number: lnBE_E5
.head 5 -  Number: lnBE_E5_Bxl
.head 5 -  Number: lnVV_E5
.head 5 -  Number: lnVBN_E5
.head 5 -  String: lsIns
.head 5 -  String: lsFichier
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnK
.head 5 -  Number: lnKi
.head 5 -  Number: lnTri
.head 5 -  String: lsNoGrp
.head 5 -  String: lsInsTmp
.head 5 -  Number: lnSC1
.head 5 -  Number: lnSC2
.head 5 -  Number: lnSC3
.head 5 -  Number: lnSC4
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnNbCantonTot
.head 5 -  Number: lnNbCantonTraites
.head 5 -  String: sSiege
.head 5 -  Number: lnNbBurDepBxl
.head 5 -  Number: lnNbBurTotBxl
.head 5 -  Number: lnNbCantonTotBxl
.head 5 -  Number: lnNbCantonTraitesBxl 
.head 5 -  Number: lnSousGroupe[*]
.head 5 -  Boolean: bSousGrpExist
.head 5 -  String: lsSousGroupe
.head 5 -  String: lsIdEntite
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 +  If sSitCanton = 'P' or sSitCanton = '' or wbSituationZeroResult
.head 7 -  Set lsFichier = "R0R00000."|| sExtElec
.head 6 +  Else
.head 7 -  Set lsFichier = "R1R00000."|| sExtElec
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R0R00000." || sExtElec )
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R1R00000." || sExtElec )
.head 6 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes S
.head 7 -  Set lnI = 1
.head 7 -  Set lnBE_BBE1E2 = 0
.head 7 -  Set lnBNB_BBE1E2E5 = 0
.head 7 -  Set lnBE_E3E4 = 0
.head 7 -  Set lnBNB_E3E4 = 0
.head 7 -  Set lnBE_E5 = 0
.head 7 -  !
.head 7 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from result_scrutin 
	where RES_NIV_LETTRE= 'K' and RES_ELE_EXT = :sExtElec and RES_ENT_INS not like '%999'
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5" )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlCommit( lhSql)
.head 7 +  If sExtElec = 'CK' or sExtElec = 'SE'
.head 8 -  !
.head 8 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from result_scrutin 
	where RES_NIV_LETTRE= 'K' and RES_ELE_EXT = :sExtElec and RES_ENT_INS like '%999'
	into :lnBE_E3E4, :lnBNB_E3E4 " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlCommit( lhSql)
.head 8 +  If sExtElec = 'CK'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr 
	where BETR_EL = :sExtElec and BETR_INS != 21004
	into :lnBE_E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum( @nullvalue(RES_NB_VV_E5,0)) ,sum( @nullvalue(RES_NB_VBN_E5,0) )
	from Result_scrutin A, Entite B
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_Ins like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR = 21004 )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE = 21004
	into  :lnVV_E5, :lnVBN_E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 8 +  Else If sExtElec = 'SE'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "select sum( @nullvalue(RES_NB_VBN,0)) /2
	from result_scrutin 
	where RES_NIV_LETTRE= 'K' and RES_ELE_EXT = :sExtElec and RES_ENT_INS not like '%999' and @left(res_ent_ins,2) in('21', '23')
	into :lnBNB_BBE1E2E5_Bxl " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 - lnBNB_BBE1E2E5_Bxl
.head 9 -  Set lnBNB_BBE1E2E5 = lnBNB_BBE1E2E5 - lnBNB_BBE1E2E5_Bxl
.head 9 -  Call SqlPrepareAndExecute( lhSql, "select sum( @nullvalue(RES_NB_VBN,0)) /2
	from result_scrutin 
	where RES_NIV_LETTRE= 'K' and RES_ELE_EXT = :sExtElec and RES_ENT_INS like '%999' and @left(res_ent_ins,2) in('21', '23')
	into :lnBNB_E3E4_Bxl " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum( @nullvalue(RES_NB_VV_E5,0)) ,sum( @nullvalue(RES_NB_VBN_E5,0) )
	from Result_scrutin A, Entite B
	where  RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and RES_ENT_INS like '%999'
	into :lnVV_E5, :lnVBN_E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr 
	where BETR_EL = :sExtElec and BETR_INS != 21004
	into :lnBE_E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Set lnBE_E3E4 = lnBE_E3E4 - lnBNB_E3E4_Bxl
.head 9 -  ! Set lnBE_E5 = lnBE_E5 +  lnVBN_E5
.head 9 -  Set lnBNB_E3E4 = lnBNB_E3E4 - lnBNB_E3E4_Bxl
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 8 -  !
.head 8 -  Set lnBE_E5 = lnBE_E5 +  (lnVV_E5 + lnVBN_E5)
.head 8 -  Set lnBE_E3E4 = lnBE_E3E4 - (lnVV_E5 + lnVBN_E5)
.head 8 -  Set lnBNB_E3E4 = lnBNB_E3E4 - lnVBN_E5
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 - lnBE_E5 +  (lnVV_E5 + lnVBN_E5)
.head 8 -  Set lnBNB_BBE1E2E5 = lnBNB_BBE1E2E5 + lnVBN_E5
.head 8 -  !
.head 8 +  If wbSituationZeroResult
.head 9 -  Set lnBE_BBE1E2 = 0
.head 9 -  Set lnBNB_BBE1E2E5 = 0
.head 9 -  Set lnBE_E3E4 = 0
.head 9 -  Set lnBNB_E3E4 = 0
.head 9 -  Set lnBE_E5 = 0
.head 8 -  !
.head 7 +  Else If sExtElec = 'EU'
.head 8 -  !
.head 8 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(RES_NB_VBN,0))
	from result_scrutin 
	where RES_NIV_LETTRE= 'K' and RES_ELE_EXT = :sExtElec and @left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = '92094'
	into :lnBNB_BBE1E2E5_Bxl" )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlCommit( lhSql)
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 - lnBNB_BBE1E2E5_Bxl
.head 8 -  Set lnBNB_BBE1E2E5 = lnBNB_BBE1E2E5 - lnBNB_BBE1E2E5_Bxl
.head 8 -  !
.head 8 +  If wbSituationZeroResult
.head 9 -  Set lnBE_BBE1E2 = 0
.head 9 -  Set lnBNB_BBE1E2E5 = 0
.head 9 -  Set lnBE_E3E4 = 0
.head 9 -  Set lnBNB_E3E4 = 0
.head 9 -  Set lnBE_E5 = 0
.head 8 -  !
.head 7 -  !
.head 7 +  If lnBE_BBE1E2 < 0
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBE_E5
.head 8 -  Set lnBE_E5 = 0
.head 7 -  Set lsBuffer[lnI] = '"S","'|| SalNumberToStrX( lnBE_BBE1E2,0) ||'","'|| SalNumberToStrX( lnBNB_BBE1E2E5,0) ||'","' || SalNumberToStrX( lnBE_E3E4,0) ||'","' || SalNumberToStrX( lnBNB_E3E4,0) ||'","'
	|| SalNumberToStrX( lnBE_E5,0) ||'"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 7 -  ! Lignes L
.head 7 -  Set lnNbBurDep = 0
.head 7 -  Set lnNbCanDef = 0
.head 7 -  Set lnNbCanTot = 0
.head 7 -  Set lsInsPrec = ''
.head 7 -  Set lnI = lnI+1
.head 7 -  Set bSousGrpExist = FALSE
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'BR' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select  LIS_GRL_FK, Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from result_listes, listes , groupe_Listes
	where REL_LIS_FK=LIS_Id and rel_ele_ext = :sExtElec and LIS_GRL_FK=GRL_ID
	group by 1,2 Order by 2,1
 	into :lsNoGrp, :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select  LIS_GRL_FK, count(*)
	from listes , groupe_listes
	where 	LIS_ele_ext = :sExtElec and LIS_GRL_FK=GRL_ID
	Group by 1 
	Order By 1 
	Into :lnK , :lnKi" )
.head 8 +  ! While SqlFetchNext( lhSql, Btmp )
.head 9 +  If lnKi > 1
.head 10 -  Set lnSousGroupe[ lnK ] = 0
.head 9 +  Else 
.head 10 -  Set lnSousGroupe[ lnK ] = NUMBER_Null
.head 8 -  ! Call SqlExists(  "Select  LIS_GRL_FK
	from listes , groupe_listes
	where 	LIS_ele_ext = :sExtElec and LIS_GRL_FK=GRL_ID
	Group by 1 having count(*) > 1 ", bSousGrpExist )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select  LIS_INSBUR, LIS_GRL_FK, Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from result_listes, listes , groupe_listes
	where REL_LIS_FK=LIS_Id and rel_ele_ext = :sExtElec and LIS_GRL_FK=GRL_ID
	group by 1,2,3 
	Order by 1,3,2
 	into :lsInsTmp, :lsNoGrp, :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 -  Set lsSousGroupe = ''
.head 8 +  ! If bSousGrpExist
.head 9 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 10 +  If lnSousGroupe[ SalStrToNumber( lsNoGrp ) ] != NUMBER_Null
.head 11 -  Set lsSousGroupe = SalNumberToChar( 65 + lnSousGroupe[ SalStrToNumber( lsNoGrp ) ] )
.head 11 -  Set lnSousGroupe[ SalStrToNumber( lsNoGrp ) ] = lnSousGroupe[ SalStrToNumber( lsNoGrp ) ] + 1
.head 8 +  If wsDiffuseElus = '1' or gbSauveEluHisto
.head 9 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "select sum(@nullvalue(elu_sieges,0))
	from result_elu_royaume
	where elu_elect = :sExtElec and elu_ListeGrp = :lsNoGrp and ELU_ENTITE = :lsInsTmp
	into :sSiege " )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "select sum(@nullvalue(elu_sieges,0))
	from result_elu_royaume
	where elu_elect = :sExtElec and elu_ListeGrp = :lsNoGrp
	into :sSiege " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 8 -  ! Histo Elu
.head 8 +  If gbSauveEluHisto
.head 9 -  Call PalMajHistoElus( wsEnveloppeR_Glob , sExtElec,  "R00000." || sExtElec , SalStrToNumber( lsNoGrp ), '',SalStrToNumber( sSiege ), SalDateCurrent(  ) )
.head 8 -  !
.head 8 -  !
.head 8 +  If wsDiffuseElus = '1'
.head 9 -  !
.head 8 +  Else
.head 9 -  Set sSiege= ''
.head 8 -  !
.head 8 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 9 -  Set lsBuffer[lnI] = '"L","","'|| sSitCanton ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","' || sSiege ||'","'|| lsNoGrp||'","","'|| lsInsTmp ||'"'
.head 8 +  Else
.head 9 -  Set lsBuffer[lnI] = '"L","","'|| sSitCanton ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","' || sSiege ||'","'|| lsNoGrp||'"'
.head 8 -  !
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  Set lnI = lnI +1
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)),sum(@nullvalue(RES_BDEP_TOT,1))  from result_scrutin where RES_ELE_EXT = :sExtElec into :lnNbBurDep,:lnNbBurTot " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from result_scrutin 
	where  RES_ELE_EXT = :sExtElec
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  ! Retrait BXL en double au SE et EU
.head 7 +  If (sExtElec = 'SE' or sExtElec = 'EU')
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)/2, sum(@nullvalue(res_sit_dep,0))/2 
	from result_scrutin 
	where  RES_ELE_EXT = :sExtElec and @left(Res_ent_ins,2) in ('21','23')  
	into :lnNbCantonTotBxl , :lnNbCantonTraitesBxl " ) 
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0))/2,sum(@nullvalue(RES_BDEP_TOT,1))/2   
	from result_scrutin
	where  RES_ELE_EXT = :sExtElec and @left(Res_ent_ins,2) in ('21','23') 
	into :lnNbBurDepBxl , :lnNbBurTotBxl " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Set lnNbCantonTot = lnNbCantonTot - lnNbCantonTotBxl
.head 8 -  Set lnNbCantonTraites = lnNbCantonTraites - lnNbCantonTraitesBxl
.head 8 -  Set lnNbBurDep = lnNbBurDep - lnNbBurDepBxl
.head 8 -  Set lnNbBurTot = lnNbBurTot - lnNbBurTotBxl
.head 7 -  !
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitCanton ||'","'|| SalNumberToStrX( lnNbBurDep,0)   ||'","XXXX","'|| sDate ||'","'|| sHeure ||'","'|| SalNumberToStrX( lnNbBurTot,0) ||'","'|| SalNumberToStrX( lnNbCantonTraites,0)||'","'|| 
			SalNumberToStrX( lnNbCantonTot,0)|| '"'
.head 7 +  If sExtElec = 'DE' 
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select ENT_ID
	from Entite
	where  ENT_ELE_EXT = :sExtElec and ent_niv_Lettre = 'G'
	into :lsIdEntite " )
.head 7 +  Else If sExtElec = 'BR' 
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select ENT_ID
	from Entite
	where  ENT_ELE_EXT = :sExtElec and ent_niv_Lettre = 'R'
	into :lsIdEntite " )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select ENT_ID
	from Entite
	where  ENT_ELE_EXT = :sExtElec and ent_ins = '00000'
	into :lsIdEntite " )
.head 7 +  If NOT SqlFetchNext( lhSql, Btmp )
.head 8 -  Set lsIdEntite = 'null'
.head 7 -  Set lsBuffer[0] = lsBuffer[0] || ',"' || lsIdEntite || '"'
.head 7 -  !
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 -  Set lnJ = 0
.head 7 +  While lnJ < lnI
.head 8 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 8 -  Set lnJ = lnJ + 1
.head 7 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 6 -  Call SqlDisconnect( lhSql )
.head 3 +  Function: PalResultatListes_Canton
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sSitCanton
.head 5 -  String: sExtElec
.head 5 -  String: psIns
.head 5 -  String: lsIdEntite
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBE_E5
.head 5 -  Number: lnBNB_E5
.head 5 -  String: lsIns
.head 5 -  String: lsFichier
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  String: lsNoGrp
.head 5 -  String: lsNoListe
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsCdtId
.head 5 -  String: lsDateDeces
.head 5 -  Number: lnSC1
.head 5 -  Number: lnSC2
.head 5 -  Number: lnSC3
.head 5 -  Number: lnSC4
.head 5 -  Number: lnVoix
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnNbCantonTot
.head 5 -  Number: lnNbCantonTraites 
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 +  If sSitCanton = 'P' or sSitCanton = '' or wbSituationZeroResult
.head 7 -  ! Set sSitCanton = 'P'
.head 7 -  Set lsFichier = "R0K"|| psIns ||"_XXX."|| sExtElec
.head 6 +  Else
.head 7 -  Set lsFichier = "R1K"|| psIns ||"."|| sExtElec
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R0K"|| psIns ||"*."|| sExtElec )
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R1K"|| psIns ||"*."|| sExtElec )
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes S
.head 7 -  Set lnI = 1
.head 7 -  Set lnBE_BBE1E2 = 0
.head 7 -  Set lnBNB_BBE1E2E5 = 0
.head 7 -  Set lnBE_E3E4 = 0
.head 7 -  Set lnBNB_E3E4 = 0
.head 7 -  Set lnBE_E5 = 0
.head 7 -  Set lnBNB_E5 = 0
.head 7 -  !
.head 7 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(RES_NB_VV,0)+@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from result_scrutin 
	where RES_NIV_LETTRE= 'K' and RES_ELE_EXT = :sExtElec and RES_ENT_INS = :psIns 
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5" )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlCommit( lhSql)
.head 7 +  If sExtElec = 'CK' or sExtElec = 'SE'
.head 8 +  If SalStrRightX( psIns, 3) = '999'
.head 9 -  Set lnBE_E3E4 = lnBE_BBE1E2
.head 9 -  Set lnBNB_E3E4 = lnBNB_BBE1E2E5
.head 9 -  Set lnBE_BBE1E2 = 0
.head 9 -  Set lnBNB_BBE1E2E5 = 0
.head 8 +  If psIns = '21999'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "select sum( @nullvalue(RES_NB_VV_E5,0) + @nullvalue(RES_NB_VBN_E5,0) ),sum( @nullvalue(RES_NB_VBN_E5,0) )
	from result_Scrutin
	where RES_ELE_EXT = :sExtElec  and RES_ENT_INS = 21999
	into :lnBE_E5 , :lnBNB_E5 " )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr 
	where BETR_EL = :sExtElec and BETR_Ins = :psIns
	into :lnBE_E5 " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlCommit( lhSql)
.head 8 +  If (SalStrLeftX( psIns, 2) = '21' or SalStrLeftX( psIns, 2) = '23') and sExtElec = 'SE'
.head 9 +  If SalStrRightX( psIns, 3) = '999'
.head 10 -  Set lnBNB_E3E4 = lnBNB_E3E4 / 2
.head 10 -  Set lnBE_E3E4 = lnBE_E3E4 - lnBNB_E3E4
.head 9 +  Else
.head 10 -  Set lnBNB_BBE1E2E5 = lnBNB_BBE1E2E5 / 2
.head 10 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 - lnBNB_BBE1E2E5
.head 8 -  !
.head 8 +  If psIns = '21999'
.head 9 -  Set lnBNB_E3E4 = lnBNB_E3E4 - lnBNB_E5
.head 9 -  Set lnBE_E3E4 = lnBE_E3E4 - lnBE_E5 
.head 9 -  Set lnBNB_BBE1E2E5 = lnBNB_E5
.head 8 +  Else
.head 9 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 - lnBE_E5
.head 7 +  Else If sExtElec = 'EU'
.head 8 +  If (SalStrLeftX( psIns, 2) = '21' or SalStrLeftX( psIns, 2) = '23') and sExtElec = 'EU'
.head 9 -  Set lnBNB_BBE1E2E5 = lnBNB_BBE1E2E5 / 2
.head 9 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 - lnBNB_BBE1E2E5
.head 8 -  !
.head 7 -  !
.head 7 +  If wbSituationZeroResult
.head 8 -  Set lnBE_BBE1E2 = 0
.head 8 -  Set lnBNB_BBE1E2E5 = 0
.head 8 -  Set lnBE_E3E4 = 0
.head 8 -  Set lnBNB_E3E4 = 0
.head 8 -  Set lnBE_E5 = 0
.head 8 -  Set lnBNB_E5 = 0
.head 7 -  !
.head 7 +  If lnBE_BBE1E2 < 0
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBE_E5
.head 8 -  Set lnBE_E5 = 0
.head 7 -  Set lsBuffer[lnI] = '"S","'|| SalNumberToStrX( lnBE_BBE1E2,0) ||'","'|| SalNumberToStrX( lnBNB_BBE1E2E5,0) ||'","' || SalNumberToStrX( lnBE_E3E4,0) ||'","' || SalNumberToStrX( lnBNB_E3E4,0) ||'","'
	|| SalNumberToStrX( lnBE_E5,0) ||'"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 7 -  ! Lignes L
.head 7 -  Set lnI = lnI+1
.head 7 -  Set lnNbBurDep = 0
.head 7 -  Set lnNbCanDef = 0
.head 7 -  Set lnNbCanTot = 0
.head 7 -  Set lsInsPrec = ''
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select  Lis_No, LIS_GRL_FK, @nullvalue(REL_SC1,0),@nullvalue(REL_SC2,0),@nullvalue(REL_SC3,0),@nullvalue(REL_SC4,0) 
	from result_listes, listes , groupe_listes
	where REL_LIS_FK=LIS_Id and rel_ele_ext = :sExtElec and REL_ENT_INS = :psIns and LIS_GRL_FK=GRL_ID
	Order by LIS_INSBUR,1
 	into :lsNoListe, :lsNoGrp, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitCanton ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","","'|| lsNoGrp ||'"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  Set lnI = lnI +1
.head 8 +  If (sSitCanton != 'P' and sSitCanton != '') or wbSituationZeroResult
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select  REC_CDT_TYPE,REC_CDT_NO, @nullvalue(REC_NB_VOIX,0), REC_CDT_FK
	from result_Cdt, listes 
	where RECL_LIS_FK=LIS_Id and reC_ele_ext = :sExtElec and REC_ENT_INS = :psIns and Lis_no = :lsNoListe 
	order by 1,2
 	into :lsTypeCdt, :lsNoCdt, :lnVoix, :lsCdtId " )
.head 9 +  While SqlFetchNext( lhSql2, Btmp )
.head 10 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","","","","","'|| lsCdtId ||'"'
.head 10 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 10 -  Set lnI = lnI +1
.head 9 -  Call SqlCommit( lhSql2)
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) from result_scrutin where RES_ELE_EXT = :sExtElec and RES_ENT_INS = :psIns
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)), sum(@nullvalue(RES_BDEP_TOT,1))   from result_scrutin where RES_ELE_EXT = :sExtElec and RES_ENT_INS = :psIns
	into :lnNbBurDep, :lnNbBurTot " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlCommit( lhSql)
.head 7 +  If (sExtElec = 'SE' or sExtElec = 'EU') and (SalStrLeftX( psIns, 2)= '21' or SalStrLeftX( psIns, 2)= '23') 
.head 8 -  Set lnNbCantonTot= lnNbCantonTot / 2
.head 8 -  Set lnNbCantonTraites= lnNbCantonTraites / 2
.head 8 -  Set lnNbBurTot= lnNbBurTot / 2
.head 8 -  Set lnNbBurDep = lnNbBurDep / 2
.head 8 -  ! Set lnNbCantonTraites= lnNbCantonTraites / 2
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitCanton ||'","'|| SalNumberToStrX( lnNbBurDep,0)   ||'","XXXX","'|| sDate ||'","'|| sHeure ||'","'|| SalNumberToStrX( lnNbBurTot,0) ||'","'|| SalNumberToStrX( lnNbCantonTraites,0)||'","'|| 
			SalNumberToStrX( lnNbCantonTot,0)|| '"'
.head 7 -  Set lsBuffer[0] = lsBuffer[0] ||',"'|| lsIdEntite || '"'
.head 7 -  !
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If sSitCanton = 'P' or sSitCanton = '' or wbSituationZeroResult
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select  RES_BDEP_TRAIT
	from result_scrutin
	where res_ele_ext = :sExtElec and RES_ENT_INS = :psIns 
 	into :lnNbBurTrait " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlCommit( lhSql)
.head 8 -  Set lsFichier = VisStrSubstitute( lsFichier , "_XXX", "_" || SalStrRightX( "000" || SalNumberToStrX( lnNbBurTrait, 0) ,3) )
.head 7 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  !
.head 8 -  Set lnJ = 0
.head 8 +  While lnJ < lnI
.head 9 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 9 -  Set lnJ = lnJ + 1
.head 8 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 -  !
.head 3 +  Function: PalEvolutionNivSup
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: sNivSup
.head 5 -  String: sWhereSuppl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsIns
.head 5 -  String: lsTmp2
.head 5 -  Number: lnIdEntite
.head 5 -  Sql Handle: lhSql
.head 5 -  Number: bExtrapolation
.head 5 -  String: sDate1
.head 5 -  String: sDate2
.head 5 -  String: sWhere
.head 5 -  Number: lnI
.head 5 -  Boolean: bContinue
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  !
.head 6 -  Set bExtrapolation = FALSE
.head 6 +  If cbMethodeStesud
.head 7 +  If sExtElec = 'EU' and (wbExtrapolElection[1] = TRUE or wbExtrapolElection[1]=NUMBER_Null)
.head 8 -  Set bExtrapolation = TRUE
.head 7 +  Else If sExtElec = 'CK' and (wbExtrapolElection[2] = TRUE or wbExtrapolElection[2]=NUMBER_Null)
.head 8 -  Set bExtrapolation = TRUE
.head 7 +  Else If sExtElec = 'SE' and (wbExtrapolElection[3] = TRUE or wbExtrapolElection[3]=NUMBER_Null)
.head 8 -  Set bExtrapolation = TRUE
.head 7 +  Else If sExtElec = 'WL' and (wbExtrapolElection[4] = TRUE or wbExtrapolElection[4]=NUMBER_Null)
.head 8 -  Set bExtrapolation = TRUE
.head 7 +  Else If sExtElec = 'VL' and (wbExtrapolElection[7] = TRUE or wbExtrapolElection[7]=NUMBER_Null)
.head 8 -  Set bExtrapolation = TRUE
.head 7 +  Else If sExtElec = 'BR' and (wbExtrapolElection[10] = TRUE or wbExtrapolElection[10]=NUMBER_Null)
.head 8 -  Set bExtrapolation = TRUE
.head 7 +  Else If sExtElec = 'DE' and (wbExtrapolElection[12] = TRUE or wbExtrapolElection[12]=NUMBER_Null)
.head 8 -  Set bExtrapolation = TRUE
.head 6 -  !
.head 6 +  If bExtrapolation
.head 7 -  Call PalEvolutionNivSup_VersEx_Stesud( sExtElec, sNivSup)
.head 6 +  Else
.head 7 -  Set sWhere = ''
.head 7 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Set sWhere = ''
.head 8 +  If sWhereSuppl != ''
.head 9 -  Set sWhere = " AND ENT_INS in (Select distinct ENT_INS_NIVSUPSUP  from entite where  @left(ENT_INS,1) IN "|| sWhereSuppl ||" and ent_ele_ext = :sExtElec and ent_niv_lettre = 'K') "
.head 7 +  Else
.head 8 +  If sWhereSuppl != ''
.head 9 -  Set sWhere = ' AND @left(ENT_INS,1) IN '|| sWhereSuppl
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select ent_ins, Ent_id
	from entite 
	where ent_ins is not null and ENT_NIV_LETTRE = :sNivSup AND ENT_ELE_EXT = :sExtElec "|| sWhere || "
	Order by 1
	into :lsIns, :lnIdEntite " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'
.head 9 -  Set lsTmp2 = 'C'
.head 8 +  Else If sExtElec = 'DE'
.head 9 -  Set lsTmp2 = 'G'
.head 8 +  Else If sExtElec = 'BR'
.head 9 -  Set lsTmp2 = 'R'
.head 8 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 9 -  Set lsTmp2 = 'L'
.head 8 -  !
.head 8 -  !
.head 8 -  ! VERIFICATION SI EXTRAPOLATION A FAIRE
.head 8 +  If cbMethodeStesud
.head 9 -  ! Si dépouillement > 75% - plus d'extrapolation
.head 9 -  Set bExtrapolation = PalVerifExtrapolationStesud( sExtElec,lsTmp2, SalNumberToStrX(lnIdEntite,0), lsIns)
.head 8 +  If bExtrapolation=1 and  cbMethodeStesud
.head 9 -  Call PalResultatListes_NivSup_MethodeStesud( sExtElec, lsIns, lnIdEntite )
.head 8 +  Else
.head 9 -  Call PalResultatListes_NivSup( sExtElec, lsIns, lnIdEntite )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  !
.head 6 -  ! Verification si on peut décocher Extrapol et Stesud pour toutes les élections
.head 6 +  If cbMethodeStesud =TRUE
.head 7 -  Set bContinue = FALSE
.head 7 -  Set lnI = 0
.head 7 +  While lnI <= 20
.head 8 +  If wbFormatRPourEL[lnI] = 1 and wbExtrapolElection[lnI] = 1
.head 9 -  Set bContinue = TRUE
.head 9 -  Break
.head 8 -  Set lnI = lnI +1
.head 7 +  If NOT bContinue 
.head 8 -  Set cbMethodeStesud = FALSE
.head 8 -  Call SalSendMsg( cbMethodeStesud, SAM_Click, 0,0 )
.head 8 -  ! Set cbExtrapolation = FALSE
.head 8 -  ! Call SalSendMsg( cbExtrapolation, SAM_Click, 0,0 )
.head 3 +  Function: PalResultatListes_NivSup
.head 4 -  Description: NivSup = Circ. pour la chambre, WL, VL
                Collège pour le sénat et Europe
	Region (G, R) pour DE, BR
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: psIns
.head 5 -  Number: nEntiteId
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBE_E5
.head 5 -  Number: lnVV_E5
.head 5 -  Number: lnVBN_E5
.head 5 -  Number: lnVV_E3E4
.head 5 -  String: lsIns
.head 5 -  String: lsIns2
.head 5 -  String: lsFichier
.head 5 -  String: lsFichierExtrapol
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  String: lsTmp2
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: nJ
.head 5 -  String: lsNoGrp
.head 5 -  String: lsNoListe
.head 5 -  Number: lnIdListe
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsCdtId
.head 5 -  String: sSitNivSup
.head 5 -  String: sSitCdtPartiel
.head 5 -  String: lsDateDeces
.head 5 -  Number: lnSC1
.head 5 -  Number: lnSC2
.head 5 -  Number: lnSC3
.head 5 -  Number: lnSC4
.head 5 -  Number: lnVoix
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnTri
.head 5 -  Number: nSommeCE
.head 5 -  Number: lnNbSiege
.head 5 -  Number: lnPremLnI
.head 5 -  Number: nDiv
.head 5 -  Number: nK
.head 5 -  Number: nRowEluEff
.head 5 -  Number: nRowEluSuppl
.head 5 -  Number: nResteSiege
.head 5 -  Number: lnIdEntite
.head 5 -  !
.head 5 -  Number: nCE[*]
.head 5 -  Number: nSC14[*]
.head 5 -  Number: nSC23[*]
.head 5 -  String: sAListeNo[*]
.head 5 -  Number: nASiege[*]
.head 5 -  Number: nAChiffreElig[*]
.head 5 -  Number: nPotEff[*]
.head 5 -  Number: nPotSuppl[*]
.head 5 -  String: sNoEluE
.head 5 -  String: sNoEluS
.head 5 -  String: sDevol
.head 5 -  String: sResteDevol
.head 5 -  Number: nFemmeElu
.head 5 -  Number: nHommeElu
.head 5 -  Number: lnNbCantonTot
.head 5 -  Number: lnNbCantonTraites 
.head 5 -  String: lsInsApp
.head 5 -  String: lsNiveauEntite
.head 5 -  String: lsNiveauEl
.head 5 -  Number: lnVoixTotListe
.head 5 -  Number: lnNbBurDepBxl
.head 5 -  Number: lnNbBurTotBxl
.head 5 -  Number: lnNbCantonTotBxl
.head 5 -  Number: lnNbCantonTraitesBxl 
.head 5 -  Number: lnNbCantonDef
.head 5 -  Number: lnNbCantonComplet
.head 5 -  String: lsRegLing
.head 5 -  Number: nSiegeListeObtenu
.head 5 -  Number: nEluParTranche[10]
.head 5 -  Number: nEluParTrancheM[10]
.head 5 -  Number: nEluParTrancheF[10]
.head 5 -  String: lsInsT
.head 5 -  Number: lnCeT
.head 5 -  Number: bExtrapolation
.head 5 -  Number: nCE_Interpole
.head 5 -  String: lsIdListe
.head 5 -  Number: nFacteur
.head 4 +  Actions
.head 5 -  Set lnNbBurDep = 0
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  Set sSitNivSup = ''
.head 6 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0) != 1 ) " )
.head 6 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
				LIS_ENT_FK = :nEntiteId  and @nullvalue(RES_SIT_DEP,0) != 1) " )
.head 6 +  If SqlFetchNext( lhSql, Btmp )
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
				LIS_ENT_FK = :nEntiteId  and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set sSitNivSup = 'P'
.head 7 +  Else
.head 8 -  Set sSitNivSup = ''
.head 6 +  Else
.head 7 -  Set sSitNivSup = 'D'
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  ! Edition des CDT dans le fichier 0 (Partiel)
.head 6 +  If sSitNivSup != 'D'
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0) = 1 ) " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
				LIS_ENT_FK = :nEntiteId  and @nullvalue(RES_SIT_DEP,0) = 1) " )
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set sSitCdtPartiel = '1'
.head 7 +  Else
.head 8 -  Set sSitCdtPartiel = '0'
.head 6 +  Else
.head 7 -  Set sSitCdtPartiel = '1'
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  !
.head 6 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'
.head 7 -  Set lsTmp2 = 'C'
.head 6 +  Else If sExtElec = 'DE'
.head 7 -  Set lsTmp2 = 'G'
.head 6 +  Else If sExtElec = 'BR'
.head 7 -  Set lsTmp2 = 'R'
.head 6 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 -  Set lsTmp2 = 'L'
.head 6 -  Set lsNiveauEl = lsTmp2
.head 6 +  If sSitNivSup = 'P' or sSitNivSup = ''
.head 7 -  ! Set sSitNivSup = 'P'
.head 7 -  Set lsFichier = "R0" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 +  Else
.head 7 -  Set lsFichier = "R1" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R0" || lsTmp2 || psIns ||"."|| sExtElec )
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R1" || lsTmp2 || psIns ||"."|| sExtElec )
.head 6 -  Set lsFichierExtrapol = wsPathResult ||"\\EX" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 -  Call VisFileDelete( lsFichierExtrapol )
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes S
.head 7 -  Set lnI = 1
.head 7 -  !
.head 7 -  Set lnBE_BBE1E2 = 0
.head 7 -  Set lnBNB_BBE1E2E5 = 0
.head 7 -  Set lnBE_E3E4 = 0
.head 7 -  Set lnBNB_E3E4 = 0
.head 7 -  Set lnBE_E5 = 0
.head 7 -  Set lnVV_E3E4 = 0
.head 7 -  !
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr 
	where BETR_EL = :sExtElec and BETR_Ins in (Select Ent_Ins from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' )
	into :lnBE_E5 " )
.head 8 -  ! Call SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'CK'
.head 9 +  If psIns = '21004' 
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select sum( @nullvalue(RES_NB_VV_E5,0)) ,sum( @nullvalue(RES_NB_VBN_E5,0) )
	from Result_scrutin 
	where res_ent_ins= '21999' and RES_ELE_EXT = :sExtElec
	into :lnVV_E5, :lnVBN_E5 " )
.head 10 -  Call SqlFetchNext( lhSql, Btmp )
.head 10 -  Set lnBE_E5= lnVV_E5+lnVBN_E5
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr 
	where BETR_EL = :sExtElec and BETR_Ins in (Select Ent_Ins from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' )
	into :lnBE_E5 " )
.head 10 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_BDEP_TOT,1)) 
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' )
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5, :lnNbBurDep " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 +  If psIns = '12025'
.head 9 +  If sExtElec = 'EU'
.head 10 -  Set lsIns2 = ' NOT IN (92094,63023) '
.head 9 +  Else
.head 10 -  Set lsIns2 = " != 92094 "
.head 8 +  Else If psIns =  '92094'
.head 9 +  If sExtElec = 'EU'
.head 10 -  Set lsIns2 = ' NOT IN (12025,63023) '
.head 9 +  Else
.head 10 -  Set lsIns2 = " != 12025 "
.head 8 +  Else If sExtElec = 'EU' and psIns = '63023'
.head 9 -  Set lsIns2 = '=63023'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0)),sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId )
			and RES_ELE_EXT= :sExtElec and RES_ENT_INS_SUP "|| lsIns2 ||"
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5, :lnNbBurDep" )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  !
.head 7 -  !
.head 7 +  If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_NB_VBN,0)) 
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins like '%999' )
	into :lnBE_E3E4, :lnBNB_E3E4 ")
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  !
.head 7 -  !
.head 7 +  If sExtElec = 'CK' 
.head 8 +  If psIns != '21004'
.head 9 -  Set lnBE_BBE1E2 = lnBE_BBE1E2  - lnBE_E5
.head 8 -  Set lnBE_E3E4 = lnBE_E3E4 - (lnVV_E5 + lnVBN_E5)
.head 8 -  Set lnBNB_E3E4 = lnBNB_E3E4 - lnVBN_E5
.head 8 -  Set lnBNB_BBE1E2E5 = lnBNB_BBE1E2E5 + lnVBN_E5
.head 7 +  Else If sExtElec = 'SE'  or sExtElec = 'EU'
.head 8 +  If psIns = '63023' and sExtElec = 'EU'
.head 9 -  ! On sait les déterminer
.head 9 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBNB_BBE1E2E5
.head 8 +  Else
.head 9 -  ! On NE sait PAS les déterminer
.head 9 -  Set lnBNB_BBE1E2E5 = NUMBER_Null
.head 9 -  Set lnBE_E3E4 = NUMBER_Null
.head 9 -  Set lnBNB_E3E4 = NUMBER_Null
.head 9 -  Set lnBE_E5 = NUMBER_Null
.head 7 -  !
.head 7 +  If wbSituationZeroResult
.head 8 -  Set lnBE_BBE1E2 = 0
.head 8 -  Set lnBNB_BBE1E2E5 = 0
.head 8 -  Set lnBE_E3E4 = 0
.head 8 -  Set lnBNB_E3E4 = 0
.head 8 -  Set lnBE_E5 = 0
.head 8 -  Set lnVV_E3E4 = 0
.head 7 -  !
.head 7 +  If lnBE_BBE1E2 < 0
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBE_E5
.head 8 -  Set lnBE_E5 = 0
.head 7 -  Set lsBuffer[lnI] = '"S","'|| SalNumberToStrX( lnBE_BBE1E2,0) ||'","'|| SalNumberToStrX( lnBNB_BBE1E2E5,0) ||'","' || SalNumberToStrX( lnBE_E3E4,0) ||'","' || SalNumberToStrX( lnBNB_E3E4,0) ||'","'
	|| SalNumberToStrX( lnBE_E5,0) ||'"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 7 -  ! Lignes L
.head 7 -  Set lnI = lnI+1
.head 7 -  Set lnNbCanDef = 0
.head 7 -  Set lnNbCanTot = 0
.head 7 -  Set nSommeCE = 0
.head 7 -  Set lsInsPrec = ''
.head 7 -  !
.head 7 +  If TRUE
.head 8 -  ! VERIFICATION SI EXTRAPOLATION A FAIRE
.head 8 -  ! Set bExtrapolation = -1
.head 8 +  ! If cbExtrapolation and NOT cbMethodeStesud
.head 9 -  Set bExtrapolation = PalVerifExtrapolation( sExtElec,lsNiveauEl, SalNumberToStrX(nEntiteId,0), psIns , nFacteur)
.head 8 -  !
.head 8 -  !
.head 8 -  Set nK = 0
.head 8 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' 
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  Else If sExtElec = 'BR'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, LIS_REGLING, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3
	order by 3 desc,2,1
 	into :lsNoListe, :lnIdEntite, :lsRegLing, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_Listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "Select LIS_NO, LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_Listes
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO, LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_Listes
	where REL_ELE_EXT = :sExtElec and REL_ENT_FK in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  While SqlFetchNext( lhSql, Btmp )
.head 9 +  If sExtElec = 'BR'
.head 10 +  If lsRegLing = 'NN'
.head 11 -  Set lnNbSiege = 17
.head 10 +  Else
.head 11 -  Set lnNbSiege = 72
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select ENT_NB_CDT_MAX from entite where ent_id = :lnIdEntite into :lnNbSiege " )
.head 11 -  Call SqlFetchNext( lhSql2 , Btmp )
.head 9 +  Else
.head 10 +  If nK = 0
.head 11 -  Set lnNbSiege = 0
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select ENT_NB_CDT_MAX from entite where ent_id = :lnIdEntite into :lnNbSiege " )
.head 11 -  Call SqlFetchNext( lhSql2 , Btmp )
.head 9 +  If bExtrapolation = 1
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_ID
	from listes, result_listes , groupe_Listes
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_NO = :lsNoListe and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :lnIdEntite and LIS_GRL_FK=GRL_ID
	into :lsIdListe " )
.head 10 +  If SqlFetchNext( lhSql2, Btmp )
.head 11 -  Set nCE_Interpole = PalDtmExtrapolation( sExtElec, lsNiveauEl, SalNumberToStrX(nEntiteId,0), psIns, lsIdListe ,  lnSC1 + lnSC2 + lnSC3 + lnSC4 )
.head 11 -  Set nCE[ nK ]  = nCE[ nK ] + nCE_Interpole
.head 10 +  Else
.head 11 -  Set nCE[ nK ]  = nCE[ nK ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 9 +  Else
.head 10 -  Set nCE[ nK ]  = nCE[ nK ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 9 -  Set nSC14[ nK ]  = nSC14[ nK ] + lnSC1  + lnSC4
.head 9 -  Set nSC23[ nK ]  = nSC23[ nK ] + lnSC2  + lnSC3
.head 9 -  Set sAListeNo[nK] = lsNoListe
.head 9 -  !
.head 9 -  Set nK = nK + 1
.head 8 -  !
.head 8 -  !
.head 8 -  Set sAListeNo[nK] = ""
.head 8 +  If lnNbSiege > 0 and nSommeCE > 0
.head 9 -  Set lsInsApp = ''
.head 9 +  If sExtElec = 'BR'
.head 10 -  Set lsInsApp= '21004'
.head 10 -  Set lsNiveauEntite = 'R'
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select Ent_GRP_App, Ent_Niv_Lettre from entite where
	Ent_id = :nEntiteId
	Into :lsInsApp, :lsNiveauEntite " )
.head 10 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 10 -  Call SqlCommit( ghSqlSecondaire)
.head 9 +  If lsInsApp != ''
.head 10 -  ! ! Verification si Groupe d'apparentement (lettre de groupement)
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select * from listes where lis_ele_ext = :sExtElec and lis_ent_fk = :nEntiteId and LIS_NOGROUPE is not null " )
.head 10 +  If NOT SqlFetchNext( ghSqlSecondaire, Btmp )
.head 11 -  Set lsInsApp = ''
.head 11 -  Set lsNiveauEntite = ''
.head 9 +  If lsInsApp != ''
.head 10 -  ! ! Verification si resultats dans TOUTES les circonscriptions composant le bureau d'apparentement
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select LIS_INSBUR, sum(@nullvalue(REL_SC1,0)+ @nullvalue(REL_SC2,0)+ @nullvalue(REL_SC3,0)+ @nullvalue(REL_SC4,0)) 
	from result_Listes, listes 
	where rel_ele_ext = :sExtElec  and lis_id = rel_lis_Fk and LIS_INSBURAPP = :lsInsApp
	group by 1
into :lsInsT, :lnCeT " )
.head 10 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 11 +  If lnCeT = 0
.head 12 -  Set lsInsApp = ''
.head 12 -  Set lsNiveauEntite = ''
.head 12 -  Break
.head 9 -  Call SqlCommit( ghSqlSecondaire)
.head 9 -  !
.head 9 +  ! If cbExtrapolation and bExtrapolation = 1
.head 10 -  Set lsInsApp = ''
.head 10 -  Set lsNiveauEntite = ''
.head 10 -  Set bExtrapolation = TRUE
.head 9 +  ! Else
.head 10 -  Set bExtrapolation = FALSE
.head 9 -  Set bExtrapolation = FALSE
.head 9 -  !
.head 9 +  If lsInsApp = ''
.head 10 -  Call PalDtmSiege( nSommeCE, lnNbSiege, nCE, sAListeNo , nASiege, sExtElec, nSC14, nSC23, psIns )
.head 9 +  Else
.head 10 +  If sExtElec = 'BR'
.head 11 -  Call tblApp_1.PalPopulateTbl_GrpBR( lsInsApp, psIns, lsNiveauEntite ,  sExtElec , nASiege, bExtrapolation)
.head 10 +  Else
.head 11 -  Call tblApp_1.PalPopulateTbl( lsInsApp, psIns, lsNiveauEntite ,  sExtElec  , nASiege, bExtrapolation)
.head 8 -  Call SqlPrepareAndExecute( lhSql2, "delete from RESULT_ELU_ROYAUME where ELU_ENTITE = :psIns and  ELU_Elect = :sExtElec ")
.head 8 -  Call SqlCommit( lhSql2 )
.head 7 -  !
.head 7 -  Set nK = 0
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK,Lis_id,Grl_Tri,sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe, :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK,Lis_id,Grl_Tri,LIS_REGLING, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4,5
	order by 5 desc, 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe, :lnTri ,:lsRegLing, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK, Lis_id, Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_Listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe , :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK, Lis_id, Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_Listes
	where REL_ELE_EXT = :sExtElec and REL_ENT_FK in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe , :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'BR'
.head 9 -  Set nSiegeListeObtenu = nASiege[lnIdListe]
.head 8 +  Else
.head 9 -  Set nSiegeListeObtenu = nASiege[nK]
.head 8 -  Set nAChiffreElig[nK] = SalNumberRound(nCE[nK] / (nSiegeListeObtenu+1) + 0.499999999)
.head 8 -  Set nPotEff[nK] = SalNumberRound(  (lnSC1+lnSC4)/2 + 0.499999999 )
.head 8 -  Set nPotSuppl[nK] = SalNumberRound(  (lnSC1+lnSC2)/2 + 0.499999999 )
.head 8 -  Call SqlPrepareAndExecute( lhSql2, "Insert into RESULT_ELU_ROYAUME ( ELU_Liste_ID,ELU_Liste_No,ELU_ListeGrp, ELU_ENTITE, ELU_SIEGES,ELU_Elect )
	values( :lnIdListe,:lsNoListe,:lsNoGrp,:psIns,:nSiegeListeObtenu,:sExtElec ) ")
.head 8 -  Call SqlCommit( lhSql2 )
.head 8 +  If wsDiffuseElus = '1'
.head 9 +  If nSiegeListeObtenu >0 and nSiegeListeObtenu != NUMBER_Null
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX(lnSC1,0) ||'","'|| SalNumberToStrX(lnSC2,0) ||'","'|| SalNumberToStrX(lnSC3,0) ||'","'|| SalNumberToStrX(lnSC4,0) ||'","'|| SalNumberToStrX(nAChiffreElig[nK],0) ||
	'","'|| SalNumberToStrX( nSiegeListeObtenu ,0) ||'","'|| lsNoGrp ||'"'
.head 9 +  Else
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","' ||
 	SalNumberToStrX( nSiegeListeObtenu ,0) ||'","'|| lsNoGrp ||'"'
.head 8 +  Else
.head 9 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","","'|| lsNoGrp ||'"'
.head 8 -  ! Histo Elu
.head 8 +  If gbSauveEluHisto
.head 9 -  Call PalMajHistoElus( wsEnveloppeR_Glob , sExtElec,  lsTmp2 || psIns ||"."|| sExtElec , SalStrToNumber( lsNoGrp ), lsNoListe, nSiegeListeObtenu, SalDateCurrent(  ) )
.head 8 -  !
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  !
.head 8 -  Set lnI = lnI +1
.head 8 +  If sSitCdtPartiel = '1' or wbSituationZeroResult or TRUE
.head 9 -  ! Vérification si au moins 1 vois sur 1 cdt pour désigantion des élus
.head 9 +  If sExtElec ='CK' or sExtElec ='WL'  or sExtElec = 'VL' or sExtElec = 'BR' or sExtElec = 'DE'
.head 10 -  Call SqlPrepareAndExecute(lhSql2, "Select sum(@nullvalue(REC_NB_VOIX,0))
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	into :lnVoixTotListe ")
.head 9 +  Else If sExtElec ='SE' or  sExtElec ='EU'
.head 10 -  Call SqlPrepareAndExecute (lhSql2, "Select sum(@nullvalue(REC_NB_VOIX,0))
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_ELE_EXT  = :sExtElec and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	into :lnVoixTotListe " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  !
.head 9 +  If lnVoixTotListe > 0 
.head 10 -  Call SalTblReset( tblCdt_E )
.head 10 -  Call SalTblReset( tblCdtSuppl_E )
.head 10 +  If sExtElec ='CK' or sExtElec ='WL'  or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 11 -  Call SalTblPopulate(tblCdt_E, lhSql2, "Select REC_CDT_NO, CDT_DATEDECES, CDT_SEXE, sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_ELE_EXT  = :sExtElec and recl_lis_fk=CDT_LIS_FK and REC_CDT_TYPE = 'E' and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = 
:sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdt_E.colNo,:tblCdt_E.colDateDeces, :tblCdt_E.colSexe , :tblCdt_E.colVoix , :tblCdt_E.colNN ", TBL_FillAll)
.head 11 -  Call SalTblPopulate( tblCdtSuppl_E, lhSql2, "Select REC_CDT_NO,CDT_DATEDECES,CDT_NOORDRETITULAIRE , sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_ELE_EXT  = :sExtElec and recl_lis_fk=CDT_LIS_FK and REC_CDT_TYPE = 'S' and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = 
:sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdtSuppl_E.colNo,:tblCdtSuppl_E.colDateDeces,:tblCdtSuppl_E.colNoEff, :tblCdtSuppl_E.colVoix, :tblCdtSuppl_E.colNN ", TBL_FillAll)
.head 10 +  Else If sExtElec ='SE' or  sExtElec ='EU'
.head 11 -  Call SalTblPopulate(tblCdt_E, lhSql2, "Select REC_CDT_NO,CDT_DATEDECES, CDT_SEXE, sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_ELE_EXT  = :sExtElec and REC_CDT_TYPE = 'E' and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdt_E.colNo,:tblCdt_E.colDateDeces, :tblCdt_E.colSexe , :tblCdt_E.colVoix, :tblCdt_E.colNN ", TBL_FillAll )
.head 11 -  Call SalTblPopulate(tblCdtSuppl_E, lhSql2, "Select REC_CDT_NO,CDT_DATEDECES, CDT_NOORDRETITULAIRE, sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_ELE_EXT  = :sExtElec and REC_CDT_TYPE = 'S' and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdtSuppl_E.colNo,:tblCdtSuppl_E.colDateDeces,:tblCdtSuppl_E.colNoEff , :tblCdtSuppl_E.colVoix, :tblCdtSuppl_E.colNN" , TBL_FillAll)
.head 10 -  !
.head 10 +  If nSiegeListeObtenu  > 0
.head 11 -  Call tblCdt_E.PalDtmCdtElu( nSiegeListeObtenu, nAChiffreElig[nK], nPotEff[nK], nPotSuppl[nK] , lnIdListe )
.head 9 -  !
.head 9 -  Set nRowEluEff = 0
.head 9 -  Set nRowEluSuppl = 0
.head 9 -  Set nFemmeElu = 0
.head 9 -  Set nHommeElu = 0
.head 9 -  Set nEluParTranche[0] = 0
.head 9 -  Set nEluParTranche[1] = 0
.head 9 -  Set nEluParTranche[2] = 0
.head 9 -  Set nEluParTranche[3] = 0
.head 9 -  Set nEluParTranche[4] = 0
.head 9 -  Set nEluParTrancheM[0] = 0
.head 9 -  Set nEluParTrancheM[1] = 0
.head 9 -  Set nEluParTrancheM[2] = 0
.head 9 -  Set nEluParTrancheM[3] = 0
.head 9 -  Set nEluParTrancheM[4] = 0
.head 9 -  Set nEluParTrancheF[0] = 0
.head 9 -  Set nEluParTrancheF[1] = 0
.head 9 -  Set nEluParTrancheF[2] = 0
.head 9 -  Set nEluParTrancheF[3] = 0
.head 9 -  Set nEluParTrancheF[4] = 0
.head 9 +  If sExtElec ='CK' or sExtElec ='WL'  or sExtElec = 'VL' or sExtElec = 'BR' or sExtElec = 'DE'
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select REC_CDT_TYPE,REC_CDT_NO, sum(@nullvalue(REC_NB_VOIX,0)), REC_CDT_FK
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_ELE_EXT  = :sExtElec and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,4
	order by 1,2
	into :lsTypeCdt, :lsNoCdt, :lnVoix, :lsCdtId ")
.head 9 +  Else If sExtElec ='SE' or sExtElec = 'EU'
.head 10 -  Call SqlPrepareAndExecute(lhSql2, "Select REC_CDT_TYPE,REC_CDT_NO, sum(@nullvalue(REC_NB_VOIX,0)), REC_CDT_FK
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_ELE_EXT  = :sExtElec and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,4
	order by 1,2
	into :lsTypeCdt, :lsNoCdt, :lnVoix, :lsCdtId" )
.head 9 +  While SqlFetchNext( lhSql2, Btmp )
.head 10 -  Set sDevol = ''
.head 10 -  Set sResteDevol = ''
.head 10 -  Set sNoEluE = ''
.head 10 -  Set sNoEluS = ''
.head 10 +  If nSiegeListeObtenu> 0 and  lnVoixTotListe > 0
.head 11 +  If lsTypeCdt = 'E'
.head 12 -  Call SalTblSetContext( tblCdt_E, nRowEluEff )
.head 12 -  Set sNoEluE = SalNumberToStrX( tblCdt_E.colNoElu, 0)
.head 12 +  If sNoEluE= '0'
.head 13 -  Set sNoEluE = ''
.head 12 +  If sNoEluE != '' 
.head 13 +  If tblCdt_E.colSexe = 'F'
.head 14 -  Set nFemmeElu = nFemmeElu+ 1
.head 13 +  Else If tblCdt_E.colSexe = 'M'
.head 14 -  Set nHommeElu = nHommeElu+ 1
.head 13 -  !
.head 13 -  Call PalDtmTrancheAgeElu( lsCdtId, nEluParTrancheM, nEluParTrancheF )
.head 13 -  !
.head 12 -  Set sDevol = SalNumberToStrX( tblCdt_E.colDevol , 0)
.head 12 -  Set sResteDevol = SalNumberToStrX( tblCdt_E.colRestPot , 0)
.head 12 -  !
.head 12 -  !
.head 12 -  Set nRowEluEff = nRowEluEff+1
.head 11 +  Else
.head 12 -  Call SalTblSetContext( tblCdtSuppl_E, nRowEluSuppl )
.head 12 -  Set sNoEluS = SalNumberToStrX( tblCdtSuppl_E.colNoElu, 0)
.head 12 +  If sNoEluS= '0'
.head 13 -  Set sNoEluS = ''
.head 12 -  Set sDevol = SalNumberToStrX( tblCdtSuppl_E.colDevol , 0)
.head 12 -  Set sResteDevol = SalNumberToStrX( tblCdtSuppl_E.colRestPot , 0)
.head 12 -  Set nRowEluSuppl = nRowEluSuppl + 1
.head 10 +  If wsDiffuseElus = '1' and nSiegeListeObtenu> 0 and lnVoixTotListe > 0
.head 11 +  If lsTypeCdt = 'S' and sNoEluS = ''
.head 12 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","","","'|| sNoEluE ||'","'|| sNoEluS ||'","'|| lsCdtId ||'"'
.head 11 +  Else
.head 12 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","'|| sDevol ||'","'|| sResteDevol ||'","'|| sNoEluE ||'","'|| sNoEluS ||'","'|| lsCdtId ||'"'
.head 10 +  Else
.head 11 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","","","","","'|| lsCdtId ||'"'
.head 10 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 10 -  Set lnI = lnI +1
.head 9 -  !
.head 9 +  If lnVoixTotListe > 0
.head 10 -  Set nEluParTranche[0] = nEluParTrancheM[0]  + nEluParTrancheF[0] 
.head 10 -  Set nEluParTranche[1] = nEluParTrancheM[1]  + nEluParTrancheF[1] 
.head 10 -  Set nEluParTranche[2] = nEluParTrancheM[2]  + nEluParTrancheF[2] 
.head 10 -  Set nEluParTranche[3] = nEluParTrancheM[3]  + nEluParTrancheF[3] 
.head 10 -  Set nEluParTranche[4] = nEluParTrancheM[4]  + nEluParTrancheF[4] 
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Update RESULT_ELU_ROYAUME
	Set ELU_Femme = :nFemmeElu , ELU_Homme = :nHommeElu, 
		ELU_1830 = :nEluParTranche[0], ELU_3140 = :nEluParTranche[1], ELU_4150 = :nEluParTranche[2],
		ELU_5160 = :nEluParTranche[3], ELU_60 = :nEluParTranche[4] ,
		ELU_M_1830 = :nEluParTrancheM[0], ELU_M_3140 = :nEluParTrancheM[1], ELU_M_4150 = :nEluParTrancheM[2],
		ELU_M_5160 = :nEluParTrancheM[3], ELU_M_60 = :nEluParTrancheM[4],
		ELU_F_1830 = :nEluParTrancheF[0], ELU_F_3140 = :nEluParTrancheF[1], ELU_F_4150 = :nEluParTrancheF[2],
		ELU_F_5160 = :nEluParTrancheF[3], ELU_F_60 = :nEluParTrancheF[4]
	Where ELU_Liste_ID = :lnIdListe and ELU_Liste_No =:lsNoListe and ELU_ENTITE =:psIns and ELU_Elect =:sExtElec ")
.head 10 -  Call SqlCommit( lhSql2 )
.head 8 -  !
.head 8 -  Set nK = nK + 1
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'  or sExtElec = 'BR' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from result_scrutin 
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)) ,sum(@nullvalue(RES_BDEP_TOT,1))  from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
	into :lnNbBurDep, :lnNbBurTot " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from result_scrutin 
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||" )
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 8 -  ! Call SqlFetchNext( lhSql, Btmp )
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)),sum(@nullvalue(RES_BDEP_TOT,1))   from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
	into :lnNbBurDep, :lnNbBurTot " )
.head 8 +  If psIns =  '92094'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from result_scrutin 
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and (ENT_DEP_LISTE like '%"|| psIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| psIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
into :lnNbCantonTot , :lnNbCantonTraites " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)),sum(@nullvalue(RES_BDEP_TOT,1))   from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and (ENT_DEP_LISTE "|| lsIns2 ||" or @left( RES_ENT_INS,2) in('21','23') )) 
	into :lnNbBurDep, :lnNbBurTot " )
.head 9 -  Call SqlPrepareAndExecute( lhSql,"Select sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
		, count(res_ent_fk)-sum( RES_SIT_DEP)
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and (ENT_DEP_LISTE like '%"|| psIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| psIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into  :lnNbBurDep, :lnNbBurTot  ")
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from result_scrutin 
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and ENT_DEP_LISTE like '%"|| psIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
into :lnNbCantonTot , :lnNbCantonTraites " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)),sum(@nullvalue(RES_BDEP_TOT,1))   from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
	into :lnNbBurDep, :lnNbBurTot " )
.head 9 -  Call SqlPrepareAndExecute( lhSql,"Select Sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and ENT_DEP_LISTE like '%"|| psIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into  :lnNbBurDep, :lnNbBurTot  " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  !
.head 7 -  ! Retrait des données en double de BHV
.head 7 +  If (sExtElec = 'SE' or sExtElec = 'EU')
.head 8 -  ! If psIns =  '92094'
.head 8 +  ! Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)/2, sum(@nullvalue(res_sit_dep,0))/2 
	from result_scrutin 
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||" ) and @left(Res_ent_ins,2) in ('21','23')  
	into :lnNbCantonTotBxl , :lnNbCantonTraitesBxl " ) 
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0))/2,sum(@nullvalue(RES_BDEP_TOT,1))/2   from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||" ) and @left(Res_ent_ins,2) in ('21','23') 
	into :lnNbBurDepBxl , :lnNbBurTotBxl " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Set lnNbCantonTot = lnNbCantonTot - lnNbCantonTotBxl
.head 9 -  Set lnNbCantonTraites = lnNbCantonTraites - lnNbCantonTraitesBxl
.head 9 -  Set lnNbBurDep = lnNbBurDep - lnNbBurDepBxl
.head 9 -  Set lnNbBurTot = lnNbBurTot - lnNbBurTotBxl
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnNbBurDep,0)   ||'","XXXX","'|| sDate ||'","'|| sHeure ||'","'|| SalNumberToStrX( lnNbBurTot,0) ||'","'|| SalNumberToStrX( lnNbCantonTraites,0)||'","'|| 
			SalNumberToStrX( lnNbCantonTot,0)|| '"'
.head 7 -  Set lsBuffer[0] = lsBuffer[0] ||',"'|| SalNumberToStrX( nEntiteId,0)|| '"'
.head 7 -  !
.head 7 -  Set lnNbCantonDef = 0
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'  or sExtElec = 'BR' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and RES_T_DEP = 'D' )
	into  :lnNbCantonDef " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
		  and RES_T_DEP = 'D'
	into  :lnNbCantonDef " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  If lnNbCantonDef = NUMBER_Null
.head 8 -  Set lnNbCantonDef = 0
.head 7 -  Set lnNbCantonComplet = 0
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'  or sExtElec = 'BR' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and RES_T_DEP in ('C','D') )
	into  :lnNbCantonComplet " )
.head 7 +  Else If sExtElec = 'SE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
				LIS_ENT_FK = :nEntiteId  and RES_T_DEP in ('C','D') ) 
	into  :lnNbCantonComplet " )
.head 7 +  Else If sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
		  and RES_T_DEP in ('C','D') 
	into  :lnNbCantonComplet " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  If lnNbCantonComplet = NUMBER_Null
.head 8 -  Set lnNbCantonComplet = 0
.head 7 -  !
.head 7 -  Call PalMajHistoGraphiqueEvolution( sExtElec, psIns, nEntiteId, lsTmp2,  lnNbBurDep, lnNbBurTot, lnNbCantonTraites, lnNbCantonTot, lnNbCantonComplet, lnNbCantonDef )
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  !
.head 8 -  Set lnJ = 0
.head 8 +  While lnJ < lnI
.head 9 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 9 -  Set lnJ = lnJ + 1
.head 8 -  Call SalFileClose( lhFileRER )
.head 7 -  !
.head 7 +  If bExtrapolation = 1
.head 8 +  If SalFileOpen( lhFileRER, lsFichierExtrapol ,  OF_Create | OF_ReadWrite | OF_Text )
.head 9 -  !
.head 9 -  Call SalFilePutStr( lhFileRER, "Méthode IBM" )
.head 9 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 +  Function: PalResultatListes_NivSup_MethodeStesud
.head 4 -  Description: NivSup = Circ. pour la chambre, WL, VL
                Collège pour le sénat et Europe
	Region (G, R) pour DE, BR
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: psIns
.head 5 -  Number: nEntiteId
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBE_E5
.head 5 -  Number: lnVV_E5
.head 5 -  Number: lnVBN_E5
.head 5 -  Number: lnVV_E3E4
.head 5 -  Number: lnIdGroupe
.head 5 -  Number: lnIdGroupeOld
.head 5 -  String: lsIns
.head 5 -  String: lsIns2
.head 5 -  String: lsFichier
.head 5 -  String: lsFichierExtrapol
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  String: lsTmp2
.head 5 -  String: lsDiffuseEluElection
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: nJ
.head 5 -  String: lsNoGrp
.head 5 -  String: lsNoListe
.head 5 -  Number: lnIdListe
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsCdtId
.head 5 -  String: sSitNivSup
.head 5 -  String: sSitCdtPartiel
.head 5 -  String: lsDateDeces
.head 5 -  Number: lnSC1
.head 5 -  Number: lnSC2
.head 5 -  Number: lnSC3
.head 5 -  Number: lnSC4
.head 5 -  Number: lnVoix
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnTri
.head 5 -  Number: nSommeCE
.head 5 -  Number: nSommeCE2
.head 5 -  Number: lnNbSiege
.head 5 -  Number: lnPremLnI
.head 5 -  Number: nDiv
.head 5 -  Number: nK
.head 5 -  Number: nK2
.head 5 -  Number: nRowEluEff
.head 5 -  Number: nRowEluSuppl
.head 5 -  Number: nResteSiege
.head 5 -  Number: lnIdEntite
.head 5 -  Boolean: lbBHV_canton
.head 5 -  !
.head 5 -  Number: nCE_CalcBxl
.head 5 -  Number: nCE[*]
.head 5 -  Number: nCE_interpol[*]
.head 5 -  Number: nCE_interpol2[*]
.head 5 -  Number: nCE_interpol_Calc[*]
.head 5 -  Number: nCE_interpol_Calc2[*]
.head 5 -  Number: nCE_New[*]
.head 5 -  Number: nSC14[*]
.head 5 -  Number: nSC23[*]
.head 5 -  String: sAListeNo[*]
.head 5 -  String: sAListeId[*]
.head 5 -  Number: nASiege[*]
.head 5 -  Number: nAChiffreElig[*]
.head 5 -  Number: nPotEff[*]
.head 5 -  Number: nPotSuppl[*]
.head 5 -  String: sNoEluE
.head 5 -  String: sNoEluS
.head 5 -  String: sDevol
.head 5 -  String: sResteDevol
.head 5 -  Number: nFemmeElu
.head 5 -  Number: nHommeElu
.head 5 -  Number: lnNbCantonTot
.head 5 -  Number: lnNbCantonTraites
.head 5 -  String: lsInsApp
.head 5 -  String: lsNiveauEntite
.head 5 -  String: lsNiveauEl
.head 5 -  Number: lnVoixTotListe
.head 5 -  Number: lnNbBurDepBxl
.head 5 -  Number: lnNbBurTotBxl
.head 5 -  Number: lnNbCantonTotBxl
.head 5 -  Number: lnNbCantonTraitesBxl
.head 5 -  Number: lnNbCantonDef
.head 5 -  Number: lnNbCantonComplet
.head 5 -  String: lsRegLing
.head 5 -  Number: nSiegeListeObtenu
.head 5 -  Number: nEluParTranche[10]
.head 5 -  Number: nEluParTrancheM[10]
.head 5 -  Number: nEluParTrancheF[10]
.head 5 -  String: lsInsT
.head 5 -  Number: lnCeT
.head 5 -  Number: bExtrapolation
.head 5 -  Number: nCE_Interpole
.head 5 -  String: lsIdListe
.head 5 -  Number: nFacteur
.head 5 -  Number: nSommeCE_H
.head 5 -  Number: nSommeCE_H2
.head 5 -  Number: nSommeCE_H_Calc
.head 5 -  Number: nCE_Liste_Calc
.head 5 -  Number: nSommeCE_H_Calc2
.head 5 -  Number: nCE_Liste_Calc2
.head 5 -  String: lsSitDep
.head 5 -  Number: lnBurDep
.head 5 -  Number: lnBurTot
.head 5 -  Number: nProjection[*]
.head 5 -  Number: nSommeProjection
.head 5 -  Number: nSommeCE_New
.head 5 -  Number: nInscrit_21
.head 5 -  Number: nInscrit_23
.head 5 -  Number: nBurDep_21
.head 5 -  Number: nBurDep_23
.head 4 +  Actions
.head 5 -  Set lnNbBurDep = 0
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  Set sSitNivSup = ''
.head 6 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0) != 1 ) " )
.head 6 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and
				LIS_ENT_FK = :nEntiteId  and @nullvalue(RES_SIT_DEP,0) != 1) " )
.head 6 +  If SqlFetchNext( lhSql, Btmp )
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and
				LIS_ENT_FK = :nEntiteId  and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set sSitNivSup = 'P'
.head 7 +  Else
.head 8 -  Set sSitNivSup = ''
.head 6 +  Else
.head 7 -  Set sSitNivSup = 'D'
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  !
.head 6 -  ! Pour la chambre à BHV : vérification si au moins un canton sur BXL et HV
.head 6 +  If sExtElec = 'CK' and psIns = '21004' 
.head 7 -  Set lsDiffuseEluElection = wsDiffuseElus
.head 7 -  Set lbBHV_canton = FALSE
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where res_ent_ins like '21%' and Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set lbBHV_canton = TRUE
.head 7 -  Call SqlCommit( lhSql)
.head 7 +  If lbBHV_canton
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where res_ent_ins like '23%' and Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 8 +  If SqlFetchNext( lhSql, Btmp )
.head 9 -  Set lbBHV_canton = TRUE
.head 8 +  Else
.head 9 -  Set lbBHV_canton = FALSE
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  !
.head 7 +  If NOT lbBHV_canton
.head 8 -  Set wsDiffuseElus = '0'
.head 6 -  !
.head 6 -  ! Edition des CDT dans le fichier 0 (Partiel)
.head 6 +  If sSitNivSup != 'D'
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0) = 1 ) " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and
				LIS_ENT_FK = :nEntiteId  and @nullvalue(RES_SIT_DEP,0) = 1) " )
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set sSitCdtPartiel = '1'
.head 7 +  Else
.head 8 -  Set sSitCdtPartiel = '0'
.head 6 +  Else
.head 7 -  Set sSitCdtPartiel = '1'
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  !
.head 6 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'
.head 7 -  Set lsTmp2 = 'C'
.head 6 +  Else If sExtElec = 'DE'
.head 7 -  Set lsTmp2 = 'G'
.head 6 +  Else If sExtElec = 'BR'
.head 7 -  Set lsTmp2 = 'R'
.head 6 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 -  Set lsTmp2 = 'L'
.head 6 -  Set lsNiveauEl = lsTmp2
.head 6 +  If sSitNivSup = 'P' or sSitNivSup = ''
.head 7 -  ! Set sSitNivSup = 'P'
.head 7 -  Set lsFichier = "R0" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 +  Else
.head 7 -  Set lsFichier = "R1" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R0" || lsTmp2 || psIns ||"."|| sExtElec )
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R1" || lsTmp2 || psIns ||"."|| sExtElec )
.head 6 -  Set lsFichierExtrapol = wsPathResult ||"\\EX" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 -  Call VisFileDelete( lsFichierExtrapol )
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes S
.head 7 -  Set lnI = 1
.head 7 -  !
.head 7 -  Set lnBE_BBE1E2 = 0
.head 7 -  Set lnBNB_BBE1E2E5 = 0
.head 7 -  Set lnBE_E3E4 = 0
.head 7 -  Set lnBNB_E3E4 = 0
.head 7 -  Set lnBE_E5 = 0
.head 7 -  Set lnVV_E3E4 = 0
.head 7 -  !
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr
	where BETR_EL = :sExtElec and BETR_Ins in (Select Ent_Ins from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' )
	into :lnBE_E5 " )
.head 8 -  ! Call SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'CK'
.head 9 +  If psIns = '21004'
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select sum( @nullvalue(RES_NB_VV_E5,0)) ,sum( @nullvalue(RES_NB_VBN_E5,0) )
	from Result_scrutin
	where res_ent_ins= '21999' and RES_ELE_EXT = :sExtElec
	into :lnVV_E5, :lnVBN_E5 " )
.head 10 -  Call SqlFetchNext( lhSql, Btmp )
.head 10 -  Set lnBE_E5= lnVV_E5+lnVBN_E5
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr
	where BETR_EL = :sExtElec and BETR_Ins in (Select Ent_Ins from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' )
	into :lnBE_E5 " )
.head 10 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' )
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5, :lnNbBurDep " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 +  If psIns = '12025'
.head 9 +  If sExtElec = 'EU'
.head 10 -  Set lsIns2 = ' NOT IN (92094,63023) '
.head 9 +  Else
.head 10 -  Set lsIns2 = " != 92094 "
.head 8 +  Else If psIns =  '92094'
.head 9 +  If sExtElec = 'EU'
.head 10 -  Set lsIns2 = ' NOT IN (12025,63023) '
.head 9 +  Else
.head 10 -  Set lsIns2 = " != 12025 "
.head 8 +  Else If sExtElec = 'EU' and psIns = '63023'
.head 9 -  Set lsIns2 = '=63023'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0)),sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId )
			and RES_ELE_EXT= :sExtElec and RES_ENT_INS_SUP "|| lsIns2 ||"
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5, :lnNbBurDep" )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  !
.head 7 -  !
.head 7 +  If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins like '%999' )
	into :lnBE_E3E4, :lnBNB_E3E4 ")
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  !
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  !
.head 7 +  If sExtElec = 'CK'
.head 8 +  If psIns != '21004'
.head 9 -  Set lnBE_BBE1E2 = lnBE_BBE1E2  - lnBE_E5
.head 8 -  Set lnBE_E3E4 = lnBE_E3E4 - (lnVV_E5 + lnVBN_E5)
.head 8 -  Set lnBNB_E3E4 = lnBNB_E3E4 - lnVBN_E5
.head 8 -  Set lnBNB_BBE1E2E5 = lnBNB_BBE1E2E5 + lnVBN_E5
.head 7 +  Else If sExtElec = 'SE'  or sExtElec = 'EU'
.head 8 +  If psIns = '63023' and sExtElec = 'EU'
.head 9 -  ! On sait les déterminer
.head 9 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBNB_BBE1E2E5
.head 8 +  Else
.head 9 -  ! On NE sait PAS les déterminer
.head 9 -  Set lnBNB_BBE1E2E5 = NUMBER_Null
.head 9 -  Set lnBE_E3E4 = NUMBER_Null
.head 9 -  Set lnBNB_E3E4 = NUMBER_Null
.head 9 -  Set lnBE_E5 = NUMBER_Null
.head 7 -  !
.head 7 +  If wbSituationZeroResult
.head 8 -  Set lnBE_BBE1E2 = 0
.head 8 -  Set lnBNB_BBE1E2E5 = 0
.head 8 -  Set lnBE_E3E4 = 0
.head 8 -  Set lnBNB_E3E4 = 0
.head 8 -  Set lnBE_E5 = 0
.head 8 -  Set lnVV_E3E4 = 0
.head 7 -  !
.head 7 +  If lnBE_BBE1E2 < 0
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBE_E5
.head 8 -  Set lnBE_E5 = 0
.head 7 -  Set lsBuffer[lnI] = '"S","'|| SalNumberToStrX( lnBE_BBE1E2,0) ||'","'|| SalNumberToStrX( lnBNB_BBE1E2E5,0) ||'","' || SalNumberToStrX( lnBE_E3E4,0) ||'","' || SalNumberToStrX( lnBNB_E3E4,0) ||'","'
	|| SalNumberToStrX( lnBE_E5,0) ||'"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 7 -  ! Lignes L
.head 7 -  Set lnI = lnI+1
.head 7 -  Set lnNbCanDef = 0
.head 7 -  Set lnNbCanTot = 0
.head 7 -  Set nSommeCE = 0
.head 7 -  Set lsInsPrec = ''
.head 7 -  !
.head 7 -  ! EXTRAPOLATION A FAIRE
.head 7 -  Set bExtrapolation = 1
.head 7 -  !
.head 7 -  !
.head 7 -  Set nK = 0
.head 7 +  If sExtElec = 'CK' and psIns = '21004'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select (sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)))/2
	from listes, result_listes , groupe_listes
	where rel_ent_ins like '21%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec  and lis_Ele_Ext = 'CK'
 	into :nSommeCE " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, sum(@nullvalue(REL_SC1,0))/2,sum(@nullvalue(REL_SC2,0))/2,sum(@nullvalue(REL_SC3,0))/2,sum(@nullvalue(REL_SC4,0))/2
	from listes, result_listes , groupe_listes
	where rel_ent_ins like '21%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
		and GRL_EL  = :sExtElec  and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
		and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
		and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, LIS_REGLING, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
	group by 1,2,3
	order by 3 desc,2,1
 	into :lsNoListe, :lnIdEntite, :lsRegLing, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_Listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE " )
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_Listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
			
 	into :nSommeCE " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO, LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_Listes
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select LIS_NO, LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_Listes
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
			
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 -  ! Selection du groupe de la liste
.head 8 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_GRL_FK  from listes where lis_ent_FK = :lnIdEntite and lis_no = :lsNoListe
	into :lnIdGroupe " )
.head 8 -  Call SqlFetchNext( lhSql2, Btmp )
.head 8 -  !
.head 8 +  If sExtElec = 'BR'
.head 9 +  If lsRegLing = 'NN'
.head 10 -  Set lnNbSiege = 17
.head 9 +  Else
.head 10 -  Set lnNbSiege = 72
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select ENT_NB_CDT_MAX from entite where ent_id = :lnIdEntite into :lnNbSiege " )
.head 10 -  Call SqlFetchNext( lhSql2 , Btmp )
.head 8 +  Else
.head 9 +  If nK = 0
.head 10 -  Set lnNbSiege = 0
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select ENT_NB_CDT_MAX from entite where ent_id = :lnIdEntite into :lnNbSiege " )
.head 10 -  Call SqlFetchNext( lhSql2 , Btmp )
.head 8 -  Call SqlCommit( lhSql2)
.head 8 -  Set nCE[ nK ]  = nCE[ nK ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 8 -  Set nSC14[ nK ]  = nSC14[ nK ] + lnSC1  + lnSC4
.head 8 -  Set nSC23[ nK ]  = nSC23[ nK ] + lnSC2  + lnSC3
.head 8 -  Set sAListeNo[nK] = lsNoListe
.head 8 -  Set sAListeId[nK] = SalNumberToStrX( lnIdGroupe, 0 )
.head 8 -  !
.head 8 -  Set nCE_interpol[ lnIdGroupe ] = 0
.head 8 -  Set nCE_interpol_Calc[ lnIdGroupe ] = 0
.head 8 -  Set nCE_interpol2[ lnIdGroupe ] = 0
.head 8 -  Set nCE_interpol_Calc2[ lnIdGroupe ] = 0
.head 8 -  !
.head 8 -  Set nK = nK + 1
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  Set sAListeNo[nK] = ""
.head 7 -  !
.head 7 +  If bExtrapolation = 1
.head 8 -  Set nSommeCE_H_Calc = 0
.head 8 +  If sExtElec = 'CK'  and psIns = '21004'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select (sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)))/2
	from LIS_H,  RESLIS_H, Grp_Old
	where rel_ent_ins like '21%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO	
			and GRP_EL = :sExtElec  and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE_H " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select Grp_no,REL_ENT_INS , sum(@nullvalue(REL_SC1,0))/2,sum(@nullvalue(REL_SC2,0))/2,sum(@nullvalue(REL_SC3,0))/2,sum(@nullvalue(REL_SC4,0))/2
	from  LIS_H,  RESLIS_H, Grp_Old
	where rel_ent_ins like '21%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO 
			and GRP_EL = :sExtElec  and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lsInsT, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  Else If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from LIS_H,  RESLIS_H, Grp_Old
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO
			and GRP_EL = :sExtElec  and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE_H " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select Grp_no,REL_ENT_INS , sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from  LIS_H,  RESLIS_H, Grp_Old
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO
			and GRP_EL = :sExtElec and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lsInsT, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 -  Else If sExtElec = 'BR'
.head 8 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from LIS_H,  RESLIS_H, Grp_Old
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRP_NO
		and GRP_EL = :sExtElec   and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE_H " )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from LIS_H,  RESLIS_H, Grp_Old
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRP_NO
		
 	into :nSommeCE_H " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select Grp_NO, REL_ENT_INS, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from LIS_H,  RESLIS_H, Grp_Old
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRP_NO
		and GRP_EL = :sExtElec   and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lsInsT , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "Select Grp_NO, REL_ENT_INS, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from LIS_H,  RESLIS_H, Grp_Old
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRP_NO
		
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lsInsT , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  While SqlFetchNext( lhSql, Btmp )
.head 9 -  ! Selection du groupe de la liste
.head 9 -  Set nCE_Liste_Calc = 0
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select GRP_NO from grp_corresp where GRP_NOOLD = :lsNoListe
	into :lnIdGroupe " )
.head 9 +  If SqlFetchNext( lhSql2, Btmp )
.head 10 -  Set nCE_interpol[ lnIdGroupe ] = nCE_interpol[ lnIdGroupe ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 9 +  Else
.head 10 -  Set lnIdGroupe = -1
.head 9 -  Call SqlCommit( lhSql2)
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select  RES_SIT_DEP,RES_BDEP_TOT,@nullvalue(RES_BDEP_TRAIT,0)
	from result_Scrutin
	where RES_ENT_INS = :lsInsT and RES_ELE_EXT = :sExtElec
	into :lsSitDep,:lnBurTot, :lnBurDep " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  Call SqlCommit( lhSql2)
.head 9 +  If lnBurTot > 0 and lnBurTot != NUMBER_Null
.head 10 -  Set nCE_Liste_Calc = SalNumberRound(  (lnSC1 + lnSC2 + lnSC3 + lnSC4) *lnBurDep/ lnBurTot )
.head 10 +  If lnIdGroupe != -1
.head 11 -  Set nCE_interpol_Calc[ lnIdGroupe ] = nCE_interpol_Calc[ lnIdGroupe ] + nCE_Liste_Calc
.head 9 -  Set nSommeCE_H_Calc = nSommeCE_H_Calc + nCE_Liste_Calc
.head 9 -  !
.head 8 -  Call SqlCommit( lhSql)
.head 8 -  !
.head 8 -  Set nK2 = 100
.head 8 +  If sExtElec = 'CK' and psIns = '21004' and wsDiffuseElus = '1'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(ENT_INSCRITS_BB,0)+@nullvalue(ENT_INSCRITS_E1_E2,0)+@nullvalue(ENT_INSCRITS_E3_E4,0)+@nullvalue(ENT_INSCRITS_E5,0) )
	from entite 
	where @left(Ent_ins,2)= '21' and ENT_INS_NIVSUP= '21004' and ENT_ELE_EXT = 'CK' and ENT_NIV_LETTRE ='K' 
 	into :nInscrit_21 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(ENT_INSCRITS_BB,0)+@nullvalue(ENT_INSCRITS_E1_E2,0)+@nullvalue(ENT_INSCRITS_E3_E4,0)+@nullvalue(ENT_INSCRITS_E5,0) ) 
	from entite 
	where @left(Ent_ins,2)= '23' and ENT_INS_NIVSUP= '21004' and ENT_ELE_EXT = 'CK' and ENT_NIV_LETTRE ='K' 
 	into :nInscrit_23 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select (sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)))/2
	from listes, result_listes , groupe_listes
	where rel_ent_ins like '23%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE2 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, sum(@nullvalue(REL_SC1,0))/2,sum(@nullvalue(REL_SC2,0))/2,sum(@nullvalue(REL_SC3,0))/2,sum(@nullvalue(REL_SC4,0))/2
	from listes, result_listes , groupe_listes
	where rel_ent_ins like '23%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
		and GRL_EL  = :sExtElec  and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 9 +  While SqlFetchNext( lhSql, Btmp )
.head 10 -  ! Selection du groupe de la liste
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_GRL_FK  from listes where lis_ent_FK = :lnIdEntite and lis_no = :lsNoListe
	into :lnIdGroupe " )
.head 10 -  Call SqlFetchNext( lhSql2, Btmp )
.head 10 -  Call SqlCommit( lhSql2)
.head 10 -  !
.head 10 +  If nK2 = 100
.head 11 -  Set lnNbSiege = 0
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select ENT_NB_CDT_MAX from entite where ent_id = :lnIdEntite into :lnNbSiege " )
.head 11 -  Call SqlFetchNext( lhSql2 , Btmp )
.head 11 -  Call SqlCommit( lhSql2)
.head 10 -  Set nCE[ nK2 ]  = nCE[ nK2 ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 10 -  Set nSC14[ nK2 ]  = nSC14[ nK2 ] + lnSC1  + lnSC4
.head 10 -  Set nSC23[ nK2 ]  = nSC23[ nK2 ] + lnSC2  + lnSC3
.head 10 -  Set sAListeNo[nK2] = lsNoListe
.head 10 -  Set sAListeId[nK2] = SalNumberToStrX( lnIdGroupe, 0 )
.head 10 -  !
.head 10 -  Set nK2 = nK2 + 1
.head 9 -  Set sAListeNo[nK2] = ""
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  !
.head 9 +  If bExtrapolation =1
.head 10 +  If sExtElec = 'CK'  and psIns = '21004'
.head 11 -  Set nSommeCE_H_Calc2 = 0
.head 11 -  Call SqlPrepareAndExecute( lhSql, "Select (sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)))/2
	from LIS_H,  RESLIS_H, Grp_Old
	where rel_ent_ins like '23%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO
			and GRP_EL = :sExtElec and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE_H2 " )
.head 11 -  Call SqlFetchNext( lhSql, Btmp )
.head 11 -  Call SqlCommit( lhSql)
.head 11 -  Call SqlPrepareAndExecute( lhSql, "Select Grp_no,REL_ENT_INS , sum(@nullvalue(REL_SC1,0))/2,sum(@nullvalue(REL_SC2,0))/2,sum(@nullvalue(REL_SC3,0))/2,sum(@nullvalue(REL_SC4,0))/2
	from  LIS_H,  RESLIS_H, Grp_Old
	where rel_ent_ins like '23%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO
			and GRP_EL = :sExtElec and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lsInsT, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 11 +  While SqlFetchNext( lhSql, Btmp )
.head 12 -  ! Selection du groupe de la liste
.head 12 -  Set nCE_Liste_Calc2 = 0
.head 12 -  Call SqlPrepareAndExecute( lhSql2, "Select GRP_NO from grp_corresp where GRP_NOOLD = :lsNoListe
	into :lnIdGroupe " )
.head 12 +  If SqlFetchNext( lhSql2, Btmp )
.head 13 -  Set nCE_interpol2[ lnIdGroupe ] = nCE_interpol2[ lnIdGroupe ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 12 +  Else
.head 13 -  Set lnIdGroupe = -1
.head 12 -  Call SqlCommit( lhSql2)
.head 12 -  Call SqlPrepareAndExecute( lhSql2, "Select  RES_SIT_DEP,RES_BDEP_TOT,@nullvalue(RES_BDEP_TRAIT,0)
	from result_Scrutin
	where RES_ENT_INS = :lsInsT and RES_ELE_EXT = :sExtElec
	into :lsSitDep,:lnBurTot, :lnBurDep " )
.head 12 -  Call SqlFetchNext( lhSql2, Btmp )
.head 12 -  Call SqlCommit( lhSql2)
.head 12 +  If lnBurTot > 0 and lnBurTot != NUMBER_Null
.head 13 -  Set nCE_Liste_Calc2 = SalNumberRound(  (lnSC1 + lnSC2 + lnSC3 + lnSC4) *lnBurDep/ lnBurTot )
.head 13 +  If lnIdGroupe != -1
.head 14 -  Set nCE_interpol_Calc2[ lnIdGroupe ] = nCE_interpol_Calc2[ lnIdGroupe ] + nCE_Liste_Calc2
.head 12 -  !
.head 12 -  Set nSommeCE_H_Calc2 = nSommeCE_H_Calc2 + nCE_Liste_Calc
.head 12 -  !
.head 11 -  Call SqlCommit( lhSql)
.head 9 -  !
.head 9 -  ! Call SqlPrepareAndExecute( lhSql2, "Select  sum(@nullvalue(RES_BDEP_TRAIT,0))
	from result_Scrutin
	where @left(RES_ENT_INS,2) = '21' and RES_ELE_EXT = :sExtElec
	into :nBurDep_21 " )
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select  sum(@decode( @nullvalue(ent_typeVote,''), '', @nullvalue(RES_BDEP_TRAIT,0),@nullvalue(RES_BDEP_TRAIT,0)/2.5) )
	from result_Scrutin, entite
	where @left(RES_ENT_INS,2) = '21' and RES_ELE_EXT = :sExtElec  and RES_ENT_INS=ENT_INS and Ent_niv_Lettre = 'K' and ENT_ELE_Ext = RES_ELE_EXT
	into :nBurDep_21 " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  Call SqlCommit( lhSql2)
.head 9 -  ! Call SqlPrepareAndExecute( lhSql2, "Select  sum(@nullvalue(RES_BDEP_TRAIT,0))
	from result_Scrutin
	where @left(RES_ENT_INS,2) = '23' and RES_ELE_EXT = :sExtElec
	into :nBurDep_23 " )
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select  sum(@decode( @nullvalue(ent_typeVote,''), '', @nullvalue(RES_BDEP_TRAIT,0),@nullvalue(RES_BDEP_TRAIT,0)/2.5) )
	from result_Scrutin, entite
	where @left(RES_ENT_INS,2) = '23' and RES_ELE_EXT = :sExtElec  and RES_ENT_INS=ENT_INS and Ent_niv_Lettre = 'K' and ENT_ELE_Ext = RES_ELE_EXT
	into :nBurDep_23 " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  Call SqlCommit( lhSql2)
.head 9 -  Set nK = 0
.head 9 -  Set nSommeCE_H_Calc=0
.head 9 +  While sAListeNo[nK] != ''
.head 10 -  Set lnIdGroupe = SalStrToNumber( sAListeId[nK] )
.head 10 -  !
.head 10 -  Set nSommeCE_H = nSommeCE_H + nSommeCE_H2
.head 10 -  Set nSommeCE = nSommeCE + nSommeCE2
.head 10 -  Set nCE[ nK]  = nCE[ nK ] + nCE[ nK+100 ]
.head 10 -  Set nSC14[ nK ]  = nSC14[ nK ] +  nSC14[ nK+100 ]
.head 10 -  Set nSC23[ nK ]  = nSC23[ nK ] + nSC23[ nK+100 ] 
.head 10 -  !
.head 10 -  ! Set nCE_interpol_Calc[ lnIdGroupe ] = SalNumberRound( ( nCE_interpol_Calc[ lnIdGroupe ] *nInscrit_21 / (nInscrit_21+ nInscrit_23) / nBurDep_21 * 50 + 
		nCE_interpol_Calc2[ lnIdGroupe ] *nInscrit_23 / (nInscrit_21+ nInscrit_23) / nBurDep_23 * 50 ) / 2)
.head 10 -  Set nCE_CalcBxl = SalNumberRound( ( nCE_interpol_Calc[ lnIdGroupe ] *nInscrit_21 / (nInscrit_21+ nInscrit_23) / nBurDep_21 *10 + 
		nCE_interpol_Calc2[ lnIdGroupe ] *nInscrit_23 / (nInscrit_21+ nInscrit_23) / nBurDep_23 * 10 ) )
.head 10 -  Set nSommeCE_H_Calc = nSommeCE_H_Calc + nCE_CalcBxl
.head 10 -  Set nCE_interpol_Calc[ lnIdGroupe ] = nCE_CalcBxl
.head 10 -  !
.head 10 -  Set nK = nK + 1
.head 8 -  !
.head 8 -  ! Dtm de la projection
.head 8 -  Set nSommeProjection = 0
.head 8 -  Set nK = 0
.head 8 +  While sAListeNo[nK] != ''
.head 9 -  Set lnIdGroupe = SalStrToNumber( sAListeId[nK] )
.head 9 -  !
.head 9 +  ! If sExtElec = 'CK'  and psIns = '21004'
.head 10 -  Set nProjection[ nK ] =  nCE_interpol_Calc[lnIdGroupe]
.head 9 +  ! Else
.head 10 +  If nSommeCE_H > 0 and nSommeCE > 0 and nSommeCE_H_Calc > 0
.head 11 -  Set nProjection[ nK ] =  ( (nCE_interpol[lnIdGroupe] / nSommeCE_H)*100) + ( (( nCE[nK] / nSommeCE ) - (nCE_interpol_Calc[lnIdGroupe]/nSommeCE_H_Calc) ) * 100 )
.head 10 +  Else 
.head 11 -  Set nProjection[ nK ] = 0
.head 9 +  If nSommeCE_H > 0 and nSommeCE > 0 and nSommeCE_H_Calc > 0
.head 10 -  Set nProjection[ nK ] =  SalNumberAbs( ( (nCE_interpol[lnIdGroupe] / nSommeCE_H)*100) + ( (( nCE[nK] / nSommeCE ) - (nCE_interpol_Calc[lnIdGroupe]/nSommeCE_H_Calc) ) * 100 ) )
.head 9 +  Else
.head 10 -  Set nProjection[ nK ] = 0
.head 9 -  Set nSommeProjection =  nSommeProjection + nProjection[ nK ]
.head 9 -  !
.head 9 -  Set nK = nK + 1
.head 8 -  ! remise du total sur 100 + Calcul à partir de la somme des CE courants
.head 8 -  Set nK = 0
.head 8 -  Set nSommeCE_New = 0
.head 8 +  While sAListeNo[nK] != ''
.head 9 +  If nSommeProjection > 0
.head 10 -  Set nCE_New[nK] = SalNumberRound( (nProjection[ nK ] / nSommeProjection ) * nSommeCE )
.head 9 +  Else
.head 10 -  Set nCE_New[nK] = 0
.head 9 -  !
.head 9 -  Set nSommeCE_New = nSommeCE_New + nCE_New[nK]
.head 9 -  Set nK = nK + 1
.head 7 -  !
.head 7 -  Set sAListeNo[nK] = ""
.head 7 +  If lnNbSiege > 0 and nSommeCE > 0
.head 8 -  Set lsInsApp = ''
.head 8 +  If sExtElec = 'BR'
.head 9 -  Set lsInsApp= '21004'
.head 9 -  Set lsNiveauEntite = 'R'
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select Ent_GRP_App, Ent_Niv_Lettre from entite where
	Ent_id = :nEntiteId
	Into :lsInsApp, :lsNiveauEntite " )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 9 -  Call SqlCommit( ghSqlSecondaire)
.head 8 +  If lsInsApp != ''
.head 9 -  ! ! Verification si Groupe d'apparentement (lettre de groupement)
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select * from listes where lis_ele_ext = :sExtElec and lis_ent_fk = :nEntiteId and LIS_NOGROUPE is not null " )
.head 9 +  If NOT SqlFetchNext( ghSqlSecondaire, Btmp )
.head 10 -  Set lsInsApp = ''
.head 10 -  Set lsNiveauEntite = ''
.head 8 +  If lsInsApp != ''
.head 9 -  ! ! Verification si resultats dans TOUTES les circonscriptions composant le bureau d'apparentement
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select LIS_INSBUR, sum(@nullvalue(REL_SC1,0)+ @nullvalue(REL_SC2,0)+ @nullvalue(REL_SC3,0)+ @nullvalue(REL_SC4,0))
	from result_Listes, listes
	where rel_ele_ext = :sExtElec  and lis_id = rel_lis_Fk and LIS_INSBURAPP = :lsInsApp
	group by 1
into :lsInsT, :lnCeT " )
.head 9 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 10 +  If lnCeT = 0
.head 11 -  Set lsInsApp = ''
.head 11 -  Set lsNiveauEntite = ''
.head 11 -  Break
.head 9 -  Call SqlCommit( ghSqlSecondaire)
.head 9 -  ! ! Verification si CK et BHV - on peut apparenter les 3 entités avec chiffres représentatifs de l'entite (TEST sur wsDiffuseElusCK_BHV)
.head 9 +  If sExtElec = 'CK' and lsInsApp = '21004' 
.head 10 +  If wsDiffuseElusCK_BHV != '1'
.head 11 -  Set lsInsApp = ''
.head 11 -  Set lsNiveauEntite = ''
.head 8 -  Call SqlCommit( ghSqlSecondaire)
.head 8 -  !
.head 8 +  If bExtrapolation = 1
.head 9 -  Set lsInsApp = ''
.head 9 -  Set lsNiveauEntite = ''
.head 9 -  Set bExtrapolation = TRUE
.head 8 +  Else
.head 9 -  Set bExtrapolation = FALSE
.head 8 -  !
.head 8 +  If lsInsApp = ''
.head 9 +  If bExtrapolation = 1
.head 10 -  Call PalDtmSiege( nSommeCE_New, lnNbSiege, nCE_New, sAListeNo , nASiege, sExtElec, nSC14, nSC23, psIns )
.head 9 +  Else
.head 10 -  Call PalDtmSiege( nSommeCE, lnNbSiege, nCE, sAListeNo , nASiege, sExtElec, nSC14, nSC23, psIns )
.head 8 +  Else
.head 9 +  If sExtElec = 'BR'
.head 10 -  Call tblApp_1.PalPopulateTbl_GrpBR( lsInsApp, psIns, lsNiveauEntite ,  sExtElec , nASiege, bExtrapolation)
.head 9 +  Else
.head 10 -  Call tblApp_1.PalPopulateTbl( lsInsApp, psIns, lsNiveauEntite ,  sExtElec  , nASiege, bExtrapolation)
.head 7 -  Call SqlPrepareAndExecute( lhSql2, "delete from RESULT_ELU_ROYAUME where ELU_ENTITE = :psIns and  ELU_Elect = :sExtElec ")
.head 7 -  Call SqlCommit( lhSql2 )
.head 7 -  !
.head 7 -  Set nK = 0
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK,Lis_id,Grl_Tri,sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe, :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK,Lis_id,Grl_Tri,LIS_REGLING, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4,5
	order by 5 desc, 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe, :lnTri ,:lsRegLing, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK, Lis_id, Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_Listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe , :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'BR'
.head 9 -  Set nSiegeListeObtenu = nASiege[lnIdListe]
.head 8 +  Else
.head 9 -  Set nSiegeListeObtenu = nASiege[nK]
.head 8 -  Set nAChiffreElig[nK] = SalNumberRound(nCE[nK] / (nSiegeListeObtenu+1) + 0.499999999)
.head 8 -  Set nPotEff[nK] = SalNumberRound(  (lnSC1+lnSC4)/2 + 0.499999999 )
.head 8 -  Set nPotSuppl[nK] = SalNumberRound(  (lnSC1+lnSC2)/2 + 0.499999999 )
.head 8 -  Call SqlPrepareAndExecute( lhSql2, "Insert into RESULT_ELU_ROYAUME ( ELU_Liste_ID,ELU_Liste_No,ELU_ListeGrp, ELU_ENTITE, ELU_SIEGES,ELU_Elect )
	values( :lnIdListe,:lsNoListe,:lsNoGrp,:psIns,:nSiegeListeObtenu,:sExtElec ) ")
.head 8 -  Call SqlCommit( lhSql2 )
.head 8 +  If wsDiffuseElus != '1' 
.head 9 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","","'|| lsNoGrp ||'"'
.head 8 +  Else If (sExtElec = 'CK' and ( psIns = '21004' or  psIns = '24062' or  psIns = '25072' ) and wsDiffuseElusCK_BHV != '1')
.head 9 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","","'|| lsNoGrp ||'"'
.head 8 +  Else
.head 9 +  If nSiegeListeObtenu >0 and nSiegeListeObtenu != NUMBER_Null
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX(lnSC1,0) ||'","'|| SalNumberToStrX(lnSC2,0) ||'","'|| SalNumberToStrX(lnSC3,0) ||'","'|| SalNumberToStrX(lnSC4,0) ||'","'|| SalNumberToStrX(nAChiffreElig[nK],0) ||
	'","'|| SalNumberToStrX( nSiegeListeObtenu ,0) ||'","'|| lsNoGrp ||'"'
.head 9 +  Else
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","' ||
 	SalNumberToStrX( nSiegeListeObtenu ,0) ||'","'|| lsNoGrp ||'"'
.head 8 -  ! Histo Elu
.head 8 +  If gbSauveEluHisto
.head 9 -  Call PalMajHistoElus( wsEnveloppeR_Glob , sExtElec,  lsTmp2 || psIns ||"."|| sExtElec , SalStrToNumber( lsNoGrp ), lsNoListe, nSiegeListeObtenu, SalDateCurrent(  ) )
.head 8 -  !
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  !
.head 8 -  Set lnI = lnI +1
.head 8 +  If sSitCdtPartiel = '1' or wbSituationZeroResult or TRUE
.head 9 -  ! Vérification si au moins 1 vois sur 1 cdt pour désigantion des élus
.head 9 +  If sExtElec ='CK' or sExtElec ='WL'  or sExtElec = 'VL' or sExtElec = 'BR' or sExtElec = 'DE'
.head 10 -  Call SqlPrepareAndExecute(lhSql2, "Select sum(@nullvalue(REC_NB_VOIX,0))
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	into :lnVoixTotListe ")
.head 9 +  Else If sExtElec ='SE' or  sExtElec ='EU'
.head 10 -  Call SqlPrepareAndExecute (lhSql2, "Select sum(@nullvalue(REC_NB_VOIX,0))
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	into :lnVoixTotListe " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  !
.head 9 +  If lnVoixTotListe > 0
.head 10 -  Call SalTblReset( tblCdt_E )
.head 10 -  Call SalTblReset( tblCdtSuppl_E )
.head 10 +  If sExtElec ='CK' or sExtElec ='WL'  or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 11 -  Call SalTblPopulate(tblCdt_E, lhSql2, "Select REC_CDT_NO, CDT_DATEDECES, CDT_SEXE, sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and REC_CDT_TYPE = 'E' and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdt_E.colNo,:tblCdt_E.colDateDeces, :tblCdt_E.colSexe , :tblCdt_E.colVoix , :tblCdt_E.colNN ", TBL_FillAll)
.head 11 -  Call SalTblPopulate( tblCdtSuppl_E, lhSql2, "Select REC_CDT_NO,CDT_DATEDECES,CDT_NOORDRETITULAIRE , sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and REC_CDT_TYPE = 'S' and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdtSuppl_E.colNo,:tblCdtSuppl_E.colDateDeces,:tblCdtSuppl_E.colNoEff, :tblCdtSuppl_E.colVoix, :tblCdtSuppl_E.colNN ", TBL_FillAll)
.head 10 +  Else If sExtElec ='SE' or  sExtElec ='EU'
.head 11 -  Call SalTblPopulate(tblCdt_E, lhSql2, "Select REC_CDT_NO,CDT_DATEDECES, CDT_SEXE, sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_CDT_TYPE = 'E' and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdt_E.colNo,:tblCdt_E.colDateDeces, :tblCdt_E.colSexe , :tblCdt_E.colVoix, :tblCdt_E.colNN ", TBL_FillAll )
.head 11 -  Call SalTblPopulate(tblCdtSuppl_E, lhSql2, "Select REC_CDT_NO,CDT_DATEDECES, CDT_NOORDRETITULAIRE, sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_CDT_TYPE = 'S' and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdtSuppl_E.colNo,:tblCdtSuppl_E.colDateDeces,:tblCdtSuppl_E.colNoEff , :tblCdtSuppl_E.colVoix, :tblCdtSuppl_E.colNN" , TBL_FillAll)
.head 10 -  !
.head 10 +  If nSiegeListeObtenu  > 0
.head 11 -  Call tblCdt_E.PalDtmCdtElu( nSiegeListeObtenu, nAChiffreElig[nK], nPotEff[nK], nPotSuppl[nK] , lnIdListe )
.head 9 -  !
.head 9 -  Set nRowEluEff = 0
.head 9 -  Set nRowEluSuppl = 0
.head 9 -  Set nFemmeElu = 0
.head 9 -  Set nHommeElu = 0
.head 9 -  Set nEluParTranche[0] = 0
.head 9 -  Set nEluParTranche[1] = 0
.head 9 -  Set nEluParTranche[2] = 0
.head 9 -  Set nEluParTranche[3] = 0
.head 9 -  Set nEluParTranche[4] = 0
.head 9 -  Set nEluParTrancheM[0] = 0
.head 9 -  Set nEluParTrancheM[1] = 0
.head 9 -  Set nEluParTrancheM[2] = 0
.head 9 -  Set nEluParTrancheM[3] = 0
.head 9 -  Set nEluParTrancheM[4] = 0
.head 9 -  Set nEluParTrancheF[0] = 0
.head 9 -  Set nEluParTrancheF[1] = 0
.head 9 -  Set nEluParTrancheF[2] = 0
.head 9 -  Set nEluParTrancheF[3] = 0
.head 9 -  Set nEluParTrancheF[4] = 0
.head 9 +  If sExtElec ='CK' or sExtElec ='WL'  or sExtElec = 'VL' or sExtElec = 'BR' or sExtElec = 'DE'
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select REC_CDT_TYPE,REC_CDT_NO, sum(@nullvalue(REC_NB_VOIX,0)), REC_CDT_FK
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,4
	order by 1,2
	into :lsTypeCdt, :lsNoCdt, :lnVoix, :lsCdtId ")
.head 9 +  Else If sExtElec ='SE' or sExtElec = 'EU'
.head 10 -  Call SqlPrepareAndExecute(lhSql2, "Select REC_CDT_TYPE,REC_CDT_NO, sum(@nullvalue(REC_NB_VOIX,0)), REC_CDT_FK
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,4
	order by 1,2
	into :lsTypeCdt, :lsNoCdt, :lnVoix, :lsCdtId" )
.head 9 +  While SqlFetchNext( lhSql2, Btmp )
.head 10 -  Set sDevol = ''
.head 10 -  Set sResteDevol = ''
.head 10 -  Set sNoEluE = ''
.head 10 -  Set sNoEluS = ''
.head 10 +  If nSiegeListeObtenu> 0 and  lnVoixTotListe > 0
.head 11 +  If lsTypeCdt = 'E'
.head 12 -  Call SalTblSetContext( tblCdt_E, nRowEluEff )
.head 12 -  Set sNoEluE = SalNumberToStrX( tblCdt_E.colNoElu, 0)
.head 12 +  If sNoEluE= '0'
.head 13 -  Set sNoEluE = ''
.head 12 +  If sNoEluE != ''
.head 13 +  If tblCdt_E.colSexe = 'F'
.head 14 -  Set nFemmeElu = nFemmeElu+ 1
.head 13 +  Else If tblCdt_E.colSexe = 'M'
.head 14 -  Set nHommeElu = nHommeElu+ 1
.head 13 -  !
.head 13 -  Call PalDtmTrancheAgeElu( lsCdtId, nEluParTrancheM, nEluParTrancheF )
.head 13 -  !
.head 12 -  Set sDevol = SalNumberToStrX( tblCdt_E.colDevol , 0)
.head 12 -  Set sResteDevol = SalNumberToStrX( tblCdt_E.colRestPot , 0)
.head 12 -  !
.head 12 -  !
.head 12 -  Set nRowEluEff = nRowEluEff+1
.head 11 +  Else
.head 12 -  Call SalTblSetContext( tblCdtSuppl_E, nRowEluSuppl )
.head 12 -  Set sNoEluS = SalNumberToStrX( tblCdtSuppl_E.colNoElu, 0)
.head 12 +  If sNoEluS= '0'
.head 13 -  Set sNoEluS = ''
.head 12 -  Set sDevol = SalNumberToStrX( tblCdtSuppl_E.colDevol , 0)
.head 12 -  Set sResteDevol = SalNumberToStrX( tblCdtSuppl_E.colRestPot , 0)
.head 12 -  Set nRowEluSuppl = nRowEluSuppl + 1
.head 10 +  If wsDiffuseElus = '1' and nSiegeListeObtenu> 0 and lnVoixTotListe > 0
.head 11 +  If lsTypeCdt = 'S' and sNoEluS = ''
.head 12 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","","","'|| sNoEluE ||'","'|| sNoEluS ||'","'|| lsCdtId ||'"'
.head 11 +  Else
.head 12 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","'|| sDevol ||'","'|| sResteDevol ||'","'|| sNoEluE ||'","'|| sNoEluS ||'","'|| lsCdtId ||'"'
.head 10 +  Else
.head 11 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","","","","","'|| lsCdtId ||'"'
.head 10 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 10 -  Set lnI = lnI +1
.head 9 -  !
.head 9 +  If lnVoixTotListe > 0
.head 10 -  Set nEluParTranche[0] = nEluParTrancheM[0]  + nEluParTrancheF[0]
.head 10 -  Set nEluParTranche[1] = nEluParTrancheM[1]  + nEluParTrancheF[1]
.head 10 -  Set nEluParTranche[2] = nEluParTrancheM[2]  + nEluParTrancheF[2]
.head 10 -  Set nEluParTranche[3] = nEluParTrancheM[3]  + nEluParTrancheF[3]
.head 10 -  Set nEluParTranche[4] = nEluParTrancheM[4]  + nEluParTrancheF[4]
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Update RESULT_ELU_ROYAUME
	Set ELU_Femme = :nFemmeElu , ELU_Homme = :nHommeElu,
		ELU_1830 = :nEluParTranche[0], ELU_3140 = :nEluParTranche[1], ELU_4150 = :nEluParTranche[2],
		ELU_5160 = :nEluParTranche[3], ELU_60 = :nEluParTranche[4] ,
		ELU_M_1830 = :nEluParTrancheM[0], ELU_M_3140 = :nEluParTrancheM[1], ELU_M_4150 = :nEluParTrancheM[2],
		ELU_M_5160 = :nEluParTrancheM[3], ELU_M_60 = :nEluParTrancheM[4],
		ELU_F_1830 = :nEluParTrancheF[0], ELU_F_3140 = :nEluParTrancheF[1], ELU_F_4150 = :nEluParTrancheF[2],
		ELU_F_5160 = :nEluParTrancheF[3], ELU_F_60 = :nEluParTrancheF[4]
	Where ELU_Liste_ID = :lnIdListe and ELU_Liste_No =:lsNoListe and ELU_ENTITE =:psIns and ELU_Elect =:sExtElec ")
.head 10 -  Call SqlCommit( lhSql2 )
.head 8 -  !
.head 8 -  Set nK = nK + 1
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'  or sExtElec = 'BR' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0))
	from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)) ,sum(@nullvalue(RES_BDEP_TOT,1))  from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
	into :lnNbBurDep, :lnNbBurTot " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0))
	from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||" )
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 8 -  ! Call SqlFetchNext( lhSql, Btmp )
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)),sum(@nullvalue(RES_BDEP_TOT,1))   from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
	into :lnNbBurDep, :lnNbBurTot " )
.head 8 +  If psIns =  '92094'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0))
	from result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and (ENT_DEP_LISTE like '%"|| psIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| psIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
into :lnNbCantonTot , :lnNbCantonTraites " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)),sum(@nullvalue(RES_BDEP_TOT,1))   from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and (ENT_DEP_LISTE "|| lsIns2 ||" or @left( RES_ENT_INS,2) in('21','23') ))
	into :lnNbBurDep, :lnNbBurTot " )
.head 9 -  Call SqlPrepareAndExecute( lhSql,"Select sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
		, count(res_ent_fk)-sum( RES_SIT_DEP)
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and (ENT_DEP_LISTE like '%"|| psIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| psIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into  :lnNbBurDep, :lnNbBurTot  ")
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0))
	from result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and ENT_DEP_LISTE like '%"|| psIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
into :lnNbCantonTot , :lnNbCantonTraites " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)),sum(@nullvalue(RES_BDEP_TOT,1))   from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
	into :lnNbBurDep, :lnNbBurTot " )
.head 9 -  Call SqlPrepareAndExecute( lhSql,"Select Sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and ENT_DEP_LISTE like '%"|| psIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into  :lnNbBurDep, :lnNbBurTot  " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  !
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnNbBurDep,0)   ||'","XXXX","'|| sDate ||'","'|| sHeure ||'","'|| SalNumberToStrX( lnNbBurTot,0) ||'","'|| SalNumberToStrX( lnNbCantonTraites,0)||'","'||
			SalNumberToStrX( lnNbCantonTot,0)|| '"'
.head 7 -  Set lsBuffer[0] = lsBuffer[0] ||',"'|| SalNumberToStrX( nEntiteId,0)|| '"'
.head 7 -  !
.head 7 -  Set lnNbCantonDef = 0
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'  or sExtElec = 'BR' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and RES_T_DEP = 'D' )
	into  :lnNbCantonDef " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
		  and RES_T_DEP = 'D'
	into  :lnNbCantonDef " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  If lnNbCantonDef = NUMBER_Null
.head 8 -  Set lnNbCantonDef = 0
.head 7 -  Set lnNbCantonComplet = 0
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'  or sExtElec = 'BR' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and RES_T_DEP in ('C','D') )
	into  :lnNbCantonComplet " )
.head 7 +  Else If sExtElec = 'SE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and
				LIS_ENT_FK = :nEntiteId  and RES_T_DEP in ('C','D') )
	into  :lnNbCantonComplet " )
.head 7 +  Else If sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
		  and RES_T_DEP in ('C','D')
	into  :lnNbCantonComplet " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlCommit( lhSql)
.head 7 +  If lnNbCantonComplet = NUMBER_Null
.head 8 -  Set lnNbCantonComplet = 0
.head 7 -  !
.head 7 -  Call PalMajHistoGraphiqueEvolution( sExtElec, psIns, nEntiteId, lsTmp2,  lnNbBurDep, lnNbBurTot, lnNbCantonTraites, lnNbCantonTot, lnNbCantonComplet, lnNbCantonDef )
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  !
.head 8 -  Set lnJ = 0
.head 8 +  While lnJ < lnI
.head 9 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 9 -  Set lnJ = lnJ + 1
.head 8 -  Call SalFileClose( lhFileRER )
.head 7 -  !
.head 7 +  If bExtrapolation = 1
.head 8 +  If SalFileOpen( lhFileRER, lsFichierExtrapol ,  OF_Create | OF_ReadWrite | OF_Text )
.head 9 -  !
.head 9 -  Call SalFilePutStr( lhFileRER, "Méthode STESUD" )
.head 9 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 6 +  If sExtElec = 'CK' and psIns = '21004'
.head 7 -  Set wsDiffuseElus = lsDiffuseEluElection
.head 3 -  !
.head 3 +  Function: PalEvolutionNivSup_VersEx_Stesud
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: sNivSup
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsIns
.head 5 -  String: lsTmp2
.head 5 -  Number: lnIdEntite
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: bExtrapolation
.head 5 -  String: sDate1
.head 5 -  String: sDate2
.head 5 -  String: sWhere
.head 5 -  String: lsFichierExtrapol
.head 5 -  Number: bExtrapolationElection
.head 4 +  Actions
.head 5 -  Set bExtrapolationElection = FALSE
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  !
.head 6 -  Call SqlCommit( lhSql2 )
.head 6 -  Call SqlPrepareAndExecute( lhSql2, "Delete from result_listes_"|| sExtElec ||"_ex
	where REL_ELE_EXT = :sExtElec " )
.head 6 -  Call SqlCommit( lhSql2 )
.head 6 -  Call SqlPrepareAndExecute( lhSql2, "Insert into 
	result_listes_"|| sExtElec ||"_Ex (REL_LIS_FK,REL_ENT_FK,REL_ELE_FK,REL_LIS_NO,REL_ENT_INS,REL_ELE_EXT,REL_NIV_FK,REL_NIV_LETTRE,REL_SC1,REL_SC2,REL_SC3,REL_SC4,REL_CHECK_SUM )
	select REL_LIS_FK,REL_ENT_FK,REL_ELE_FK,REL_LIS_NO,REL_ENT_INS,REL_ELE_EXT,REL_NIV_FK,REL_NIV_LETTRE,REL_SC1,REL_SC2,REL_SC3,REL_SC4,REL_CHECK_SUM 
		from result_listes , Listes
		where REL_ELE_EXT = :sExtElec and LIS_ID = Rel_Lis_FK and (( REL_SC1 is not null and REL_SC2 is not null and REL_SC3 is not null and REL_SC4 is not null) or LIS_INSBUR = REL_ENT_INS) " )
.head 6 -  Call SqlCommit( lhSql2 )
.head 6 -  ! Call SqlPrepareAndExecute( lhSql2, "Update statistics on table result_listes_ex " )
.head 6 -  ! Call SqlCommit( lhSql2 )
.head 6 -  !
.head 6 -  Call SqlPrepareAndExecute( lhSql, "Select ent_ins, Ent_id
	from entite 
	where ent_ins is not null and ENT_NIV_LETTRE = :sNivSup AND ENT_ELE_EXT = :sExtElec
	Order by 1
	into :lsIns, :lnIdEntite " )
.head 6 +  While SqlFetchNext( lhSql, Btmp )
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'
.head 8 -  Set lsTmp2 = 'C'
.head 7 +  Else If sExtElec = 'DE'
.head 8 -  Set lsTmp2 = 'G'
.head 7 +  Else If sExtElec = 'BR'
.head 8 -  Set lsTmp2 = 'R'
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Set lsTmp2 = 'L'
.head 7 -  !
.head 7 -  Set lsFichierExtrapol = wsPathResult ||"\\EX" || lsTmp2 || lsIns ||"."|| sExtElec
.head 7 -  Call VisFileDelete( lsFichierExtrapol )
.head 7 -  ! Si dépouillement > 90% - plus d'extrapolation
.head 7 -  Set bExtrapolation = PalVerifExtrapolationStesud( sExtElec,lsTmp2, SalNumberToStrX(lnIdEntite,0), lsIns)
.head 7 -  !
.head 7 +  If bExtrapolation = 1
.head 8 -  Call PalExtrapol_ResultatListes_NivSup_MethodeStesud( sExtElec, lsIns, lnIdEntite )
.head 8 -  Set bExtrapolationElection = TRUE
.head 7 -  !
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  !
.head 6 -  Call SqlPrepareAndExecute( lhSql, "Select ent_ins, Ent_id
	from entite 
	where ent_ins is not null and ENT_NIV_LETTRE = :sNivSup AND ENT_ELE_EXT = :sExtElec 
	Order by 1
	into :lsIns, :lnIdEntite " )
.head 6 +  While SqlFetchNext( lhSql, Btmp )
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'
.head 8 -  Set lsTmp2 = 'C'
.head 7 +  Else If sExtElec = 'DE'
.head 8 -  Set lsTmp2 = 'G'
.head 7 +  Else If sExtElec = 'BR'
.head 8 -  Set lsTmp2 = 'R'
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Set lsTmp2 = 'L'
.head 7 -  !
.head 7 -  Call PalResultatListes_NivSup_Ex( sExtElec, lsIns, lnIdEntite, bExtrapolationElection )
.head 7 -  !
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 6 -  !
.head 6 -  ! Extrapolation par élections
.head 6 +  If sExtElec = 'EU'
.head 7 -  Set wbExtrapolElection[1] = bExtrapolationElection
.head 6 +  Else If sExtElec = 'CK' 
.head 7 -  Set wbExtrapolElection[2] = bExtrapolationElection
.head 6 +  Else If sExtElec = 'SE'
.head 7 -  Set wbExtrapolElection[3] = bExtrapolationElection
.head 6 +  Else If sExtElec = 'WL'
.head 7 -  Set bExtrapolation = TRUE
.head 7 -  Set wbExtrapolElection[4] = bExtrapolationElection
.head 6 +  Else If sExtElec = 'VL'
.head 7 -  Set wbExtrapolElection[7] = bExtrapolationElection
.head 6 +  Else If sExtElec = 'BR'
.head 7 -  Set wbExtrapolElection[10] = bExtrapolationElection
.head 6 +  Else If sExtElec = 'DE'
.head 7 -  Set wbExtrapolElection[12] = bExtrapolationElection
.head 3 +  Function: PalExtrapol_ResultatListes_NivSup_MethodeStesud
.head 4 -  Description: NivSup = Circ. pour la chambre, WL, VL
                Collège pour le sénat et Europe
	Region (G, R) pour DE, BR
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: psIns
.head 5 -  Number: nEntiteId
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBE_E5
.head 5 -  Number: lnVV_E5
.head 5 -  Number: lnVBN_E5
.head 5 -  Number: lnVV_E3E4
.head 5 -  Number: lnIdGroupe
.head 5 -  Number: lnIdGroupeOld
.head 5 -  String: lsIns
.head 5 -  String: lsIns2
.head 5 -  String: lsFichier
.head 5 -  String: lsFichierExtrapol
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  String: lsTmp2
.head 5 -  String: lsDiffuseEluElection
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: nJ
.head 5 -  String: lsNoGrp
.head 5 -  String: lsNoListe
.head 5 -  Number: lnIdListe
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsCdtId
.head 5 -  String: sSitNivSup
.head 5 -  String: sSitCdtPartiel
.head 5 -  String: lsDateDeces
.head 5 -  Number: lnSC1
.head 5 -  Number: lnSC2
.head 5 -  Number: lnSC3
.head 5 -  Number: lnSC4
.head 5 -  Number: lnVoix
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnTri
.head 5 -  Number: nSommeCE
.head 5 -  Number: nSommeCE2
.head 5 -  Number: lnNbSiege
.head 5 -  Number: lnPremLnI
.head 5 -  Number: nDiv
.head 5 -  Number: nK
.head 5 -  Number: nK2
.head 5 -  Number: nRowEluEff
.head 5 -  Number: nRowEluSuppl
.head 5 -  Number: nResteSiege
.head 5 -  Number: lnIdEntite
.head 5 -  Boolean: lbBHV_canton
.head 5 -  !
.head 5 -  Number: nCE_CalcBxl
.head 5 -  Number: nCE[*]
.head 5 -  Number: nCE_interpol[*]
.head 5 -  Number: nCE_interpol2[*]
.head 5 -  Number: nCE_interpol_Calc[*]
.head 5 -  Number: nCE_interpol_Calc2[*]
.head 5 -  Number: nCE_New[*]
.head 5 -  Number: nSC14[*]
.head 5 -  Number: nSC23[*]
.head 5 -  String: sAListeNo[*]
.head 5 -  String: sAListeId[*]
.head 5 -  Number: nASiege[*]
.head 5 -  Number: nAChiffreElig[*]
.head 5 -  Number: nPotEff[*]
.head 5 -  Number: nPotSuppl[*]
.head 5 -  String: sNoEluE
.head 5 -  String: sNoEluS
.head 5 -  String: sDevol
.head 5 -  String: sResteDevol
.head 5 -  Number: nFemmeElu
.head 5 -  Number: nHommeElu
.head 5 -  Number: lnNbCantonTot
.head 5 -  Number: lnNbCantonTraites
.head 5 -  String: lsInsApp
.head 5 -  String: lsNiveauEntite
.head 5 -  String: lsNiveauEl
.head 5 -  Number: lnVoixTotListe
.head 5 -  Number: lnNbBurDepBxl
.head 5 -  Number: lnNbBurTotBxl
.head 5 -  Number: lnNbCantonTotBxl
.head 5 -  Number: lnNbCantonTraitesBxl
.head 5 -  Number: lnNbCantonDef
.head 5 -  Number: lnNbCantonComplet
.head 5 -  String: lsRegLing
.head 5 -  Number: nSiegeListeObtenu
.head 5 -  Number: nEluParTranche[10]
.head 5 -  Number: nEluParTrancheM[10]
.head 5 -  Number: nEluParTrancheF[10]
.head 5 -  String: lsInsT
.head 5 -  Number: lnCeT
.head 5 -  Number: bExtrapolation
.head 5 -  Number: nCE_Interpole
.head 5 -  String: lsIdListe
.head 5 -  Number: nFacteur
.head 5 -  Number: nSommeCE_H
.head 5 -  Number: nSommeCE_H2
.head 5 -  Number: nSommeCE_H_Calc
.head 5 -  Number: nCE_Liste_Calc
.head 5 -  Number: nSommeCE_H_Calc2
.head 5 -  Number: nCE_Liste_Calc2
.head 5 -  String: lsSitDep
.head 5 -  Number: lnBurDep
.head 5 -  Number: lnBurTot
.head 5 -  Number: nProjection[*]
.head 5 -  Number: nSommeProjection
.head 5 -  Number: nSommeCE_New
.head 5 -  Number: nInscrit_21
.head 5 -  Number: nInscrit_23
.head 5 -  Number: nBurDep_21
.head 5 -  Number: nBurDep_23
.head 4 +  Actions
.head 5 -  Set lnNbBurDep = 0
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  !
.head 6 -  Set nK = 0
.head 6 +  While nK<= 200 
.head 7 -  Set sAListeNo[nK] = ''
.head 7 -  Set nCE[nK] = NUMBER_Null
.head 7 -  Set nSC14[nK] = NUMBER_Null
.head 7 -  Set nSC23[nK] = NUMBER_Null
.head 7 -  Set sAListeId[nK] = ''
.head 7 -  Set nK = nK + 1
.head 6 -  !
.head 6 -  ! Pour la chambre à BHV : vérification si au moins un canton sur BXL et HV
.head 6 +  ! If sExtElec = 'CK' and psIns = '21004'
.head 7 -  Set lsDiffuseEluElection = wsDiffuseElus
.head 7 -  Set lbBHV_canton = FALSE
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where res_ent_ins like '21%' and Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set lbBHV_canton = TRUE
.head 7 +  If lbBHV_canton
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where res_ent_ins like '23%' and Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 8 +  If SqlFetchNext( lhSql, Btmp )
.head 9 -  Set lbBHV_canton = TRUE
.head 8 +  Else 
.head 9 -  Set lbBHV_canton = FALSE
.head 7 -  !
.head 7 +  If NOT lbBHV_canton
.head 8 -  Set wsDiffuseElus = '0'
.head 6 -  !
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes S
.head 7 -  Set lnI = 1
.head 7 -  !
.head 7 -  Set lnBE_BBE1E2 = 0
.head 7 -  Set lnBNB_BBE1E2E5 = 0
.head 7 -  Set lnBE_E3E4 = 0
.head 7 -  Set lnBNB_E3E4 = 0
.head 7 -  Set lnBE_E5 = 0
.head 7 -  Set lnVV_E3E4 = 0
.head 7 -  !
.head 7 -  Set lnNbCanDef = 0
.head 7 -  Set lnNbCanTot = 0
.head 7 -  Set nSommeCE = 0
.head 7 -  Set lsInsPrec = ''
.head 7 -  !
.head 7 -  ! EXTRAPOLATION A FAIRE
.head 7 -  Set bExtrapolation = 1
.head 7 -  !
.head 7 -  !
.head 7 -  Set nK = 0
.head 7 +  If sExtElec = 'CK' and psIns = '21004'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select (sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)))/2
	from listes, result_listes , groupe_listes
	where rel_ent_ins like '21%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec  and lis_Ele_Ext = 'CK'
 	into :nSommeCE " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, sum(@nullvalue(REL_SC1,0))/2,sum(@nullvalue(REL_SC2,0))/2,sum(@nullvalue(REL_SC3,0))/2,sum(@nullvalue(REL_SC4,0))/2
	from listes, result_listes , groupe_listes
	where rel_ent_ins like '21%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
		and GRL_EL  = :sExtElec  and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
		and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
		and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, LIS_REGLING, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
	group by 1,2,3
	order by 3 desc,2,1
 	into :lsNoListe, :lnIdEntite, :lsRegLing, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_Listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE " )
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_Listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
			
 	into :nSommeCE " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO, LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_Listes
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select LIS_NO, LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , groupe_Listes
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
			
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 -  ! Selection du groupe de la liste
.head 8 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_GRL_FK  from listes where lis_ent_FK = :lnIdEntite and lis_no = :lsNoListe
	into :lnIdGroupe " )
.head 8 -  Call SqlFetchNext( lhSql2, Btmp )
.head 8 -  Call SqlCommit( lhSql2)
.head 8 -  !
.head 8 +  If sExtElec = 'BR'
.head 9 +  If lsRegLing = 'NN'
.head 10 -  Set lnNbSiege = 17
.head 9 +  Else
.head 10 -  Set lnNbSiege = 72
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select ENT_NB_CDT_MAX from entite where ent_id = :lnIdEntite into :lnNbSiege " )
.head 10 -  Call SqlFetchNext( lhSql2 , Btmp )
.head 8 +  Else
.head 9 +  If nK = 0
.head 10 -  Set lnNbSiege = 0
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select ENT_NB_CDT_MAX from entite where ent_id = :lnIdEntite into :lnNbSiege " )
.head 10 -  Call SqlFetchNext( lhSql2 , Btmp )
.head 8 -  Call SqlCommit( lhSql2)
.head 8 -  Set nCE[ nK ]  = nCE[ nK ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 8 -  Set nSC14[ nK ]  = nSC14[ nK ] + lnSC1  + lnSC4
.head 8 -  Set nSC23[ nK ]  = nSC23[ nK ] + lnSC2  + lnSC3
.head 8 -  Set sAListeNo[nK] = lsNoListe
.head 8 -  Set sAListeId[nK] = SalNumberToStrX( lnIdGroupe, 0 )
.head 8 -  !
.head 8 -  Set nCE_interpol[ lnIdGroupe ] = 0
.head 8 -  Set nCE_interpol_Calc[ lnIdGroupe ] = 0
.head 8 -  Set nCE_interpol2[ lnIdGroupe ] = 0
.head 8 -  Set nCE_interpol_Calc2[ lnIdGroupe ] = 0
.head 8 -  !
.head 8 -  Set nK = nK + 1
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  Set sAListeNo[nK] = ""
.head 7 -  !
.head 7 +  If bExtrapolation = 1
.head 8 -  Set nSommeCE_H_Calc = 0
.head 8 +  If sExtElec = 'CK'  and psIns = '21004'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select (sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)))/2
	from LIS_H,  RESLIS_H, Grp_Old
	where rel_ent_ins like '21%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO	
			and GRP_EL = :sExtElec  and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE_H " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select Grp_no,REL_ENT_INS , sum(@nullvalue(REL_SC1,0))/2,sum(@nullvalue(REL_SC2,0))/2,sum(@nullvalue(REL_SC3,0))/2,sum(@nullvalue(REL_SC4,0))/2
	from  LIS_H,  RESLIS_H, Grp_Old
	where rel_ent_ins like '21%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO 
			and GRP_EL = :sExtElec  and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lsInsT, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  Else If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from LIS_H,  RESLIS_H, Grp_Old
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO
			and GRP_EL = :sExtElec  and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE_H " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select Grp_no,REL_ENT_INS , sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from  LIS_H,  RESLIS_H, Grp_Old
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO
			and GRP_EL = :sExtElec and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lsInsT, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 -  Else If sExtElec = 'BR'
.head 8 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from LIS_H,  RESLIS_H, Grp_Old
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRP_NO
		and GRP_EL = :sExtElec   and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE_H " )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0))
	from LIS_H,  RESLIS_H, Grp_Old
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRP_NO
		
 	into :nSommeCE_H " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select Grp_NO, REL_ENT_INS, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from LIS_H,  RESLIS_H, Grp_Old
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRP_NO
		and GRP_EL = :sExtElec   and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lsInsT , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "Select Grp_NO, REL_ENT_INS, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from LIS_H,  RESLIS_H, Grp_Old
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRP_NO
		
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lsInsT , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  While SqlFetchNext( lhSql, Btmp )
.head 9 -  ! Selection du groupe de la liste
.head 9 -  Set nCE_Liste_Calc = 0
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select GRP_NO from grp_corresp where GRP_NOOLD = :lsNoListe
	into :lnIdGroupe " )
.head 9 +  If SqlFetchNext( lhSql2, Btmp )
.head 10 -  Set nCE_interpol[ lnIdGroupe ] = nCE_interpol[ lnIdGroupe ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 9 +  Else
.head 10 -  Set lnIdGroupe = -1
.head 9 -  Call SqlCommit( lhSql2)
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select  RES_SIT_DEP,RES_BDEP_TOT,@nullvalue(RES_BDEP_TRAIT,0)
	from result_Scrutin
	where RES_ENT_INS = :lsInsT and RES_ELE_EXT = :sExtElec
	into :lsSitDep,:lnBurTot, :lnBurDep " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  Call SqlCommit( lhSql2)
.head 9 +  If lnBurTot > 0 and lnBurTot != NUMBER_Null
.head 10 -  Set nCE_Liste_Calc = SalNumberRound(  (lnSC1 + lnSC2 + lnSC3 + lnSC4) * lnBurDep/ lnBurTot )
.head 10 +  If lnIdGroupe != -1
.head 11 -  Set nCE_interpol_Calc[ lnIdGroupe ] = nCE_interpol_Calc[ lnIdGroupe ] + nCE_Liste_Calc
.head 9 -  Set nSommeCE_H_Calc = nSommeCE_H_Calc + nCE_Liste_Calc
.head 9 -  !
.head 8 -  Call SqlCommit( lhSql)
.head 8 -  !
.head 8 -  Set nK2 = 100
.head 8 +  If sExtElec = 'CK' and psIns = '21004' and wsDiffuseElus = '1'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(ENT_INSCRITS_BB,0)+@nullvalue(ENT_INSCRITS_E1_E2,0)+@nullvalue(ENT_INSCRITS_E3_E4,0)+@nullvalue(ENT_INSCRITS_E5,0) )
	from entite 
	where @left(Ent_ins,2)= '21' and ENT_INS_NIVSUP= '21004' and ENT_ELE_EXT = 'CK' and ENT_NIV_LETTRE ='K' 
 	into :nInscrit_21 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(ENT_INSCRITS_BB,0)+@nullvalue(ENT_INSCRITS_E1_E2,0)+@nullvalue(ENT_INSCRITS_E3_E4,0)+@nullvalue(ENT_INSCRITS_E5,0) ) 
	from entite 
	where @left(Ent_ins,2)= '23' and ENT_INS_NIVSUP= '21004' and ENT_ELE_EXT = 'CK' and ENT_NIV_LETTRE ='K' 
 	into :nInscrit_23 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select (sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)))/2
	from listes, result_listes , groupe_listes
	where rel_ent_ins like '23%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
			and GRL_EL  = :sExtElec and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE2 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, sum(@nullvalue(REL_SC1,0))/2,sum(@nullvalue(REL_SC2,0))/2,sum(@nullvalue(REL_SC3,0))/2,sum(@nullvalue(REL_SC4,0))/2
	from listes, result_listes , groupe_listes
	where rel_ent_ins like '23%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
		and GRL_EL  = :sExtElec  and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 9 +  While SqlFetchNext( lhSql, Btmp )
.head 10 -  ! Selection du groupe de la liste
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_GRL_FK  from listes where lis_ent_FK = :lnIdEntite and lis_no = :lsNoListe
	into :lnIdGroupe " )
.head 10 -  Call SqlFetchNext( lhSql2, Btmp )
.head 10 -  Call SqlCommit( lhSql2)
.head 10 -  !
.head 10 +  If nK2 = 100
.head 11 -  Set lnNbSiege = 0
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select ENT_NB_CDT_MAX from entite where ent_id = :lnIdEntite into :lnNbSiege " )
.head 11 -  Call SqlFetchNext( lhSql2 , Btmp )
.head 11 -  Call SqlCommit( lhSql2)
.head 10 -  Set nCE[ nK2 ]  = nCE[ nK2 ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 10 -  Set nSC14[ nK2 ]  = nSC14[ nK2 ] + lnSC1  + lnSC4
.head 10 -  Set nSC23[ nK2 ]  = nSC23[ nK2 ] + lnSC2  + lnSC3
.head 10 -  Set sAListeNo[nK2] = lsNoListe
.head 10 -  Set sAListeId[nK2] = SalNumberToStrX( lnIdGroupe, 0 )
.head 10 -  !
.head 10 -  Set nK2 = nK2 + 1
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Set sAListeNo[nK2] = ""
.head 9 -  !
.head 9 +  If bExtrapolation =1
.head 10 +  If sExtElec = 'CK'  and psIns = '21004'
.head 11 -  Set nSommeCE_H_Calc2 = 0
.head 11 -  Call SqlPrepareAndExecute( lhSql, "Select (sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)))/2
	from LIS_H,  RESLIS_H, Grp_Old
	where rel_ent_ins like '23%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO
			and GRP_EL = :sExtElec and lis_Ele_Ext =  :sExtElec
 	into :nSommeCE_H2 " )
.head 11 -  Call SqlFetchNext( lhSql, Btmp )
.head 11 -  Call SqlCommit( lhSql)
.head 11 -  Call SqlPrepareAndExecute( lhSql, "Select Grp_no,REL_ENT_INS , sum(@nullvalue(REL_SC1,0))/2,sum(@nullvalue(REL_SC2,0))/2,sum(@nullvalue(REL_SC3,0))/2,sum(@nullvalue(REL_SC4,0))/2
	from  LIS_H,  RESLIS_H, Grp_Old
	where rel_ent_ins like '23%' and Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRP_NO
			and GRP_EL = :sExtElec and lis_Ele_Ext =  :sExtElec
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lsInsT, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 11 +  While SqlFetchNext( lhSql, Btmp )
.head 12 -  ! Selection du groupe de la liste
.head 12 -  Set nCE_Liste_Calc2 = 0
.head 12 -  Call SqlPrepareAndExecute( lhSql2, "Select GRP_NO from grp_corresp where GRP_NOOLD = :lsNoListe
	into :lnIdGroupe " )
.head 12 +  If SqlFetchNext( lhSql2, Btmp )
.head 13 -  Set nCE_interpol2[ lnIdGroupe ] = nCE_interpol2[ lnIdGroupe ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 12 +  Else
.head 13 -  Set lnIdGroupe = -1
.head 12 -  Call SqlCommit( lhSql2)
.head 12 -  Call SqlPrepareAndExecute( lhSql2, "Select  RES_SIT_DEP,RES_BDEP_TOT,@nullvalue(RES_BDEP_TRAIT,0)
	from result_Scrutin
	where RES_ENT_INS = :lsInsT and RES_ELE_EXT = :sExtElec
	into :lsSitDep,:lnBurTot, :lnBurDep " )
.head 12 -  Call SqlFetchNext( lhSql2, Btmp )
.head 12 -  Call SqlCommit( lhSql2)
.head 12 +  If lnBurTot > 0 and lnBurTot != NUMBER_Null
.head 13 -  Set nCE_Liste_Calc2 = SalNumberRound(  (lnSC1 + lnSC2 + lnSC3 + lnSC4) *lnBurDep/ lnBurTot )
.head 13 +  If lnIdGroupe != -1
.head 14 -  Set nCE_interpol_Calc2[ lnIdGroupe ] = nCE_interpol_Calc2[ lnIdGroupe ] + nCE_Liste_Calc2
.head 12 -  !
.head 12 -  Set nSommeCE_H_Calc2 = nSommeCE_H_Calc2 + nCE_Liste_Calc
.head 12 -  !
.head 11 -  Call SqlCommit( lhSql)
.head 9 -  !
.head 9 -  ! Call SqlPrepareAndExecute( lhSql2, "Select  sum(@nullvalue(RES_BDEP_TRAIT,0))
	from result_Scrutin
	where @left(RES_ENT_INS,2) = '21' and RES_ELE_EXT = :sExtElec
	into :nBurDep_21 " )
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select  sum(@decode( @nullvalue(ent_typeVote,''), '', @nullvalue(RES_BDEP_TRAIT,0),@nullvalue(RES_BDEP_TRAIT,0)/2.5) )
	from result_Scrutin, entite
	where @left(RES_ENT_INS,2) = '21' and RES_ELE_EXT = :sExtElec  and RES_ENT_INS=ENT_INS and Ent_niv_Lettre = 'K' and ENT_ELE_Ext = RES_ELE_EXT
	into :nBurDep_21 " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  Call SqlCommit( lhSql2)
.head 9 -  ! Call SqlPrepareAndExecute( lhSql2, "Select  sum(@nullvalue(RES_BDEP_TRAIT,0))
	from result_Scrutin
	where @left(RES_ENT_INS,2) = '23' and RES_ELE_EXT = :sExtElec
	into :nBurDep_23 " )
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select  sum(@decode( @nullvalue(ent_typeVote,''), '', @nullvalue(RES_BDEP_TRAIT,0),@nullvalue(RES_BDEP_TRAIT,0)/2.5) )
	from result_Scrutin, entite
	where @left(RES_ENT_INS,2) = '23' and RES_ELE_EXT = :sExtElec  and RES_ENT_INS=ENT_INS and Ent_niv_Lettre = 'K' and ENT_ELE_Ext = RES_ELE_EXT
	into :nBurDep_23 " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  Call SqlCommit( lhSql2)
.head 9 -  Set nK = 0
.head 9 -  Set nSommeCE_H_Calc=0
.head 9 +  While sAListeNo[nK] != ''
.head 10 -  Set lnIdGroupe = SalStrToNumber( sAListeId[nK] )
.head 10 -  !
.head 10 -  Set nSommeCE_H = nSommeCE_H + nSommeCE_H2
.head 10 -  Set nSommeCE = nSommeCE + nSommeCE2
.head 10 -  Set nCE[ nK]  = nCE[ nK ] + nCE[ nK+100 ]
.head 10 -  Set nSC14[ nK ]  = nSC14[ nK ] +  nSC14[ nK+100 ]
.head 10 -  Set nSC23[ nK ]  = nSC23[ nK ] + nSC23[ nK+100 ] 
.head 10 -  !
.head 10 -  ! Set nCE_interpol_Calc[ lnIdGroupe ] = SalNumberRound( ( nCE_interpol_Calc[ lnIdGroupe ] *nInscrit_21 / (nInscrit_21+ nInscrit_23) / nBurDep_21 * 50 + 
		nCE_interpol_Calc2[ lnIdGroupe ] *nInscrit_23 / (nInscrit_21+ nInscrit_23) / nBurDep_23 * 50 ) / 2)
.head 10 +  If nBurDep_21 != 0 and nBurDep_23 != 0 and nInscrit_21+ nInscrit_23 !=0
.head 11 -  Set nCE_CalcBxl = SalNumberRound( ( nCE_interpol_Calc[ lnIdGroupe ] *nInscrit_21 / (nInscrit_21+ nInscrit_23) / nBurDep_21 *10 + 
		nCE_interpol_Calc2[ lnIdGroupe ] *nInscrit_23 / (nInscrit_21+ nInscrit_23) / nBurDep_23 * 10 ) )
.head 10 +  Else
.head 11 -  Set nCE_CalcBxl = 0
.head 10 -  Set nSommeCE_H_Calc = nSommeCE_H_Calc + nCE_CalcBxl
.head 10 -  Set nCE_interpol_Calc[ lnIdGroupe ] = nCE_CalcBxl
.head 10 -  !
.head 10 -  Set nK = nK + 1
.head 8 -  !
.head 8 -  ! Dtm de la projection
.head 8 -  Set nSommeProjection = 0
.head 8 -  Set nK = 0
.head 8 +  While sAListeNo[nK] != ''
.head 9 -  Set lnIdGroupe = SalStrToNumber( sAListeId[nK] )
.head 9 -  !
.head 9 +  If nSommeCE_H > 0 and nSommeCE > 0 and nSommeCE_H_Calc > 0
.head 10 -  Set nProjection[ nK ] =  SalNumberAbs( ( (nCE_interpol[lnIdGroupe] / nSommeCE_H)*100) + ( (( nCE[nK] / nSommeCE ) - (nCE_interpol_Calc[lnIdGroupe]/nSommeCE_H_Calc) ) * 100 ) )
.head 9 +  Else
.head 10 -  Set nProjection[ nK ] = 0
.head 9 -  Set nSommeProjection =  nSommeProjection + nProjection[ nK ]
.head 9 -  !
.head 9 -  Set nK = nK + 1
.head 8 -  ! remise du total sur 100 + Calcul à partir de la somme des CE courants
.head 8 -  Set nK = 0
.head 8 -  Set nSommeCE_New = 0
.head 8 +  While sAListeNo[nK] != ''
.head 9 +  If nSommeProjection > 0
.head 10 -  Set nCE_New[nK] = SalNumberRound( (nProjection[ nK ] / nSommeProjection ) * nSommeCE )
.head 9 +  Else
.head 10 -  Set nCE_New[nK] = 0
.head 9 -  !
.head 9 -  Set nSommeCE_New = nSommeCE_New + nCE_New[nK]
.head 9 -  Set nK = nK + 1
.head 7 -  !
.head 7 -  Set sAListeNo[nK] = ""
.head 7 +  If TRUE
.head 8 -  Call SqlCommit( lhSql2)
.head 8 -  Call SqlCommit( lhSql)
.head 8 -  Set nK = 0
.head 8 +  While sAListeNo[nK] != ''
.head 9 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE'
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Update result_listes_"|| sExtElec ||"_Ex 
	Set REL_SC1 = null ,REL_SC2 = null , REL_SC3 = null , REL_SC4 = null
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and REL_Ele_Ext = :sExtElec and REL_Lis_NO = :sAListeNo[nK]  " )
.head 9 +  Else If sExtElec = 'BR'
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Update result_listes_"|| sExtElec ||"_Ex  
	Set REL_SC1 = null ,REL_SC2 = null , REL_SC3 = null , REL_SC4 = null
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and REL_Ele_Ext = :sExtElec and REL_Lis_NO = :sAListeNo[nK]  " )
.head 9 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Update result_listes_"|| sExtElec ||"_Ex  
	Set REL_SC1 = null ,REL_SC2 = null , REL_SC3 = null , REL_SC4 = null
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) 
		and REL_Ele_Ext = :sExtElec and REL_Lis_NO = :sAListeNo[nK]  " )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlCommit( lhSql2)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Update result_listes_"|| sExtElec ||"_Ex 
	Set REL_SC1 = :nCE_New[nK] ,REL_SC2 = 0 , REL_SC3 = 0 , REL_SC4 = 0
	Where REL_Ent_ins = :psIns and REL_Ele_Ext = :sExtElec and REL_Lis_NO = :sAListeNo[nK] " )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlCommit( lhSql2)
.head 9 -  Set nK = nK + 1
.head 7 -  !
.head 7 +  If bExtrapolation = 1
.head 8 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'
.head 9 -  Set lsTmp2 = 'C'
.head 8 +  Else If sExtElec = 'DE'
.head 9 -  Set lsTmp2 = 'G'
.head 8 +  Else If sExtElec = 'BR'
.head 9 -  Set lsTmp2 = 'R'
.head 8 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 9 -  Set lsTmp2 = 'L'
.head 8 -  Set lsFichierExtrapol = wsPathResult ||"\\EX" || lsTmp2 || psIns ||"."|| sExtElec
.head 8 +  If SalFileOpen( lhFileRER, lsFichierExtrapol ,  OF_Create | OF_ReadWrite | OF_Text )
.head 9 -  !
.head 9 -  Call SalFilePutStr( lhFileRER, "Méthode STESUD" )
.head 9 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 6 +  ! If sExtElec = 'CK' and psIns = '21004'
.head 7 -  Set wsDiffuseElus = lsDiffuseEluElection
.head 3 +  Function: PalResultatListes_NivSup_Ex
.head 4 -  Description: NivSup = Circ. pour la chambre, WL, VL
                Collège pour le sénat et Europe
	Region (G, R) pour DE, BR
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: psIns
.head 5 -  Number: nEntiteId
.head 5 -  Boolean: bExtrapolListes
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBE_E5
.head 5 -  Number: lnVV_E5
.head 5 -  Number: lnVBN_E5
.head 5 -  Number: lnVV_E3E4
.head 5 -  String: lsIns
.head 5 -  String: lsIns2
.head 5 -  String: lsFichier
.head 5 -  String: lsFichierExtrapol
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  String: lsTmp2
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: nJ
.head 5 -  String: lsNoGrp
.head 5 -  String: lsNoListe
.head 5 -  Number: lnIdListe
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsCdtId
.head 5 -  String: sSitNivSup
.head 5 -  String: sSitCdtPartiel
.head 5 -  String: lsDateDeces
.head 5 -  Number: lnSC1
.head 5 -  Number: lnSC2
.head 5 -  Number: lnSC3
.head 5 -  Number: lnSC4
.head 5 -  Number: lnVoix
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnTri
.head 5 -  Number: nSommeCE
.head 5 -  Number: lnNbSiege
.head 5 -  Number: lnPremLnI
.head 5 -  Number: nDiv
.head 5 -  Number: nK
.head 5 -  Number: nRowEluEff
.head 5 -  Number: nRowEluSuppl
.head 5 -  Number: nResteSiege
.head 5 -  Number: lnIdEntite
.head 5 -  !
.head 5 -  Number: nCE[*]
.head 5 -  Number: nSC14[*]
.head 5 -  Number: nSC23[*]
.head 5 -  String: sAListeNo[*]
.head 5 -  Number: nASiege[*]
.head 5 -  Number: nAChiffreElig[*]
.head 5 -  Number: nPotEff[*]
.head 5 -  Number: nPotSuppl[*]
.head 5 -  String: sNoEluE
.head 5 -  String: sNoEluS
.head 5 -  String: sDevol
.head 5 -  String: sResteDevol
.head 5 -  Number: nFemmeElu
.head 5 -  Number: nHommeElu
.head 5 -  Number: lnNbCantonTot
.head 5 -  Number: lnNbCantonTraites 
.head 5 -  String: lsInsApp
.head 5 -  String: lsNiveauEntite
.head 5 -  String: lsNiveauEl
.head 5 -  Number: lnVoixTotListe
.head 5 -  Number: lnNbBurDepBxl
.head 5 -  Number: lnNbBurTotBxl
.head 5 -  Number: lnNbCantonTotBxl
.head 5 -  Number: lnNbCantonTraitesBxl 
.head 5 -  Number: lnNbCantonDef
.head 5 -  Number: lnNbCantonComplet
.head 5 -  String: lsRegLing
.head 5 -  Number: nSiegeListeObtenu
.head 5 -  Number: nEluParTranche[10]
.head 5 -  Number: nEluParTrancheM[10]
.head 5 -  Number: nEluParTrancheF[10]
.head 5 -  String: lsInsT
.head 5 -  Number: lnCeT
.head 5 -  Number: bExtrapolation
.head 5 -  Number: nCE_Interpole
.head 5 -  String: lsIdListe
.head 5 -  Number: nFacteur
.head 5 -  String: lsTableResultListes
.head 5 -  String: lsDiffuseEluElection
.head 5 -  Boolean: lbBHV_canton
.head 4 +  Actions
.head 5 +  If bExtrapolListes 	
.head 6 -  Set lsTableResultListes = ' RESULT_LISTES_'|| sExtElec ||'_EX '
.head 5 +  Else
.head 6 -  Set lsTableResultListes = ' RESULT_LISTES '
.head 5 -  Set lnNbBurDep = 0
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  Set sSitNivSup = ''
.head 6 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0) != 1 ) " )
.head 6 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
				LIS_ENT_FK = :nEntiteId  and @nullvalue(RES_SIT_DEP,0) != 1) " )
.head 6 +  If SqlFetchNext( lhSql, Btmp )
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
				LIS_ENT_FK = :nEntiteId  and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set sSitNivSup = 'P'
.head 7 +  Else
.head 8 -  Set sSitNivSup = ''
.head 6 +  Else
.head 7 -  Set sSitNivSup = 'D'
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  ! Edition des CDT dans le fichier 0 (Partiel)
.head 6 +  If sSitNivSup != 'D'
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0) = 1 ) " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
				LIS_ENT_FK = :nEntiteId  and @nullvalue(RES_SIT_DEP,0) = 1) " )
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set sSitCdtPartiel = '1'
.head 7 +  Else
.head 8 -  Set sSitCdtPartiel = '0'
.head 6 +  Else
.head 7 -  Set sSitCdtPartiel = '1'
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  !
.head 6 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'
.head 7 -  Set lsTmp2 = 'C'
.head 6 +  Else If sExtElec = 'DE'
.head 7 -  Set lsTmp2 = 'G'
.head 6 +  Else If sExtElec = 'BR'
.head 7 -  Set lsTmp2 = 'R'
.head 6 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 -  Set lsTmp2 = 'L'
.head 6 -  Set lsNiveauEl = lsTmp2
.head 6 +  If sSitNivSup = 'P' or sSitNivSup = ''
.head 7 -  ! Set sSitNivSup = 'P'
.head 7 -  Set lsFichier = "R0" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 +  Else
.head 7 -  Set lsFichier = "R1" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R0" || lsTmp2 || psIns ||"."|| sExtElec )
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R1" || lsTmp2 || psIns ||"."|| sExtElec )
.head 6 -  ! Set lsFichierExtrapol = wsPathResult ||"\\EX" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 -  ! Call VisFileDelete( lsFichierExtrapol )
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes S
.head 7 -  Set lnI = 1
.head 7 -  !
.head 7 -  Set lnBE_BBE1E2 = 0
.head 7 -  Set lnBNB_BBE1E2E5 = 0
.head 7 -  Set lnBE_E3E4 = 0
.head 7 -  Set lnBNB_E3E4 = 0
.head 7 -  Set lnBE_E5 = 0
.head 7 -  Set lnVV_E3E4 = 0
.head 7 -  !
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr 
	where BETR_EL = :sExtElec and BETR_Ins in (Select Ent_Ins from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' )
	into :lnBE_E5 " )
.head 8 -  ! Call SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'CK'
.head 9 +  If psIns = '21004' 
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select sum( @nullvalue(RES_NB_VV_E5,0)) ,sum( @nullvalue(RES_NB_VBN_E5,0) )
	from Result_scrutin 
	where res_ent_ins= '21999' and RES_ELE_EXT = :sExtElec
	into :lnVV_E5, :lnVBN_E5 " )
.head 10 -  Call SqlFetchNext( lhSql, Btmp )
.head 10 -  Set lnBE_E5= lnVV_E5+lnVBN_E5
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr 
	where BETR_EL = :sExtElec and BETR_Ins in (Select Ent_Ins from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' )
	into :lnBE_E5 " )
.head 10 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_BDEP_TOT,1)) 
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' )
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5, :lnNbBurDep " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 +  If psIns = '12025'
.head 9 +  If sExtElec = 'EU'
.head 10 -  Set lsIns2 = ' NOT IN (92094,63023) '
.head 9 +  Else
.head 10 -  Set lsIns2 = " != 92094 "
.head 8 +  Else If psIns =  '92094'
.head 9 +  If sExtElec = 'EU'
.head 10 -  Set lsIns2 = ' NOT IN (12025,63023) '
.head 9 +  Else
.head 10 -  Set lsIns2 = " != 12025 "
.head 8 +  Else If sExtElec = 'EU' and psIns = '63023'
.head 9 -  Set lsIns2 = '=63023'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0)),sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId )
			and RES_ELE_EXT= :sExtElec and RES_ENT_INS_SUP "|| lsIns2 ||"
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5, :lnNbBurDep" )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  !
.head 7 -  ! Pour la chambre à BHV : vérification si au moins un canton sur BXL et HV
.head 7 -  Set lsDiffuseEluElection = wsDiffuseElus
.head 7 +  If sExtElec = 'CK' and psIns = '21004' and wsDiffuseElus = '1'
.head 8 -  Set lbBHV_canton = FALSE
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where res_ent_ins like '21%' and Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 8 +  If SqlFetchNext( lhSql, Btmp )
.head 9 -  Set lbBHV_canton = TRUE
.head 8 -  Call SqlCommit( lhSql)
.head 8 +  If lbBHV_canton
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where res_ent_ins like '23%' and Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1)  >= 0 ) " )
.head 9 +  If SqlFetchNext( lhSql, Btmp )
.head 10 -  Set lbBHV_canton = TRUE
.head 9 +  Else
.head 10 -  Set lbBHV_canton = FALSE
.head 9 -  Call SqlCommit( lhSql)
.head 8 -  !
.head 8 +  If NOT lbBHV_canton
.head 9 -  Set wsDiffuseElus = '0'
.head 7 -  !
.head 7 +  If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_NB_VBN,0)) 
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and ENT_Ins like '%999' )
	into :lnBE_E3E4, :lnBNB_E3E4 ")
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlCommit( lhSql)
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  !
.head 7 -  !
.head 7 +  If sExtElec = 'CK' 
.head 8 +  If psIns != '21004'
.head 9 -  Set lnBE_BBE1E2 = lnBE_BBE1E2  - lnBE_E5
.head 8 -  Set lnBE_E3E4 = lnBE_E3E4 - (lnVV_E5 + lnVBN_E5)
.head 8 -  Set lnBNB_E3E4 = lnBNB_E3E4 - lnVBN_E5
.head 8 -  Set lnBNB_BBE1E2E5 = lnBNB_BBE1E2E5 + lnVBN_E5
.head 7 +  Else If sExtElec = 'SE'  or sExtElec = 'EU'
.head 8 +  If psIns = '63023' and sExtElec = 'EU'
.head 9 -  ! On sait les déterminer
.head 9 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBNB_BBE1E2E5
.head 8 +  Else
.head 9 -  ! On NE sait PAS les déterminer
.head 9 -  Set lnBNB_BBE1E2E5 = NUMBER_Null
.head 9 -  Set lnBE_E3E4 = NUMBER_Null
.head 9 -  Set lnBNB_E3E4 = NUMBER_Null
.head 9 -  Set lnBE_E5 = NUMBER_Null
.head 7 -  !
.head 7 +  If wbSituationZeroResult
.head 8 -  Set lnBE_BBE1E2 = 0
.head 8 -  Set lnBNB_BBE1E2E5 = 0
.head 8 -  Set lnBE_E3E4 = 0
.head 8 -  Set lnBNB_E3E4 = 0
.head 8 -  Set lnBE_E5 = 0
.head 8 -  Set lnVV_E3E4 = 0
.head 7 -  !
.head 7 +  If lnBE_BBE1E2 < 0
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBE_E5
.head 8 -  Set lnBE_E5 = 0
.head 7 -  Set lsBuffer[lnI] = '"S","'|| SalNumberToStrX( lnBE_BBE1E2,0) ||'","'|| SalNumberToStrX( lnBNB_BBE1E2E5,0) ||'","' || SalNumberToStrX( lnBE_E3E4,0) ||'","' || SalNumberToStrX( lnBNB_E3E4,0) ||'","'
	|| SalNumberToStrX( lnBE_E5,0) ||'"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 7 -  ! Lignes L
.head 7 -  Set lnI = lnI+1
.head 7 -  Set lnNbCanDef = 0
.head 7 -  Set lnNbCanTot = 0
.head 7 -  Set nSommeCE = 0
.head 7 -  Set lsInsPrec = ''
.head 7 -  !
.head 7 +  If TRUE
.head 8 -  !
.head 8 -  Set nK = 0
.head 8 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' 
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, "|| lsTableResultListes ||" , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlCommit( lhSql)
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, "|| lsTableResultListes ||" , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  Else If sExtElec = 'BR'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, "|| lsTableResultListes ||" , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, LIS_REGLING, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, "|| lsTableResultListes ||" , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3
	order by 3 desc,2,1
 	into :lsNoListe, :lnIdEntite, :lsRegLing, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, "|| lsTableResultListes ||" , groupe_Listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO, LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, "|| lsTableResultListes ||" , groupe_Listes
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  While SqlFetchNext( lhSql, Btmp )
.head 9 +  If sExtElec = 'BR'
.head 10 +  If lsRegLing = 'NN'
.head 11 -  Set lnNbSiege = 17
.head 10 +  Else
.head 11 -  Set lnNbSiege = 72
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select ENT_NB_CDT_MAX from entite where ent_id = :lnIdEntite into :lnNbSiege " )
.head 11 -  Call SqlFetchNext( lhSql2 , Btmp )
.head 9 +  Else
.head 10 +  If nK = 0
.head 11 -  Set lnNbSiege = 0
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select ENT_NB_CDT_MAX from entite where ent_id = :lnIdEntite into :lnNbSiege " )
.head 11 -  Call SqlFetchNext( lhSql2 , Btmp )
.head 9 -  Call SqlCommit( lhSql2)
.head 9 +  ! If bExtrapolation = 1
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_ID
	from listes, result_listes , groupe_Listes
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_NO = :lsNoListe and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :lnIdEntite and LIS_GRL_FK=GRL_ID
	into :lsIdListe " )
.head 10 +  If SqlFetchNext( lhSql2, Btmp )
.head 11 -  Set nCE_Interpole = PalDtmExtrapolation( sExtElec, lsNiveauEl, SalNumberToStrX(nEntiteId,0), psIns, lsIdListe ,  lnSC1 + lnSC2 + lnSC3 + lnSC4 )
.head 11 -  Set nCE[ nK ]  = nCE[ nK ] + nCE_Interpole
.head 10 +  Else 
.head 11 -  Set nCE[ nK ]  = nCE[ nK ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 9 -  ! Else
.head 9 -  Set nCE[ nK ]  = nCE[ nK ] + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 9 -  Set nSC14[ nK ]  = nSC14[ nK ] + lnSC1  + lnSC4
.head 9 -  Set nSC23[ nK ]  = nSC23[ nK ] + lnSC2  + lnSC3
.head 9 -  Set sAListeNo[nK] = lsNoListe
.head 9 -  !
.head 9 -  Set nK = nK + 1
.head 8 -  Call SqlCommit( lhSql)
.head 8 -  !
.head 8 -  !
.head 8 -  Set sAListeNo[nK] = ""
.head 8 +  If lnNbSiege > 0 and nSommeCE > 0
.head 9 -  Set lsInsApp = ''
.head 9 +  If sExtElec = 'BR'
.head 10 -  Set lsInsApp= '21004'
.head 10 -  Set lsNiveauEntite = 'R'
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select Ent_GRP_App, Ent_Niv_Lettre from entite where
	Ent_id = :nEntiteId
	Into :lsInsApp, :lsNiveauEntite " )
.head 10 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 10 -  Call SqlCommit( ghSqlSecondaire)
.head 9 +  If lsInsApp != ''
.head 10 -  ! ! Verification si Groupe d'apparentement (lettre de groupement)
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select * from listes where lis_ele_ext = :sExtElec and lis_ent_fk = :nEntiteId and LIS_NOGROUPE is not null " )
.head 10 +  If NOT SqlFetchNext( ghSqlSecondaire, Btmp )
.head 11 -  Set lsInsApp = ''
.head 11 -  Set lsNiveauEntite = ''
.head 9 +  If lsInsApp != ''
.head 10 -  ! ! Verification si resultats dans TOUTES les circonscriptions composant le bureau d'apparentement
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select LIS_INSBUR, sum(@nullvalue(REL_SC1,0)+ @nullvalue(REL_SC2,0)+ @nullvalue(REL_SC3,0)+ @nullvalue(REL_SC4,0)) 
	from result_Listes, listes 
	where rel_ele_ext = :sExtElec  and lis_id = rel_lis_Fk and LIS_INSBURAPP = :lsInsApp
	group by 1
into :lsInsT, :lnCeT " )
.head 10 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 11 +  If lnCeT = 0
.head 12 -  Set lsInsApp = ''
.head 12 -  Set lsNiveauEntite = ''
.head 12 -  Break
.head 10 -  ! ! Verification si CK et BHV - on peut apparenter les 3 entités avec chiffres représentatifs de l'entite (TEST sur wsDiffuseElusCK_BHV)
.head 10 +  If sExtElec = 'CK' and lsInsApp = '21004' 
.head 11 +  If wsDiffuseElusCK_BHV != '1'
.head 12 -  Set lsInsApp = ''
.head 12 -  Set lsNiveauEntite = ''
.head 10 -  !
.head 9 -  Call SqlCommit( ghSqlSecondaire)
.head 9 -  !
.head 9 +  If lsInsApp = ''
.head 10 -  Call PalDtmSiege( nSommeCE, lnNbSiege, nCE, sAListeNo , nASiege, sExtElec, nSC14, nSC23, psIns )
.head 9 +  Else
.head 10 +  If sExtElec = 'BR'
.head 11 -  Call tblApp_1.PalPopulateTbl_GrpBR( lsInsApp, psIns, lsNiveauEntite ,  sExtElec , nASiege, bExtrapolListes)
.head 10 +  Else
.head 11 -  Call tblApp_1.PalPopulateTbl( lsInsApp, psIns, lsNiveauEntite ,  sExtElec  , nASiege, bExtrapolListes)
.head 8 -  Call SqlPrepareAndExecute( lhSql2, "delete from RESULT_ELU_ROYAUME where ELU_ENTITE = :psIns and  ELU_Elect = :sExtElec ")
.head 8 -  Call SqlCommit( lhSql2 )
.head 8 -  Call SqlCommit( lhSql2)
.head 7 -  !
.head 7 -  Set nK = 0
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK,Lis_id,Grl_Tri,sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe, :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK,Lis_id,Grl_Tri,LIS_REGLING, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4,5
	order by 5 desc, 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe, :lnTri ,:lsRegLing, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK, Lis_id, Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_Listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe , :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'BR'
.head 9 -  Set nSiegeListeObtenu = nASiege[lnIdListe]
.head 8 +  Else
.head 9 -  Set nSiegeListeObtenu = nASiege[nK]
.head 8 -  Set nAChiffreElig[nK] = SalNumberRound(nCE[nK] / (nSiegeListeObtenu+1) + 0.499999999)
.head 8 -  Set nPotEff[nK] = SalNumberRound(  (lnSC1+lnSC4)/2 + 0.499999999 )
.head 8 -  Set nPotSuppl[nK] = SalNumberRound(  (lnSC1+lnSC2)/2 + 0.499999999 )
.head 8 -  Call SqlPrepareAndExecute( lhSql2, "Insert into RESULT_ELU_ROYAUME ( ELU_Liste_ID,ELU_Liste_No,ELU_ListeGrp, ELU_ENTITE, ELU_SIEGES,ELU_Elect )
	values( :lnIdListe,:lsNoListe,:lsNoGrp,:psIns,:nSiegeListeObtenu,:sExtElec ) ")
.head 8 -  Call SqlCommit( lhSql2 )
.head 8 +  If wsDiffuseElus = '1'
.head 9 +  If nSiegeListeObtenu >0 and nSiegeListeObtenu != NUMBER_Null
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX(lnSC1,0) ||'","'|| SalNumberToStrX(lnSC2,0) ||'","'|| SalNumberToStrX(lnSC3,0) ||'","'|| SalNumberToStrX(lnSC4,0) ||'","'|| SalNumberToStrX(nAChiffreElig[nK],0) ||
	'","'|| SalNumberToStrX( nSiegeListeObtenu ,0) ||'","'|| lsNoGrp ||'"'
.head 9 +  Else
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","' ||
 	SalNumberToStrX( nSiegeListeObtenu ,0) ||'","'|| lsNoGrp ||'"'
.head 8 +  Else
.head 9 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","","'|| lsNoGrp ||'"'
.head 8 -  ! Histo Elu
.head 8 +  If gbSauveEluHisto
.head 9 -  Call PalMajHistoElus( wsEnveloppeR_Glob , sExtElec,  lsTmp2 || psIns ||"."|| sExtElec , SalStrToNumber( lsNoGrp ), lsNoListe, nSiegeListeObtenu, SalDateCurrent(  ) )
.head 8 -  !
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  !
.head 8 -  Set lnI = lnI +1
.head 8 +  If sSitCdtPartiel = '1' or wbSituationZeroResult or TRUE
.head 9 -  ! Vérification si au moins 1 vois sur 1 cdt pour désigantion des élus
.head 9 +  If sExtElec ='CK' or sExtElec ='WL'  or sExtElec = 'VL' or sExtElec = 'BR' or sExtElec = 'DE'
.head 10 -  Call SqlPrepareAndExecute(lhSql2, "Select sum(@nullvalue(REC_NB_VOIX,0))
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	into :lnVoixTotListe ")
.head 9 +  Else If sExtElec ='SE' or  sExtElec ='EU'
.head 10 -  Call SqlPrepareAndExecute (lhSql2, "Select sum(@nullvalue(REC_NB_VOIX,0))
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	into :lnVoixTotListe " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  !
.head 9 +  If lnVoixTotListe > 0 
.head 10 -  Call SalTblReset( tblCdt_E )
.head 10 -  Call SalTblReset( tblCdtSuppl_E )
.head 10 +  If sExtElec ='CK' or sExtElec ='WL'  or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 11 -  Call SalTblPopulate(tblCdt_E, lhSql2, "Select REC_CDT_NO, CDT_DATEDECES, CDT_SEXE, sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and REC_CDT_TYPE = 'E' and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdt_E.colNo,:tblCdt_E.colDateDeces, :tblCdt_E.colSexe , :tblCdt_E.colVoix , :tblCdt_E.colNN ", TBL_FillAll)
.head 11 -  Call SalTblPopulate( tblCdtSuppl_E, lhSql2, "Select REC_CDT_NO,CDT_DATEDECES,CDT_NOORDRETITULAIRE , sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and REC_CDT_TYPE = 'S' and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdtSuppl_E.colNo,:tblCdtSuppl_E.colDateDeces,:tblCdtSuppl_E.colNoEff, :tblCdtSuppl_E.colVoix, :tblCdtSuppl_E.colNN ", TBL_FillAll)
.head 10 +  Else If sExtElec ='SE' or  sExtElec ='EU'
.head 11 -  Call SalTblPopulate(tblCdt_E, lhSql2, "Select REC_CDT_NO,CDT_DATEDECES, CDT_SEXE, sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_CDT_TYPE = 'E' and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdt_E.colNo,:tblCdt_E.colDateDeces, :tblCdt_E.colSexe , :tblCdt_E.colVoix, :tblCdt_E.colNN ", TBL_FillAll )
.head 11 -  Call SalTblPopulate(tblCdtSuppl_E, lhSql2, "Select REC_CDT_NO,CDT_DATEDECES, CDT_NOORDRETITULAIRE, sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_CDT_TYPE = 'S' and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdtSuppl_E.colNo,:tblCdtSuppl_E.colDateDeces,:tblCdtSuppl_E.colNoEff , :tblCdtSuppl_E.colVoix, :tblCdtSuppl_E.colNN" , TBL_FillAll)
.head 10 -  !
.head 10 +  If nSiegeListeObtenu  > 0
.head 11 -  Call tblCdt_E.PalDtmCdtElu( nSiegeListeObtenu, nAChiffreElig[nK], nPotEff[nK], nPotSuppl[nK] , lnIdListe )
.head 9 -  !
.head 9 -  Set nRowEluEff = 0
.head 9 -  Set nRowEluSuppl = 0
.head 9 -  Set nFemmeElu = 0
.head 9 -  Set nHommeElu = 0
.head 9 -  Set nEluParTranche[0] = 0
.head 9 -  Set nEluParTranche[1] = 0
.head 9 -  Set nEluParTranche[2] = 0
.head 9 -  Set nEluParTranche[3] = 0
.head 9 -  Set nEluParTranche[4] = 0
.head 9 -  Set nEluParTrancheM[0] = 0
.head 9 -  Set nEluParTrancheM[1] = 0
.head 9 -  Set nEluParTrancheM[2] = 0
.head 9 -  Set nEluParTrancheM[3] = 0
.head 9 -  Set nEluParTrancheM[4] = 0
.head 9 -  Set nEluParTrancheF[0] = 0
.head 9 -  Set nEluParTrancheF[1] = 0
.head 9 -  Set nEluParTrancheF[2] = 0
.head 9 -  Set nEluParTrancheF[3] = 0
.head 9 -  Set nEluParTrancheF[4] = 0
.head 9 +  If sExtElec ='CK' or sExtElec ='WL'  or sExtElec = 'VL' or sExtElec = 'BR' or sExtElec = 'DE'
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select REC_CDT_TYPE,REC_CDT_NO, sum(@nullvalue(REC_NB_VOIX,0)), REC_CDT_FK
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,4
	order by 1,2
	into :lsTypeCdt, :lsNoCdt, :lnVoix, :lsCdtId ")
.head 9 +  Else If sExtElec ='SE' or sExtElec = 'EU'
.head 10 -  Call SqlPrepareAndExecute(lhSql2, "Select REC_CDT_TYPE,REC_CDT_NO, sum(@nullvalue(REC_NB_VOIX,0)), REC_CDT_FK
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,4
	order by 1,2
	into :lsTypeCdt, :lsNoCdt, :lnVoix, :lsCdtId" )
.head 9 +  While SqlFetchNext( lhSql2, Btmp )
.head 10 -  Set sDevol = ''
.head 10 -  Set sResteDevol = ''
.head 10 -  Set sNoEluE = ''
.head 10 -  Set sNoEluS = ''
.head 10 +  If nSiegeListeObtenu> 0 and  lnVoixTotListe > 0
.head 11 +  If lsTypeCdt = 'E'
.head 12 -  Call SalTblSetContext( tblCdt_E, nRowEluEff )
.head 12 -  Set sNoEluE = SalNumberToStrX( tblCdt_E.colNoElu, 0)
.head 12 +  If sNoEluE= '0'
.head 13 -  Set sNoEluE = ''
.head 12 +  If sNoEluE != '' 
.head 13 +  If tblCdt_E.colSexe = 'F'
.head 14 -  Set nFemmeElu = nFemmeElu+ 1
.head 13 +  Else If tblCdt_E.colSexe = 'M'
.head 14 -  Set nHommeElu = nHommeElu+ 1
.head 13 -  !
.head 13 -  Call PalDtmTrancheAgeElu( lsCdtId, nEluParTrancheM, nEluParTrancheF )
.head 13 -  !
.head 12 -  Set sDevol = SalNumberToStrX( tblCdt_E.colDevol , 0)
.head 12 -  Set sResteDevol = SalNumberToStrX( tblCdt_E.colRestPot , 0)
.head 12 -  !
.head 12 -  !
.head 12 -  Set nRowEluEff = nRowEluEff+1
.head 11 +  Else
.head 12 -  Call SalTblSetContext( tblCdtSuppl_E, nRowEluSuppl )
.head 12 -  Set sNoEluS = SalNumberToStrX( tblCdtSuppl_E.colNoElu, 0)
.head 12 +  If sNoEluS= '0'
.head 13 -  Set sNoEluS = ''
.head 12 -  Set sDevol = SalNumberToStrX( tblCdtSuppl_E.colDevol , 0)
.head 12 -  Set sResteDevol = SalNumberToStrX( tblCdtSuppl_E.colRestPot , 0)
.head 12 -  Set nRowEluSuppl = nRowEluSuppl + 1
.head 10 +  If wsDiffuseElus = '1' and nSiegeListeObtenu> 0 and lnVoixTotListe > 0
.head 11 +  If lsTypeCdt = 'S' and sNoEluS = ''
.head 12 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","","","'|| sNoEluE ||'","'|| sNoEluS ||'","'|| lsCdtId ||'"'
.head 11 +  Else
.head 12 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","'|| sDevol ||'","'|| sResteDevol ||'","'|| sNoEluE ||'","'|| sNoEluS ||'","'|| lsCdtId ||'"'
.head 10 +  Else
.head 11 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","","","","","'|| lsCdtId ||'"'
.head 10 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 10 -  Set lnI = lnI +1
.head 9 -  !
.head 9 +  If lnVoixTotListe > 0
.head 10 -  Set nEluParTranche[0] = nEluParTrancheM[0]  + nEluParTrancheF[0] 
.head 10 -  Set nEluParTranche[1] = nEluParTrancheM[1]  + nEluParTrancheF[1] 
.head 10 -  Set nEluParTranche[2] = nEluParTrancheM[2]  + nEluParTrancheF[2] 
.head 10 -  Set nEluParTranche[3] = nEluParTrancheM[3]  + nEluParTrancheF[3] 
.head 10 -  Set nEluParTranche[4] = nEluParTrancheM[4]  + nEluParTrancheF[4] 
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Update RESULT_ELU_ROYAUME
	Set ELU_Femme = :nFemmeElu , ELU_Homme = :nHommeElu, 
		ELU_1830 = :nEluParTranche[0], ELU_3140 = :nEluParTranche[1], ELU_4150 = :nEluParTranche[2],
		ELU_5160 = :nEluParTranche[3], ELU_60 = :nEluParTranche[4] ,
		ELU_M_1830 = :nEluParTrancheM[0], ELU_M_3140 = :nEluParTrancheM[1], ELU_M_4150 = :nEluParTrancheM[2],
		ELU_M_5160 = :nEluParTrancheM[3], ELU_M_60 = :nEluParTrancheM[4],
		ELU_F_1830 = :nEluParTrancheF[0], ELU_F_3140 = :nEluParTrancheF[1], ELU_F_4150 = :nEluParTrancheF[2],
		ELU_F_5160 = :nEluParTrancheF[3], ELU_F_60 = :nEluParTrancheF[4]
	Where ELU_Liste_ID = :lnIdListe and ELU_Liste_No =:lsNoListe and ELU_ENTITE =:psIns and ELU_Elect =:sExtElec ")
.head 10 -  Call SqlCommit( lhSql2 )
.head 8 -  !
.head 8 -  Set nK = nK + 1
.head 7 -  Call SqlCommit( lhSql2)
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'  or sExtElec = 'BR' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from result_scrutin 
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)) ,sum(@nullvalue(RES_BDEP_TOT,1))  from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
	into :lnNbBurDep, :lnNbBurTot " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from result_scrutin 
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||" )
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 8 -  ! Call SqlFetchNext( lhSql, Btmp )
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)),sum(@nullvalue(RES_BDEP_TOT,1))   from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
	into :lnNbBurDep, :lnNbBurTot " )
.head 8 +  If psIns =  '92094'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from result_scrutin 
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and (ENT_DEP_LISTE like '%"|| psIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| psIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
into :lnNbCantonTot , :lnNbCantonTraites " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)),sum(@nullvalue(RES_BDEP_TOT,1))   from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and (ENT_DEP_LISTE "|| lsIns2 ||" or @left( RES_ENT_INS,2) in('21','23') )) 
	into :lnNbBurDep, :lnNbBurTot " )
.head 9 -  Call SqlPrepareAndExecute( lhSql,"Select sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
		, count(res_ent_fk)-sum( RES_SIT_DEP)
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and (ENT_DEP_LISTE like '%"|| psIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| psIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into  :lnNbBurDep, :lnNbBurTot  ")
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from result_scrutin 
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and ENT_DEP_LISTE like '%"|| psIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
into :lnNbCantonTot , :lnNbCantonTraites " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)),sum(@nullvalue(RES_BDEP_TOT,1))   from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
	into :lnNbBurDep, :lnNbBurTot " )
.head 9 -  Call SqlPrepareAndExecute( lhSql,"Select Sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId
			and ENT_DEP_LISTE like '%"|| psIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :psIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into  :lnNbBurDep, :lnNbBurTot  " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  !
.head 7 -  ! Retrait des données en double de BHV
.head 7 +  If (sExtElec = 'SE' or sExtElec = 'EU')
.head 8 -  ! If psIns =  '92094'
.head 8 +  ! Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)/2, sum(@nullvalue(res_sit_dep,0))/2 
	from result_scrutin 
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||" ) and @left(Res_ent_ins,2) in ('21','23')  
	into :lnNbCantonTotBxl , :lnNbCantonTraitesBxl " ) 
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0))/2,sum(@nullvalue(RES_BDEP_TOT,1))/2   from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||" ) and @left(Res_ent_ins,2) in ('21','23') 
	into :lnNbBurDepBxl , :lnNbBurTotBxl " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Set lnNbCantonTot = lnNbCantonTot - lnNbCantonTotBxl
.head 9 -  Set lnNbCantonTraites = lnNbCantonTraites - lnNbCantonTraitesBxl
.head 9 -  Set lnNbBurDep = lnNbBurDep - lnNbBurDepBxl
.head 9 -  Set lnNbBurTot = lnNbBurTot - lnNbBurTotBxl
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnNbBurDep,0)   ||'","XXXX","'|| sDate ||'","'|| sHeure ||'","'|| SalNumberToStrX( lnNbBurTot,0) ||'","'|| SalNumberToStrX( lnNbCantonTraites,0)||'","'|| 
			SalNumberToStrX( lnNbCantonTot,0)|| '"'
.head 7 -  Set lsBuffer[0] = lsBuffer[0] ||',"'|| SalNumberToStrX( nEntiteId,0)|| '"'
.head 7 -  !
.head 7 -  Set lnNbCantonDef = 0
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'  or sExtElec = 'BR' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and RES_T_DEP = 'D' )
	into  :lnNbCantonDef " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
		  and RES_T_DEP = 'D'
	into  :lnNbCantonDef " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlCommit( lhSql)
.head 7 +  If lnNbCantonDef = NUMBER_Null
.head 8 -  Set lnNbCantonDef = 0
.head 7 -  Set lnNbCantonComplet = 0
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'  or sExtElec = 'BR' or sExtElec = 'DE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and RES_T_DEP in ('C','D') )
	into  :lnNbCantonComplet " )
.head 7 +  Else If sExtElec = 'SE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
				LIS_ENT_FK = :nEntiteId  and RES_T_DEP in ('C','D') ) 
	into  :lnNbCantonComplet " )
.head 7 +  Else If sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_DEP_LISTE "|| lsIns2 ||")
		  and RES_T_DEP in ('C','D') 
	into  :lnNbCantonComplet " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlCommit( lhSql)
.head 7 +  If lnNbCantonComplet = NUMBER_Null
.head 8 -  Set lnNbCantonComplet = 0
.head 7 -  !
.head 7 -  Call PalMajHistoGraphiqueEvolution( sExtElec, psIns, nEntiteId, lsTmp2,  lnNbBurDep, lnNbBurTot, lnNbCantonTraites, lnNbCantonTot, lnNbCantonComplet, lnNbCantonDef )
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  !
.head 8 -  Set lnJ = 0
.head 8 +  While lnJ < lnI
.head 9 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 9 -  Set lnJ = lnJ + 1
.head 8 -  Call SalFileClose( lhFileRER )
.head 7 -  !
.head 7 -  Set wsDiffuseElus = lsDiffuseEluElection
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 +  ! Function: PalMethodeStesud
.head 4 -  Description: 
.head 4 +  Returns 
.head 5 -  Number: 
.head 4 +  Parameters 
.head 5 -  String: sExtElec
.head 5 -  String: psIns
.head 5 -  Number: nEntiteId
.head 5 -  Number: nCE_ElectionEnCours
.head 5 -  Number: nTotCE_ElectionEnCours
.head 5 -  Number: nGroupeListe
.head 4 -  Static Variables 
.head 4 +  Local variables 
.head 5 -  Number: nCE_Predict
.head 5 -  Number: nCE_ElectionPrec
.head 5 -  Number: nP_ElectionEnCours
.head 5 -  Number: nP_ElectionPrec
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: nOldGrp
.head 5 -  String: sOldGroupeIn
.head 5 -  Number: nDiffPourcent
.head 5 -  Number: nSommeCE
.head 5 -  Number: lnCE_Canton
.head 5 -  Number: lnCE_CantonListe
.head 5 -  Number: lnCE_CantonTot
.head 5 -  Number: lnSC1
.head 5 -  Number: lnSC2
.head 5 -  Number: lnSC3
.head 5 -  Number: lnSC4
.head 5 -  String: lsNoListe
.head 5 -  String: lsInsCanton
.head 5 -  Number: lnBurTrait
.head 5 -  Number: lnBurTot
.head 5 -  Number: lnIdEntite
.head 5 -  String: lsRegLing
.head 4 +  Actions 
.head 5 +  If nTotCE_ElectionEnCours > 0
.head 6 +  If SqlConnect( lhSql )
.head 7 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 7 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 7 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 7 -  Call SqlConnect( lhSql2 )
.head 7 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 7 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 7 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 7 -  !
.head 7 -  Set sOldGroupeIn = ''
.head 7 +  If nTotCE_ElectionEnCours > 0
.head 8 -  Set nP_ElectionEnCours = nCE_ElectionEnCours/nTotCE_ElectionEnCours 
.head 8 -  Call SqlPrepareAndExecute( lhSql , "Select GRP_NOOLD from GRP_CORRESP where grp_no=:nGroupeListe 
	into :nOldGrp ")
.head 8 +  While SqlFetchNext( lhSql, Btmp )
.head 9 +  If sOldGroupeIn != ''
.head 10 -  Set sOldGroupeIn = sOldGroupeIn ||','
.head 9 -  Set sOldGroupeIn = sOldGroupeIn || SalNumberToStrX( nOldGrp, 0 )
.head 8 -  !
.head 8 +  If sOldGroupeIn != ''
.head 9 -  Set lnCE_CantonTot = 0
.head 9 -  Set lnCE_CantonListe = 0
.head 9 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' 
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select distinct REL_ENT_INS , RES_BDEP_TRAIT,RES_BDEP_TOT
	from listes, result_listes , groupe_listes,  result_scrutin
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and 
				@nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0) > 0 and REL_ENT_FK = res_ent_Fk and
				@nullvalue(RES_BDEP_TOT,0) > 0
	order by 1
 	into :lsInsCanton, :lnBurTrait,:lnBurTot " )
.head 9 +  Else If sExtElec = 'BR'
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select distinct REL_ENT_INS , RES_BDEP_TRAIT,RES_BDEP_TOT
	from listes, result_listes , groupe_listes,  result_scrutin
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and 
				@nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0) > 0 and REL_ENT_FK = res_ent_Fk and
				@nullvalue(RES_BDEP_TOT,0) > 0
	order by 1
 	into :lsInsCanton, :lnBurTrait,:lnBurTot   " )
.head 9 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select distinct REL_ENT_INS , RES_BDEP_TRAIT,RES_BDEP_TOT 
	from listes, result_listes , groupe_Listes,  result_scrutin
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID and 
				@nullvalue(REL_SC1,0)+@nullvalue(REL_SC2,0)+@nullvalue(REL_SC3,0)+@nullvalue(REL_SC4,0) > 0 and REL_ENT_FK = res_ent_Fk and
				@nullvalue(RES_BDEP_TOT,0) > 0
	order by 1
 	into :lsInsCanton, :lnBurTrait,:lnBurTot  " )
.head 9 +  While SqlFetchNext( lhSql, Btmp )
.head 10 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' 
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_NO,LIS_ENT_FK, sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK in("|| sOldGroupeIn ||") 
			and REL_ENT_INS = :lsInsCanton
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite, :lnCE_Canton " )
.head 10 +  Else If sExtElec = 'BR'
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_NO,LIS_ENT_FK, LIS_REGLING, sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK in("|| sOldGroupeIn ||") 
			and REL_ENT_INS = :lsInsCanton
	group by 1,2,3
	order by 3 desc,2,1
 	into :lsNoListe, :lnIdEntite, :lsRegLing, :lnCE_Canton4 " )
.head 10 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_NO, LIS_ENT_FK, sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H 
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK in("|| sOldGroupeIn ||") 
			and REL_ENT_INS = :lsInsCanton
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite , :lnCE_Canton " )
.head 10 +  If SqlFetchNext( lhSql2, Btmp )
.head 11 -  Set lnCE_CantonListe = lnCE_CantonListe + SalNumberRound(  lnCE_Canton * lnBurTrait / lnBurTot )
.head 10 -  ! Somme des cantons concernés
.head 10 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' 
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK
			and REL_ENT_INS = :lsInsCanton
 	into :lnCE_Canton " )
.head 10 +  Else If sExtElec = 'BR'
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK
			and REL_ENT_INS = :lsInsCanton
 	into :lnCE_Canton " )
.head 10 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H 
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId 
			and REL_ENT_INS = :lsInsCanton
 	into :lnCE_Canton " )
.head 10 +  If SqlFetchNext( lhSql2, Btmp )
.head 11 -  Set lnCE_CantonTot = lnCE_CantonTot  +SalNumberRound(  lnCE_Canton * lnBurTrait / lnBurTot )
.head 9 -  !
.head 9 -  Set nP_ElectionPrec = lnCE_CantonListe / lnCE_CantonTot
.head 9 -  Set nDiffPourcent = nP_ElectionEnCours - nP_ElectionPrec
.head 9 -  !
.head 9 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' 
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_NO,LIS_ENT_FK, sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK in("|| sOldGroupeIn ||") 
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite, :lnCE_Canton " )
.head 9 +  Else If sExtElec = 'BR'
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_NO,LIS_ENT_FK, LIS_REGLING, sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK in("|| sOldGroupeIn ||") 
	group by 1,2,3
	order by 3 desc,2,1
 	into :lsNoListe, :lnIdEntite, :lsRegLing, :lnCE_Canton4 " )
.head 9 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select LIS_NO, LIS_ENT_FK, sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H 
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK in("|| sOldGroupeIn ||") 
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite , :lnCE_Canton " )
.head 8 +  Else 
.head 9 -  Set nDiffPourcent = nP_ElectionEnCours
.head 8 -  !
.head 8 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' 
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H 
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK 
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 +  Else If sExtElec = 'BR'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H 
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H 
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId 
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  !
.head 8 -  !
.head 8 -  !
.head 8 -  !
.head 8 +  ! If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' 
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H 
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK 
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 +  ! Else If sExtElec = 'BR'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H 
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 +  ! Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H 
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId 
 	into :nSommeCE " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 +  ! If sOldGroupeIn != ''
.head 9 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' 
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK in("|| sOldGroupeIn ||") 
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 9 +  Else If sExtElec = 'BR'
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_ENT_FK, LIS_REGLING, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK in("|| sOldGroupeIn ||") 
	group by 1,2,3
	order by 3 desc,2,1
 	into :lsNoListe, :lnIdEntite, :lsRegLing, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 9 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO, LIS_ENT_FK, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from lis_H, reslis_H 
	where  Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK in("|| sOldGroupeIn ||") 
	group by 1,2
	order by 2,1
 	into :lsNoListe, :lnIdEntite , :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 9 +  While SqlFetchNext( lhSql, Btmp )
.head 10 -  Set nCE_ElectionPrec = nCE_ElectionPrec + lnSC1 + lnSC2 + lnSC3 + lnSC4
.head 9 -  Set nP_ElectionPrec = nCE_ElectionPrec / nSommeCE * 100
.head 9 -  Set nDiffPourcent = nP_ElectionEnCours - nP_ElectionPrec
.head 8 +  ! Else
.head 9 -  Set nDiffPourcent = nP_ElectionEnCours
.head 7 -  !
.head 7 -  Call SqlCommit( lhSql)
.head 7 -  Call SqlCommit( lhSql2)
.head 7 -  Call SqlDisconnect( lhSql )
.head 7 -  Call SqlDisconnect( lhSql2 )
.head 3 +  Function: PalVerifExtrapolation
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  String: sEl
.head 5 -  String: sNiv
.head 5 -  String: nIdEntite
.head 5 -  String: sIns
.head 5 -  Receive Number: nFacteur
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nBurDepTot
.head 5 -  Number: nBurDep
.head 5 -  Number: nInscrits
.head 5 -  Number: nInscrits_H
.head 5 -  Number: nVV
.head 5 -  Number: nVBN
.head 5 -  Number: nVV_H
.head 5 -  Number: nVBN_H
.head 4 +  Actions
.head 5 +  If (sNiv = 'C' and (sEl='CK' or sEl='WL' or sEl='VL' )) or (sNiv = 'G' and sEl='DE' ) or (sNiv = 'R' and sEl='BR' )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where res_ent_fk in (Select Ent_id from entite where ENT_INS_NIVSUP= :sIns and ENT_ELE_EXT = :sEl )
	into  :nVV, :nVBN,:nBurDep, :nBurDepTot ")
.head 5 +  Else If sNiv = 'L' and (sEl='SE' or sEl='EU')
.head 6 +  If sIns != '92094'
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and ENT_DEP_LISTE like '%"|| sIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into :nVV, :nVBN,:nBurDep, :nBurDepTot ")
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain,"Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and (ENT_DEP_LISTE like '%"|| sIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| sIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into :nVV, :nVBN,:nBurDep, :nBurDepTot ")
.head 5 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 5 -  !
.head 5 +  If nBurDepTot > 0
.head 6 -  Set nFacteur = nBurDep / nBurDepTot
.head 6 +  If nFacteur = 0
.head 7 -  Return -1
.head 6 +  Else If nFacteur < 0.40
.head 7 -  Return 1
.head 6 +  Else
.head 7 -  Return -1
.head 5 +  Else
.head 6 -  Return -1
.head 3 +  Function: PalVerifExtrapolationStesud
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  String: sEl
.head 5 -  String: sNiv
.head 5 -  String: nIdEntite
.head 5 -  String: sIns
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nBurDepTot
.head 5 -  Number: nBurDep
.head 5 -  Number: nInscrits
.head 5 -  Number: nInscrits_H
.head 5 -  Number: nVV
.head 5 -  Number: nVBN
.head 5 -  Number: nVV_H
.head 5 -  Number: nVBN_H
.head 5 -  Number: nFacteur
.head 5 -  String: sInsApp
.head 5 -  String: sInsC
.head 5 -  String: sTmp
.head 5 -  Number: nRet
.head 4 +  Actions
.head 5 -  Set sInsApp = ''
.head 5 +  If (sNiv = 'C' and (sEl='CK' or sEl='WL' or sEl='VL' )) or (sNiv = 'G' and sEl='DE' ) or (sNiv = 'R' and sEl='BR' )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ENT_GRP_APP from entite where ENT_INS= :sIns and ENT_NIV_LETTRE = :sNiv and ENT_ELE_EXT = :sEl
	Into :sInsApp " )
.head 6 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If sInsApp != ''
.head 7 -  Set sInsC = ''
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ent_ins from entite where ENT_GRP_APP = :sInsApp and ENT_NIV_LETTRE = :sNiv and ENT_ELE_EXT = :sEl
	Into :sTmp " )
.head 7 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 8 +  If sInsC != ''
.head 9 -  Set sInsC = sInsC || ','
.head 8 -  Set sInsC = sInsC || sTmp
.head 7 +  If sInsC != ''
.head 8 -  Set sInsC = ' (' || sInsC || ') '
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where res_ent_fk in (Select Ent_id from entite where ENT_INS_NIVSUP in "|| sInsC ||" and ENT_ELE_EXT = :sEl )
	into  :nVV, :nVBN,:nBurDep, :nBurDepTot ")
.head 7 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where res_ent_fk in (Select Ent_id from entite where ENT_INS_NIVSUP= :sIns and ENT_ELE_EXT = :sEl )
	into  :nVV, :nVBN,:nBurDep, :nBurDepTot ")
.head 5 +  Else If sNiv = 'L' and (sEl='SE' or sEl='EU')
.head 6 +  If sIns != '92094'
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and ENT_DEP_LISTE like '%"|| sIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into :nVV, :nVBN,:nBurDep, :nBurDepTot ")
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain,"Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and (ENT_DEP_LISTE like '%"|| sIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| sIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into :nVV, :nVBN,:nBurDep, :nBurDepTot ")
.head 5 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 5 -  !
.head 5 +  If nBurDepTot > 0
.head 6 -  Set nFacteur = nBurDep / nBurDepTot
.head 6 +  If nFacteur = 0
.head 7 -  Return -1
.head 6 +  Else If nFacteur <= 0.98
.head 7 +  If sInsApp != ''
.head 8 -  Set nRet = 0
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select Ent_ins from entite where ENT_GRP_APP = :sInsApp and ENT_NIV_LETTRE = :sNiv  and ENT_ELE_EXT = :sEl
	Into :sTmp " )
.head 8 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 9 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where res_ent_fk in (Select Ent_id from entite where ENT_INS_NIVSUP= :sTmp and ENT_ELE_EXT = :sEl )
	into  :nVV, :nVBN,:nBurDep, :nBurDepTot ")
.head 9 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 9 +  If nBurDepTot > 0
.head 10 -  Set nFacteur = nBurDep / nBurDepTot
.head 10 +  If nFacteur = 0
.head 11 -  Set nRet = 1
.head 11 -  Break
.head 10 +  Else If nFacteur <= 0.98
.head 11 -  Set nRet = 1
.head 11 -  Break
.head 9 +  Else
.head 10 -  Set nRet = 1
.head 10 -  Break
.head 8 -  !
.head 8 -  Return nRet
.head 7 +  Else
.head 8 -  Return 1
.head 6 +  Else
.head 7 -  Return -1
.head 5 +  Else
.head 6 -  Return -1
.head 3 +  Function: PalDtmExtrapolation
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  String: sEl
.head 5 -  String: sNiv
.head 5 -  String: nIdEntite
.head 5 -  String: sIns
.head 5 -  String: nIdListe
.head 5 -  Number: nCE_Origine
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nBurDepTot
.head 5 -  Number: nBurDep
.head 5 -  Number: nInscrits
.head 5 -  Number: nInscrits_H
.head 5 -  Number: nVV
.head 5 -  Number: nVBN
.head 5 -  Number: nVV_H
.head 5 -  Number: nVBN_H
.head 5 -  Number: nCE_K
.head 5 -  Number: nCE_Extrapole
.head 5 -  String: sInsK
.head 5 -  Number: nFacteur
.head 4 +  Actions
.head 5 +  If sEl = 'VL' and sIns = '21004'
.head 6 -  Return nCE_Origine
.head 5 +  Else
.head 6 +  If (sNiv = 'C' and (sEl='CK' or sEl='WL' or sEl='VL' )) or (sNiv = 'G' and sEl='DE' ) or (sNiv = 'R' and sEl='BR' )
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where res_ent_fk in (Select Ent_id from entite where ENT_INS_NIVSUP= :sIns and ENT_ELE_EXT = :sEl )
	into  :nVV, :nVBN,:nBurDep, :nBurDepTot ")
.head 6 +  Else If sNiv = 'L' and (sEl='SE' or sEl='EU')
.head 7 +  If sIns != '92094'
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and ENT_DEP_LISTE like '%"|| sIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into :nVV, :nVBN,:nBurDep, :nBurDepTot ")
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain,"Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1))
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and (ENT_DEP_LISTE like '%"|| sIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| sIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) )
	into :nVV, :nVBN,:nBurDep, :nBurDepTot ")
.head 6 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  !
.head 6 +  If nBurDepTot > 0
.head 7 -  Set nFacteur = nBurDep / nBurDepTot
.head 7 +  If nFacteur = 0
.head 8 -  Return nCE_Origine
.head 7 +  Else If nFacteur < 0.40
.head 8 -  Set nCE_Extrapole = 0
.head 8 +  If (sNiv = 'C' and (sEl='CK' or sEl='WL' or sEl='VL' )) or (sNiv = 'G' and sEl='DE' ) or (sNiv = 'R' and sEl='BR' )
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ent_id
	from Result_Scrutin , entite
	where res_ent_fk in (Select Ent_id from entite where ENT_INS_NIVSUP= :sIns and ENT_ELE_EXT = :sEl ) and ent_id = RES_ENT_FK and RES_NB_VV is not null
	into  :sInsK ")
.head 8 +  Else If sNiv = 'L' and (sEl='SE' or sEl='EU')
.head 9 +  If sIns != '92094'
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ent_id
	from Result_Scrutin, entite
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and ENT_DEP_LISTE like '%"|| sIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and ent_id = RES_ENT_FK and RES_NB_VV is not null
	into :sInsK ")
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire,"Select Ent_id
	from Result_Scrutin, entite
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and (ENT_DEP_LISTE like '%"|| sIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| sIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and ent_id = RES_ENT_FK and RES_NB_VV is not null
	into :sInsK ")
.head 8 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 9 -  ! CE elections en cours
.head 9 +  If (sNiv = 'C' and (sEl='CK' or sEl='WL' or sEl='VL' )) or (sNiv = 'G' and sEl='DE' ) or (sNiv = 'R' and sEl='BR' )
.head 10 -  Call SqlPrepareAndExecute( ghSqlMain, "Select (sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)))
	from Result_Scrutin , entite, Result_Listes
	where res_ent_fk in (Select Ent_id from entite where ENT_INS_NIVSUP= :sIns and ENT_ELE_EXT = :sEl ) and ent_id = RES_ENT_FK and ent_id = :sInsK  and rel_ent_FK = RES_ent_FK and REL_lis_Fk = :nIdListe
	into  :nCE_K ")
.head 9 +  Else If sNiv = 'L' and (sEl='SE' or sEl='EU')
.head 10 +  If sIns != '92094'
.head 11 -  Call SqlPrepareAndExecute( ghSqlMain, "Select (sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)))
	from Result_Scrutin, entite,Result_Listes
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and ENT_DEP_LISTE like '%"|| sIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and ent_id = RES_ENT_FK and ent_id = :sInsK  and rel_ent_FK = RES_ent_FK and
			REL_lis_Fk = :nIdListe
	into  :nCE_K  ")
.head 10 +  Else
.head 11 -  Call SqlPrepareAndExecute( ghSqlMain,"Select (sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)))
	from Result_Scrutin, entite,Result_Listes
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and (ENT_DEP_LISTE like '%"|| sIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| sIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and ent_id = RES_ENT_FK and ent_id = :sInsK  and rel_ent_FK = RES_ent_FK and
		  REL_lis_Fk = :nIdListe
	into :nCE_K  ")
.head 9 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 9 +  If nCE_K > 0
.head 10 -  ! Inscrits election en cours
.head 10 +  If (sNiv = 'C' and (sEl='CK' or sEl='WL' or sEl='VL' )) or (sNiv = 'G' and sEl='DE' ) or (sNiv = 'R' and sEl='BR' )
.head 11 -  Call SqlPrepareAndExecute( ghSqlMain, "Select sum(ENT_INSCRITS_BB)
	from Result_Scrutin , entite
	where res_ent_fk in (Select Ent_id from entite where ENT_INS_NIVSUP= :sIns and ENT_ELE_EXT = :sEl ) and ent_id = RES_ENT_FK and ent_id = :sInsK
	into  :nInscrits ")
.head 10 +  Else If sNiv = 'L' and (sEl='SE' or sEl='EU')
.head 11 +  If sIns != '92094'
.head 12 -  Call SqlPrepareAndExecute( ghSqlMain, "Select sum(ENT_INSCRITS_BB)
	from Result_Scrutin, entite
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and ENT_DEP_LISTE like '%"|| sIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and ent_id = RES_ENT_FK and ent_id = :sInsK
	into :nInscrits  ")
.head 11 +  Else
.head 12 -  Call SqlPrepareAndExecute( ghSqlMain,"Select sum(ENT_INSCRITS_BB)
	from Result_Scrutin, entite
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and (ENT_DEP_LISTE like '%"|| sIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| sIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and ent_id = RES_ENT_FK and ent_id = :sInsK
	into :nInscrits  ")
.head 10 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 10 -  ! Inscrits election histo
.head 10 +  If (sNiv = 'C' and (sEl='CK' or sEl='WL' or sEl='VL' )) or (sNiv = 'G' and sEl='DE' ) or (sNiv = 'R' and sEl='BR' )
.head 11 -  Call SqlPrepareAndExecute( ghSqlMain, "Select sum(ENT_INSCRITS_BB)
	from Resscr_H , entite_H
	where res_ent_fk in (Select Ent_id from entite where ENT_INS_NIVSUP= :sIns and ENT_ELE_EXT = :sEl ) and ent_id = RES_ENT_FK and ent_id = :sInsK
	into  :nInscrits_H ")
.head 10 +  Else If sNiv = 'L' and (sEl='SE' or sEl='EU')
.head 11 +  If sIns != '92094'
.head 12 -  Call SqlPrepareAndExecute( ghSqlMain, "Select sum(ENT_INSCRITS_BB)
	from Resscr_H, entite_H
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and ENT_DEP_LISTE like '%"|| sIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and ent_id = RES_ENT_FK and ent_id = :sInsK
	into :nInscrits_H ")
.head 11 +  Else
.head 12 -  Call SqlPrepareAndExecute( ghSqlMain,"Select sum(ENT_INSCRITS_BB)
	from Resscr_H, entite_H
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and (ENT_DEP_LISTE like '%"|| sIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| sIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and ent_id = RES_ENT_FK and ent_id = :sInsK
	into :nInscrits_H ")
.head 10 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 10 -  ! VV et VBN election histo
.head 10 +  If (sNiv = 'C' and (sEl='CK' or sEl='WL' or sEl='VL' )) or (sNiv = 'G' and sEl='DE' ) or (sNiv = 'R' and sEl='BR' )
.head 11 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0))
	from Resscr_H
	where res_ent_fk in (Select Ent_id from entite where ENT_INS_NIVSUP= :sIns and ENT_ELE_EXT = :sEl ) and RES_ENT_FK = :sInsK
	into  :nVV_H, :nVBN_H ")
.head 10 +  Else If sNiv = 'L' and (sEl='SE' or sEl='EU')
.head 11 +  If sIns != '92094'
.head 12 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0))
	from Resscr_H
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and ENT_DEP_LISTE like '%"|| sIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and RES_ENT_FK = :sInsK
	into :nVV_H, :nVBN_H ")
.head 11 +  Else
.head 12 -  Call SqlPrepareAndExecute( ghSqlMain,"Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0))
	from Resscr_H
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and (ENT_DEP_LISTE like '%"|| sIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| sIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and RES_ENT_FK = :sInsK
	into :nVV_H, :nVBN_H ")
.head 10 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 10 -  !
.head 10 -  ! VV et VBN election 
.head 10 +  If (sNiv = 'C' and (sEl='CK' or sEl='WL' or sEl='VL' )) or (sNiv = 'G' and sEl='DE' ) or (sNiv = 'R' and sEl='BR' )
.head 11 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin
	where res_ent_fk in (Select Ent_id from entite where ENT_INS_NIVSUP= :sIns and ENT_ELE_EXT = :sEl ) and RES_ENT_FK = :sInsK
	into  :nVV, :nVBN ")
.head 10 +  Else If sNiv = 'L' and (sEl='SE' or sEl='EU')
.head 11 +  If sIns != '92094'
.head 12 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and ENT_DEP_LISTE like '%"|| sIns ||"%'  )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and RES_ENT_FK = :sInsK
	into :nVV, :nVBN")
.head 11 +  Else
.head 12 -  Call SqlPrepareAndExecute( ghSqlMain,"Select Sum(@nullvalue(RES_NB_VV,0)),Sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin
	where  RES_ENT_FK in (Select Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sEl and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nIdEntite
			and (ENT_DEP_LISTE like '%"|| sIns ||"%' or ENT_INS_NIVSUPSUP like '%"|| sIns ||"%'  ) )
		and ( (@left(RES_ENT_INS,2) in ('21','23') and RES_ENT_INS_SUP = :sIns)  or (@left(RES_ENT_INS,2) not in ('21','23')) ) and RES_ENT_FK = :sInsK
	into :nVV, :nVBN")
.head 10 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 10 -  !
.head 10 +  If nInscrits_H > 0 and (nVV_H+nVBN_H)>0 and (nVV+nVBN)>0
.head 11 -  Set nFacteur = SalNumberRound(   (nInscrits / nInscrits_H) / ( (nVV+nVBN) / (nVV_H+nVBN_H) ) * 10000 ) / 10000
.head 11 -  Set nCE_Extrapole = nCE_Extrapole + (nCE_K * nFacteur)
.head 9 -  !
.head 8 -  Return SalNumberRound( nCE_Extrapole)
.head 7 +  Else
.head 8 -  Return nCE_Origine
.head 6 +  Else
.head 7 -  Return nCE_Origine
.head 3 -  !
.head 3 +  Function: PalDtmTrancheAgeElu
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sIdCdt
.head 5 -  Receive Number: nTrancheM[10]
.head 5 -  Receive Number: nTrancheF[10]
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Sql Handle: lhSqlCdt
.head 5 -  String: sDateNais
.head 5 -  String: sSexe
.head 5 -  Number: nDateEl
.head 5 -  Number: nDateNais
.head 5 -  Number: nDiff
.head 4 +  Actions
.head 5 -  Call SqlConnect( lhSqlCdt )
.head 5 -  Call SqlSetParameter( lhSqlCdt, DBP_FETCHTHROUGH, TRUE, '' )
.head 5 -  Call SqlSetParameter( lhSqlCdt, DBP_PRESERVE, TRUE, '' )
.head 5 -  Call SqlSetIsolationLevel( lhSqlCdt, 'RL' )
.head 5 -  !
.head 5 -  Call SqlPrepareAndExecute( lhSqlCdt, "Select CDT_DATNAIS, CDT_SEXE from candidats where cdt_id = :sIdCdt into :sDateNais, :sSexe " )
.head 5 +  If SqlFetchNext( lhSqlCdt, Btmp )
.head 6 -  Call SqlCommit( lhSqlCdt )
.head 6 -  Set nDateEl = SalStrToNumber(SalStrRightX( gsDateEl, 4 ) || SalStrMidX( gsDateEl, 3, 2 )|| SalStrLeftX( gsDateEl,  2 ))
.head 6 -  Set nDateNais = SalStrToNumber(SalStrRightX( sDateNais, 4 ) || SalStrMidX( sDateNais, 3, 2 )|| SalStrLeftX( sDateNais,  2 ))
.head 6 -  Set nDiff = (nDateEl - nDateNais) / 10000 
.head 6 -  !
.head 6 +  If sSexe = 'M'
.head 7 +  If nDiff < 31
.head 8 -  Set nTrancheM[0] = nTrancheM[0] + 1
.head 7 +  Else If nDiff >= 31 and nDiff < 41
.head 8 -  Set nTrancheM[1] = nTrancheM[1] + 1
.head 7 +  Else If nDiff >= 41 and nDiff < 51
.head 8 -  Set nTrancheM[2] = nTrancheM[2] + 1
.head 7 +  Else If nDiff >= 51 and nDiff < 61
.head 8 -  Set nTrancheM[3] = nTrancheM[3] + 1
.head 7 +  Else If nDiff >= 61
.head 8 -  Set nTrancheM[4] = nTrancheM[4] + 1
.head 6 +  Else
.head 7 +  If nDiff < 31
.head 8 -  Set nTrancheF[0] = nTrancheF[0] + 1
.head 7 +  Else If nDiff >= 31 and nDiff < 41
.head 8 -  Set nTrancheF[1] = nTrancheF[1] + 1
.head 7 +  Else If nDiff >= 41 and nDiff < 51
.head 8 -  Set nTrancheF[2] = nTrancheF[2] + 1
.head 7 +  Else If nDiff >= 51 and nDiff < 61
.head 8 -  Set nTrancheF[3] = nTrancheF[3] + 1
.head 7 +  Else If nDiff >= 61
.head 8 -  Set nTrancheF[4] = nTrancheF[4] + 1
.head 5 -  !
.head 5 -  Call SqlCommit( lhSqlCdt )
.head 5 -  !
.head 5 -  Call SqlDisconnect( lhSqlCdt )
.head 3 +  Function: PalEvolutionNivProv
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: sNivSup
.head 5 -  String: sWhereSuppl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsIns
.head 5 -  String: lsTmp
.head 5 -  String: sWhere
.head 5 -  Number: lnIdEntite
.head 5 -  Sql Handle: lhSql
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Set sWhere = ''
.head 6 +  If sWhereSuppl != ''
.head 7 -  Set sWhere = ' AND @left(ENT_INS,1) IN '|| sWhereSuppl
.head 6 -  Call SqlPrepareAndExecute( lhSql, "Select ent_ins, Ent_id
	from entite 
	where ent_ins is not null and ENT_NIV_LETTRE = :sNivSup AND ENT_ELE_EXT = :sExtElec "|| sWhere ||"
	Order by 1
	into :lsIns, :lnIdEntite " )
.head 6 +  While SqlFetchNext( lhSql, Btmp )
.head 7 -  Call PalResultatListes_Prov( sExtElec, lsIns, lnIdEntite , 'C')
.head 7 +  If lsIns = '21004' and sExtElec = 'SE'
.head 8 -  Call PalResultatListes_Prov( sExtElec, lsIns, lnIdEntite , 'P')
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlDisconnect( lhSql )
.head 3 +  Function: PalResultatListes_Prov
.head 4 -  Description: Niveau province au Sénat
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: psIns
.head 5 -  Number: nEntiteId
.head 5 -  String: psNivBxl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  String: lsWhere
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBE_E5
.head 5 -  String: lsIns
.head 5 -  String: lsFichier
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  String: lsTmp2
.head 5 -  String: lsBufferP21004[*]
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  String: lsNoGrp
.head 5 -  String: lsNoListe
.head 5 -  Number: lnIdListe
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsCdtId
.head 5 -  String: sSitNivSup
.head 5 -  String: lsDateDeces
.head 5 -  Number: lnSC1
.head 5 -  Number: lnSC2
.head 5 -  Number: lnSC3
.head 5 -  Number: lnSC4
.head 5 -  Number: lnVoix
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnTri
.head 5 -  String: lsInsTmp
.head 5 -  Number: lnNbCantonTot
.head 5 -  Number: lnNbCantonTraites
.head 5 -  Number: lnVV_E5
.head 5 -  Number: lnVBN_E5
.head 5 -  String: lsWhereE3E4
.head 5 -  Number: lnNbBurDepBxl
.head 5 -  Number: lnNbBurTotBxl
.head 5 -  Number: lnNbCantonTotBxl
.head 5 -  Number: lnNbCantonTraitesBxl
.head 5 -  Number: lnNbCantonDef
.head 5 -  Number: lnNbCantonComplet
.head 5 -  Long String: sBufferR
.head 5 -  Number: lnIdEntiteProv
.head 4 +  Actions
.head 5 -  Set lnNbBurDep = 0
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  Set sSitNivSup = ''
.head 6 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 +  If SalStrLeftX( psIns,1) = '2'
.head 8 +  If psIns = '21004'
.head 9 -  Set lsWhere = "@Left(ENT_INS,2) IN('21', '23') and ENT_NIV_LETTRE = 'K' "
.head 8 +  Else
.head 9 -  Set lsWhere = "@Left(ENT_INS,2) = '"|| SalStrLeftX( psIns ,2) ||"' and ENT_NIV_LETTRE = 'K' "
.head 7 +  Else If psIns = '63023'
.head 8 -  Set lsWhere = "ENT_INS_NIVSUP= '"||psIns ||"' and ENT_NIV_LETTRE = 'K' "
.head 7 +  Else
.head 8 -  Set lsWhere = "@Left(ENT_INS,1) = '"|| SalStrLeftX( psIns,1) ||"' and ENT_NIV_LETTRE = 'K' "
.head 8 +  If sExtElec = 'EU' and SalStrLeftX( psIns,1) = '6'
.head 9 -  Set lsWhere = lsWhere || " and ENT_INS not in ('63023','63067') "
.head 9 -  ! Set lsWhere = lsWhere || " and ENT_INS != '63023' "
.head 7 +  If psNivBxl = 'C'
.head 8 +  If psIns != '21004'
.head 9 -  Set lsWhere = lsWhere || " and @right(ENT_INS,3) != '999' "
.head 8 -  Set lsWhereE3E4 = lsWhere
.head 7 +  Else
.head 8 -  Set lsWhere = lsWhere || " and @right(ENT_INS,3) != '999' "
.head 8 -  Set lsWhereE3E4 = lsWhere
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where exists (Select Ent_id from entite , result_Listes, Listes where  res_ent_fk = ent_Id and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and
				"|| lsWhere ||"  and @nullvalue(RES_SIT_DEP,0) != 1 )  ")
.head 6 +  If SqlFetchNext( lhSql, Btmp )
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where Exists (Select Ent_id from entite , result_Listes, Listes where Res_ent_fk =Ent_id and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and
				"|| lsWhere ||"  and @nullvalue(RES_SIT_DEP,-1) >= 0 )  ")
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set sSitNivSup = 'P'
.head 7 +  Else
.head 8 -  Set sSitNivSup = ''
.head 6 +  Else
.head 7 -  Set sSitNivSup = 'D'
.head 6 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 +  If psIns = '21004' and psNivBxl = 'C'
.head 8 -  Set lsTmp2 = 'C'
.head 7 +  Else
.head 8 -  Set lsTmp2 = 'P'
.head 6 +  If sSitNivSup = 'P' or sSitNivSup = ''
.head 7 -  ! Set sSitNivSup = 'P'
.head 7 -  Set lsFichier = "R0" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 +  Else
.head 7 -  Set lsFichier = "R1" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 -  ! Call VisFileDelete( wsPathResult ||"\\R0" || lsTmp2 || psIns ||"*."|| sExtElec )
.head 6 -  ! Call VisFileDelete( wsPathResult ||"\\R1" || lsTmp2 || psIns ||"*."|| sExtElec )
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R0" || lsTmp2 || psIns ||"."|| sExtElec )
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R1" || lsTmp2 || psIns ||"."|| sExtElec )
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes S
.head 7 -  Set lnI = 1
.head 7 -  !
.head 7 -  Set lnBE_BBE1E2 = 0
.head 7 -  Set lnBNB_BBE1E2E5 = 0
.head 7 -  Set lnBE_E3E4 = 0
.head 7 -  Set lnBNB_E3E4 = 0
.head 7 -  Set lnBE_E5 = 0
.head 7 -  !
.head 7 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_BDEP_TOT,1)),
		sum( @nullvalue(RES_NB_VV_E5,0)) ,sum( @nullvalue(RES_NB_VBN_E5,0) )
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and "|| lsWhere ||" )
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5, :lnNbBurDep, :lnVV_E5, :lnVBN_E5" )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr
	where BETR_EL = :sExtElec and BETR_Ins in (Select Ent_ins from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and "|| lsWhere ||" )
	into :lnBE_E5 " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'SE' or (sExtElec= 'EU' and psIns = '21004' and psNivBxl = 'C' )
.head 9 +  If psIns = '21004'
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select sum( @nullvalue(RES_NB_VV_E5,0)) ,sum( @nullvalue(RES_NB_VBN_E5,0) )
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_Ins like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and "|| lsWhereE3E4 ||" )
	into :lnVV_E5, :lnVBN_E5" )
.head 10 -  Call SqlFetchNext( lhSql, Btmp )
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)) ,sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin
	where  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_Ins like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and "|| lsWhereE3E4 ||" )
	into :lnBE_E3E4, :lnBNB_E3E4 " )
.head 10 -  Call SqlFetchNext( lhSql, Btmp )
.head 10 -  Set lnBNB_E3E4 = lnBNB_E3E4 /2 - lnVBN_E5
.head 10 -  Set lnBE_E3E4 = lnBE_E3E4 - lnBNB_E3E4 - (lnVV_E5+lnVBN_E5)
.head 10 +  If psIns = '21004' and psNivBxl = 'C'
.head 11 -  Set lnBE_E3E4 = lnBE_E3E4 - lnVBN_E5
.head 10 -  Set lnBE_E5 = lnBE_E5 + (lnVV_E5+ lnVBN_E5)
.head 9 -  !
.head 9 +  If psIns = '21004'
.head 10 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 - lnBNB_BBE1E2E5/2
.head 10 -  Set lnBNB_BBE1E2E5 = lnBNB_BBE1E2E5 / 2 + lnVBN_E5
.head 9 +  Else
.head 10 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 - lnBE_E5
.head 8 -  !
.head 7 -  !
.head 7 +  If wbSituationZeroResult
.head 8 -  Set lnBE_BBE1E2 = 0
.head 8 -  Set lnBNB_BBE1E2E5 = 0
.head 8 -  Set lnBE_E3E4 = 0
.head 8 -  Set lnBNB_E3E4 = 0
.head 8 -  Set lnBE_E5 = 0
.head 7 -  !
.head 7 +  If lnBE_BBE1E2 < 0
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBE_E5
.head 8 -  Set lnBE_E5 = 0
.head 7 -  Set lsBuffer[lnI] = '"S","'|| SalNumberToStrX( lnBE_BBE1E2,0) ||'","'|| SalNumberToStrX( lnBNB_BBE1E2E5,0) ||'","' || SalNumberToStrX( lnBE_E3E4,0) ||'","' || SalNumberToStrX( lnBNB_E3E4,0) ||'","'
	|| SalNumberToStrX( lnBE_E5,0) ||'"'
.head 7 -  !
.head 7 +  ! If psIns = '21004' and sExtElec = 'SE'
.head 8 -  Set lsBufferP21004[lnI] = '"S","'|| SalNumberToStrX( lnBE_BBE1E2,0) ||'","'|| SalNumberToStrX( lnBNB_BBE1E2E5-lnVBN_E5,0) ||'","' || SalNumberToStrX( lnBE_E3E4,0) ||'","' || SalNumberToStrX( lnBNB_E3E4,0) ||'","'
	|| SalNumberToStrX( 0,0) ||'"'
.head 7 -  !
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 7 -  ! Lignes L
.head 7 -  Set lnI = lnI+1
.head 7 -  Set lnNbCanDef = 0
.head 7 -  Set lnNbCanTot = 0
.head 7 -  Set lsInsPrec = ''
.head 7 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_INSBUR, LIS_GRL_FK, Lis_id,Grl_Tri ,sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0))
	from listes, result_listes , Groupe_listes
	where REL_ENT_FK in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec  and "|| lsWhere ||"  ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	Group by 1,2,3,4,5
	order by 2, 1, 5
 	into :lsNoListe, :lsInsTmp, :lsNoGrp, :lnIdListe , :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","","'|| lsNoGrp ||'"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  Set lnI = lnI +1
.head 8 +  If (sSitNivSup != 'P' and sSitNivSup != '') or wbSituationZeroResult or TRUE
.head 9 +  If sExtElec ='SE' or sExtElec = 'EU'
.head 10 -  Call SqlPrepareAndExecute(lhSql2, "Select REC_CDT_TYPE,REC_CDT_NO, sum(@nullvalue(REC_NB_VOIX,0)), REC_CDT_FK
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where "|| lsWhere ||" and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,4
	order by 1,2
	into :lsTypeCdt, :lsNoCdt, :lnVoix, :lsCdtId" )
.head 9 +  While SqlFetchNext( lhSql2, Btmp )
.head 10 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","","","","","'|| lsCdtId ||'"'
.head 10 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 10 -  Set lnI = lnI +1
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 +  If psIns = '21004'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)/2, sum(@nullvalue(res_sit_dep,0))/2
	from result_scrutin
	where exists (Select Ent_id from entite where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec  and "|| lsWhere ||"  )
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2)),
		sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, @nullvalue(res_sit_dep,0),@nullvalue(res_sit_dep,0)/2 ), @nullvalue(res_sit_dep,0)/2))
	from result_scrutin
	where exists (Select Ent_id from entite where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec  and "|| lsWhere ||"  )
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  If psIns = '21004'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0))/2, sum(@nullvalue(RES_BDEP_TOT,1))/2  from result_scrutin
	where Exists (Select Ent_id from entite where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec  and "|| lsWhere ||"  )
	into :lnNbBurDep, :lnNbBurTot " )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select  sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, @nullvalue(RES_BDEP_TRAIT,0),@nullvalue(RES_BDEP_TRAIT,0)/2 ), @nullvalue(RES_BDEP_TRAIT,0)/2)),
		 sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, @nullvalue(RES_BDEP_TOT,1),@nullvalue(RES_BDEP_TOT,1)/2 ), @nullvalue(RES_BDEP_TOT,1)/2))
	from result_scrutin
	where Exists (Select Ent_id from entite where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec  and "|| lsWhere ||"  )
	into :lnNbBurDep, :lnNbBurTot " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnNbBurDep,0)   ||'","XXXX","'|| sDate ||'","'|| sHeure ||'","'|| SalNumberToStrX( lnNbBurTot,0)  ||'","'|| SalNumberToStrX( lnNbCantonTraites,0)||'","'||
			SalNumberToStrX( lnNbCantonTot,0)|| '"'
.head 7 +  ! If psIns = '21004' and sExtElec = 'SE'
.head 8 -  Set lsBufferP21004[0] = lsBuffer[0]
.head 7 -  ! POur BXL (EU, SE) - Niveau Province
.head 7 -  Set sBufferR = lsBuffer[0]
.head 7 -  !
.head 7 +  If psIns = '21004' and (sExtElec = 'SE' or sExtElec = 'EU')
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select Ent_id
	from entite
	where ENT_NIV_LETTRE = 'C' and ENT_INS = '21004' AND ENT_ELE_EXT = :sExtElec
	Order by 1
	into :lnIdEntiteProv " )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select Ent_id
	from entite
	where ENT_NIV_LETTRE = :psNivBxl and ENT_INS = '21004' AND ENT_ELE_EXT = :sExtElec
	Order by 1
	into :lnIdEntiteProv " )
.head 8 -  Call SqlFetchNext( lhSql , Btmp )
.head 8 -  Set lsBuffer[0] = lsBuffer[0] ||',"'|| SalNumberToStrX( lnIdEntiteProv,0)|| '"'
.head 7 +  Else
.head 8 -  Set lsBuffer[0] = lsBuffer[0] ||',"'|| SalNumberToStrX( nEntiteId,0)|| '"'
.head 7 -  !
.head 7 -  Set lnNbCantonDef = 0
.head 7 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin
	where exists (Select Ent_id from entite , result_Listes, Listes where  res_ent_fk = ent_Id and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and
				"|| lsWhere ||"  and RES_T_DEP = 'D'  )
	into :lnNbCantonDef ")
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin
	where exists (Select Ent_id from entite , result_Listes, Listes where  res_ent_fk = ent_Id and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and
				"|| lsWhere ||"  and RES_T_DEP = 'D'  )
	into :lnNbCantonDef ")
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  If lnNbCantonDef = NUMBER_Null
.head 8 -  Set lnNbCantonDef = 0
.head 7 -  Set lnNbCantonComplet = 0
.head 7 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin
	where exists (Select Ent_id from entite , result_Listes, Listes where  res_ent_fk = ent_Id and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and
				"|| lsWhere ||"  and RES_T_DEP in ('C','D')  )
	into :lnNbCantonComplet ")
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin
	where exists (Select Ent_id from entite , result_Listes, Listes where  res_ent_fk = ent_Id and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and
				"|| lsWhere ||"  and RES_T_DEP in ('C','D')  )
	into :lnNbCantonComplet ")
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  If lnNbCantonComplet = NUMBER_Null
.head 8 -  Set lnNbCantonComplet = 0
.head 7 -  Call PalMajHistoGraphiqueEvolution( sExtElec, psIns, nEntiteId, lsTmp2,  lnNbBurDep, lnNbBurTot, lnNbCantonTraites, lnNbCantonTot,lnNbCantonComplet, lnNbCantonDef )
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  !
.head 8 -  Set lnJ = 0
.head 8 +  While lnJ < lnI
.head 9 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 9 -  Set lnJ = lnJ + 1
.head 8 -  Call SalFileClose( lhFileRER )
.head 7 -  !
.head 7 +  ! If psIns = '21004' and (sExtElec = 'SE' or sExtElec = 'EU')
.head 8 -  Call VisFileDelete( wsPathResult ||"\\R0P21004."|| sExtElec )
.head 8 -  Call VisFileDelete( wsPathResult ||"\\R1P21004."|| sExtElec )
.head 8 -  Set lsTmp = SalStrLeftX(lsFichier,2) ||"P"|| SalStrMidX( lsFichier, 3, SalStrLength( lsFichier ))
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select Ent_id
	from entite
	where ENT_NIV_LETTRE = 'P' and ENT_INS = '21004' AND ENT_ELE_EXT = :sExtElec
	Order by 1
	into :lnIdEntiteProv " )
.head 8 -  Call SqlFetchNext( lhSql , Btmp )
.head 8 -  ! Call VisFileCopy( wsPathResult ||"\\"|| lsFichier , wsPathResult ||"\\"|| lsTmp )
.head 8 +  If SalFileOpen( lhFileRER,wsPathResult ||"\\"|| lsTmp , OF_Create| OF_ReadWrite | OF_Text)
.head 9 -  Set lnJ = 0
.head 9 +  While lnJ < lnI
.head 10 +  If lnJ = 0
.head 11 -  Set lsBuffer[0] =sBufferR ||',"'|| SalNumberToStrX( lnIdEntiteProv,0)|| '"'
.head 11 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 10 +  Else If lnJ = 1 and sExtElec = 'SE'
.head 11 -  Set lsBuffer[lnJ] =lsBufferP21004
.head 10 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 10 -  Set lnJ = lnJ + 1
.head 9 -  Call SalFileClose( lhFileRER )
.head 7 +  If psIns = '21004' and sExtElec = 'EU'
.head 8 -  Call VisFileDelete( wsPathResult ||"\\R0P21004."|| sExtElec )
.head 8 -  Call VisFileDelete( wsPathResult ||"\\R1P21004."|| sExtElec )
.head 8 -  Set lsTmp = SalStrLeftX(lsFichier,2) ||"P"|| SalStrMidX( lsFichier, 3, SalStrLength( lsFichier ))
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select Ent_id
	from entite
	where ENT_NIV_LETTRE = 'P' and ENT_INS = '21004' AND ENT_ELE_EXT = :sExtElec
	Order by 1
	into :lnIdEntiteProv " )
.head 8 -  Call SqlFetchNext( lhSql , Btmp )
.head 8 -  ! Call VisFileCopy( wsPathResult ||"\\"|| lsFichier , wsPathResult ||"\\"|| lsTmp )
.head 8 +  If SalFileOpen( lhFileRER,wsPathResult ||"\\"|| lsTmp , OF_Create| OF_ReadWrite | OF_Text)
.head 9 -  Set lnJ = 0
.head 9 +  While lnJ < lnI
.head 10 +  If lnJ = 0
.head 11 -  Set lsBuffer[0] =sBufferR ||',"'|| SalNumberToStrX( lnIdEntiteProv,0)|| '"'
.head 11 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 10 +  ! Else If lnJ = 1 and sExtElec = 'SE'
.head 11 -  Set lsBuffer[lnJ] =lsBufferP21004
.head 10 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 10 -  Set lnJ = lnJ + 1
.head 9 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 -  !
.head 3 +  Function: PalEvolutionNivInterm
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: sNivInterm
.head 5 -  String: sWhereSuppl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsIns
.head 5 -  Number: lnIdEntite
.head 5 -  Sql Handle: lhSql
.head 5 -  String: sWhere
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 -  Set sWhere = ''
.head 7 +  If sWhereSuppl != ''
.head 8 -  Set sWhere = " AND ENT_INS in (Select distinct ENT_INS_NIVSUPSUP  from entite where  @left(ENT_INS,1) IN "|| sWhereSuppl ||" and ent_ele_ext = :sExtElec and ent_niv_lettre = 'K') "
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select ent_ins, Ent_id
	from entite 
	where ent_ins is not null and ENT_NIV_LETTRE = :sNivInterm AND ENT_ELE_EXT = :sExtElec and ent_ins != '21004'  
	Order by 1
	into :lsIns, :lnIdEntite " )
.head 6 +  Else If sExtElec = 'CK' or sExtElec = 'WL'
.head 7 -  Set sWhere = ''
.head 7 +  If sWhereSuppl != ''
.head 8 -  Set sWhere = ' AND @left(ENT_INS,1) IN '|| sWhereSuppl
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select ent_ins, Ent_id
	from entite 
	where ent_ins is not null and ENT_NIV_LETTRE = :sNivInterm AND ENT_ELE_EXT = :sExtElec "|| sWhere ||"
	Order by 1
	into :lsIns, :lnIdEntite " )
.head 6 +  While SqlFetchNext( lhSql, Btmp )
.head 7 -  Call PalResultatListes_NivInterm( sExtElec, lsIns, lnIdEntite )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlDisconnect( lhSql )
.head 3 +  Function: PalResultatListes_NivInterm
.head 4 -  Description: NivInterm 
                
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: psIns
.head 5 -  Number: nEntiteId
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBE_E5
.head 5 -  Number: lnVV_E5
.head 5 -  Number: lnVBN_E5
.head 5 -  Number: lnVV_E5b
.head 5 -  Number: lnVBN_E5b
.head 5 -  String: lsIns
.head 5 -  String: lsIns2
.head 5 -  String: lsIns3
.head 5 -  String: lsFichier
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  String: lsTmp2
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  String: lsNoGrp
.head 5 -  String: lsNoSousGrp
.head 5 -  String: lsNoListe
.head 5 -  String: lsNoGrpApp
.head 5 -  Number: lnIdListe
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsCdtId
.head 5 -  String: sSitNivSup
.head 5 -  String: lsDateDeces
.head 5 -  Number: lnSC1
.head 5 -  Number: lnSC2
.head 5 -  Number: lnSC3
.head 5 -  Number: lnSC4
.head 5 -  Number: lnVoix
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnTri
.head 5 -  Number: lnNbCantonTot
.head 5 -  Number: lnNbCantonTraites 
.head 5 -  Number: lnNbSousGroupe
.head 5 -  Number: lnSousGroupeId
.head 5 -  String: lsNoGrpPrec
.head 5 -  Number: lnNbBurDepBxl
.head 5 -  Number: lnNbBurTotBxl
.head 5 -  Number: lnNbCantonTotBxl
.head 5 -  Number: lnNbCantonTraitesBxl 
.head 5 -  Number: lnNbCantonDef
.head 5 -  Number: lnNbCantonComplet
.head 5 -  String: sSiegesObtenus
.head 5 -  String: sSousGrpTmp
.head 5 -  Number: nSousGrpTmp
.head 4 +  Actions
.head 5 -  Set lnNbBurDep = 0
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 +  If psIns = '21004'
.head 8 -  Set lsIns2 = "12025,92094"
.head 7 +  Else
.head 8 -  Set lsIns2 = psIns
.head 6 +  Else If sExtElec = 'CK'
.head 7 +  If psIns = '21004'
.head 8 -  Set lsIns2 = "('21004','25072','24062')"
.head 8 -  Set lsIns3 = "('25072','24062')"
.head 7 +  Else
.head 8 -  Set lsIns2 = ''
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select Ent_ins
	from entite
	where ENT_GRP_APP = :psIns and ENT_ELE_EXT = :sExtElec
	into :lsIns3 ")
.head 8 +  While SqlFetchNext( lhSql, Btmp )
.head 9 +  If lsIns2 != ''
.head 10 -  Set lsIns2 = lsIns2 || ","
.head 9 -  Set lsIns2 = lsIns2 || "'" || lsIns3 ||"'"
.head 8 -  Set lsIns3 =''
.head 8 -  Set lsIns2 = " (" || lsIns2 ||") "
.head 6 +  Else If sExtElec = 'WL'
.head 7 -  Set lsIns2 = psIns
.head 6 -  Set sSitNivSup = ''
.head 6 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE = :lsIns2  and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0) != 1 " )
.head 6 +  Else If sExtElec = 'CK'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE in "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0) != 1 " )
.head 6 +  Else If sExtElec = 'WL'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE = :lsIns2  and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0) != 1 " )
.head 6 +  If SqlFetchNext( lhSql, Btmp )
.head 7 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE  = :lsIns2  and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1) >= 0 " )
.head 7 +  Else If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE in "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1)>=0 " )
.head 7 +  Else If sExtElec = 'WL'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE  = :lsIns2  and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1) >= 0 " )
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set sSitNivSup = 'P'
.head 7 +  Else
.head 8 -  Set sSitNivSup = ''
.head 6 +  Else
.head 7 -  Set sSitNivSup = 'D'
.head 6 +  If sExtElec = 'CK'
.head 7 -  Set lsTmp2 = 'O'
.head 6 +  Else If sExtElec = 'WL'
.head 7 -  Set lsTmp2 = 'P'
.head 6 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 -  Set lsTmp2 = 'C'
.head 6 +  If sSitNivSup = 'P' or sSitNivSup = ''
.head 7 -  ! Set sSitNivSup = 'P'
.head 7 -  Set lsFichier = "R0" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 +  Else
.head 7 -  Set lsFichier = "R1" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R0" || lsTmp2 || psIns ||"*."|| sExtElec )
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R1" || lsTmp2 || psIns ||"*."|| sExtElec )
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes S
.head 7 -  Set lnI = 1
.head 7 -  !
.head 7 -  Set lnBE_BBE1E2 = 0
.head 7 -  Set lnBNB_BBE1E2E5 = 0
.head 7 -  Set lnBE_E3E4 = 0
.head 7 -  Set lnBNB_E3E4 = 0
.head 7 -  Set lnBE_E5 = 0
.head 7 -  Set lnVV_E5 = 0
.head 7 -  Set lnVV_E5b = 0
.head 7 -  Set lnVBN_E5 = 0
.head 7 -  Set lnVBN_E5b = 0
.head 7 -  !
.head 7 +  If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr 
	where BETR_EL = :sExtElec and BETR_Ins in (Select Ent_Ins from entite where ENT_INS in "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' )
	into :lnBE_E5 " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 +  If psIns = '21004'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin A, Entite B
	where  RES_ENT_FK in (Select  Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR  in "|| 
lsIns2 ||" )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE in "|| lsIns2 ||"
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum( @nullvalue(RES_NB_VV_E5,0)) ,sum( @nullvalue(RES_NB_VBN_E5,0) )
	from Result_scrutin A, Entite B
	where  RES_ENT_FK in (Select  Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR = :psIns )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE = :psIns
	into  :lnVV_E5, :lnVBN_E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue( BETR_RECUS, 0))  
	from bulletins_Betr 
	where @left(BETR_INS,2) in ('24','25') and BETR_EL = 'CK'
	into :lnVV_E5b " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Set lnBE_E5 = lnVV_E5 + lnVBN_E5 + lnVV_E5b
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin A, Entite B
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR  in "|| 
lsIns2 ||" )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE in "|| lsIns2 ||"
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin A, Entite B
	where  RES_ENT_FK in (Select  Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR  in "|| lsIns2 ||" 
)
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE in " || lsIns2 ||"
	into :lnBE_E3E4, :lnBNB_E3E4 " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  Else If sExtElec = 'WL'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin A, Entite B
	where  RES_ENT_FK in (Select  Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID  )
		and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and ENT_INS_NIVSUPSUP  = :lsIns2
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5 " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr 
	where BETR_EL = :sExtElec and BETR_Ins  in (Select Ent_ins from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
						LIS_ENT_FK = :nEntiteId )
	into :lnBE_E5 " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'SE' or (sExtElec = 'EU' and psIns = '63023' )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin A, Entite B
	where  RES_ENT_FK in (Select  Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = 
:nEntiteId )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE != '12025,92094' 
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 +  If sExtElec = 'SE'
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select sum( @nullvalue(RES_NB_VV_E5,0)) ,sum( @nullvalue(RES_NB_VBN_E5,0) )
	from Result_scrutin A, Entite B
	where  RES_ENT_FK in (Select  Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE != '12025,92094' 
	into :lnVV_E5, :lnVBN_E5 " )
.head 10 -  Call SqlFetchNext( lhSql, Btmp )
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin A, Entite B
	where  RES_ENT_FK in (Select  Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins  like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK 
= :nEntiteId )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE != '12025,92094' 
	into :lnBE_E3E4, :lnBNB_E3E4 " )
.head 10 -  Call SqlFetchNext( lhSql, Btmp )
.head 10 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 -  lnBE_E5
.head 8 +  Else If sExtElec = 'EU'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin A, Entite B
	where  RES_ENT_FK in (Select  Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' and
	 	ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE not in ('12025,92094', '63023')  and @left(ent_ins,2) not in ('21','23')
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  !
.head 7 -  Set lnBE_E3E4 = lnBE_E3E4 - (lnVV_E5 + lnVBN_E5)
.head 7 -  Set lnBNB_E3E4 = lnBNB_E3E4 - lnVBN_E5
.head 7 -  Set lnBNB_BBE1E2E5 = lnBNB_BBE1E2E5 + lnVBN_E5
.head 7 -  Set lnBE_BBE1E2 = lnBE_BBE1E2  - lnVV_E5b
.head 7 -  !
.head 7 +  If wbSituationZeroResult
.head 8 -  Set lnBE_BBE1E2 = 0
.head 8 -  Set lnBNB_BBE1E2E5 = 0
.head 8 -  Set lnBE_E3E4 = 0
.head 8 -  Set lnBNB_E3E4 = 0
.head 8 -  Set lnBE_E5 = 0
.head 7 -  !
.head 7 +  If lnBE_BBE1E2 < 0
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBE_E5
.head 8 -  Set lnBE_E5 = 0
.head 7 -  !
.head 7 +  If lnBE_BBE1E2 < 0
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBE_E5
.head 8 -  Set lnBE_E5 = 0
.head 7 -  Set lsBuffer[lnI] = '"S","'|| SalNumberToStrX( lnBE_BBE1E2,0) ||'","'|| SalNumberToStrX( lnBNB_BBE1E2E5,0) ||'","' || SalNumberToStrX( lnBE_E3E4,0) ||'","' || SalNumberToStrX( lnBNB_E3E4,0) ||'","'
	|| SalNumberToStrX( lnBE_E5,0) ||'"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 7 -  ! Lignes L
.head 7 -  Set lnI = lnI+1
.head 7 -  Set lnNbCanDef = 0
.head 7 -  Set lnNbCanTot = 0
.head 7 -  Set lsInsPrec = ''
.head 7 +  If sExtElec = 'CK'
.head 8 +  If psIns = '21004' or lsTmp2 = 'O'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_GRL_FK,Grl_id,Grl_Tri, @nullvalue(LIS_NOGROUPE,' '),sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where  REL_ELE_EXT = :sExtElec and REL_ENT_FK in (Select Ent_id from entite where ENT_DEP_LISTE in  "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec ) 
		and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4
	order by 3,1,4
 	into :lsNoGrp, :lnIdListe, :lnTri, :lsNoGrpApp, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK,Grl_id,Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where  REL_ELE_EXT = :sExtElec and  REL_ENT_FK in (Select Ent_id from entite where ENT_DEP_LISTE in  "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec ) 
			and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe, :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'WL'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_GRL_FK,Grl_id,Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where  REL_ELE_EXT = :sExtElec and  REL_ENT_FK in (Select Ent_id from entite where @left(ENT_ins,1)  ='" || SalStrLeftX( lsIns2,1) ||"'  and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3
	order by 4
 	into :lsNoGrp, :lnIdListe, :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'SE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK, Lis_id, Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_Listes, entite
	where  REL_ENT_FK in (Select Ent_id from entite where  ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
			and REL_ELE_EXT= :sExtElec and rel_Ent_FK = Ent_ID and Ent_DEP_LISTE != '12025,92094'
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe , :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 +  Else If sExtElec = 'EU'
.head 8 +  If psIns = '63023' 
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK, Lis_id, Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_Listes, entite
	where  REL_ENT_FK in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
			and REL_ELE_EXT= :sExtElec and rel_Ent_FK = Ent_ID and Ent_DEP_LISTE = :psIns
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe , :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_NO,LIS_GRL_FK, Lis_id, Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_Listes, entite
	where  REL_ENT_FK in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK  and LIS_ENT_FK = :nEntiteId and LIS_GRL_FK=GRL_ID
			and REL_ELE_EXT= :sExtElec and rel_Ent_FK = Ent_ID and Ent_DEP_LISTE not in ('12025,92094', '63023')  and @left(ent_ins,2) not in ('21','23')
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe , :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 -  Set lsNoSousGrp = ''
.head 7 -  Set lsNoGrpPrec = ''
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'CK' and lsTmp2 = 'O'
.head 9 +  If psIns = '21004' and sExtElec = 'CK' and lsTmp2 = 'O'
.head 10 +  If lsNoSousGrp != '' and lsNoGrp = lsNoGrpPrec
.head 11 -  Set lnSousGroupeId = lnSousGroupeId + 1
.head 10 +  Else
.head 11 -  Set lsNoSousGrp = ''
.head 11 -  Set lnSousGroupeId = 65
.head 9 +  Else
.head 10 +  If lsNoSousGrp != '' and lsNoGrp = lsNoGrpPrec
.head 11 -  Set lnSousGroupeId = lnSousGroupeId + 1
.head 10 +  Else
.head 11 -  Set lsNoSousGrp = ''
.head 11 -  Set lnSousGroupeId = 65
.head 8 +  Else
.head 9 -  Set lsNoSousGrp = ''
.head 8 -  !
.head 8 -  Set sSiegesObtenus = ''
.head 8 +  If (psIns = '21004' or lsTmp2 = 'O') and sExtElec = 'CK' 
.head 9 -  Set lsNoListe = ''
.head 9 -  Call SqlPrepareAndExecute(lhSql2, "Select Min(A.LIS_NO) from Listes A, Listes_Nat B 
	where lis_grl_Fk = :lsNoGrp and A.Lis_No = B.Lis_No
	into :lsNoListe " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  !
.head 9 +  If (psIns = '21004' or lsTmp2 = 'O') and sExtElec = 'CK' and lsTmp2 = 'O'
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select  count(distinct LIS_GRL_FK|| GRL_ID ||GRL_TRI || @NULLVALUE(LIS_NOGROUPE,' ') )
	from listes, result_listes , groupe_listes
	where Grl_id = :lsNoGrp and Exists (Select Ent_id from entite where REL_ENT_FK =Ent_ID and ENT_DEP_LISTE in  "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
 	into :lnNbSousGroupe " )
.head 10 -  Call SqlFetchNext( lhSql2, Btmp )
.head 10 +  If lnNbSousGroupe > 1
.head 11 -  Set lsNoSousGrp = SalNumberToChar( lnSousGroupeId )
.head 11 -  !
.head 11 -  Set nSousGrpTmp = 1
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select @nullvalue(LIS_NOGROUPE,' '), sum (ELU_SIEGES ) 
	from result_elu_royaume,Listes  
	where elu_listegrp = :lsNoGrp  and elu_listegrp = lis_grl_fk and  lis_insBur in "|| lsIns2 ||"  and ELU_ENTITE = lis_insBur and ELU_ELECT = :sExtElec
	group by 1
	order by 1
	into :sSousGrpTmp, :sSiegesObtenus ")
.head 11 +  While SqlFetchNext( lhSql2, Btmp ) 
.head 12 -  Set nSousGrpTmp = nSousGrpTmp + 1
.head 12 +  If nSousGrpTmp > lnSousGroupeId - 64
.head 13 -  Break
.head 10 +  Else
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select sum (ELU_SIEGES ) 
	from result_elu_royaume ,Listes  
	where elu_listegrp = :lsNoGrp and elu_listegrp = lis_grl_fk and  lis_insBur in "|| lsIns2 ||"  and ELU_ENTITE = lis_insBur and ELU_ELECT = :sExtElec
	into :sSiegesObtenus ")
.head 11 -  Call SqlFetchNext( lhSql2, Btmp )
.head 10 -  !
.head 10 -  !
.head 10 -  Set lsNoGrpPrec = lsNoGrp
.head 9 -  !
.head 8 +  Else If sExtElec = 'WL' and lsTmp2 = 'P'
.head 9 -  Set lsNoListe = ''
.head 9 -  Call SqlPrepareAndExecute(lhSql2, "Select Min(A.LIS_NO) from Listes A, Listes_Nat B 
	where lis_grl_Fk = :lsNoGrp and A.Lis_No = B.Lis_No
	into :lsNoListe " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select sum (ELU_SIEGES ) 
	from result_elu_royaume , Listes
	where elu_listegrp = :lsNoGrp and ELU_ELECT = :sExtElec and elu_liste_Id = Lis_Id 
		and lis_ent_Fk in (select Ent_Id from entite where ent_ele_ext = :sExtElec and ent_niv_Lettre = 'C' and ENT_INS_NIVSUP = :psIns ) 
	into :sSiegesObtenus " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 8 -  !
.head 8 +  If wsDiffuseElus = '1'
.head 9 +  If psIns = '21004' and sExtElec = 'CK' and lsTmp2 = 'O'
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","'|| sSiegesObtenus ||'","'|| lsNoGrp ||'","'|| lsNoSousGrp ||'"'
.head 9 +  Else If psIns != '21004' and sExtElec = 'CK' and lsTmp2 = 'O'
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","'|| sSiegesObtenus ||'","'|| lsNoGrp ||'","'|| lsNoSousGrp ||'"'
.head 9 +  Else
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","'|| sSiegesObtenus ||'","'|| lsNoGrp ||'"'
.head 8 +  Else
.head 9 +  If psIns = '21004' and sExtElec = 'CK' and lsTmp2 = 'O'
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","'|| '' ||'","'|| lsNoGrp ||'","'|| lsNoSousGrp ||'"'
.head 9 +  Else
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","'|| '' ||'","'|| lsNoGrp ||'"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  Set lnI = lnI +1
.head 8 +  If (sSitNivSup != 'P' and sSitNivSup != '')  or wbSituationZeroResult or TRUE
.head 9 +  If sExtElec ='CK' or sExtElec = 'WL'
.head 10 -  ! Pas d'affichage de candidats
.head 9 +  Else If sExtElec ='SE' or sExtElec = 'EU'
.head 10 +  If sExtElec = 'SE'
.head 11 -  Call SqlPrepareAndExecute(lhSql2, "Select REC_CDT_TYPE,REC_CDT_NO, sum(@nullvalue(REC_NB_VOIX,0)), REC_CDT_FK
	from Candidats, result_cdt
	where rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec and Ent_DEP_LISTE != '12025,92094' )  and REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK 
		and CDT_ENT_FK = :nEntiteId  and recl_lis_fk = :lnIdListe
	group by 1,2, 4
	order by 1,2
	into :lsTypeCdt, :lsNoCdt, :lnVoix, :lsCdtId" )
.head 10 +  Else If sExtElec = 'EU'
.head 11 +  If psIns = '63023'
.head 12 -  Call SqlPrepareAndExecute(lhSql2, "Select REC_CDT_TYPE,REC_CDT_NO, sum(@nullvalue(REC_NB_VOIX,0)), REC_CDT_FK
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )  
		and CDT_ENT_FK = :nEntiteId and recl_lis_fk = :lnIdListe
	group by 1,2, 4
	order by 1,2
	into :lsTypeCdt, :lsNoCdt, :lnVoix, :lsCdtId" )
.head 11 +  Else
.head 12 -  Call SqlPrepareAndExecute(lhSql2, "Select REC_CDT_TYPE,REC_CDT_NO, sum(@nullvalue(REC_NB_VOIX,0)), REC_CDT_FK
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec AND Ent_DEP_LISTE not in ('12025,92094', '63023')  
		and @left(ent_ins,2) not in ('21','23') )  and 	CDT_ENT_FK = :nEntiteId and recl_lis_fk = :lnIdListe
	group by 1,2, 4
	order by 1,2
	into :lsTypeCdt, :lsNoCdt, :lnVoix, :lsCdtId" )
.head 10 +  While SqlFetchNext( lhSql2, Btmp )
.head 11 -  Set lsBuffer[lnI] = '"C","'|| lsNoListe ||'","'|| lsTypeCdt ||'","'|| lsNoCdt ||'","'|| SalNumberToStrX( lnVoix,0) ||'","'|| lsDateDeces ||'","","","","","'|| lsCdtId ||'"'
.head 11 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 11 -  Set lnI = lnI +1
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from Result_scrutin A, Entite B 
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE != '12025,92094' 
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)) ,sum(@nullvalue(RES_BDEP_TOT,1)) 
	from Result_scrutin A, Entite B
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE != '12025,92094' 
	into :lnNbBurDep, :lnNbBurTot " )
.head 7 +  Else If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from Result_scrutin A, Entite B 
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR   in "|| lsIns2 ||" )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE  in " || lsIns2 ||" 
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)) ,sum(@nullvalue(RES_BDEP_TOT,1)) 
	from Result_scrutin A, Entite B
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR   in "|| lsIns2 ||" )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE  in " || lsIns2 ||" 
	into :lnNbBurDep, :lnNbBurTot " )
.head 7 +  Else If sExtElec = 'WL'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from Result_scrutin A, Entite B 
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and @left(LIS_INSBUR,1) = '" || SalStrLeftX( lsIns2, 1) ||"'  )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and @left(B.Ent_DEP_LISTE,1) = '" || SalStrLeftX( lsIns2, 1) ||"' 
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)) ,sum(@nullvalue(RES_BDEP_TOT,1)) 
	from Result_scrutin A, Entite B
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and @left(LIS_INSBUR,1) = '" || SalStrLeftX( lsIns2, 1) ||"' )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and  @left(B.Ent_DEP_LISTE,1) = '" || SalStrLeftX( lsIns2, 1) ||"' 
	into :lnNbBurDep, :lnNbBurTot " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  ! Retrait des données en double de BHV
.head 7 +  If (sExtElec = 'SE' or sExtElec = 'EU')
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from Result_scrutin A, Entite B 
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE != '12025,92094' and @left(Res_ent_ins,2) in ('21','23')  
	into :lnNbCantonTotBxl , :lnNbCantonTraitesBxl " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)) ,sum(@nullvalue(RES_BDEP_TOT,1)) 
	from Result_scrutin A, Entite B
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE != '12025,92094' and @left(Res_ent_ins,2) in ('21','23')  
	into :lnNbBurDepBxl, :lnNbBurTotBxl " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Set lnNbCantonTot = lnNbCantonTot - lnNbCantonTotBxl
.head 8 -  Set lnNbCantonTraites = lnNbCantonTraites - lnNbCantonTraitesBxl
.head 8 -  Set lnNbBurDep = lnNbBurDep - lnNbBurDepBxl
.head 8 -  Set lnNbBurTot = lnNbBurTot - lnNbBurTotBxl
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnNbBurDep,0)   ||'","XXXX","'|| sDate ||'","'|| sHeure  ||'","'|| SalNumberToStrX( lnNbBurTot,0)   ||'","'|| SalNumberToStrX( lnNbCantonTraites,0)||'","'|| 
			SalNumberToStrX( lnNbCantonTot,0)|| '"'
.head 7 -  !
.head 7 -  ! Entités particulières pour EU C12025, C92094 (collèges sans BXL)
.head 7 +  If (sExtElec='EU' or sExtElec='SE') and lsTmp2 = 'C'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select Ent_id
	from entite 
	where ent_ins = :psIns and ENT_NIV_LETTRE = :lsTmp2 AND ENT_ELE_EXT = :sExtElec
	into :nEntiteId " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  !
.head 7 -  Set lsBuffer[0] = lsBuffer[0] ||',"'|| SalNumberToStrX( nEntiteId,0)|| '"'
.head 7 -  !
.head 7 -  Set lnNbCantonDef = 0
.head 7 +  If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE in "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec and RES_T_DEP = 'D' 
	into  :lnNbCantonDef " )
.head 7 +  Else If sExtElec = 'WL'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE = :lsIns2  and ENT_ELE_EXT = :sExtElec and RES_T_DEP = 'D' 
	into  :lnNbCantonDef " )
.head 7 +  Else If sExtElec = 'SE'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin, entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE = :lsIns2  and ENT_ELE_EXT = :sExtElec   and RES_T_DEP = 'D'  
	into  :lnNbCantonDef " )
.head 7 +  Else If sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,0 ), 0)) 
	from Result_scrutin A, Entite B 
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE != '12025,92094' and RES_T_DEP = 'D'
	into  :lnNbCantonDef " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  If lnNbCantonDef = NUMBER_Null
.head 8 -  Set lnNbCantonDef = 0
.head 7 -  Set lnNbCantonComplet = 0
.head 7 +  If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE in "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec and RES_T_DEP in ('C','D') 
	into  :lnNbCantonComplet " )
.head 7 +  Else If sExtElec = 'WL'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE = :lsIns2  and ENT_ELE_EXT = :sExtElec and RES_T_DEP in ('C','D')
	into  :lnNbCantonComplet " )
.head 7 +  Else If sExtElec = 'SE' 
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,1/2 ), 1/2))
	from Result_scrutin, entite
	where res_ent_fk = ent_id and Ent_DEP_LISTE = :lsIns2  and ENT_ELE_EXT = :sExtElec   and RES_T_DEP in ('C','D')
	into  :lnNbCantonComplet " )
.head 7 +  Else If sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum ( @if(@value(@left(res_ent_ins,2))-21, @if(@value(@left(res_ent_ins,2))-23, 1,0 ), 0)) 
	from Result_scrutin A, Entite B 
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK = :nEntiteId )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE != '12025,92094' and RES_T_DEP in ('C','D')
	into  :lnNbCantonComplet " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  If lnNbCantonComplet = NUMBER_Null
.head 8 -  Set lnNbCantonComplet = 0
.head 7 -  Call PalMajHistoGraphiqueEvolution( sExtElec, psIns, nEntiteId, lsTmp2,  lnNbBurDep, lnNbBurTot, lnNbCantonTraites, lnNbCantonTot ,lnNbCantonComplet, lnNbCantonDef)
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If sSitNivSup = 'P' and sSitNivSup != ''
.head 8 -  Set lsFichier = VisStrSubstitute( lsFichier , "_XXX", "_" || SalStrRightX( "000" || SalNumberToStrX( lnNbBurDep, 0) ,3) )
.head 7 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  !
.head 8 -  Set lnJ = 0
.head 8 +  While lnJ < lnI
.head 9 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 9 -  Set lnJ = lnJ + 1
.head 8 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 -  !
.head 3 +  ! Function: PalEvolutionNivRegionsSpeciales
.head 4 -  Description: 
.head 4 -  Returns 
.head 4 +  Parameters 
.head 5 -  String: sExtElec
.head 5 -  String: sNivInterm
.head 5 -  String: sWhereSuppl
.head 4 -  Static Variables 
.head 4 +  Local variables 
.head 5 -  String: lsIns
.head 5 -  Number: lnIdEntite
.head 5 -  Sql Handle: lhSql
.head 5 -  String: sWhere
.head 4 +  Actions 
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 +  If sExtElec = 'SE'
.head 7 -  Set sWhere = ''
.head 7 +  If sWhereSuppl != ''
.head 8 -  Set sWhere = " AND ENT_INS in (Select distinct ENT_INS_NIVSUPSUP  from entite where  @left(ENT_INS,1) IN "|| sWhereSuppl ||" and ent_ele_ext = :sExtElec and ent_niv_lettre = 'K') "
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select ent_ins, Ent_id
	from entite 
	where ent_ins is not null and ENT_NIV_LETTRE = :sNivInterm AND ENT_ELE_EXT = :sExtElec and ent_ins != '21004'  
	Order by 1
	into :lsIns, :lnIdEntite " )
.head 6 +  Else If sExtElec = 'CK'
.head 7 -  Set sWhere = ''
.head 7 +  If sWhereSuppl != ''
.head 8 -  Set sWhere = ' AND @left(ENT_INS,1) IN '|| sWhereSuppl
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select ent_ins, Ent_id
	from entite 
	where ent_ins is not null and ENT_NIV_LETTRE = :sNivInterm AND ENT_ELE_EXT = :sExtElec "|| sWhere ||"
	Order by 1
	into :lsIns, :lnIdEntite " )
.head 6 +  While SqlFetchNext( lhSql, Btmp )
.head 7 -  Call PalResultatListes_NivRegionsSpeciales( sExtElec, lsIns, lnIdEntite )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlDisconnect( lhSql )
.head 3 +  ! Function: PalResultatListes_NivRegionsSpeciales
.head 4 -  Description: NivRégions Spéciales
                
.head 4 -  Returns 
.head 4 +  Parameters 
.head 5 -  String: sExtElec
.head 5 -  String: psIns
.head 5 -  Number: nEntiteId
.head 4 -  Static Variables 
.head 4 +  Local variables 
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBE_E5
.head 5 -  Number: lnVV_E5
.head 5 -  Number: lnVBN_E5
.head 5 -  Number: lnVV_E5b
.head 5 -  Number: lnVBN_E5b
.head 5 -  String: lsIns
.head 5 -  String: lsIns2
.head 5 -  String: lsIns3
.head 5 -  String: lsFichier
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  String: lsTmp2
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  String: lsNoGrp
.head 5 -  String: lsNoSousGrp
.head 5 -  String: lsNoListe
.head 5 -  String: lsNoGrpApp
.head 5 -  Number: lnIdListe
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsCdtId
.head 5 -  String: sSitNivSup
.head 5 -  String: lsDateDeces
.head 5 -  Number: lnSC1
.head 5 -  Number: lnSC2
.head 5 -  Number: lnSC3
.head 5 -  Number: lnSC4
.head 5 -  Number: lnVoix
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnTri
.head 5 -  Number: lnNbCantonTot
.head 5 -  Number: lnNbCantonTraites 
.head 5 -  Number: lnNbSousGroupe
.head 5 -  Number: lnSousGroupeId
.head 5 -  String: lsNoGrpPrec
.head 5 -  Number: lnNbBurDepBxl
.head 5 -  Number: lnNbBurTotBxl
.head 5 -  Number: lnNbCantonTotBxl
.head 5 -  Number: lnNbCantonTraitesBxl 
.head 5 -  Number: lnNbCantonDef
.head 5 -  Number: lnNbCantonComplet
.head 5 -  String: sSiegesObtenus
.head 5 -  String: sSousGrpTmp
.head 5 -  Number: nSousGrpTmp
.head 4 +  Actions 
.head 5 -  Set lnNbBurDep = 0
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 +  If sExtElec = 'CK'
.head 7 +  ! If psIns = '21004'
.head 8 -  Set lsIns2 = "('21004','25072','24062')"
.head 8 -  Set lsIns3 = "('25072','24062')"
.head 7 +  If psIns = '21000'
.head 8 -  Set lsIns2 = ''
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select Ent_ins
	from entite
	where @left(ENT_INS,2) in ('21') and ENT_ELE_EXT = :sExtElec and Ent_Niv_Lettre = 'K'
	into :lsIns3 ")
.head 8 +  While SqlFetchNext( lhSql, Btmp )
.head 9 +  If lsIns2 != ''
.head 10 -  Set lsIns2 = lsIns2 || ","
.head 9 -  Set lsIns2 = lsIns2 || "'" || lsIns3 ||"'"
.head 8 -  Set lsIns3 =''
.head 8 -  Set lsIns2 = " (" || lsIns2 ||") "
.head 7 +  Else If psIns = '23000'
.head 8 -  Set lsIns2 = ''
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select Ent_ins
	from entite
	where @left(ENT_INS,2) in ('23')  and ENT_ELE_EXT = :sExtElec and Ent_Niv_Lettre = 'K'
	into :lsIns3 ")
.head 8 +  While SqlFetchNext( lhSql, Btmp )
.head 9 +  If lsIns2 != ''
.head 10 -  Set lsIns2 = lsIns2 || ","
.head 9 -  Set lsIns2 = lsIns2 || "'" || lsIns3 ||"'"
.head 8 -  Set lsIns3 =''
.head 8 -  Set lsIns2 = " (" || lsIns2 ||") "
.head 7 +  Else If psIns = '90000'
.head 8 -  Set lsIns2 = ''
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select Ent_ins
	from entite
	where (@left(ENT_INS,1) in ('5','6','8','9') or @left(ENT_INS,2) in ('25') ) and ENT_ELE_EXT = :sExtElec and Ent_Niv_Lettre = 'K'
	into :lsIns3 ")
.head 8 +  While SqlFetchNext( lhSql, Btmp )
.head 9 +  If lsIns2 != ''
.head 10 -  Set lsIns2 = lsIns2 || ","
.head 9 -  Set lsIns2 = lsIns2 || "'" || lsIns3 ||"'"
.head 8 -  Set lsIns3 =''
.head 8 -  Set lsIns2 = " (" || lsIns2 ||") "
.head 7 +  Else If psIns = '10000'
.head 8 -  Set lsIns2 = ''
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select Ent_ins
	from entite
	where ( @left(ENT_INS,1) in ('1','3','4','7') or @left(ENT_INS,2) in ('24') ) and ENT_ELE_EXT = :sExtElec and Ent_Niv_Lettre = 'K'
	into :lsIns3 ")
.head 8 +  While SqlFetchNext( lhSql, Btmp )
.head 9 +  If lsIns2 != ''
.head 10 -  Set lsIns2 = lsIns2 || ","
.head 9 -  Set lsIns2 = lsIns2 || "'" || lsIns3 ||"'"
.head 8 -  Set lsIns3 =''
.head 8 -  Set lsIns2 = " (" || lsIns2 ||") "
.head 7 -  !
.head 6 -  Set sSitNivSup = ''
.head 6 +  If sExtElec = 'CK'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_INS in "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0) != 1 " )
.head 6 +  If SqlFetchNext( lhSql, Btmp )
.head 7 +  If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_INS in "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,-1)>=0 " )
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set sSitNivSup = 'P'
.head 7 +  Else 
.head 8 -  Set sSitNivSup = ''
.head 6 +  Else 
.head 7 -  Set sSitNivSup = 'D'
.head 6 +  If sExtElec = 'CK'
.head 7 -  Set lsTmp2 = 'G'
.head 6 +  If sSitNivSup = 'P' or sSitNivSup = ''
.head 7 -  ! Set sSitNivSup = 'P'
.head 7 -  Set lsFichier = "R0" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 +  Else 
.head 7 -  Set lsFichier = "R1" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R0" || lsTmp2 || psIns ||"*."|| sExtElec )
.head 6 -  Call VisFileDelete( wsPathResult ||"\\R1" || lsTmp2 || psIns ||"*."|| sExtElec )
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes S
.head 7 -  Set lnI = 1
.head 7 -  !
.head 7 -  Set lnBE_BBE1E2 = 0
.head 7 -  Set lnBNB_BBE1E2E5 = 0
.head 7 -  Set lnBE_E3E4 = 0
.head 7 -  Set lnBNB_E3E4 = 0
.head 7 -  Set lnBE_E5 = 0
.head 7 -  Set lnVV_E5 = 0
.head 7 -  Set lnVV_E5b = 0
.head 7 -  Set lnVBN_E5 = 0
.head 7 -  Set lnVBN_E5b = 0
.head 7 -  !
.head 7 +  If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "select sum(@nullvalue(BETR_Recus,0))
	from Bulletins_Betr 
	where BETR_EL = :sExtElec and BETR_Ins in (Select Ent_Ins from entite where ENT_INS in "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' )
	into :lnBE_E5 " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 +  ! If psIns = '21004'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin A, Entite B
	where  RES_ENT_FK in (Select  Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR  in "|| 
lsIns2 ||" )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE in "|| lsIns2 ||"
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum( @nullvalue(RES_NB_VV_E5,0)) ,sum( @nullvalue(RES_NB_VBN_E5,0) )
	from Result_scrutin A, Entite B
	where  RES_ENT_FK in (Select  Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR = :psIns )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE = :psIns
	into  :lnVV_E5, :lnVBN_E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue( BETR_RECUS, 0))  
	from bulletins_Betr 
	where @left(BETR_INS,2) in ('24','25') and BETR_EL = 'CK'
	into :lnVV_E5b " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Set lnBE_E5 = lnVV_E5 + lnVBN_E5 + lnVV_E5b
.head 8 +  ! Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin A, Entite B
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR  in "|| 
lsIns2 ||" )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_DEP_LISTE in "|| lsIns2 ||"
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5 " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin A, Entite B
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_Ins NOT like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
LIS_INSBUR  in "|| 
lsIns2 ||" )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_INS in "|| lsIns2 ||"
	into :lnBE_BBE1E2, :lnBNB_BBE1E2E5 " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))+sum(@nullvalue(RES_NB_VBN,0)),sum(@nullvalue(RES_NB_VBN,0))
	from Result_scrutin A, Entite B
	where  RES_ENT_FK in (Select  Ent_id from entite , result_Listes, Listes where ENT_ELE_EXT = :sExtElec and ENT_Ins like '%999' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR  in "|| lsIns2 ||" 
)
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_INS in " || lsIns2 ||"
	into :lnBE_E3E4, :lnBNB_E3E4 " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  !
.head 7 -  Set lnBE_E3E4 = lnBE_E3E4 - (lnVV_E5 + lnVBN_E5)
.head 7 -  Set lnBNB_E3E4 = lnBNB_E3E4 - lnVBN_E5
.head 7 -  Set lnBNB_BBE1E2E5 = lnBNB_BBE1E2E5 + lnVBN_E5
.head 7 -  Set lnBE_BBE1E2 = lnBE_BBE1E2  - lnVV_E5b
.head 7 -  !
.head 7 +  If wbSituationZeroResult
.head 8 -  Set lnBE_BBE1E2 = 0
.head 8 -  Set lnBNB_BBE1E2E5 = 0
.head 8 -  Set lnBE_E3E4 = 0
.head 8 -  Set lnBNB_E3E4 = 0
.head 8 -  Set lnBE_E5 = 0
.head 7 -  !
.head 7 +  If lnBE_BBE1E2 < 0
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBE_E5
.head 8 -  Set lnBE_E5 = 0
.head 7 -  !
.head 7 +  If lnBE_BBE1E2 < 0
.head 8 -  Set lnBE_BBE1E2 = lnBE_BBE1E2 + lnBE_E5
.head 8 -  Set lnBE_E5 = 0
.head 7 -  Set lsBuffer[lnI] = '"S","'|| SalNumberToStrX( lnBE_BBE1E2,0) ||'","'|| SalNumberToStrX( lnBNB_BBE1E2E5,0) ||'","' || SalNumberToStrX( lnBE_E3E4,0) ||'","' || SalNumberToStrX( lnBNB_E3E4,0) ||'","'
	|| SalNumberToStrX( lnBE_E5,0) ||'"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 7 -  ! Lignes L
.head 7 -  Set lnI = lnI+1
.head 7 -  Set lnNbCanDef = 0
.head 7 -  Set lnNbCanTot = 0
.head 7 -  Set lsInsPrec = ''
.head 7 +  If sExtElec = 'CK'
.head 8 +  If psIns = '21004' or lsTmp2 = 'O'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_GRL_FK,Grl_id,Grl_Tri, @nullvalue(LIS_NOGROUPE,' '),sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where  REL_ELE_EXT = :sExtElec and REL_ENT_FK in (Select Ent_id from entite where ENT_INS in  "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec ) 
		and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4
	order by 3,1,4
 	into :lsNoGrp, :lnIdListe, :lnTri, :lsNoGrpApp, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 8 +  Else 
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_GRL_FK,LIS_GRL_FK,Grl_id,Grl_Tri, sum(@nullvalue(REL_SC1,0)),sum(@nullvalue(REL_SC2,0)),sum(@nullvalue(REL_SC3,0)),sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where  REL_ELE_EXT = :sExtElec and  REL_ENT_FK in (Select Ent_id from entite where ENT_INS in  "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec ) 
			and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
	group by 1,2,3,4
	order by 1,4
 	into :lsNoListe, :lsNoGrp, :lnIdListe, :lnTri, :lnSC1, :lnSC2, :lnSC3, :lnSC4 " )
.head 7 -  Set lsNoSousGrp = ''
.head 7 -  Set lsNoGrpPrec = ''
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'CK' and lsTmp2 = 'O'
.head 9 +  If psIns = '21004' and sExtElec = 'CK' and lsTmp2 = 'O'
.head 10 +  If lsNoSousGrp != '' and lsNoGrp = lsNoGrpPrec
.head 11 -  Set lnSousGroupeId = lnSousGroupeId + 1
.head 10 +  Else 
.head 11 -  Set lsNoSousGrp = ''
.head 11 -  Set lnSousGroupeId = 65
.head 9 +  Else 
.head 10 +  If lsNoSousGrp != '' and lsNoGrp = lsNoGrpPrec
.head 11 -  Set lnSousGroupeId = lnSousGroupeId + 1
.head 10 +  Else 
.head 11 -  Set lsNoSousGrp = ''
.head 11 -  Set lnSousGroupeId = 65
.head 8 +  Else 
.head 9 -  Set lsNoSousGrp = ''
.head 8 +  If sExtElec = 'CK'
.head 9 -  Set lsNoListe = ''
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select distinct A.Lis_no 
	from LISTES A, Listes_Nat B 
	where LIS_Grl_FK = :lnIdListe and A.LIS_NO=B.LIs_NO
into :lsNoListe " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 8 -  !
.head 8 -  ! Set sSiegesObtenus = ''
.head 8 +  ! If (psIns = '21004' or lsTmp2 = 'O') and sExtElec = 'CK' 
.head 9 -  Set lsNoListe = ''
.head 9 -  Call SqlPrepareAndExecute(lhSql2, "Select Min(A.LIS_NO) from Listes A, Listes_Nat B 
	where lis_grl_Fk = :lsNoGrp and A.Lis_No = B.Lis_No
	into :lsNoListe " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  !
.head 9 +  If (psIns = '21004' or lsTmp2 = 'O') and sExtElec = 'CK' and lsTmp2 = 'O'
.head 10 -  Call SqlPrepareAndExecute( lhSql2, "Select  count(distinct LIS_GRL_FK|| GRL_ID ||GRL_TRI || @NULLVALUE(LIS_NOGROUPE,' ') )
	from listes, result_listes , groupe_listes
	where Grl_id = :lsNoGrp and Exists (Select Ent_id from entite where REL_ENT_FK =Ent_ID and ENT_DEP_LISTE in  "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID
 	into :lnNbSousGroupe " )
.head 10 -  Call SqlFetchNext( lhSql2, Btmp )
.head 10 +  If lnNbSousGroupe > 1
.head 11 -  Set lsNoSousGrp = SalNumberToChar( lnSousGroupeId )
.head 11 -  !
.head 11 -  Set nSousGrpTmp = 1
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select @nullvalue(LIS_NOGROUPE,' '), sum (ELU_SIEGES ) 
	from result_elu_royaume,Listes  
	where elu_listegrp = :lsNoGrp  and elu_listegrp = lis_grl_fk and  lis_insBur in "|| lsIns2 ||"  and ELU_ENTITE = lis_insBur and ELU_ELECT = :sExtElec
	group by 1
	order by 1
	into :sSousGrpTmp, :sSiegesObtenus ")
.head 11 +  While SqlFetchNext( lhSql2, Btmp ) 
.head 12 -  Set nSousGrpTmp = nSousGrpTmp + 1
.head 12 +  If nSousGrpTmp > lnSousGroupeId - 64
.head 13 -  Break 
.head 10 +  Else 
.head 11 -  Call SqlPrepareAndExecute( lhSql2, "Select sum (ELU_SIEGES ) 
	from result_elu_royaume ,Listes  
	where elu_listegrp = :lsNoGrp and elu_listegrp = lis_grl_fk and  lis_insBur in "|| lsIns2 ||"  and ELU_ENTITE = lis_insBur and ELU_ELECT = :sExtElec
	into :sSiegesObtenus ")
.head 11 -  Call SqlFetchNext( lhSql2, Btmp )
.head 10 -  !
.head 10 -  !
.head 10 -  Set lsNoGrpPrec = lsNoGrp
.head 9 -  !
.head 8 -  !
.head 8 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","'|| '' ||'","'|| lsNoGrp ||'"'
.head 8 +  ! If wsDiffuseElus = '1'
.head 9 +  If psIns = '21004' and sExtElec = 'CK' and lsTmp2 = 'O'
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","'|| sSiegesObtenus ||'","'|| lsNoGrp ||'","'|| lsNoSousGrp ||'"'
.head 9 +  Else If psIns != '21004' and sExtElec = 'CK' and lsTmp2 = 'O'
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","'|| sSiegesObtenus ||'","'|| lsNoGrp ||'","'|| lsNoSousGrp ||'"'
.head 9 +  Else 
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","'|| sSiegesObtenus ||'","'|| lsNoGrp ||'"'
.head 8 +  ! Else
.head 9 +  If psIns = '21004' and sExtElec = 'CK' and lsTmp2 = 'O'
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","'|| '' ||'","'|| lsNoGrp ||'","'|| lsNoSousGrp ||'"'
.head 9 +  Else 
.head 10 -  Set lsBuffer[lnI] = '"L","'|| lsNoListe ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnSC1,0) ||'","'|| SalNumberToStrX( lnSC2,0) ||'","'|| SalNumberToStrX( lnSC3,0) ||'","'|| SalNumberToStrX( lnSC4,0) ||'","","'|| '' ||'","'|| lsNoGrp ||'"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  Set lnI = lnI +1
.head 8 +  ! If (sSitNivSup != 'P' and sSitNivSup != '')  or wbSituationZeroResult or TRUE
.head 9 +  If sExtElec ='CK'
.head 10 -  ! Pas d'affichage de candidats
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 +  If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*), sum(@nullvalue(res_sit_dep,0)) 
	from Result_scrutin A, Entite B 
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR   in "|| lsIns2 ||" )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_INS  in " || lsIns2 ||" 
	into :lnNbCantonTot , :lnNbCantonTraites " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)) ,sum(@nullvalue(RES_BDEP_TOT,1)) 
	from Result_scrutin A, Entite B
	where  Exists (Select  Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_INSBUR   in "|| lsIns2 ||" )
			and RES_ELE_EXT= :sExtElec and A.res_Ent_FK = B.Ent_ID and B.Ent_INS  in " || lsIns2 ||" 
	into :lnNbBurDep, :lnNbBurTot " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnNbBurDep,0)   ||'","XXXX","'|| sDate ||'","'|| sHeure  ||'","'|| SalNumberToStrX( lnNbBurTot,0)   ||'","'|| SalNumberToStrX( lnNbCantonTraites,0)||'","'|| 
			SalNumberToStrX( lnNbCantonTot,0)|| '"'
.head 7 -  !
.head 7 -  Set lsBuffer[0] = lsBuffer[0] ||',"'|| SalNumberToStrX( nEntiteId,0)|| '"'
.head 7 -  !
.head 7 -  Set lnNbCantonDef = 0
.head 7 +  If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_INS in "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec and RES_T_DEP = 'D' 
	into  :lnNbCantonDef " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  If lnNbCantonDef = NUMBER_Null
.head 8 -  Set lnNbCantonDef = 0
.head 7 -  Set lnNbCantonComplet = 0
.head 7 +  If sExtElec = 'CK'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from Result_scrutin , entite
	where res_ent_fk = ent_id and Ent_INS in "|| lsIns2 ||" and ENT_ELE_EXT = :sExtElec and RES_T_DEP in ('C','D') 
	into  :lnNbCantonComplet " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 +  If lnNbCantonComplet = NUMBER_Null
.head 8 -  Set lnNbCantonComplet = 0
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If sSitNivSup = 'P' and sSitNivSup != ''
.head 8 -  Set lsFichier = VisStrSubstitute( lsFichier , "_XXX", "_" || SalStrRightX( "000" || SalNumberToStrX( lnNbBurDep, 0) ,3) )
.head 7 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  !
.head 8 -  Set lnJ = 0
.head 8 +  While lnJ < lnI
.head 9 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 9 -  Set lnJ = lnJ + 1
.head 8 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 -  !
.head 3 +  Function: PalEvolutionHitParadeCdt
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: sNivSup
.head 5 -  String: sWhereSuppl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsIns
.head 5 -  Number: lnIdEntite
.head 5 -  Sql Handle: lhSql
.head 5 -  String: sWhere
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 +  If sWhereSuppl != ''
.head 7 +  If sExtElec = 'EU' or sExtElec = 'SE'
.head 8 -  Set sWhere = " AND ENT_INS in (Select distinct ENT_INS_NIVSUPSUP  from entite where  @left(ENT_INS,1) IN "|| sWhereSuppl ||" and ent_ele_ext = :sExtElec and ent_niv_lettre = 'K') "
.head 7 +  Else
.head 8 -  Set sWhere = ' AND @left(ENT_INS,1) IN '|| sWhereSuppl
.head 6 +  ! If sExtElec = 'SE' and sNivSup = 'L'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select ent_ins, Ent_id, ENT_NIV_LETTRE
	from entite 
	where ent_ins is not null and ENT_NIV_LETTRE in ( 'L','C')  AND ENT_ELE_EXT = :sExtElec "|| sWhere ||"
	Order by 1
	into :lsIns, :lnIdEntite, :sNivSup " )
.head 6 -  ! Else
.head 6 -  Call SqlPrepareAndExecute( lhSql, "Select ent_ins, Ent_id
	from entite 
	where ent_ins is not null and ENT_NIV_LETTRE = :sNivSup AND ENT_ELE_EXT = :sExtElec "|| sWhere ||"
	Order by 1
	into :lsIns, :lnIdEntite " )
.head 6 +  While SqlFetchNext( lhSql, Btmp )
.head 7 -  Call PalResultatHitParadeCdt( sExtElec, sNivSup, lsIns, lnIdEntite )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlDisconnect( lhSql )
.head 3 +  Function: PalResultatHitParadeCdt
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: sNiveau
.head 5 -  String: psInsEntite
.head 5 -  Number: pnIdEntite
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnNbBurDepBxl
.head 5 -  Number: lnNbCanDefBxl
.head 5 -  Number: lnNbBurTotBxl
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBE_E5
.head 5 -  String: lsIns
.head 5 -  String: lsIns2
.head 5 -  String: lsFichier
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  String: lsNoGrp
.head 5 -  String: lsNoListe
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsCdtId
.head 5 -  String: lsDateDeces
.head 5 -  Number: lnSC1
.head 5 -  Number: lnSC2
.head 5 -  Number: lnSC3
.head 5 -  Number: lnSC4
.head 5 -  Number: lnVoix
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: nVoixTot
.head 5 -  Number: nVoixTotF
.head 5 -  Number: nVoixTotN
.head 5 -  Number: nVoixTotD
.head 5 -  Number: nVoix
.head 5 -  Number: nPenetration
.head 5 -  String: sId
.head 5 -  String: sConnuComme
.head 5 -  String: sSexe
.head 5 -  String: sSitElection
.head 5 -  String: sChiffrePenetration
.head 5 -  String: sRegLingCdt
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 +  If sNiveau = 'R' and psInsEntite = '00000'
.head 7 -  Set lsFichier = "RHR00000."|| sExtElec
.head 7 -  Call VisFileDelete( wsPathResult ||"\\RHR00000."|| sExtElec )
.head 6 +  Else
.head 7 -  Set lsFichier = "RH"|| sNiveau || psInsEntite ||"."|| sExtElec
.head 7 -  Call VisFileDelete( wsPathResult ||"\\"|| lsFichier )
.head 6 -  ! Bureaux depouillés et totaux
.head 6 +  If sNiveau = 'R' and psInsEntite = '00000'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)), sum(@nullvalue(RES_BDEP_TOT,1))   from result_scrutin where RES_ELE_EXT = :sExtElec 
	into :lnNbBurDep, :lnNbBurTot " )
.head 6 +  Else If sNiveau = 'C' and (sExtElec = 'SE' or sExtElec = 'EU')
.head 7 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 +  If psInsEntite = '21004'
.head 9 -  Set lsIns2 = "12025,92094"
.head 8 +  Else
.head 9 -  Set lsIns2 = psInsEntite
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)), sum(@nullvalue(RES_BDEP_TOT,1))   
	from result_scrutin , entite
	where RES_ELE_EXT = :sExtElec and RES_ENT_FK = ent_id  and ENT_DEP_LISTE = :lsIns2 
	into :lnNbBurDep, :lnNbBurTot " )
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)), sum(@nullvalue(RES_BDEP_TOT,1))   
	from result_scrutin 
	where RES_ELE_EXT = :sExtElec and RES_ENT_FK =:pnIdEntite
	into :lnNbBurDep, :lnNbBurTot " )
.head 6 -  Call SqlFetchNext( lhSql, Btmp )
.head 6 -  ! Bureaux sur Bxl
.head 6 +  If (sNiveau = 'C' or sNiveau = 'R') and (sExtElec = 'SE' or sExtElec = 'EU')
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0))/2, sum(@nullvalue(RES_BDEP_TOT,1))/2   
	from result_scrutin , entite
	where RES_ELE_EXT = :sExtElec and RES_ENT_FK = ent_id  and ENT_DEP_LISTE = '12025,92094' 
	into :lnNbBurDepBxl, :lnNbBurTotBxl " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Set lnNbBurDep = lnNbBurDep - lnNbBurDepBxl
.head 7 -  Set lnNbBurTot = lnNbBurTot - lnNbBurTotBxl
.head 6 +  If lnNbBurDep = lnNbBurTot
.head 7 -  Set sSitElection = 'D'
.head 6 +  Else If lnNbBurDep = 0 or lnNbBurDep = NUMBER_Null
.head 7 -  Set sSitElection = ''
.head 6 +  Else
.head 7 -  Set sSitElection = 'P'
.head 6 -  !
.head 6 -  ! Cantons définitifs
.head 6 +  If sNiveau = 'R' and psInsEntite = '00000'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from result_scrutin where RES_ELE_EXT = :sExtElec and @nullvalue(RES_T_DEP,'0') in ('C','D')
	into :lnNbCanDef " )
.head 6 +  Else If sNiveau = 'C' and (sExtElec = 'SE' or sExtElec = 'EU')
.head 7 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 +  If psInsEntite = '21004'
.head 9 -  Set lsIns2 = "12025,92094"
.head 8 +  Else
.head 9 -  Set lsIns2 = psInsEntite
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from result_scrutin , entite
	where RES_ELE_EXT = :sExtElec and RES_ENT_FK = ent_id  and ENT_DEP_LISTE = :lsIns2 and @nullvalue(RES_T_DEP,'0')  in ('C','D')

	into :lnNbCanDef " )
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)
	from result_scrutin 
	where RES_ELE_EXT = :sExtElec and RES_ENT_FK =:pnIdEntite and @nullvalue(RES_T_DEP,'0')  in ('C','D')

	into :lnNbCanDef " )
.head 6 -  Call SqlFetchNext( lhSql, Btmp )
.head 6 -  ! Bureaux sur Bxl
.head 6 +  If (sNiveau = 'C' or sNiveau = 'R') and (sExtElec = 'SE' or sExtElec = 'EU')
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select count(*)/2
	from result_scrutin , entite
	where RES_ELE_EXT = :sExtElec and RES_ENT_FK = ent_id  and ENT_DEP_LISTE = '12025,92094' and @nullvalue(RES_T_DEP,'0')  in ('C','D')
	into :lnNbCanDefBxl " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Set lnNbCanDef = lnNbCanDef - lnNbCanDefBxl
.head 6 -  !
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes C -- ATTENTION à revoir pour notion Partiel / Définitif
.head 7 -  Set lnI = 1
.head 7 -  ! Sur les conseils de Bruno,
.head 7 -  ! multiplié par 10  pour les décimal d'un integer perdu lors du select en divisant par 2 un nombre impair (BXL)
.head 7 +  If sNiveau = 'R' and psInsEntite = '00000'
.head 8 +  If sExtElec = 'EU'
.head 9 -  Set nVoixTotF = 0
.head 9 -  Set nVoixTotN = 0
.head 9 -  Set nVoixTotD = 0
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))
	from Result_scrutin
	where @nullvalue(RES_NB_VV,0)>0 and  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = 'EU' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK 
= 889 )
			and RES_ELE_EXT= 'EU' and RES_ENT_INS_SUP not in (92094,63023)
	into :nVoixTotN " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))
	from Result_scrutin
	where @nullvalue(RES_NB_VV,0)>0 and  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = 'EU' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK 
= 891 )
			and RES_ELE_EXT= 'EU' and RES_ENT_INS_SUP not in (12025,63023)
	into :nVoixTotF " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_NB_VV,0))
	from Result_scrutin
	where @nullvalue(RES_NB_VV,0)>0 and  Exists (Select Ent_id from entite , result_Listes, Listes where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = 'EU' and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and LIS_ENT_FK 
= 890 )
			and RES_ELE_EXT= 'EU' and RES_ENT_INS_SUP = '63023'
	into :nVoixTotD " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "
   Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum(@if(@value(@left(RES_ENT_INS,2))-21, @if(@value(@left(RES_ENT_INS,2))-23, @nullvalue(rec_nb_voix*10,0), @nullvalue(rec_nb_voix*10,0)/2 ), @nullvalue(rec_nb_voix*10,0)/2 ))
					 , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin
	where rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe,  :nVoix, :nVoixTot " )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "
   Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , LIS_INSBUR , 
		sum(@if(@value(@left(RES_ENT_INS,2))-21, @if(@value(@left(RES_ENT_INS,2))-23, @nullvalue(rec_nb_voix*10,0), @nullvalue(rec_nb_voix*10,0)/2 ), @nullvalue(rec_nb_voix*10,0)/2 ))
	from result_cdt ,Candidats, result_scrutin, Listes
	where @nullvalue(rec_nb_voix*10,0)> 0 and rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec  and RECL_LIS_FK = lis_Id
	group by 1,2,3,4
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 5 desc
	into :sId, :sConnuComme, :sSexe, :sRegLingCdt,  :nVoix " )
.head 8 +  Else If sExtElec = 'SE'
.head 9 -  Set nVoixTotF = 0
.head 9 -  Set nVoixTotN = 0
.head 9 -  Call SqlPrepareAndExecute( lhSql, "select sum(RES_NB_VV) from result_scrutin, entite 
	where RES_ELE_EXT  = 'SE' and RES_ENT_FK = ent_id and ENT_DEP_LISTE like '%12025%' and RES_ENT_INS_SUP != 92094
	into :nVoixTotN " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "select sum(RES_NB_VV) from result_scrutin, entite 
	where RES_ELE_EXT  = 'SE' and RES_ENT_FK = ent_id and ENT_DEP_LISTE like '%92094%' and RES_ENT_INS_SUP != 12025
	into :nVoixTotF " )
.head 9 -  Call SqlFetchNext( lhSql, Btmp )
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "
   Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum(@nullvalue(rec_nb_voix*10,0))
					 , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin
	where rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and RES_ENT_INS_SUP != 
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "
   Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe, LIS_INSBUR  , 
			sum(@if(@value(@left(RES_ENT_INS,2))-21, @if(@value(@left(RES_ENT_INS,2))-23, @nullvalue(rec_nb_voix*10,0), @nullvalue(rec_nb_voix*10,0)/2 ), @nullvalue(rec_nb_voix*10,0)/2 ))
	from result_cdt ,Candidats, result_scrutin, Listes
	where  @nullvalue(rec_nb_voix*10,0)> 0 and  rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec   and RECL_LIS_FK = lis_Id
	group by 1,2,3,4
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 5 desc
	into :sId, :sConnuComme, :sSexe, :sRegLingCdt,  :nVoix " )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "
   Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum(@if(@value(@left(RES_ENT_INS,2))-21, @if(@value(@left(RES_ENT_INS,2))-23, @nullvalue(rec_nb_voix*10,0), @nullvalue(rec_nb_voix*10,0) ), @nullvalue(rec_nb_voix*10,0) )) 
					 , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin
	where  @nullvalue(rec_nb_voix*10,0)> 0 and rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec 
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 7 +  Else If sNiveau = 'C' and (sExtElec = 'SE' or sExtElec = 'EU')
.head 8 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 9 +  If psInsEntite = '21004'
.head 10 -  Set lsIns2 = "12025,92094"
.head 10 -  ! Call SqlPrepareAndExecute( lhSql, "Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum(@nullvalue(rec_nb_voix,0) )/2  , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin, entite
	where rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and res_ENT_FK = ENT_ID and ENT_DEP_LISTE = :lsIns2
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , Sum(@nullvalue(rec_nb_voix*10,0)/2)  ,Sum(@nullvalue(res_nb_VV,0))
	from result_cdt ,Candidats, result_scrutin, entite
	where  @nullvalue(rec_nb_voix*10,0)> 0 and rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and res_ENT_FK = ENT_ID and 
		(ENT_DEP_LISTE = :lsIns2 or (ENT_DEP_LISTE=12025 and ENT_INS like '23%' ))
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc 
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 9 +  Else
.head 10 -  Set lsIns2 = psInsEntite
.head 10 -  Call SqlPrepareAndExecute( lhSql, "Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum(@nullvalue(rec_nb_voix*10,0) )  , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin, entite
	where  @nullvalue(rec_nb_voix*10,0)> 0 and  rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and res_ENT_FK = ENT_ID and 
		(ENT_DEP_LISTE = :lsIns2 and ENT_INS not like '23%' ) 
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 7 +  Else If (sNiveau = 'R' and sExtElec = 'BR') 
.head 8 -  Set lsIns2 = psInsEntite
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum(@nullvalue(rec_nb_voix*10,0) )  , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin, entite
	where  @nullvalue(rec_nb_voix*10,0)> 0 and rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and res_ENT_FK = ENT_ID and ENT_DEP_LISTE = :lsIns2
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 7 +  Else If (sNiveau = 'G' and sExtElec = 'DE') 
.head 8 -  Set lsIns2 = psInsEntite
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum(@nullvalue(rec_nb_voix*10,0) )  , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin, entite
	where  @nullvalue(rec_nb_voix*10,0)> 0 and rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and res_ENT_FK = ENT_ID and ENT_DEP_LISTE = :lsIns2
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 7 +  Else
.head 8 +  If (sExtElec = 'EU') and sNiveau = 'L'
.head 9 +  If psInsEntite = '92094'
.head 10 -  Set lsIns2 = ' not in (12025,63023) '
.head 9 +  Else If psInsEntite = '12025'
.head 10 -  Set lsIns2 = ' not in (92094,63023) '
.head 9 +  Else If psInsEntite = '63023'
.head 10 -  Set lsIns2 = "= '63023' "
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "
   Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum(@if(@value(@left(RES_ENT_INS,2))-21, @if(@value(@left(RES_ENT_INS,2))-23, @nullvalue(rec_nb_voix*10,0), @nullvalue(rec_nb_voix*10,0)/2 ), @nullvalue(rec_nb_voix*10,0)/2 ))
					 , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin
	where rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and CDT_ENT_FK = :pnIdEntite 
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 9 -  Call SqlPrepareAndExecute( lhSql, "
   Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum( @nullvalue(rec_nb_voix*10,0) )
				 , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin
	where  @nullvalue(rec_nb_voix*10,0)> 0 and rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and CDT_ENT_FK = :pnIdEntite and RES_ENT_INS_SUP "|| lsIns2 || "
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 8 +  Else If (sExtElec = 'SE' ) and sNiveau = 'L'
.head 9 -  ! Call SqlPrepareAndExecute( lhSql, "
   Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum(@if(@value(@left(RES_ENT_INS,2))-21, @if(@value(@left(RES_ENT_INS,2))-23, @nullvalue(rec_nb_voix*10,0), @nullvalue(rec_nb_voix*10,0)/2 ), @nullvalue(rec_nb_voix*10,0)/2 ))
					 , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin
	where rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and CDT_ENT_FK = :pnIdEntite 
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 9 +  If psInsEntite = '92094'
.head 10 -  Set lsIns2 = '12025'
.head 9 +  Else
.head 10 -  Set lsIns2 = '92094'
.head 9 -  Call SqlPrepareAndExecute( lhSql, "
   Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum( @nullvalue(rec_nb_voix*10,0) )
					 , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin
	where  @nullvalue(rec_nb_voix*10,0)> 0 and rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and CDT_ENT_FK = :pnIdEntite and RES_ENT_INS_SUP != :lsIns2
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 8 +  Else If sExtElec = 'CK' or  sExtElec = 'WL' or sExtElec = 'VL' or  ((sExtElec = 'SE' or sExtElec = 'EU') and SalStrLeftX(psInsEntite,2) != '21' and SalStrLeftX(psInsEntite,2) != '23')
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum(@nullvalue(rec_nb_voix*10,0) )  , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin
	where  @nullvalue(rec_nb_voix*10,0)> 0 and rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and CDT_ENT_FK = :pnIdEntite
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( lhSql, "Select rec_cdt_fk, cdt_ConnuComme, cdt_Sexe , sum(@nullvalue(rec_nb_voix*10,0) ) /2 , sum(@nullvalue(res_nb_VV,0) )
	from result_cdt ,Candidats, result_scrutin
	where  @nullvalue(rec_nb_voix*10,0)> 0 and rec_cdt_fk = cdt_id and rec_ent_fk = res_ent_fk and REC_ELE_EXT = :sExtElec and CDT_ENT_FK = :pnIdEntite
	group by 1,2,3
	HAVING sum(@nullvalue(rec_nb_voix,0) ) > 0
	order by 4 desc
	into :sId, :sConnuComme, :sSexe, :nVoix, :nVoixTot " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If sNiveau = 'R' and psInsEntite = '00000'
.head 9 +  If sExtElec = 'SE'
.head 10 +  If sRegLingCdt = '92094'
.head 11 -  Set nVoixTot = nVoixTotF
.head 10 +  Else
.head 11 -  Set nVoixTot = nVoixTotN
.head 9 +  Else If sExtElec = 'EU'
.head 10 +  If sRegLingCdt = '92094'
.head 11 -  Set nVoixTot = nVoixTotF
.head 10 +  Else If sRegLingCdt = '12025'
.head 11 -  Set nVoixTot = nVoixTotN
.head 10 +  Else
.head 11 -  Set nVoixTot = nVoixTotD
.head 8 -  !
.head 8 -  Set nVoix = nVoix / 10
.head 8 -  Set nPenetration = nVoix / nVoixTot * 100
.head 8 -  Set sChiffrePenetration = VisStrSubstitute ( SalNumberToStrX( nPenetration,2), ',', '.' )
.head 8 -  Set lsBuffer[lnI] = '"C","'|| sId ||'","'|| SalNumberToStrX( nVoix,0) ||'","' || sChiffrePenetration ||'","' || sSitElection ||'"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  Set lnI = lnI +1
.head 8 +  ! If lnI > 200 and sExtElec != 'EU'
.head 9 -  Break 
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 -  ! Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitElection ||'","'|| SalNumberToStrX( lnNbBurDep,0)   ||'","XXXX","'|| sDate ||'","'|| sHeure ||'","'|| SalNumberToStrX( lnNbBurTot,0) || '"'
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitElection ||'","'|| SalNumberToStrX( lnNbBurDep,0) ||'","'|| SalNumberToStrX( lnNbCanDef,0)  ||'","XXXX","'|| sDate ||'","'|| sHeure ||'","'|| SalNumberToStrX( lnNbBurTot,0) || '"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If lnI > 1
.head 8 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 9 -  !
.head 9 -  Set lnJ = 0
.head 9 +  While lnJ < lnI
.head 10 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 10 -  Set lnJ = lnJ + 1
.head 9 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 -  !
.head 3 +  Function: PalDtmSiege
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nSommeCE
.head 5 -  Number: nSiegeTot
.head 5 -  Number: nCE[*]
.head 5 -  String: sAListeNo[*]
.head 5 -  Receive Number: nASiege[*]
.head 5 -  String: sElection
.head 5 -  Number: nSC14[*]
.head 5 -  Number: nSC23[*]
.head 5 -  String: psIns
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nI
.head 5 -  Number: nJ
.head 5 -  Number: nK
.head 5 -  Number: nDiv
.head 5 -  !
.head 5 -  Number: nIdListeN
.head 5 -  Number: nIdListeN1
.head 5 -  Number: nVoixN
.head 5 -  Number: nVoixN1
.head 5 -  Number: nDiviseurN
.head 5 -  Number: nDiviseurN1
.head 5 -  Number: nRowListeN
.head 5 -  Number: nRowListeN1
.head 5 -  Number: nNoListeN
.head 5 -  Number: nNoListeN1
.head 5 -  String: sDateNaisN
.head 5 -  String: sDateNaisN1
.head 5 -  Boolean: bEgalite
.head 4 +  Actions
.head 5 -  Call SalTblReset( tblDiviseur )
.head 5 -  Set nI = 1
.head 5 +  While nI <= nSiegeTot
.head 6 -  Set nJ  = 0
.head 6 +  While sAListeNo[nJ] != ""
.head 7 -  Set nASiege[ nJ ] =  0
.head 7 +  If (nCE[nJ] >= nSommeCE * 5 / 100 and sElection != 'EU') 
or (sElection = 'EU' and nCE[nJ] >0)
.head 8 -  Set nDiv = nCE[nJ] / nI
.head 8 -  !
.head 8 -  Set nK = SalTblInsertRow( tblDiviseur, TBL_MaxRow )
.head 8 -  Call SalTblSetContext( tblDiviseur, nK )
.head 8 -  Set tblDiviseur.colRowListe = nJ
.head 8 -  Set tblDiviseur.colNoListe = SalStrToNumber(sAListeNo[ nJ ])
.head 8 -  Set tblDiviseur.colDiv = nDiv
.head 8 -  Set tblDiviseur.colDivStrTri = SalStrRightX('000000000' || SalNumberToStrX(nDiv,4),14) ||'#'||SalStrRightX('000' || SalNumberToStrX(nI,0),3)
.head 7 -  Set nJ = nJ + 1
.head 6 -  Set nI = nI +1
.head 5 -  ! Call SalTblSortRows( tblDiviseur, 3, TBL_SortDecreasing  )
.head 5 -  Call SalTblSortRows( tblDiviseur, 4, TBL_SortDecreasing  )
.head 5 -  !
.head 5 -  Set nJ = 0
.head 5 +  While nJ < nSiegeTot
.head 6 -  Call SalTblSetContext( tblDiviseur, nJ )
.head 6 -  Set nASiege[ tblDiviseur.colRowListe ] =  nASiege[ tblDiviseur.colRowListe ] + 1
.head 6 -  Set nDiviseurN = tblDiviseur.colDiv
.head 6 -  Set nNoListeN =  tblDiviseur.colNoListe
.head 6 -  Set nRowListeN =  tblDiviseur.colRowListe
.head 6 -  Set nJ = nJ + 1
.head 5 -  Call SalTblSetContext( tblDiviseur, nJ )
.head 5 -  Set nDiviseurN1 = tblDiviseur.colDiv
.head 5 -  Set nNoListeN1 =   tblDiviseur.colNoListe
.head 5 -  Set nRowListeN1 =  tblDiviseur.colRowListe
.head 5 +  If nDiviseurN1 = nDiviseurN
.head 6 -  Set bEgalite = TRUE
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select LIS_ID from listes where Lis_ELE_Ext = :sElection and LIS_NO = :nNoListeN and LIS_INSBUR=:psIns into :nIdListeN " )
.head 6 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select LIS_ID from listes where Lis_ELE_Ext = :sElection and LIS_NO = :nNoListeN1 and LIS_INSBUR=:psIns into :nIdListeN1 " )
.head 6 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 6 -  Set nVoixN= PalDtmCdtEgalite( nASiege[ nRowListeN ] , nIdListeN, sDateNaisN , sElection, nCE[nRowListeN] ,nSC14[nRowListeN] ,psIns)
.head 6 -  Set nVoixN1= PalDtmCdtEgalite( nASiege[ nRowListeN1 ]+1 , nIdListeN1, sDateNaisN1, sElection, nCE[nRowListeN1], nSC14[nRowListeN] ,psIns) 
.head 6 +  If nVoixN1 > nVoixN
.head 7 -  Set nASiege[ nRowListeN ] = nASiege[ nRowListeN] -1
.head 7 -  Set nASiege[ nRowListeN1 ] = nASiege[ nRowListeN1] +1
.head 6 +  Else If nVoixN1=nVoixN
.head 7 +  If SalStrToNumber( sDateNaisN1 ) < SalStrToNumber( sDateNaisN )
.head 8 -  Set nASiege[ nRowListeN ] = nASiege[ nRowListeN] -1
.head 8 -  Set nASiege[ nRowListeN1 ] = nASiege[ nRowListeN1] +1
.head 5 -  !
.head 3 +  Function: PalDtmCdtEgalite
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Number: nSiege
.head 5 -  Number: lnIdListe
.head 5 -  Receive String: sDateNais
.head 5 -  String: sExtElec
.head 5 -  Number: lnCEListe
.head 5 -  Number: lnSC14Liste
.head 5 -  String: psIns
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nI
.head 5 -  Number: nJ
.head 5 -  Number: nK
.head 5 -  Number: nCE_Cdt
.head 5 -  Number: nRow
.head 5 -  Number: nDiv
.head 5 -  Number: nASiege[*]
.head 5 -  ! Number: nSiege
.head 5 -  Number: nCdt
.head 5 -  Number: nChiffreElig
.head 5 -  Number: nPotEff
.head 5 -  Number: nPotSuppl
.head 5 -  Long String: llsNN_Elu
.head 5 -  Boolean: bElu
.head 5 -  Number: nNN_DejaElu
.head 4 +  Actions
.head 5 -  Call SalTblReset( tblCdt_E )
.head 5 +  If sExtElec ='CK' or sExtElec ='WL'  or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 6 -  Call SalTblPopulate(tblCdt_E, ghSqlSecondaire, "Select REC_CDT_NO, CDT_DATEDECES, CDT_SEXE, sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and recl_lis_fk=CDT_LIS_FK and REC_CDT_TYPE = 'E' and rec_ent_fk  in (Select Ent_id from entite where ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdt_E.colNo,:tblCdt_E.colDateDeces, :tblCdt_E.colSexe , :tblCdt_E.colVoix , :tblCdt_E.colNN ", TBL_FillAll)
.head 5 +  Else If sExtElec ='SE' or  sExtElec ='EU'
.head 6 -  Call SalTblPopulate(tblCdt_E, ghSqlSecondaire, "Select REC_CDT_NO,CDT_DATEDECES, CDT_SEXE, sum(@nullvalue(REC_NB_VOIX,0)),CDT_NN
	from Candidats, result_cdt
	where REC_CDT_FK = CDT_ID and REC_CDT_TYPE = 'E' and recl_lis_fk=CDT_LIS_FK and rec_ent_fk  in (Select Ent_id from entite where ENT_ELE_EXT = :sExtElec )
		and recl_lis_fk = :lnIdListe
	group by 1,2,3,5
	order by 1
	into :tblCdt_E.colNo,:tblCdt_E.colDateDeces, :tblCdt_E.colSexe , :tblCdt_E.colVoix, :tblCdt_E.colNN ", TBL_FillAll )
.head 5 +  If SalTblAnyRows( tblCdt_E, 0,0 )
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select LIS_NBEFF from Listes where Lis_Id = :lnIdListe into :nCdt ")
.head 6 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 6 -  Set nChiffreElig = SalNumberRound( lnCEListe / (nSiege+1) + 0.499999999)
.head 6 -  Set nPotEff = SalNumberRound(  ( lnSC14Liste)/2 + 0.499999 )
.head 6 -  !
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select LIS_NBEFF from Listes where Lis_Id = :lnIdListe into :nCdt ")
.head 6 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 6 -  Set nJ = -1
.head 6 +  While SalTblFindNextRow( tblCdt_E, nJ, 0,0 )
.head 7 -  Call SalTblSetContext( tblCdt_E, nJ )
.head 7 +  If tblCdt_E.colDateDeces = ''
.head 8 +  If nPotEff > 0 and nCdt != nSiege
.head 9 +  If tblCdt_E.colVoix >= nChiffreElig
.head 10 -  Set tblCdt_E.colVoixPot = 0
.head 9 +  Else
.head 10 +  If nPotEff >= nChiffreElig - tblCdt_E.colVoix
.head 11 -  Set tblCdt_E.colVoixPot = nChiffreElig - tblCdt_E.colVoix
.head 10 +  Else
.head 11 -  Set tblCdt_E.colVoixPot = nPotEff
.head 10 -  Set nPotEff = nPotEff - tblCdt_E.colVoixPot
.head 9 -  Set tblCdt_E.colRestPot = nPotEff
.head 9 -  ! Set tblCdt_E.colDevol = tblCdt_E.colVoix + tblCdt_E.colVoixPot
.head 9 -  Set tblCdt_E.colDevol = tblCdt_E.colVoix
.head 8 +  Else
.head 9 -  Set tblCdt_E.colVoixPot = 0
.head 9 -  Set tblCdt_E.colDevol = tblCdt_E.colVoix
.head 9 -  Set tblCdt_E.colRestPot = 0
.head 8 -  Set tblCdt_E.colDevolNo = SalStrRightX( '0000000000' || SalNumberToStrX(tblCdt_E.colDevol, 0 ), 10) || "-"|| SalStrRightX( '000' || SalNumberToStrX(nCdt - tblCdt_E.colNo, 0 ), 3 )
.head 6 -  !
.head 6 -  ! Call SalTblSortRows( tblCdt_E, 5, TBL_SortDecreasing )
.head 6 -  Call SalTblSortRows( tblCdt_E, 10, TBL_SortDecreasing )
.head 6 -  !
.head 6 -  Set llsNN_Elu = ''
.head 6 -  Set nJ = 0
.head 6 +  While nJ < nSiege
.head 7 -  Call SalTblSetContext( tblCdt_E, nJ )
.head 7 +  If nJ = nSiege-1
.head 8 -  Set nCE_Cdt= tblCdt_E.colDevol
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select CDT_DATNAIS from candidats
	where CDT_LIS_FK=:lnIdListe and CDT_TYPECDT='E' and CDT_NOORDRE=:tblCdt_E.colNo
	into :sDateNais ")
.head 8 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 -  Set sDateNais = SalStrRightX( sDateNais,4)|| SalStrMidX( sDateNais, 3,2) || SalStrLeftX( sDateNais, 2 )
.head 8 -  Break
.head 7 -  Set nJ = nJ + 1
.head 6 -  !
.head 6 -  Call SalTblSortRows( tblCdt_E, 1, TBL_SortIncreasing )
.head 6 -  !
.head 6 -  Call SalTblSortRows( tblCdt_E, 1, TBL_SortIncreasing )
.head 6 -  !
.head 6 -  Return nCE_Cdt
.head 3 +  Function: PalResultatSiege_NivRoyaume
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  String: lsIns
.head 5 -  String: lsFichier
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  String: sIdGrp
.head 5 -  String: sHomme
.head 5 -  String: sFemme
.head 5 -  String: sSitElection
.head 5 -  String: sSiege
.head 5 -  String: sInsEnt
.head 5 -  String: sE1830
.head 5 -  String: sE3140
.head 5 -  String: sE4150
.head 5 -  String: sE5160
.head 5 -  String: sE61
.head 5 -  String: sE1830M
.head 5 -  String: sE3140M
.head 5 -  String: sE4150M
.head 5 -  String: sE5160M
.head 5 -  String: sE61M
.head 5 -  String: sE1830F
.head 5 -  String: sE3140F
.head 5 -  String: sE4150F
.head 5 -  String: sE5160F
.head 5 -  String: sE61F
.head 5 -  String: sE_tot
.head 5 -  String: sNiv
.head 5 -  String: sIdEnt
.head 5 -  String: lsWhereCK_BHV
.head 5 -  Number: lnNbBurDepBxl
.head 5 -  Number: lnNbBurTotBxl
.head 5 -  Number: lnNbCantonTotBxl
.head 5 -  Number: lnNbCantonTraitesBxl 
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  ! Fichier R - distribution des sièges
.head 6 -  Set lsFichier = "RSR00000."|| sExtElec
.head 6 -  Call VisFileDelete( wsPathResult ||"\\RSR00000."|| sExtElec )
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Ligne L
.head 7 -  !
.head 7 -  Set lsWhereCK_BHV = ''
.head 7 +  If sExtElec = 'CK' and wsDiffuseElusCK_BHV != '1'
.head 8 -  Set lsWhereCK_BHV = " and ELU_ENTITE  != '21004' "
.head 7 -  Set lnI = 1
.head 7 -  Call SqlPrepareAndExecute( lhSql, "select elu_ListeGrp, sum(@nullvalue(elu_sieges,0)), sum(@nullvalue(elu_homme,0)), sum(@nullvalue(elu_femme,0))
	from result_elu_royaume
	where elu_elect = :sExtElec "|| lsWhereCK_BHV ||"
	group by 1
	order by 1
	into :sIdGrp , :sSiege, :sHomme, :sFemme " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If SalStrToNumber( sSiege ) != SalStrToNumber( sHomme ) + SalStrToNumber( sFemme )
.head 9 -  Set sHomme = ''
.head 9 -  Set sFemme = ''
.head 8 -  Set lsBuffer[lnI] = '"L","'|| sIdGrp ||'","'|| sSiege ||'","' || sHomme ||'","' || sFemme ||'"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  Set lnI = lnI +1
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)), sum(@nullvalue(RES_BDEP_TOT,1)), sum(@nullvalue(RES_SIT_DEP,0))    
	from result_scrutin where RES_ELE_EXT = :sExtElec  and RES_NIV_LETTRE = 'K' 
	into :lnNbBurDep, :lnNbBurTot, :lnNbCanDef " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  ! Retrait BXL en double au SE et EU
.head 7 +  If (sExtElec = 'SE' or sExtElec = 'EU')
.head 8 -  ! Call SqlPrepareAndExecute( lhSql, "Select count(*)/2, sum(@nullvalue(res_sit_dep,0))/2 
	from result_scrutin 
	where  RES_ELE_EXT = :sExtElec and @left(Res_ent_ins,2) in ('21','23')  
	into :lnNbCantonTotBxl , :lnNbCantonTraitesBxl " ) 
.head 8 -  ! Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_BDEP_TRAIT,0))/2,sum(@nullvalue(RES_BDEP_TOT,1))/2   
	from result_scrutin
	where  RES_ELE_EXT = :sExtElec and @left(Res_ent_ins,2) in ('21','23') 
	into :lnNbBurDepBxl , :lnNbBurTotBxl " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  ! Set lnNbCantonTot = lnNbCantonTot - lnNbCantonTotBxl
.head 8 -  ! Set lnNbCantonTraites = lnNbCantonTraites - lnNbCantonTraitesBxl
.head 8 -  Set lnNbBurDep = lnNbBurDep - lnNbBurDepBxl
.head 8 -  Set lnNbBurTot = lnNbBurTot - lnNbBurTotBxl
.head 7 -  !
.head 7 -  !
.head 7 +  If lnNbBurDep = lnNbBurTot
.head 8 -  Set sSitElection = 'D'
.head 7 +  Else If lnNbBurDep = 0 or lnNbBurDep = NUMBER_Null
.head 8 -  Set sSitElection = ''
.head 7 +  Else
.head 8 -  Set sSitElection = 'P'
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitElection ||'","'|| SalNumberToStrX( lnNbBurDep,0) ||'","'|| SalNumberToStrX( lnNbCanDef,0)  ||'","XXXX","'|| sDate ||'","'|| sHeure ||'","'|| SalNumberToStrX( lnNbBurTot,0) || '"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  !
.head 8 -  Set lnJ = 0
.head 8 +  While lnJ < lnI
.head 9 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 9 -  Set lnJ = lnJ + 1
.head 8 -  Call SalFileClose( lhFileRER )
.head 6 -  !
.head 6 -  ! Fichier R par tranches d'age
.head 6 -  Set lsFichier = "RTR00000."|| sExtElec
.head 6 -  Call VisFileDelete( wsPathResult ||"\\RTR00000."|| sExtElec )
.head 6 +  If TRUE
.head 7 -  ! Ligne E
.head 7 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Set sNiv = 'L'
.head 7 +  Else If sExtElec = 'CK' or sExtElec = 'WL'  or sExtElec = 'VL' 
.head 8 -  Set sNiv = 'C'
.head 7 +  Else If sExtElec = 'BR' 
.head 8 -  Set sNiv = 'R'
.head 7 +  Else If sExtElec = 'DE' 
.head 8 -  Set sNiv = 'G'
.head 7 -  Set lnI = 1
.head 7 -  Call SqlPrepareAndExecute( lhSql, "select elu_entite, sum(@nullvalue(ELU_1830,0)),  sum(@nullvalue(ELU_3140,0)),  sum(@nullvalue(ELU_4150,0)),   sum(@nullvalue(ELU_5160,0)), sum(@nullvalue(ELU_60,0)) , 
		sum(@nullvalue(ELU_1830,0))+sum(@nullvalue(ELU_3140,0))+sum(@nullvalue(ELU_4150,0))+sum(@nullvalue(ELU_5160,0) )+sum(@nullvalue(ELU_60,0))  ,
		sum(@nullvalue(ELU_M_1830,0)),  sum(@nullvalue(ELU_M_3140,0)),  sum(@nullvalue(ELU_M_4150,0)),   sum(@nullvalue(ELU_M_5160,0)), sum(@nullvalue(ELU_M_60,0)),
		sum(@nullvalue(ELU_F_1830,0)),  sum(@nullvalue(ELU_F_3140,0)),  sum(@nullvalue(ELU_F_4150,0)),   sum(@nullvalue(ELU_F_5160,0)), sum(@nullvalue(ELU_F_60,0))
	from RESULT_ELU_ROYAUME
	where elu_elect = :sExtElec  "|| lsWhereCK_BHV ||"
	group by 1
	Order by 1
	into :sInsEnt , :sE1830, :sE3140, :sE4150, :sE5160, :sE61, :sE_tot , :sE1830M, :sE3140M, :sE4150M, :sE5160M, :sE61M, :sE1830F, :sE3140F, :sE4150F, :sE5160F, :sE61F " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql2, "select Ent_id
	from entite
	where Ent_ins = :sInsEnt and ent_ele_ext = :sExtElec and ent_niv_Lettre = :sNiv
	into :sIdEnt " )
.head 8 -  Call SqlFetchNext( lhSql2, Btmp )
.head 8 -  Set lsBuffer[lnI] = '"E","'|| sIdEnt ||'","'|| sExtElec ||'","' || sNiv ||'","' || sInsEnt  ||'","' || sE_tot  ||'","' || sE1830 ||'","' || sE3140 ||'","' || sE4150  ||'","' || sE5160  ||'","' || sE61
	 ||'","' || sE1830F ||'","' || sE3140F ||'","' || sE4150F  ||'","' || sE5160F  ||'","' || sE61F
	 ||'","' || sE1830M ||'","' || sE3140M ||'","' || sE4150M  ||'","' || sE5160M  ||'","' || sE61M ||'"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  Set lnI = lnI +1
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitElection ||'","'|| SalNumberToStrX( lnNbBurDep,0) ||'","'|| SalNumberToStrX( lnNbBurTot,0)  ||'","XXXX","'|| sDate ||'","'|| sHeure  || '"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  !
.head 8 -  Set lnJ = 0
.head 8 +  While lnJ < lnI
.head 9 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 9 -  Set lnJ = lnJ + 1
.head 8 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 -  !
.head 3 +  Function: PalEvolutionAnalyseDetail
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: sNiv
.head 5 -  String: sWhereSuppl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsIns
.head 5 -  Number: lnIdEntite
.head 5 -  Sql Handle: lhSql
.head 5 -  String: sWhere
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 +  If sNiv != 'R' or (sNiv = 'R' and sExtElec = 'BR')
.head 7 -  Set sWhere = ''
.head 7 +  If sWhereSuppl != '' and sExtElec != 'BR'
.head 8 -  Set sWhere = ' AND @left(ENT_INS,1) IN '|| sWhereSuppl
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select ent_ins, Ent_id
	from entite 
	where ent_ins is not null and ENT_NIV_LETTRE = :sNiv AND ENT_ELE_EXT = :sExtElec "|| sWhere ||"
	Order by 1
	into :lsIns, :lnIdEntite " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 -  Call PalResultatAnalyseDetail( sExtElec, lsIns, lnIdEntite , sNiv)
.head 6 +  Else
.head 7 -  Call PalResultatAnalyseDetailRoyaume( sExtElec, '00000' )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlDisconnect( lhSql )
.head 3 +  Function: PalResultatAnalyseDetail
.head 4 -  Description: Analyse détaillée = Circ. pour la chambre
                	Province pour le sénat
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: psIns
.head 5 -  Number: nEntiteId
.head 5 -  String: sNiv
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBE_E5
.head 5 -  String: lsGrpLing
.head 5 -  String: lsIns
.head 5 -  String: lsIns2
.head 5 -  String: lsFichier
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  String: lsTmp2
.head 5 -  String: lsGrpLis
.head 5 -  String: lsWhere
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  String: lsNoGrp
.head 5 -  String: lsNoListe
.head 5 -  Number: lnIdListe
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsCdtId
.head 5 -  String: sSitNivSup
.head 5 -  String: lsDateDeces
.head 5 -  Number: lnCE
.head 5 -  Number: lnVoixTot
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnTri
.head 5 -  Number: nSommeCE
.head 5 -  Number: lnNbSiege
.head 5 -  Number: lnPremLnI
.head 5 -  Number: nDiv
.head 5 -  Number: nK
.head 5 -  Number: nRowEluEff
.head 5 -  Number: nRowEluSuppl
.head 5 -  Number: nResteSiege
.head 5 -  Number: lnIdEntite
.head 5 -  !
.head 5 -  Number: nCE[*]
.head 5 -  String: sAListeNo[*]
.head 5 -  Number: nASiege[*]
.head 5 -  Number: nAChiffreElig[*]
.head 5 -  Number: nPotEff[*]
.head 5 -  Number: nPotSuppl[*]
.head 5 -  String: sNoEluE
.head 5 -  String: sNoEluS
.head 5 -  String: sDevol
.head 5 -  String: sResteDevol
.head 5 -  Number: nFemmeElu
.head 5 -  Number: nHommeElu
.head 4 +  Actions
.head 5 -  Set lnNbBurDep = 0
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  Set sSitNivSup = ''
.head 6 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin 
	where exists (Select Ent_id from entite where RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0) != 1 ) " )
.head 6 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 7 +  If SalStrLeftX( psIns,1) = '2' and (sExtElec = 'SE' or sExtElec = 'EU')
.head 8 +  If psIns = '21004'
.head 9 -  Set lsWhere = "@Left(ENT_INS,2) IN('21', '23') and ENT_NIV_LETTRE = 'K' "
.head 8 +  Else
.head 9 -  Set lsWhere = "@Left(ENT_INS,2) = '"|| SalStrLeftX( psIns ,2) ||"' and ENT_NIV_LETTRE = 'K' "
.head 7 +  Else
.head 8 +  If sExtElec = 'SE' or (sExtElec = 'EU'  and SalStrLeftX( psIns,1) != '6' )
.head 9 -  Set lsWhere = "@Left(ENT_INS,1) = '"|| SalStrLeftX( psIns,1) ||"' and ENT_NIV_LETTRE = 'K' "
.head 8 +  Else If sExtElec = 'EU'  and SalStrLeftX( psIns,1) = '6' 
.head 9 +  If psIns = '62063'
.head 10 -  Set lsWhere = "@Left(ENT_INS,1) = '"|| SalStrLeftX( psIns,1) ||"' and ENT_INS not in ('63023', '63067') and ENT_NIV_LETTRE = 'K' "
.head 9 +  Else
.head 10 -  Set lsWhere = "@Left(ENT_INS,1) = '"|| SalStrLeftX( psIns,1) ||"' and ENT_INS in ('63023', '63067') and ENT_NIV_LETTRE = 'K' "
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where Exists (Select Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
				"|| lsWhere ||"  and @nullvalue(RES_SIT_DEP,0) != 1)  ")
.head 6 +  If SqlFetchNext( lhSql, Btmp )
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin 
	where Exists (Select Ent_id from entite where RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec and @nullvalue(RES_SIT_DEP,0)= 0 ) " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 +  If SalStrLeftX( psIns,1) = '2' and (sExtElec = 'SE' or sExtElec = 'EU')
.head 9 +  If psIns = '21004'
.head 10 -  Set lsWhere = "@Left(ENT_INS,2) IN('21', '23') and ENT_NIV_LETTRE = 'K' "
.head 9 +  Else
.head 10 -  Set lsWhere = "@Left(ENT_INS,2) = '"|| SalStrLeftX( psIns ,2) ||"' and ENT_NIV_LETTRE = 'K' "
.head 8 +  Else
.head 9 -  Set lsWhere = "@Left(ENT_INS,1) = '"|| SalStrLeftX( psIns,1) ||"' and ENT_NIV_LETTRE = 'K' "
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select *
	from Result_scrutin
	where Exists (Select Ent_id from entite , result_Listes, Listes where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec and ENT_ID = REL_ENT_FK and REL_LIS_FK = LIS_ID and 
				"|| lsWhere ||"  and @nullvalue(RES_SIT_DEP,0)=0 )  ")
.head 7 +  If SqlFetchNext( lhSql, Btmp )
.head 8 -  Set sSitNivSup = 'P'
.head 7 +  Else
.head 8 -  Set sSitNivSup = ''
.head 6 +  Else
.head 7 -  Set sSitNivSup = 'D'
.head 6 -  Set lsTmp2 = sNiv
.head 6 +  If sSitNivSup = 'P' or sSitNivSup = ''
.head 7 -  ! Set sSitNivSup = 'P'
.head 7 -  Set lsFichier = "RA" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 +  Else
.head 7 -  Set lsFichier = "RA" || lsTmp2 || psIns ||"."|| sExtElec
.head 6 -  Call VisFileDelete( wsPathResult ||"\\RA" || lsTmp2 || psIns ||"."|| sExtElec )
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes E
.head 7 -  Set lnI = 1
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'  or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select REL_ENT_INS,Lis_id,Grl_Tri, LIS_GRL_FK, sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_Listes , groupe_listes
	where Exists (Select Ent_id from entite where REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and LIS_ELE_EXT = :sExtElec
	group by 1,2,3,4
	order by 1,3,2
	into :lsIns,  :lnIdListe, :lnTri  , :lsGrpLis, :lnCE " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select  REL_ENT_INS,Lis_id,Grl_Tri, LIS_GRL_FK ,sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_Listes , Groupe_listes
	where Exists (Select Ent_id from entite where REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec  and "|| lsWhere || " ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and LIS_ELE_EXT = :sExtElec
	group by 1,2,3,4
	order by 1,3,2
	Into :lsIns, :lnIdListe, :lnTri  , :lsGrpLis, :lnCE " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'BR'
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select lis_regling
	from Listes 
	where Lis_Id = :lnIdListe
	into :lsGrpLing " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select sum( @nullvalue( REL_SC1,0)+@nullvalue( REL_SC2,0)+@nullvalue( REL_SC3,0)+@nullvalue( REL_SC4,0) )
	from result_Listes, Listes
	where REL_ENT_INS = :lsIns and REL_ELE_EXT = :sExtElec and REL_NIV_LETTRE = 'K' and REL_Lis_FK = LIS_ID and LIS_RegLing = :lsGrpLing
 	into :lnVoixTot " )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select sum(RES_NB_VV)
	from result_scrutin 
	where RES_ENT_INS = :lsIns and RES_ELE_EXT = :sExtElec and RES_NIV_LETTRE = 'K'
	into :lnVoixTot " )
.head 8 -  Call SqlFetchNext( lhSql2, Btmp )
.head 8 +  If lnVoixTot = 0 or lnVoixTot = NUMBER_Null
.head 9 -  Set lnVoixTot = 1
.head 8 +  If lnCE= NUMBER_Null
.head 9 -  Set lnCE = 0
.head 8 +  If wbSituationZeroResult
.head 9 -  Set lsBuffer[lnI] = '"E","'|| lsIns ||'","'|| SalNumberToStrX( lnIdListe, 0 ) ||'","","K"'  ||',"'|| lsGrpLis ||'"'
.head 8 +  Else
.head 9 -  Set lsBuffer[lnI] = '"E","'|| lsIns ||'","'|| SalNumberToStrX( lnIdListe, 0 ) ||'","'||  VisStrSubstitute (  SalNumberToStrX( lnCE/lnVoixTot * 100,2) , ',', '.' )  ||'","K"'  ||',"'|| lsGrpLis ||'"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  !
.head 8 -  Set lnI = lnI +1
.head 7 -  ! Ligne E - Total (C ou P)
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'  or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(RES_NB_VV)
	from Result_Scrutin
	where Exists (Select Ent_id from entite where RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) 
	into :lnVoixTot " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select Lis_id,Grl_Tri, LIS_GRL_FK, sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_Listes , groupe_listes
	where Exists (Select Ent_id from entite where REL_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and  LIS_ELE_EXT = :sExtElec
	group by 1,2,3
	order by 2,1
	into :lnIdListe, :lnTri , :lsGrpLis, :lnCE " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(RES_NB_VV)
	from result_Scrutin
	where Exists (Select Ent_id from entite where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec  and "|| lsWhere || " ) 
	into :lnVoixTot " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select  Lis_id,Grl_Tri , LIS_GRL_FK,sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_Listes , Groupe_listes
	where Exists (Select Ent_id from entite where REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec  and "|| lsWhere || " ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and  LIS_ELE_EXT = :sExtElec
	Group by 1,2,3
	order by 2, 1
	Into :lnIdListe, :lnTri , :lsGrpLis, :lnCE " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If sExtElec = 'BR'
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select lis_regling
	from Listes 
	where Lis_Id = :lnIdListe
	into :lsGrpLing " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 9 -  Call SqlPrepareAndExecute( lhSql2, "Select sum( @nullvalue( REL_SC1,0)+@nullvalue( REL_SC2,0)+@nullvalue( REL_SC3,0)+@nullvalue( REL_SC4,0) )
	from result_Listes, Listes
	where REL_ELE_EXT = :sExtElec and REL_NIV_LETTRE = 'K' and REL_Lis_FK = LIS_ID and LIS_RegLing = :lsGrpLing
 	into :lnVoixTot " )
.head 9 -  Call SqlFetchNext( lhSql2, Btmp )
.head 8 +  If lnVoixTot = 0  or lnVoixTot = NUMBER_Null
.head 9 -  Set lnVoixTot = 1
.head 8 +  If lnCE= NUMBER_Null
.head 9 -  Set lnCE = 0
.head 8 +  If wbSituationZeroResult
.head 9 -  Set lsBuffer[lnI] = '"E","'|| psIns ||'","'|| SalNumberToStrX( lnIdListe, 0 ) ||'","","'|| sNiv ||'","'|| lsGrpLis ||'"'
.head 8 +  Else
.head 9 -  Set lsBuffer[lnI] = '"E","'|| psIns ||'","'|| SalNumberToStrX( lnIdListe, 0 ) ||'","'||  VisStrSubstitute (  SalNumberToStrX( lnCE/lnVoixTot * 100,2) , ',', '.' )  ||'","'|| sNiv ||'","'|| lsGrpLis ||'"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  !
.head 8 -  Set lnI = lnI +1
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL' or sExtElec = 'DE' or sExtElec = 'BR'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_SIT_DEP,0)), sum(@nullvalue(RES_BDEP_TRAIT,0)) ,sum(@nullvalue(RES_BDEP_TOT,1))  from result_scrutin
	where  Exists (Select Ent_id from entite where RES_ENT_FK =Ent_ID and ENT_INS_NIVSUP= :psIns and ENT_ELE_EXT = :sExtElec )
	into :lnNbCanDef, :lnNbBurDep, :lnNbBurTot " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_SIT_DEP,0)), sum(@nullvalue(RES_BDEP_TRAIT,0)), sum(@nullvalue(RES_BDEP_TOT,1))  from result_scrutin 
	where Exists (Select Ent_id from entite where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec  and "|| lsWhere ||"  )
	into :lnNbCanDef, :lnNbBurDep, :lnNbBurTot " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnNbBurDep,0) ||'","'||  SalNumberToStrX( lnNbCanDef, 0)  ||'","XXXX","'|| sDate ||'","'|| sHeure ||'","'|| SalNumberToStrX( lnNbBurTot,0)  || '"'
.head 7 -  Set lsBuffer[0] = lsBuffer[0] ||',"'|| SalNumberToStrX( nEntiteId,0)|| '"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  !
.head 8 -  Set lnJ = 0
.head 8 +  While lnJ < lnI
.head 9 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 9 -  Set lnJ = lnJ + 1
.head 8 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 +  Function: PalResultatAnalyseDetailRoyaume
.head 4 -  Description: Analyse détaillée pour le Royaume
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sExtElec
.head 5 -  String: psIns
.head 5 -  ! String: sNiv
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: lhFileRER
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsHeureMaj
.head 5 -  Number: lnNbBurDep
.head 5 -  Number: lnNbCanDef
.head 5 -  Number: lnNbCanTot
.head 5 -  Number: lnBE_BBE1E2
.head 5 -  Number: lnBNB_BBE1E2E5
.head 5 -  Number: lnBE_E3E4
.head 5 -  Number: lnBNB_E3E4
.head 5 -  Number: lnBE_E5
.head 5 -  String: lsIns
.head 5 -  String: lsIns2
.head 5 -  String: lsInsBur
.head 5 -  String: lsFichier
.head 5 -  String: lsInsPrec
.head 5 -  String: lsTmp
.head 5 -  String: lsTmp2
.head 5 -  String: lsGrpLis
.head 5 -  String: lsWhere
.head 5 -  Number: lnNbBurTot
.head 5 -  Number: lnNbBurTrait
.head 5 -  Number: lnSitDep
.head 5 -  String: lsDateMaj
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  String: lsNoGrp
.head 5 -  String: lsNoListe
.head 5 -  Number: lnIdListe
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsCdtId
.head 5 -  String: sSitNivSup
.head 5 -  String: lsDateDeces
.head 5 -  Number: lnCE
.head 5 -  Number: lnVoixTot
.head 5 -  Sql Handle: lhSql
.head 5 -  Sql Handle: lhSql2
.head 5 -  Number: lnTri
.head 5 -  Number: nSommeCE
.head 5 -  Number: lnNbSiege
.head 5 -  Number: lnPremLnI
.head 5 -  Number: nDiv
.head 5 -  Number: nK
.head 5 -  Number: nRowEluEff
.head 5 -  Number: nRowEluSuppl
.head 5 -  Number: nResteSiege
.head 5 -  Number: lnIdEntite
.head 5 -  !
.head 5 -  Number: nCE[*]
.head 5 -  String: sAListeNo[*]
.head 5 -  Number: nASiege[*]
.head 5 -  Number: nAChiffreElig[*]
.head 5 -  Number: nPotEff[*]
.head 5 -  Number: nPotSuppl[*]
.head 5 -  String: sNoEluE
.head 5 -  String: sNoEluS
.head 5 -  String: sDevol
.head 5 -  String: sResteDevol
.head 5 -  Number: nFemmeElu
.head 5 -  Number: nHommeElu
.head 5 -  String: lsIdEntite
.head 4 +  Actions
.head 5 -  Set lnNbBurDep = 0
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 -  Call SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  Set lsFichier = "RAR00000."|| sExtElec
.head 6 -  Call VisFileDelete( wsPathResult ||"\\RAR00000."|| sExtElec )
.head 6 +  If TRUE
.head 7 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 7 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 7 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 7 -  Set sDate = date_separa(sDate, '/')
.head 7 -  ! Lignes E (C ou P)
.head 7 -  Set lnI = 1
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'
.head 8 -  Set lsTmp2 = 'C'
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Set lsTmp2 = 'P'
.head 7 +  If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select @if( @value(@left(RES_ENT_INS,2))-21, @if(@value(@left(RES_ENT_INS,2))-23, RES_ENT_INS_SUP,  '21004'),  '21004')
			,Lis_id,Grl_Tri, LIS_GRL_FK, sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes, result_Scrutin
	where RES_ENT_INS_SUP in (Select ENT_INS_NIVSUP from entite where ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and  LIS_ELE_EXT = :sExtElec and REL_ENT_FK= RES_ENT_FK
	group by 1,2,3,4
	order by 3,1,2,4
	into :lsIns, :lnIdListe, :lnTri , :lsGrpLis , :lnCE " )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select @if( @value(@left(RES_ENT_INS,2))-21, RES_ENT_INS_SUP,  '21004')
			,Lis_id,Grl_Tri, LIS_GRL_FK, sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes, result_Scrutin
	where RES_ENT_INS_SUP in (Select ENT_INS_NIVSUP from entite where ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and  LIS_ELE_EXT = :sExtElec and REL_ENT_FK= RES_ENT_FK
	group by 1,2,3,4
	order by 3,1,2,4
	into :lsIns, :lnIdListe, :lnTri , :lsGrpLis , :lnCE " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql2, "Select sum(RES_NB_VV)
	from result_Scrutin
	where Exists (Select Ent_id from entite where RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec  and ENT_INS_NIVSUP = :lsIns and Ent_Niv_Lettre = 'K' ) and  RES_ELE_EXT = :sExtElec
	into :lnVoixTot " )
.head 8 -  Call SqlFetchNext( lhSql2, Btmp )
.head 8 -  !
.head 8 +  If lnCE > lnVoixTot
.head 9 -  Set lnCE = lnCE
.head 8 +  If lnVoixTot = 0  or lnVoixTot = NUMBER_Null
.head 9 -  Set lnVoixTot = 1
.head 8 +  If lnCE= NUMBER_Null
.head 9 -  Set lnCE = 0
.head 8 -  !
.head 8 +  If (sExtElec = 'SE' or sExtElec = 'EU') and (SalStrLeftX( lsIns,2) = '21' or SalStrLeftX( lsIns,2) = '23') 
.head 9 -  Set lnCE = lnCE / 2
.head 8 -  !
.head 8 +  If wbSituationZeroResult
.head 9 -  Set lsBuffer[lnI] = '"E","'|| lsIns ||'","'|| SalNumberToStrX( lnIdListe, 0 ) ||'","","'|| lsTmp2 ||'","'|| lsGrpLis ||'"'
.head 8 +  Else
.head 9 -  Set lsBuffer[lnI] = '"E","'|| lsIns ||'","'|| SalNumberToStrX( lnIdListe, 0 ) ||'","'||  VisStrSubstitute (  SalNumberToStrX( lnCE/lnVoixTot * 100,2) , ',', '.' )  ||'","'|| lsTmp2 ||'","'|| lsGrpLis ||'"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  !
.head 8 -  Set lnI = lnI +1
.head 7 -  ! - Total (R)
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and  LIS_ELE_EXT = :sExtElec
	into :lnVoixTot " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select LIS_GRL_FK,Grl_Tri, LIS_GRL_FK, sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and  ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and  LIS_ELE_EXT = :sExtElec
	group by 1,2,3
	order by 2,1,3
	into :lnIdListe, :lnTri  , :lsGrpLis, :lnCE " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select  sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , Groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and  LIS_ELE_EXT = :sExtElec
	into :lnVoixTot " )
.head 8 -  Call SqlFetchNext( lhSql, Btmp )
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select  LIS_GRL_FK,Grl_Tri , LIS_GRL_FK,sum(@nullvalue(REL_SC1,0))+sum(@nullvalue(REL_SC2,0))+sum(@nullvalue(REL_SC3,0))+sum(@nullvalue(REL_SC4,0)) 
	from listes, result_listes , Groupe_listes
	where Exists (Select Ent_id from entite where  REL_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec ) and LIS_ID = REL_LIS_FK and LIS_GRL_FK=GRL_ID and  LIS_ELE_EXT = :sExtElec
	Group by 1,2,3
	order by 2,1,3
	Into :lnIdListe, :lnTri  , :lsGrpLis, :lnCE " )
.head 7 +  While SqlFetchNext( lhSql, Btmp )
.head 8 +  If lnVoixTot = 0  or lnVoixTot = NUMBER_Null
.head 9 -  Set lnVoixTot = 1
.head 8 +  If lnCE= NUMBER_Null
.head 9 -  Set lnCE = 0
.head 8 +  If wbSituationZeroResult
.head 9 -  Set lsBuffer[lnI] = '"E","'|| '00000' ||'","'|| SalNumberToStrX( lnIdListe, 0 ) ||'","","R","'|| lsGrpLis ||'"'
.head 8 +  Else
.head 9 -  Set lsBuffer[lnI] = '"E","'|| '00000' ||'","'|| SalNumberToStrX( lnIdListe, 0 ) ||'","'||  VisStrSubstitute (  SalNumberToStrX( lnCE/lnVoixTot * 100,2) , ',', '.' )  ||'","R","'|| lsGrpLis ||'"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 8 -  !
.head 8 -  Set lnI = lnI +1
.head 7 -  !
.head 7 -  ! Ligne G
.head 7 +  If sExtElec = 'CK' or sExtElec = 'WL' or sExtElec = 'VL'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_SIT_DEP,0)), sum(@nullvalue(RES_BDEP_TRAIT,0)) ,sum(@nullvalue(RES_BDEP_TOT,1))  from result_scrutin
	where  Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec )
	into :lnNbCanDef, :lnNbBurDep, :lnNbBurTot " )
.head 7 +  Else If sExtElec = 'SE' or sExtElec = 'EU'
.head 8 -  Call SqlPrepareAndExecute( lhSql, "Select sum(@nullvalue(RES_SIT_DEP,0)), sum(@nullvalue(RES_BDEP_TRAIT,0)), sum(@nullvalue(RES_BDEP_TOT,1))  from result_scrutin 
	where Exists (Select Ent_id from entite where  RES_ENT_FK =Ent_ID and ENT_ELE_EXT = :sExtElec  )
	into :lnNbCanDef, :lnNbBurDep, :lnNbBurTot " )
.head 7 -  Call SqlFetchNext( lhSql, Btmp )
.head 7 -  !
.head 7 -  !
.head 7 +  If lnNbBurDep = lnNbBurTot
.head 8 -  Set sSitNivSup = 'D'
.head 7 +  Else If lnNbBurDep = 0 or lnNbCanDef = NUMBER_Null
.head 8 -  Set sSitNivSup = ''
.head 7 +  Else
.head 8 -  Set sSitNivSup = 'P'
.head 7 -  !
.head 7 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitNivSup ||'","'|| SalNumberToStrX( lnNbBurDep,0) ||'","'||  SalNumberToStrX( lnNbCanDef, 0)  ||'","XXXX","'|| sDate ||'","'|| sHeure ||'","'|| SalNumberToStrX( lnNbBurTot,0)  || '"'
.head 7 -  Call SqlPrepareAndExecute( lhSql, "Select ENT_ID
	from Entite
	where  ENT_ELE_EXT = :sExtElec and ent_ins = '00000'
	into :lsIdEntite " )
.head 7 +  If NOT SqlFetchNext( lhSql, Btmp )
.head 8 -  Set lsIdEntite = 'null'
.head 7 -  Set lsBuffer[0] = lsBuffer[0] ||',"' || lsIdEntite || '"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 7 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  Set lnLongTot = lnLongTot + lnLong
.head 7 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 8 -  Set lnLongTot = lnLongTot + 1
.head 7 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 7 -  !
.head 7 +  If SalFileOpen( lhFileRER, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  !
.head 8 -  Set lnJ = 0
.head 8 +  While lnJ < lnI
.head 9 -  Call SalFilePutStr( lhFileRER, lsBuffer[lnJ] )
.head 9 -  Set lnJ = lnJ + 1
.head 8 -  Call SalFileClose( lhFileRER )
.head 6 -  Call SqlCommit( lhSql)
.head 6 -  Call SqlCommit( lhSql2)
.head 6 -  Call SqlDisconnect( lhSql )
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 -  !
.head 3 +  Function: PalMajHistoGraphiqueEvolution
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sElExt
.head 5 -  String: psIns
.head 5 -  Number: nIdEntite
.head 5 -  String: sNiveau
.head 5 -  Number: nNbBurDep
.head 5 -  Number: nNbBurTot
.head 5 -  Number: nNbCantonTraites
.head 5 -  Number: nNbCantonTot
.head 5 -  Number: nNbCantonComplet
.head 5 -  Number: nNbCantonDef
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Sql Handle: lhSql2
.head 5 -  String: lsFichier
.head 5 -  String: lsBuffer[*]
.head 5 -  Number: lnJ
.head 5 -  Number: lnI
.head 5 -  String: lsDate
.head 5 -  String: lsBD
.head 5 -  String: lsBDT
.head 5 -  String: lsCTr
.head 5 -  String: lsCTo
.head 5 -  String: lsCD
.head 5 -  String: lsCC
.head 5 -  File Handle: lhFileRG
.head 5 -  String: sSitDep
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  !
.head 6 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 6 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 6 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 6 -  Set sDate = date_separa(sDate, '/')
.head 6 -  !
.head 6 +  If psIns = '' and sNiveau = 'R'
.head 7 -  Set psIns = '00000'
.head 6 -  !
.head 6 -  Call SqlPrepareAndExecute( lhSql2, "Insert into HISTO_EVOL ( HEV_EL, HEV_INS, HEV_ENT_FK, HEV_NIV, HEV_BurDep, HEV_BurDepTot, HEV_CantonTrait, HEV_CantonTot, HEV_CantonDef, HEV_CantonComplet,HEV_DateH)
	values (:sElExt, :psIns, :nIdEntite, :sNiveau, :nNbBurDep, :nNbBurTot, :nNbCantonTraites, :nNbCantonTot, :nNbCantonDef, :nNbCantonComplet  ,sysdatetime ) "  )
.head 6 -  Call SqlCommit( lhSql2 )
.head 6 -  ! Lignes H
.head 6 -  Set lnI = 1
.head 6 -  Call SqlPrepareAndExecute( lhSql2, "Select HEV_DateH,HEV_BurDep, HEV_BurDepTot, HEV_CantonTrait, HEV_CantonTot, HEV_CantonDef, HEV_CantonComplet
	from HISTO_EVOL
	Where HEV_Ins = :psIns and HEV_Niv = :sNiveau and HEV_EL = :sElExt
	order by 1
	into :lsDate, :lsBD, :lsBDT, :lsCTr, :lsCTo,:lsCD, :lsCC "   )
.head 6 +  While SqlFetchNext( lhSql2, Btmp )
.head 7 -  Set lsBuffer[lnI] = '"H","' || SalStrLeftX( lsDate, 23) || '","'|| lsBDT || '","'|| lsBD|| '","'|| lsCTo || '","'|| lsCTr || '","'|| lsCC  || '","'|| lsCD || '"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[lnI] )+2
.head 7 -  Set lnI = lnI + 1
.head 6 -  !
.head 6 -  ! Ligne G
.head 6 +  If nNbCantonDef = nNbCantonTot
.head 7 -  Set sSitDep = 'D'
.head 6 +  Else If nNbCantonComplet = nNbCantonTot
.head 7 -  Set sSitDep = 'C'
.head 6 +  Else
.head 7 -  Set sSitDep = 'P'
.head 6 -  Set lsBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sSitDep ||'","'|| SalNumberToStrX( nNbBurDep,0) ||'","'|| SalNumberToStrX( nNbCantonDef,0)  ||'","XXXX","'|| sDate ||'","'|| sHeure || '"'
.head 6 -  !
.head 6 -  Set lnLongTot = lnLongTot + SalStrLength( lsBuffer[0] )+2 - 4
.head 6 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 6 -  Set lnLongTot = lnLongTot + lnLong
.head 6 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 7 -  Set lnLongTot = lnLongTot + 1
.head 6 -  Set lsBuffer[0] =  VisStrSubstitute( lsBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 6 -  !
.head 6 -  Set lsFichier = "RG" || sNiveau || psIns ||"."|| sElExt
.head 6 -  Call VisFileDelete( wsPathResult || "\\" || lsFichier )
.head 6 +  If SalFileOpen( lhFileRG, wsPathResult ||"\\"|| lsFichier ,  OF_Create | OF_ReadWrite | OF_Text )
.head 7 -  !
.head 7 -  Set lnJ = 0
.head 7 +  While lnJ < lnI
.head 8 -  Call SalFilePutStr( lhFileRG, lsBuffer[lnJ] )
.head 8 -  Set lnJ = lnJ + 1
.head 7 -  Call SalFileClose( lhFileRG )
.head 6 -  !
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 +  Function: PalMajHistoElus
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sEnv
.head 5 -  String: sEl
.head 5 -  String: sNiv
.head 5 -  Number: nGrp
.head 5 -  String: sNoListe
.head 5 -  Number: nElus
.head 5 -  Date/Time: dDateTft
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Sql Handle: lhSql2
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql2 )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql2, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql2, 'RL' )
.head 6 -  !
.head 6 -  Call SqlPrepareAndExecute( lhSql2, "Insert into HISTO_ELU 
	(HIE_ENVELOP_G, HIE_EL, HIE_NIV ,HIE_GRP , HIE_NOL,HIE_NB_ELU , HIE_DATEH )
	values (:sEnv , :sEl, :sNiv , :nGrp , :sNoListe, :nElus, :dDateTft ) " )
.head 6 -  Call SqlCommit( lhSql2 )
.head 6 -  !
.head 6 -  Call SqlDisconnect( lhSql2 )
.head 3 -  !
.head 3 +  Function: PalZipResultat
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psEL
.head 5 -  Number: nBurDep
.head 5 -  Number: nCantonDef
.head 5 -  String: psNomEnveloppe
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsPkZip
.head 5 -  String: sFileZIP
.head 5 -  Boolean: bZip
.head 5 -  Number: nRet
.head 5 -  File Handle: hFile
.head 5 -  String: lsTemp
.head 5 -  String: lsFileDef
.head 5 -  String: lsRepDef
.head 5 -  String: lsPathLoc5
.head 5 -  String: lsPathLoc3
.head 5 -  String: lsHttpCockpit
.head 5 -  String: lsHttpWeb5
.head 5 -  String: lsFormatRWeb3Diff
.head 5 -  Number: lnHttpTimeout
.head 5 -  Number: lnCopiesErr
.head 5 -  Number: lnCopiesErr2
.head 5 -  String: lsCopiesErrTrad
.head 5 -  String: lsCurrentDirectory
.head 4 +  Actions
.head 5 -  ! Création de la MAP des résultats
.head 5 +  If SalFileOpen( hFile, gsPathApplic || "\\RERMap\\RerMap.Exe" , OF_Exist)
.head 6 +  If SalFileOpen( hFile, gsPathApplic || "\\RERMap\\RerMapC.Exe" , OF_Exist)
.head 7 -  Set dfLibelleR = 'Création MAP - RERmap < '|| psEL||' >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call SalFileGetCurrentDirectory( lsCurrentDirectory )
.head 7 -  Call SalFileSetCurrentDirectory( gsPathApplic || "\\RERMap" )
.head 7 -  Call SalLoadAppAndWait( gsPathApplic || "\\RERMap\\RerMap.Exe "|| psEL ,  Window_NotVisible, nRet )
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call SalBringWindowToTop( frmLOC2 )
.head 7 -  Call DispatchMessage(  )
.head 7 -  Set dfLibelleR = 'Création MAP C - RERmapC < '|| psEL||' >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call SalLoadAppAndWait( gsPathApplic || "\\RERMap\\RerMapC.Exe "|| psEL ,  Window_NotVisible, nRet )
.head 7 -  Call SalFileSetCurrentDirectory( lsCurrentDirectory )
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call SalBringWindowToTop( frmLOC2 )
.head 7 -  Call DispatchMessage(  )
.head 5 -  !
.head 5 -  Set dfLibelleR = 'Création ZIP < '|| psEL||' >'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SalGetProfileString( 'PATH', 'PKZIP',  '', lsPkZip, wsPathINI )
.head 5 -  Call SalGetProfileString( 'PATH', 'PATH_LOC3',  '', lsPathLoc3, wsPathINI )
.head 5 +  If SalStrRightX( lsPathLoc3 , 1) != '\\'
.head 6 -  ! Set lsPathLoc3 = SalStrLeftX( lsPathLoc3 , SalStrLength( lsPathLoc3 ) - 1)
.head 6 -  Set lsPathLoc3 =lsPathLoc3 ||'\\'
.head 5 -  Call SalGetProfileString( 'PATH', 'PATH_LOC5',  '', lsPathLoc5, wsPathINI )
.head 5 +  If SalStrRightX( lsPathLoc5 , 1) != '\\'
.head 6 -  ! Set lsPathLoc5 = SalStrLeftX( lsPathLoc5 , SalStrLength( lsPathLoc5 ) - 1)
.head 6 -  Set lsPathLoc5 =lsPathLoc5 ||'\\'
.head 5 -  ! Call SalGetProfileString( 'ELECTIONS', 'FORMAT_R_WEB3',  '', lsFormatRWeb3Diff, wsPathINI )
.head 5 +  ! If lsFormatRWeb3Diff = ''
.head 6 -  Set lsFormatRWeb3Diff ='1'
.head 6 -  Call SalSetProfileString( 'ELECTIONS', 'FORMAT_R_WEB3', lsFormatRWeb3Diff, wsPathINI )
.head 5 -  !
.head 5 +  ! If lsFormatRWeb3Diff = '1'
.head 6 +  If lsPkZip = ''
.head 7 -  Call SalMessageBox( "PkZip non trouvé !!", "ERREUR", MB_Ok )
.head 7 -  Return (FALSE)
.head 6 +  If SalStrScan( SalStrUpperX(lsPkZip), "ZIP.EXE" ) != -1
.head 7 -  Set bZip = TRUE
.head 7 -  Set sFileZIP = wsPathTmp ||"\\"|| psEL||".ZIP"
.head 7 -  Call VisFileDelete(sFileZIP )
.head 7 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| wsPathResult ||"\\*."|| psEL ,  Window_NotVisible, nRet )
.head 6 +  Else 
.head 7 -  Set bZip = FALSE
.head 7 -  Set sFileZIP = wsPathTmp||"\\"|| psEL||".7ZA"
.head 7 -  Call VisFileDelete(sFileZIP )
.head 7 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| wsPathResult ||"\\*."|| psEL ,  Window_NotVisible, nRet )
.head 6 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 7 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 7 -  Return (FALSE)
.head 6 -  Set lsRepDef = "W3_R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || SalStrRightX('000' || SalNumberToStrX( nCantonDef,0) , 3)|| "_"|| psEL 
.head 6 +  If bZip = TRUE
.head 7 -  Set lsFileDef = "\\W3_R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || SalStrRightX('000' || SalNumberToStrX( nCantonDef,0) , 3)|| "_"|| psEL ||".ZIP"
.head 6 +  Else 
.head 7 -  Set lsFileDef = "\\W3_R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || SalStrRightX('000' || SalNumberToStrX( nCantonDef,0) , 3)|| "_"|| psEL ||".7ZA"
.head 6 -  Call VisFileDelete(wsPathTmp|| lsFileDef )
.head 6 +  If NOT VisFileRename( sFileZIP, wsPathTmp || lsFileDef )
.head 7 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " n'a pas été renommé en 
" || wsPathTmp || lsFileDef ||"!!", "ERREUR", MB_IconHand | MB_Ok)
.head 7 -  Return (FALSE)
.head 6 +  If VisFileCopy( wsPathTmp|| lsFileDef, lsPathLoc3 || lsFileDef ) != 1
.head 7 -  Call SalMessageBox( "Impossible de copier le fichier "|| lsFileDef || " vers
" || lsPathLoc3 ||"!!", "ERREUR", MB_IconHand | MB_Ok)
.head 7 -  Return (FALSE)
.head 6 -  Call VisFileDelete( wsPathResult ||"\\GraphBur*.*"|| psEL )
.head 6 -  Call VisFileDelete( wsPathResult ||"\\GraphInf*.*"|| psEL )
.head 5 -  !
.head 5 -  ! Diffusion d'un nouveau format R dédié à Web et aux médias (avec /sans les graphiques d'évolution du dépouillement suivant 'FORMAT_R_WEB3' )
.head 5 +  If lsPkZip = ''
.head 6 -  ! Call SalMessageBox( "PkZip non trouvé !!", "ERREUR", MB_Ok )
.head 6 -  Call PalErrLog( "PKZIP", 436, "PkZip non trouvé !!", '0', '1', 1 )
.head 6 -  Return (FALSE)
.head 5 +  If SalStrScan( SalStrUpperX(lsPkZip), "ZIP.EXE" ) != -1
.head 6 -  Set bZip = TRUE
.head 6 -  Set sFileZIP = wsPathTmp ||"\\"|| psEL||".ZIP"
.head 6 -  Call VisFileDelete(sFileZIP )
.head 6 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| wsPathResult ||"\\*."|| psEL ,  Window_NotVisible, nRet )
.head 5 +  Else
.head 6 -  Set bZip = FALSE
.head 6 -  Set sFileZIP = wsPathTmp||"\\"|| psEL||".7ZA"
.head 6 -  Call VisFileDelete(sFileZIP )
.head 6 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| wsPathResult ||"\\*."|| psEL ,  Window_NotVisible, nRet )
.head 5 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 6 -  ! Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 6 -  Call PalErrLog( sFileZIP, 436, "Le fichier "|| sFileZIP || " est introuvable !!", '0', '1', 1 )
.head 6 -  Return (FALSE)
.head 5 -  ! Set lsRepDef = "R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || SalStrRightX('000' || SalNumberToStrX( nCantonDef,0) , 3)|| "_"|| psEL 
.head 5 -  Set lsRepDef = psNomEnveloppe
.head 5 +  If bZip = TRUE
.head 6 -  ! Set lsFileDef = "\\R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || SalStrRightX('000' || SalNumberToStrX( nCantonDef,0) , 3)|| "_"|| psEL ||".ZIP"
.head 6 -  Set lsFileDef = "\\"|| psNomEnveloppe ||".ZIP"
.head 5 +  Else
.head 6 -  ! Set lsFileDef = "\\R"|| SalStrRightX('0000' || SalNumberToStrX( nBurDep,0) , 4) ||"_" || SalStrRightX('000' || SalNumberToStrX( nCantonDef,0) , 3)|| "_"|| psEL ||".7ZA"
.head 6 -  Set lsFileDef = "\\"|| psNomEnveloppe ||".7ZA"
.head 5 -  Call VisFileDelete(wsPathTmp|| lsFileDef )
.head 5 +  If NOT VisFileRename( sFileZIP, wsPathTmp || lsFileDef )
.head 6 -  ! Call SalMessageBox( "Le fichier "|| sFileZIP || " n'a pas été renommé en 
" || wsPathTmp || lsFileDef ||"!!", "ERREUR", MB_IconHand | MB_Ok)
.head 6 -  Call PalErrLog( sFileZIP, 436, "Le fichier "|| sFileZIP || " n'a pas été renommé en " || wsPathTmp || lsFileDef ||"!!", '0', '1', 1 )
.head 6 -  Return (FALSE)
.head 5 +  If VisFileCopy( wsPathTmp|| lsFileDef, lsPathLoc3 || lsFileDef ) != 1
.head 6 -  Call SalPause( 200 )
.head 6 +  If VisFileCopy( wsPathTmp|| lsFileDef, lsPathLoc3 || lsFileDef ) != 1
.head 7 -  Call SalPause( 200 )
.head 7 -  Set lnCopiesErr = VisFileCopy( wsPathTmp|| lsFileDef, lsPathLoc3 || lsFileDef )
.head 7 +  If lnCopiesErr != 1
.head 8 -  ! Call SalMessageBox( "Impossible de copier le fichier "|| lsFileDef || " vers
" || lsPathLoc3 ||"!!", "ERREUR", MB_IconHand | MB_Ok)
.head 8 -  Call PalErrLog( lsFileDef, 436, "Impossible de copier le fichier (Err : "|| SalNumberToStrX( lnCopiesErr , 0 )|| ") "|| wsPathTmp || lsFileDef || " vers " || lsPathLoc3 ||"!!", '0', '1', 1 )
.head 8 -  Return (FALSE)
.head 5 -  !
.head 5 -  Call VisFileDelete( wsPathTmp || lsFileDef )
.head 5 -  Return (TRUE)
.head 3 +  Function: PalCreateRSRmap
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: psEL
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsCurrentDirectory
.head 5 -  File Handle: hFile
.head 5 -  Number: nRet
.head 4 +  Actions
.head 5 +  ! If SalFileOpen( hFile, gsPathApplic || "\\RSRMap\\RSRmap"|| psEL ||".php" , OF_Exist)
.head 6 +  If SalFileOpen( hFile, gsPathApplic || "\\RSRMap\\IG."|| psEL , OF_Exist)
.head 7 -  Set dfLibelleR = 'Création MAP - RSRmap < '|| psEL ||' >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call SalFileGetCurrentDirectory( lsCurrentDirectory )
.head 7 -  Call SalFileSetCurrentDirectory( gsPathApplic || "\\RSRMap" )
.head 7 -  Call SalLoadAppAndWait( "php -q RSRmap"|| psEL ||".php" ,  Window_NotVisible, nRet )
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call SalBringWindowToTop( frmLOC2 )
.head 7 -  Call SalFileSetCurrentDirectory( lsCurrentDirectory )
.head 7 -  Call DispatchMessage(  )
.head 5 +  If SalFileOpen( hFile, gsPathApplic || "\\RSRMap\\RSRmap.php" , OF_Exist)
.head 6 +  If SalFileOpen( hFile, gsPathApplic || "\\RSRMap\\IG."|| psEL , OF_Exist)
.head 7 -  Set dfLibelleR = 'Création MAP - RSRmap < '|| psEL ||' >'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call SalFileGetCurrentDirectory( lsCurrentDirectory )
.head 7 -  Call SalFileSetCurrentDirectory( gsPathApplic || "\\RSRMap" )
.head 7 -  Call SalLoadAppAndWait( "php -q RSRmap.php Elec="|| psEL  ,  Window_NotVisible, nRet )
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call SalBringWindowToTop( frmLOC2 )
.head 7 -  Call SalFileSetCurrentDirectory( lsCurrentDirectory )
.head 7 -  Call DispatchMessage(  )
.head 5 -  !
.head 5 -  ! Graphique d'évolution du dépouillement par Canton
.head 5 +  ! If SalFileOpen( hFile, gsPathApplic || "\\RERGraph\\RERGraph"|| psEL ||".php" , OF_Exist)
.head 6 -  Set dfLibelleR = 'Création GRAPH - RERGraph < '|| psEL ||' >'
.head 6 -  Call DispatchMessage(  )
.head 6 -  Call SalFileGetCurrentDirectory( lsCurrentDirectory )
.head 6 -  Call SalFileSetCurrentDirectory( gsPathApplic || "\\RERGraph" )
.head 6 -  Call SalLoadAppAndWait( "php -q RERGraph"|| psEL ||".php" ,  Window_NotVisible, nRet )
.head 6 -  Call DispatchMessage(  )
.head 6 -  Call SalBringWindowToTop( frmLOC2 )
.head 6 -  Call SalFileSetCurrentDirectory( lsCurrentDirectory )
.head 6 -  Call DispatchMessage(  )
.head 5 +  If SalFileOpen( hFile, gsPathApplic || "\\RERGraph\\GraphGen.php" , OF_Exist)
.head 6 -  Set dfLibelleR = 'Création GRAPH - RERGraph < '|| psEL ||' >'
.head 6 -  Call DispatchMessage(  )
.head 6 -  Call SalFileGetCurrentDirectory( lsCurrentDirectory )
.head 6 -  Call SalFileSetCurrentDirectory( gsPathApplic || "\\RERGraph" )
.head 6 -  Call SalLoadAppAndWait( "php -q GraphGen.php Elec="|| psEL  ,  Window_NotVisible, nRet )
.head 6 -  Call DispatchMessage(  )
.head 6 -  Call SalBringWindowToTop( frmLOC2 )
.head 6 -  Call SalFileSetCurrentDirectory( lsCurrentDirectory )
.head 6 -  Call DispatchMessage(  )
.head 5 -  !
.head 5 -  ! Graphique d'évolution du dépouillement niveaux supérieurs
.head 5 +  If SalFileOpen( hFile, gsPathApplic || "\\RGRGraph\\RGRGraph.php" , OF_Exist)
.head 6 -  Set dfLibelleR = 'Création GRAPH niv. sup. - RGRGraph < '|| psEL ||' >'
.head 6 -  Call DispatchMessage(  )
.head 6 -  Call SalFileGetCurrentDirectory( lsCurrentDirectory )
.head 6 -  Call SalFileSetCurrentDirectory( gsPathApplic || "\\RGRGraph" )
.head 6 -  Call SalLoadAppAndWait( "php -q RGRGraph.php Elec="|| psEL  ,  Window_NotVisible, nRet )
.head 6 -  Call DispatchMessage(  )
.head 6 -  Call SalBringWindowToTop( frmLOC2 )
.head 6 -  Call SalFileSetCurrentDirectory( lsCurrentDirectory )
.head 6 -  Call DispatchMessage(  )
.head 3 -  !
.head 3 +  Function: PalDtmTempsR
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nPassage
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nSeconde
.head 5 -  Number: nMin
.head 5 -  Number: nSecondeMax
.head 5 -  Number: nTempsR
.head 4 +  Actions
.head 5 -  Set nSeconde = SalNumberRound(  nPassage + 0.001 )
.head 5 -  Set nSecondeMax = SalStrToNumber(SalStrLeftX( dfTempsEntreR, 2))*60 + SalStrToNumber(SalStrRightX( dfTempsEntreR, 2))
.head 5 -  Set nTempsR = nSecondeMax - nSeconde
.head 5 +  If nTempsR <= 0
.head 6 -  Set wbResultat = TRUE
.head 6 -  Set dfTempsR = '0000'
.head 5 +  Else
.head 6 -  Set nSeconde = SalNumberMod( nTempsR, 60 )
.head 6 -  Set nMin = (nTempsR - nSeconde) / 60
.head 6 -  Set dfTempsR = SalStrRightX('00' || SalNumberToStrX( nMin,0), 2) || SalStrRightX('00' || SalNumberToStrX( nSeconde,0), 2)
.head 3 +  Function: PalDtmTempsCoord
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nPassage
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nSeconde
.head 5 -  Number: nMin
.head 5 -  Number: nSecondeMax
.head 5 -  Number: nTempsR
.head 4 +  Actions
.head 5 -  Set nSeconde = nPassage
.head 5 -  Set nSecondeMax = SalStrToNumber(SalStrLeftX( dfTempsEntreCoord, 2))*60 + SalStrToNumber(SalStrRightX( dfTempsEntreCoord, 2))
.head 5 -  Set nTempsR = nSecondeMax - nSeconde
.head 5 +  If nTempsR <= 0
.head 6 -  Set wbCoord = TRUE
.head 6 -  Set dfTempsCoord = '0000'
.head 5 +  Else
.head 6 -  Set nSeconde = SalNumberMod( nTempsR, 60 )
.head 6 -  Set nMin = (nTempsR - nSeconde) / 60
.head 6 -  Set dfTempsCoord = SalStrRightX('00' || SalNumberToStrX( nMin,0), 2) || SalStrRightX('00' || SalNumberToStrX( nSeconde,0), 2)
.head 3 +  Function: PalDtmTitre
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 +  If SalIsWindowEnabled( pbFormatR )
.head 6 -  Set dfEtatLoc2 = "Collecte des Résultats"
.head 5 +  Else
.head 6 -  Set dfEtatLoc2 = "Collecte des listes et des coord."
.head 5 +  If SalIsWindowEnabled( pbAction )
.head 6 -  Set dfEtatLoc2 =dfEtatLoc2 ||" - PAUSE"
.head 5 +  Else
.head 6 -  Set dfEtatLoc2 =dfEtatLoc2 ||" - ACTIVE"
.head 3 +  Function: PalCreateRepDetail
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: lnFiles
.head 5 -  Number: lnAttrib[*]
.head 5 -  String: lsFiles[*]
.head 5 -  Number: lnSize[*]
.head 5 -  Date/Time: ldDateF[*]
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnRow
.head 5 -  Number: lnRep
.head 5 -  String: wsSousRep[10]
.head 4 +  Actions
.head 5 -  Set lnRep = 0
.head 5 -  Set lnRep = lnRep+1
.head 5 -  Set wsSousRep[lnRep] = "\\I"
.head 5 -  Set lnRep = lnRep+1
.head 5 -  Set wsSousRep[lnRep] = "\\0"
.head 5 -  Set lnRep = lnRep+1
.head 5 -  Set wsSousRep[lnRep] = "\\1"
.head 5 -  Set lnRep = lnRep+1
.head 5 -  Set wsSousRep[lnRep] = "\\Sup"
.head 5 -  Set lnRep = lnRep+1
.head 5 -  Set wsSousRep[lnRep] = "\\Autres"
.head 5 -  Set lnRep = lnRep+1
.head 5 -  Set wsSousRep[lnRep] = "\\PDF"
.head 5 -  Set lnRep = lnRep+1
.head 5 -  Set wsSousRep[lnRep] = "\\DATA"
.head 5 -  Set lnRep = lnRep+1
.head 5 -  Set wsSousRep[lnRep] = "\\T"
.head 5 -  !
.head 5 -  Set lnJ = 1
.head 5 +  While lnJ <= lnRep
.head 6 -  Call PalMakeAllDir( dfIn || wsSousRep[lnJ] )
.head 6 -  Set lnJ = lnJ +1
.head 5 -  Call PalMakeAllDir( dfIn || "\\X7S" )
.head 3 -  !
.head 3 +  Function: PalVerifStructureDb
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bExist
.head 5 -  Number: lnId
.head 5 -  String: lsEl
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  String: lsTmp
.head 5 -  String: lsGrp
.head 5 -  String: lsGrp2
.head 5 -  String: lsEl1
.head 5 -  String: lsEl2
.head 4 +  Actions
.head 5 -  Call SalShowWindow( dfLibelleR )
.head 5 -  Set dfLibelleR = "Vérification de la structure de la DB ... "
.head 5 -  Call SalBringWindowToTop( dfLibelleR )
.head 5 -  Call DispatchMessage(  )
.head 5 -  ! GROUPE_LISTES - Tri
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'GROUPE_LISTES' and NAME = 'GRL_TRI' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table GROUPE_LISTES add GRL_TRI integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 7 -  Set lnJ = 0
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "select distinct(grl_EL) from groupe_listes 
	into :lsEl ")
.head 7 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select grl_id from groupe_listes where GRL_EL= :lsEl order by grl_Id 
	into :lnId ")
.head 8 -  Set lnI = 1
.head 8 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update groupe_listes Set grL_Tri = :lnI where GRL_EL= :lsEl and  grl_Id = :lnId ")
.head 9 -  Set lnI = lnI + 1
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 -  Call SqlCommit( ghSqlSecondaire)
.head 8 -  Set lnJ = lnJ +1
.head 5 -  ! RESULT_SCRUTIN - Zones E5 Format F pour Bxl
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'RESULT_SCRUTIN' and NAME = 'RES_NB_VV_E5' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table RESULT_SCRUTIN add RES_NB_VV_E5 integer,  RES_NB_VBN_E5 integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! Table BULLETINS_BETR - table pour bulletins des Belges résidant à l'étranger
.head 5 -  Call SqlExists(  "Select * from systables where name = 'BULLETINS_BETR' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create table BULLETINS_BETR 
	( BETR_INS char(5),  BETR_EL char(2) , BETR_INSCRITS integer, BETR_Recus integer ) ")
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "create public synonym BULLETINS_BETR for sysadm.BULLETINS_BETR ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "grant all on BULLETINS_BETR to public ")
.head 9 -  Call SqlCommit( ghSqlSecondaire )
.head 9 -  ! CHAMBRE
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '12021','CK') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '31005','CK') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '44021','CK') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '24107','CK') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '73083','CK') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '53053','CK') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '61031','CK') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '81001','CK') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '92094','CK') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '25072','CK') ")
.head 9 -  ! SENAT
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '12021','SE') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '31005','SE') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '44021','SE') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '24107','SE') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '73083','SE') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '53053','SE') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '61031','SE') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '81001','SE') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '92094','SE') ")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '25072','SE') ")
.head 9 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! RESULT_SCRUTIN - Zones SIT_DEPOUILLEMENT en lettre (P,C ou D)
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'RESULT_SCRUTIN' and NAME = 'RES_T_DEP' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table RESULT_SCRUTIN add RES_T_DEP char(1) ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! COORD CEVI - Correction sur niveau O
.head 5 -  Call SqlExists(  "Select * from Coord_Adr_CEVI where Niveau = 'O' and ins != '21004' ", bExist)
.head 5 +  If bExist
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "delete from Coord_Adr_CEVI where Niveau = 'O' and ins != '21004' ")
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "delete from Coord_Bureau where CB_TYPEBUR = 'O' and CB_INS != '21004' ")
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "delete from Coord_Adresse where CA_TYPEBUR = 'O' and CA_INS != '21004' ")
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "delete from Coord_Contact where CC_TYPEBUR = 'O' and CC_INS != '21004' ")
.head 6 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! Table RESULT_ELU_ROYAUME
.head 5 -  Call SqlExists(  "Select * from systables where name = 'RESULT_ELU_ROYAUME' ", bExist)
.head 5 +  If NOT bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create table RESULT_ELU_ROYAUME 
	( ELU_Liste_ID integer,  ELU_Liste_No char(5) , ELU_ENTITE char(5), ELU_SIEGES integer, ELU_Homme integer, ELU_Femme integer, ELU_Elect char(2), ELU_ListeGrp integer ) ")
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "create public synonym RESULT_ELU_ROYAUME for sysadm.RESULT_ELU_ROYAUME ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "grant all on RESULT_ELU_ROYAUME to public ")
.head 9 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index IDX_ELU_ROY_1 on  RESULT_ELU_ROYAUME (ELU_Liste_ID) ")
.head 10 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! Lignes dans BULLETINS_BETR pour 21004
.head 5 -  Call SqlExists(  "Select * from BULLETINS_BETR where BETR_INS = '21004' ", bExist)
.head 5 +  If Not bExist
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '21004','CK') ")
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into BULLETINS_BETR ( BETR_INS,  BETR_EL ) values ( '21004','SE') ")
.head 6 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! RESULT_WEB5 dans APPL_PARM
.head 5 -  Call SqlExists(  "Select * from APPL_PARM where NAME = 'RESULT_WEB5' ", bExist)
.head 5 +  If Not bExist
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, 
"Insert into appl_parm ( NAME, LABEL_NL, LABEL_FR, DESC_NL, DESC_FR, VALUE, VALUE_DATATYPE, USER_YN, SYSMAN_YN, ORDER)
	values( 'RESULT_WEB5','Diffusion resultats directement WEB5','Diffusion resultats directement WEB5', '', '', '1', 'N', 'N','Y',7) " )
.head 6 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! New index sur Resultats
.head 5 -  Call SqlExists(  "Select * from Sysindexes where NAME = 'RES_IDX16' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_IDX16 on  RESULT_LISTES (REL_LIS_FK) ")
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_IDX17 on  RESULT_LISTES (REL_ENT_FK) ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_IDX18 on  RESULT_CDT (REC_CDT_FK) ")
.head 9 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_IDX19 on  RESULT_CDT (RECL_LIS_FK) ")
.head 10 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_IDX20 on  RESULT_CDT (REC_ENT_FK) ")
.head 11 -  Call SqlCommit( ghSqlSecondaire )
.head 10 +  Else
.head 11 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 5 -  ! New index sur Listes
.head 5 -  Call SqlExists(  "Select * from Sysindexes where NAME = 'LIS_IDX_2' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index LIS_IDX_2 on  LISTES (LIS_ENT_FK) ")
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index LIS_IDX_3 on  LISTES (LIS_GRL_FK) ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index LIS_IDX_4 on  LISTES (LIS_INSBUR) ")
.head 9 -  Call SqlCommit( ghSqlSecondaire )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 5 -  ! New index sur Candidats
.head 5 -  Call SqlExists(  "Select * from Sysindexes where NAME = 'CDT_IDX_2' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index CDT_IDX_2 on  CANDIDATS (CDT_ENT_FK) ")
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index CDT_IDX_3 on  CANDIDATS (CDT_LIS_FK) ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index CDT_IDX_4 on  CANDIDATS (CDT_INSBUR) ")
.head 9 -  Call SqlCommit( ghSqlSecondaire )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 5 -  ! GRoupe_LIstes - zone Grl_Couleur
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'GROUPE_LISTES' and NAME = 'GRL_COULEUR' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table GROUPE_LISTES add GRL_COULEUR integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! Apparentement - entités
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'ENTITE' and NAME = 'ENT_GRP_APP' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table ENTITE add ENT_GRP_APP char(5) ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 7 -  !
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Update  Entite set ENT_GRP_APP = '21004' where ent_niv_Lettre = 'C' and ent_Ele_ext = 'CK' and ent_ins in ('21004', '24062','25072' ) ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! Election - date result en fct de l'election
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'ELECTION' and NAME = 'ELE_D_RESULT' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table ELECTION add ELE_D_RESULT timestamp ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 7 -  !
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Update  ELECTION  set ELE_D_RESULT = 1900-01-01  ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! Table des Loc2 lancé
.head 5 -  Call SqlExists(  "Select * from systables where name = 'LOC2_ACTIF' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create table LOC2_ACTIF
	( LOC2_H integer,  LOC2_DESC char(100) , LOC2_HeureStart Timestamp ) ")
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "create public synonym LOC2_ACTIF for sysadm.LOC2_ACTIF ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "grant all on LOC2_ACTIF to public ")
.head 9 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! Colonne _ 'ELE_NB_FORMATR' dans la table Election
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'ELECTION' and NAME = 'ELE_NB_FORMATR' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table ELECTION add ELE_NB_FORMATR integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! MSG_435=Discordance entre le niveau sup. avec les niveaux inf.
.head 5 -  Call SalGetProfileString( 'HTTP_MSG', 'MSG_435', '', lsTmp , wsPathINI  )
.head 5 +  If lsTmp = ''
.head 6 -  Call SalSetProfileString( 'HTTP_MSG', 'MSG_435', "Discordance entre le niveau sup. avec les niveaux inf." , wsPathINI  )
.head 5 -  ! ERREUR_EnCours - Ajout Err_Ctrl_Cdt 
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'ERREUR_ENCOURS' and NAME = 'ERR_CTRL_CDT' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table ERREUR_ENCOURS add ERR_CTRL_CDT integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! ERREUR_EnCours - Ajout Err_Ctrl_Id
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'ERREUR_ENCOURS' and NAME = 'ERR_CTRL_ID' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table ERREUR_ENCOURS add ERR_CTRL_ID integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! Table histo_evol
.head 5 -  Call SqlExists(  "Select * from systables where name = 'HISTO_EVOL' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create table HISTO_EVOL
	( HEV_EL char(5),  HEV_INS char(5) , HEV_DateH Timestamp,
	HEV_ENT_FK integer, HEV_NIV char(5), HEV_BurDep integer, HEV_BurDepTot integer, 
	HEV_CantonTrait integer, HEV_CantonTot integer, HEV_CantonDef integer ) ")
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "create public synonym HISTO_EVOL for sysadm.HISTO_EVOL ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "grant all on HISTO_EVOL to public ")
.head 9 -  Call SqlCommit( ghSqlSecondaire )
.head 9 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index HEV_IDX1 on  HISTO_EVOL (HEV_EL) ")
.head 10 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index HEV_IDX2 on  HISTO_EVOL (HEV_INS) ")
.head 11 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index HEV_IDX3 on  HISTO_EVOL (HEV_ENT_FK) ")
.head 12 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index HEV_IDX4 on  HISTO_EVOL (HEV_NIV) ")
.head 13 -  Call SqlCommit( ghSqlSecondaire )
.head 12 +  Else
.head 13 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 11 +  Else
.head 12 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 10 +  Else
.head 11 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 5 -  ! HISTO_EVOL - Ajout HEV_CANTONCOMPLET
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'HISTO_EVOL' and NAME = 'HEV_CANTONCOMPLET' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table HISTO_EVOL add HEV_CANTONCOMPLET integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  !
.head 5 -  ! Table insc_ENTITE
.head 5 -  Call SqlExists(  "Select * from systables where name = 'INSC_ENTITE' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create table insc_ENTITE (INE_INS char(5), INE_EL char(5), INE_ID integer, INE_NIV char(1), INE_BB integer, INE_E1E2 integer,INE_E3E4 integer, INE_E5 integer) " )
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "create public synonym insc_ENTITE for sysadm.insc_ENTITE ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "grant all on INSC_ENTITE to public ")
.head 9 -  Call SqlCommit( ghSqlSecondaire )
.head 9 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index INE_IDX1 on  INSC_ENTITE (INE_ID) ")
.head 10 -  Call SqlCommit( ghSqlSecondaire )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 5 -  !
.head 5 -  ! Insert into Table insc_ENTITE
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain,  "Select * from INSC_ENTITE ")
.head 5 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Insert into insc_entite (INE_INS, INE_EL, INE_ID, INE_NIV)
Select distinct ent_ins , ent_ele_ext , ent_id  , ent_niv_Lettre from entite where ent_niv_Lettre = 'K' " )
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 7 -  ! Update des nb indispensables
.head 7 -  ! BB
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire,"Update insc_entite set INE_BB = 1 where ine_ins not like '%999'  " )
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 7 -  ! E1E2
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain,"Select ent_id  from entite where ent_inscrits_E1_E2 is not null
	into :lsTmp ")
.head 7 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire,"Update insc_entite set INE_E1E2 = 1 where ine_id = "|| lsTmp )
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 7 -  ! E3E4
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain,"Select  ent_id  from entite where ent_inscrits_E3_E4 is not null
	into :lsTmp ")
.head 7 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire,"Update insc_entite set INE_E3E4 = 1 where ine_id = "|| lsTmp )
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 7 -  ! E5
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain,"Select  ent_id  from entite where ent_inscrits_E5 is not null
	into :lsTmp ")
.head 7 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire,"Update insc_entite set INE_E5 = 1 where ine_id ="|| lsTmp )
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  !
.head 5 -  ! Insert into Table Coord_Bureau
.head 5 -  Set lsTmp = gsGestionElectionType
.head 5 +  While lsTmp != ''
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain,  "Select * from Coord_Bureau where CB_ELECT = '"|| SalStrLeftX( lsTmp ,2) ||"' ")
.head 6 +  If NOT SqlFetchNext( ghSqlMain, Btmp )
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Coord_Bureau (CB_TYPEBUR,CB_INS, CB_ELECT)
Select distinct 'K', ent_ins , ent_ele_ext  from entite where ent_niv_Lettre = 'K' and ent_ele_ext =  '"|| SalStrLeftX( lsTmp ,2) ||"' " )
.head 8 -  Call SqlCommit( ghSqlSecondaire )
.head 6 -  Set lsTmp = SalStrMidX( lsTmp, 3, SalStrLength( lsTmp ) )
.head 5 -  !
.head 5 -  ! INSC_ENTITE - Rename INE_RECUS_E5
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'BULLETINS_BETR' and NAME = 'BETR_ENCODE' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table BULLETINS_BETR rename BETR_INSCRITS BETR_ENCODE ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Update BULLETINS_BETR set BETR_ENCODE=1 where BETR_RECUS is not null ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 6 -  !
.head 5 -  !
.head 5 -  ! LISTES_NAT
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'LISTES_NAT' and NAME = 'LOGO' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table LISTES_NAT add LOGO char(200) ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! HISTO_ELU
.head 5 -  Call SqlExists(  "Select * from systables where name = 'HISTO_ELU' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create table HISTO_ELU 
		(HIE_ENVELOP_G char(20), HIE_EL char(2), HIE_NIV char(25), 
		HIE_GRP integer, HIE_NOL char(3),
		HIE_NB_ELU integer, HIE_DATEH timestamp ) " )
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "create public synonym HISTO_ELU for sysadm.HISTO_ELU ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "grant all on HISTO_ELU to public ")
.head 9 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! Table Groupe_Color
.head 5 -  Call SqlExists(  "Select * from systables where name = 'GROUPE_COLOR' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "CREATE TABLE SYSADM.GROUPE_COLOR (
  GRL_NOM CHAR(18), 
  GRL_PHON CHAR(18), 
  GRL_COULEUR INTEGER)" )
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "create public synonym GROUPE_COLOR for sysadm.GROUPE_COLOR ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "grant all on GROUPE_COLOR to public ")
.head 9 -  Call SqlCommit( ghSqlSecondaire )
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'MR','MR',9646350 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'PS','PS',221 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'FN','FN',3355443  )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'CDH','CDH',26367 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'sp.a-spirit','SPASPIRIT',3355647 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'CD&V NVA','CD&VNVA',39423 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'VLAAMS BELANG','VLAAMSBELANG',65535 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'open vld','OPENVLD',13382400 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'ECOLO','ECOLO',39219 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'VLAAMS BLOK','VLAAMSBLOK',26316 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'CSP','CSP',3394815 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'PFF MR','PFFMR',6500401 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'SP','SP',1118702 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'PJU-PDB','PJUPDB',26316 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values( 'VIVANT','VIVANT',16764108 )")
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Insert into Groupe_Color values('VLD-VIVANT','VLDVIVANT',13382400 )")
.head 9 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! RESULT_ELU_ROYAUME
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'RESULT_ELU_ROYAUME' and NAME = 'ELU_1830' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table RESULT_ELU_ROYAUME add ELU_1830 integer, ELU_3140 integer , ELU_4150 integer, ELU_5160 integer, ELU_60 integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! RESULT_ELU_ROYAUME
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'RESULT_ELU_ROYAUME' and NAME = 'ELU_M_1830' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table RESULT_ELU_ROYAUME add ELU_M_1830 integer, ELU_M_3140 integer , ELU_M_4150 integer, ELU_M_5160 integer, ELU_M_60 integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! RESULT_ELU_ROYAUME
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'RESULT_ELU_ROYAUME' and NAME = 'ELU_F_1830' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table RESULT_ELU_ROYAUME add ELU_F_1830 integer, ELU_F_3140 integer , ELU_F_4150 integer, ELU_F_5160 integer, ELU_F_60 integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! ENTITE - ENT_INSCRITS_BB
.head 5 -  Call SqlExists(  "Select * from insc_entite where INE_INS like '21%' and ine_el = 'VL' and INE_BB = 1 ", bExist)
.head 5 +  If bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Update ENTITE set ENT_INSCRITS_BB=null where ENT_INS like '21%' and ENT_NIV_LETTRE = 'K' and ENT_ELE_EXT ='VL' ")
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Update insc_entite set INE_BB=null where INE_INS like '21%' and INE_EL ='VL' ")
.head 8 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! ENTITE - ENT_DEP_LISTE pour le 5 (Prov hainaut)
.head 5 -  Call SqlExists(  "Select * from entite where ENT_INS like '5%' and ENT_ELE_EXT = 'EU' and ent_dep_LIste = '12025' and ENT_NIV_LETTRE = 'K' ", bExist)
.head 5 +  If bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Update ENTITE set ent_dep_LIste='92094' where ENT_INS like '5%' and ENT_NIV_LETTRE = 'K' and ENT_ELE_EXT ='EU' ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! ENTITE - Nom du collège avec accents
.head 5 -  Call SqlExists(  "Select * from entite where ENT_INS like '92094' and ENT_ELE_EXT = 'EU' and ent_Niv_lettre = 'L' and ENT_Nom_FF like  '%Electoral%' ", bExist)
.head 5 +  If bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Update ENTITE set ENT_Nom_FF= @left(ENT_Nom_FF,8) ||'électoral' || @mid(ENT_Nom_FF, 17, 25)  where ENT_NIV_LETTRE = 'L' and ENT_ELE_EXT ='EU' ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! ENTITE - Nb cdt à lEurope
.head 5 -  ! Call SqlExists(  "Select * from entite where ENT_INS = '92094' and ENT_ELE_EXT = 'EU' and ent_Niv_lettre = 'L' and @nullvalue(ENT_NB_CDT_MAX,0)=9 ", bExist)
.head 5 +  ! If bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Update ENTITE set ENT_NB_CDT_MAX= 8  where ENT_NIV_LETTRE = 'L' and ENT_ELE_EXT ='EU' and ENT_INS = '92094' ")
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Update ENTITE set ENT_NB_CDT_MAX= 13  where ENT_NIV_LETTRE = 'L' and ENT_ELE_EXT ='EU' and ENT_INS = '120205' ")
.head 8 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! ENTITE - Nom de la Circ Bxl pour MBPF correction
.head 5 -  Call SqlExists(  "Select * from entite where ENT_INS = '21004' and ENT_ELE_EXT = 'VL' and ent_Niv_lettre = 'C' and ENT_Nom_FF like  '%MBPF)' ", bExist)
.head 5 +  If bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Update ENTITE 
	set ENT_Nom_FF= 'Ressort MBPF' , ENT_Nom_NN= 'Kiesgebied BLVP', ENT_Nom_DD='Wahlbezirk BMFP', ENT_Nom_EN='Electoral District of BMFP'  
	where ENT_INS = '21004' and ENT_ELE_EXT = 'VL' and ent_Niv_lettre = 'C' ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! ENTITE - Traduction Royaume
.head 5 -  Call SqlExists(  "Select * from entite where ENT_INS = '00000' and ENT_NOM_NN is null and ent_ele_ext = 'EU'  ", bExist)
.head 5 +  If bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Update ENTITE 
	set ENT_Nom_NN= 'Koninkrijk' , ENT_Nom_DD='Königreich', ENT_Nom_EN='Kingdom'  
	where ENT_INS = '00000' and ENT_NOM_NN is null and ent_ele_ext = 'EU' ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! ENTITE - Correction HEron canton EU
.head 5 -  Call SqlExists(  "Select * from entite where ENT_INS = '61028' and ENT_NOM_FF like 'Canton de HE%' and ent_ele_ext = 'EU'  ", bExist)
.head 5 +  If bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Update ENTITE 
	set ENT_Nom_FF= 'Canton de Héron' , ENT_Nom_DD='Kanton van Héron', ENT_Nom_NN='Kanton van Héron'  , ENT_Nom_EN='District of Héron'  
	where ENT_INS = '61028' and  ENT_NOM_FF like 'Canton de HE%' and ent_ele_ext = 'EU'  ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! EXTRAPOLATION des élus
.head 5 -  Call SqlExists(  "Select * from APPL_PARM where NAME = 'EXTRAPOL' ", bExist)
.head 5 +  If Not bExist
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, 
"Insert into appl_parm ( NAME, LABEL_NL, LABEL_FR, DESC_NL, DESC_FR, VALUE, VALUE_DATATYPE, USER_YN, SYSMAN_YN, ORDER)
	values( 'EXTRAPOL','Etrapolation des élus avec élection préc.','Etrapolation des élus avec élection préc.', '', '', '0', 'N', 'N','Y',7) " )
.head 6 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! ELUS_DIRECT dans APPL_PARM
.head 5 -  Call SqlExists(  "Select * from APPL_PARM where NAME = 'ELUS_DIRECT' ", bExist)
.head 5 +  If Not bExist
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, 
"Insert into appl_parm ( NAME, LABEL_NL, LABEL_FR, DESC_NL, DESC_FR, VALUE, VALUE_DATATYPE, USER_YN, SYSMAN_YN, ORDER)
	values( 'ELUS_DIRECT','Diffusion des élus directement avec sièges','Diffusion des élus directement avec sièges', '', '', '1', 'N', 'N','Y',7) " )
.head 6 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! RESULT_SCRUTIN - Colonne pour le CheckSUM (RES_CHECK_SUM)
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'RESULT_SCRUTIN' and NAME = 'RES_CHECK_SUM' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table RESULT_SCRUTIN add RES_CHECK_SUM integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! RESULT_LISTES - Colonne pour le CheckSUM (REL_CHECK_SUM)
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'RESULT_LISTES' and NAME = 'REL_CHECK_SUM' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table RESULT_LISTES add REL_CHECK_SUM integer ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! EXTRAPOLATION des élus - méthode Stesud
.head 5 -  Call SqlExists(  "Select * from APPL_PARM where NAME = 'EXTRAPOL_STD' ", bExist)
.head 5 +  If Not bExist
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, 
"Insert into appl_parm ( NAME, LABEL_NL, LABEL_FR, DESC_NL, DESC_FR, VALUE, VALUE_DATATYPE, USER_YN, SYSMAN_YN, ORDER)
	values( 'EXTRAPOL_STD','Etrapolation des élus avec élection préc. - Méth. Stesud','Etrapolation des élus avec élection préc. - Méth. Stesud', '', '', '0', 'N', 'N','Y',7) " )
.head 6 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  !
.head 5 -  !
.head 5 -  ! Creation de RESULT_LISTES_??_EX en fct des élections traitées
.head 5 -  Set lnI = 0
.head 5 -  Set lsEl  = SalStrLeftX( gsGestionElectionType, 2 )
.head 5 +  While lsEl != ''
.head 6 +  If lsEl ='EU' or lsEl ='SE' or lsEl ='CK' or lsEl ='WL' or lsEl ='VL' or lsEl ='BR' or lsEl ='DE'
.head 7 -  ! Creation RESULT_LISTES_EX : table pour extrapolation et calcul des élus avec Apparentement
.head 7 -  Call SqlExists(  "Select * from systables where name = 'RESULT_LISTES_"|| lsEl ||"_EX' ", bExist)
.head 7 +  If Not bExist
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "CREATE TABLE SYSADM.RESULT_LISTES_"|| lsEl ||"_EX (
REL_LIS_FK INTEGER,
REL_ENT_FK INTEGER,
REL_ELE_FK INTEGER,
REL_LIS_NO INTEGER,
REL_ENT_INS CHAR(5),
REL_ELE_EXT CHAR(2),
REL_NIV_FK INTEGER,
REL_NIV_LETTRE CHAR(1),
REL_SC1 INTEGER,
REL_SC2 INTEGER,
REL_SC3 INTEGER,
REL_SC4 INTEGER,
REL_CHECK_SUM INTEGER ) " )
.head 9 +  If SqlPrepareAndExecute( ghSqlSecondaire, "create public synonym RESULT_LISTES_"|| lsEl ||"_EX for sysadm.RESULT_LISTES_"|| lsEl ||"_EX ")
.head 10 +  If SqlPrepareAndExecute( ghSqlSecondaire, "grant all on RESULT_LISTES_"|| lsEl ||"_EX to public ")
.head 11 -  Call SqlCommit( ghSqlSecondaire )
.head 7 -  ! New index sur RESULT_LISTES_EX 
.head 7 -  Call SqlExists(  "Select * from Sysindexes where NAME = 'RES_"|| lsEl ||"_IDX5_EX' ", bExist)
.head 7 +  If Not bExist
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX5_EX on  RESULT_LISTES_"|| lsEl ||"_EX (REL_ENT_INS) ")
.head 9 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX6_EX on  RESULT_LISTES_"|| lsEl ||"_EX (REL_NIV_LETTRE) ")
.head 10 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX7_EX on  RESULT_LISTES_"|| lsEl ||"_EX (REL_ELE_EXT) ")
.head 11 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX8_EX on  RESULT_LISTES_"|| lsEl ||"_EX (REL_LIS_NO) ")
.head 12 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX16_EX on  RESULT_LISTES_"|| lsEl ||"_EX (REL_LIS_FK) ")
.head 13 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX17_EX on  RESULT_LISTES_"|| lsEl ||"_EX (REL_ENT_FK) ")
.head 14 -  Call SqlCommit( ghSqlSecondaire )
.head 13 +  Else
.head 14 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 12 +  Else
.head 13 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 11 +  Else
.head 12 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 10 +  Else
.head 11 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 6 -  Set lnI = lnI+3
.head 6 -  Set lsEl  = SalStrMidX( gsGestionElectionType, lnI, 2 )
.head 5 -  ! Creation de RESULT_LISTES_??_EX2visu en fct des élections traitées
.head 5 -  Set lnI = 0
.head 5 -  Set lsEl  = SalStrLeftX( gsGestionElectionType, 2 )
.head 5 +  While lsEl != ''
.head 6 +  If lsEl ='EU' or lsEl ='SE' or lsEl ='CK' or lsEl ='WL' or lsEl ='VL' or lsEl ='BR' or lsEl ='DE'
.head 7 -  ! Creation RESULT_LISTES_EX2visu : table pour extrapolation et calcul des élus avec Apparentement dans Loc2Visu
.head 7 -  Call SqlExists(  "Select * from systables where name = 'RESULT_LISTES_"|| lsEl ||"_EX2VISU' ", bExist)
.head 7 +  If Not bExist
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "CREATE TABLE SYSADM.RESULT_LISTES_"|| lsEl ||"_EX2VISU (
REL_LIS_FK INTEGER,
REL_ENT_FK INTEGER,
REL_ELE_FK INTEGER,
REL_LIS_NO INTEGER,
REL_ENT_INS CHAR(5),
REL_ELE_EXT CHAR(2),
REL_NIV_FK INTEGER,
REL_NIV_LETTRE CHAR(1),
REL_SC1 INTEGER,
REL_SC2 INTEGER,
REL_SC3 INTEGER,
REL_SC4 INTEGER,
REL_CHECK_SUM INTEGER ) " )
.head 9 +  If SqlPrepareAndExecute( ghSqlSecondaire, "create public synonym RESULT_LISTES_"|| lsEl ||"_EX2VISU for sysadm.RESULT_LISTES_"|| lsEl ||"_EX2VISU ")
.head 10 +  If SqlPrepareAndExecute( ghSqlSecondaire, "grant all on RESULT_LISTES_"|| lsEl ||"_EX2VISU to public ")
.head 11 -  Call SqlCommit( ghSqlSecondaire )
.head 7 -  ! New index sur RESULT_LISTES_EX 
.head 7 -  Call SqlExists(  "Select * from Sysindexes where NAME = 'RES_"|| lsEl ||"_IDX5_EX2VISU' ", bExist)
.head 7 +  If Not bExist
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX5_EX2VISU on  RESULT_LISTES_"|| lsEl ||"_EX2VISU (REL_ENT_INS) ")
.head 9 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX6_EX2VISU on  RESULT_LISTES_"|| lsEl ||"_EX2VISU (REL_NIV_LETTRE) ")
.head 10 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX7_EX2VISU on  RESULT_LISTES_"|| lsEl ||"_EX2VISU (REL_ELE_EXT) ")
.head 11 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX8_EX2VISU on  RESULT_LISTES_"|| lsEl ||"_EX2VISU (REL_LIS_NO) ")
.head 12 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX16_EX2VISU on  RESULT_LISTES_"|| lsEl ||"_EX2VISU (REL_LIS_FK) ")
.head 13 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_"|| lsEl ||"_IDX17_EX2VISU on  RESULT_LISTES_"|| lsEl ||"_EX2VISU (REL_ENT_FK) ")
.head 14 -  Call SqlCommit( ghSqlSecondaire )
.head 13 +  Else
.head 14 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 12 +  Else
.head 13 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 11 +  Else
.head 12 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 10 +  Else
.head 11 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 6 -  Set lnI = lnI+3
.head 6 -  Set lsEl  = SalStrMidX( gsGestionElectionType, lnI, 2 )
.head 5 -  !
.head 5 -  ! Suppression de l'ancienne table RESULT_LISTES_EX : table pour extrapolation et calcul des élus avec Apparentement
.head 5 -  Call SqlExists(  "Select * from systables where name = 'RESULT_LISTES_EX' ", bExist)
.head 5 +  If bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Drop TABLE RESULT_LISTES_EX" )
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! Creation RESULT_LISTES_EX : table pour extrapolation et calcul des élus avec Apparentement
.head 5 -  ! Call SqlExists(  "Select * from systables where name = 'RESULT_LISTES_EX' ", bExist)
.head 5 +  ! If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "CREATE TABLE SYSADM.RESULT_LISTES_EX (
REL_LIS_FK INTEGER,
REL_ENT_FK INTEGER,
REL_ELE_FK INTEGER,
REL_LIS_NO INTEGER,
REL_ENT_INS CHAR(5),
REL_ELE_EXT CHAR(2),
REL_NIV_FK INTEGER,
REL_NIV_LETTRE CHAR(1),
REL_SC1 INTEGER,
REL_SC2 INTEGER,
REL_SC3 INTEGER,
REL_SC4 INTEGER,
REL_CHECK_SUM INTEGER ) " )
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "create public synonym RESULT_LISTES_EX for sysadm.RESULT_LISTES_EX ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "grant all on RESULT_LISTES_EX to public ")
.head 9 -  Call SqlCommit( ghSqlSecondaire )
.head 5 -  ! New index sur RESULT_LISTES_EX 
.head 5 -  ! Call SqlExists(  "Select * from Sysindexes where NAME = 'RES_IDX5_EX' ", bExist)
.head 5 +  ! If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_IDX5_EX on  RESULT_LISTES_EX (REL_ENT_INS) ")
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_IDX6_EX on  RESULT_LISTES_EX (REL_NIV_LETTRE) ")
.head 8 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_IDX7_EX on  RESULT_LISTES_EX (REL_ELE_EXT) ")
.head 9 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_IDX8_EX on  RESULT_LISTES_EX (REL_LIS_NO) ")
.head 10 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_IDX16_EX on  RESULT_LISTES_EX (REL_LIS_FK) ")
.head 11 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index RES_IDX17_EX on  RESULT_LISTES_EX (REL_ENT_FK) ")
.head 12 -  Call SqlCommit( ghSqlSecondaire )
.head 11 +  Else 
.head 12 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 10 +  Else 
.head 11 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 9 +  Else 
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 8 +  Else 
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 7 +  Else 
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 6 +  Else 
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 5 -  !
.head 5 -  ! New Index sur GRP_OLD
.head 5 -  Call SqlExists(  "Select * from Sysindexes where NAME = 'GRPO_IDX1' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index GrpO_Idx1 on Grp_old(GRP_NO ) ")
.head 7 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Create Index GrpO_Idx2 on Grp_old(GRP_EL ) ")
.head 8 -  Call SqlCommit( ghSqlSecondaire )
.head 7 +  Else
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "ROLLBACK" )
.head 5 -  ! GRP_CORRESP - Colonne GRP_EL
.head 5 -  Call SqlExists(  "Select * from syscolumns where tbname = 'GRP_CORRESP' and NAME = 'GRP_EL' ", bExist)
.head 5 +  If Not bExist
.head 6 +  If SqlPrepareAndExecute( ghSqlSecondaire, "Alter table GRP_CORRESP add GRP_EL char(5) ")
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 7 -  ! Call SqlPrepareAndExecute( ghSqlSecondaire, "Select GRP_NO , GRP_NOOLD
 from GRP_CORRESP
 into :lsGrp, :lsGrp2 ")
.head 7 +  ! While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 -  Call SqlPrepareAndExecute( ghSqlMaj , "Select GRL_EL 
 from Groupe_Listes where Grl_id = :lsGrp
 into :lsEl1 ")
.head 8 -  Call SqlFetchNext( ghSqlMaj, Btmp )
.head 8 -  Call SqlPrepareAndExecute( ghSqlMaj, "Select GRP_EL 
 from Grp_Old where GRP_NO  = :lsGrp2
 into :lsEl2 ")
.head 8 -  Call SqlFetchNext( ghSqlMaj, Btmp )
.head 8 +  If lsEl1 = lsEl2
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update GRP_CORRESP set  GRP_EL = :lsEl1 where GRP_NO=:lsGrp and GRP_NOOLD=:lsGrp2 ")
.head 9 -  Call SqlCommit( ghSqlMaj )
.head 8 +  Else 
.head 9 -  Call SalMessageBox( "Corresp. de Groupe non trouvé : "|| lsGrp || " "|| lsEl1 ||"   et   "|| lsGrp2 || " "|| lsEl2  , "ERR", MB_Ok  )
.head 5 -  !
.head 5 -  Call SqlCommit( ghSqlSecondaire)
.head 5 -  Call PalUpdateStatistics(  )
.head 5 -  Call SalHideWindow( dfLibelleR )
.head 3 +  Function: PalUpdateStatistics
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Sql Handle: lhSql
.head 4 +  Actions
.head 5 +  If SqlConnect( lhSql )
.head 6 -  Call SalShowWindow( dfLibelleR )
.head 6 -  Set dfLibelleR = "Update statistics sur la Base de Données ... "
.head 6 -  Call SalBringWindowToTop( dfLibelleR )
.head 6 -  Call DispatchMessage(  )
.head 6 -  Call SqlSetParameter( lhSql, DBP_FETCHTHROUGH, TRUE, '' )
.head 6 -  Call SqlSetParameter( lhSql, DBP_PRESERVE, TRUE, '' )
.head 6 -  Call SqlSetIsolationLevel( lhSql, 'RL' )
.head 6 +  If SqlPrepareAndExecute( lhSql, "Update Statistics on Database ")
.head 7 -  Call SqlCommit( lhSql )
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( lhSql, "ROLLBACK" )
.head 7 -  Call SalMessageBox( "Erreur dans l'update statistics", "ERREUR", MB_Ok | MB_IconHand )
.head 6 -  Call SqlDisconnect( lhSql )
.head 3 -  !
.head 3 +  Function: PalDiffuseElus
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Number: nNoElection
.head 5 -  Number: nElu
.head 5 -  String: sElection
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  String: sMsg
.head 4 +  Actions
.head 5 -  Set bOk = TRUE
.head 5 -  Set wbClickOn = FALSE
.head 5 +  If SalIsWindowEnabled( pbStop )
.head 6 -  Call SalSendMsg( pbStop, SAM_Click, 0,0 )
.head 6 -  Set wbClickOn = TRUE
.head 5 +  If gsPhaseResult = '1'  
.head 6 -  Call SalModalDialog(dlgPW, hWndForm, 'VALID', bOk)
.head 6 +  If bOk
.head 7 +  If nElu
.head 8 -  Set sMsg = "Désirez-vous commencer à diffuser les sièges et les élus ?"
.head 7 +  Else
.head 8 -  Set sMsg = "Désirez-vous STOPPER la diffusion des sièges et des élus ?"
.head 7 +  If SalMessageBox( sMsg , "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 8 -  Call VisWaitCursor( TRUE )
.head 8 -  Call PalSetApplParm( "ELU_DIFFUSE", '1' )
.head 8 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update Election set  ele_Loc2_EluDiffuse = :nElu
	where ELE_LETTRE = :sElection " )
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 +  If nElu
.head 9 -  Call SalColorSet( whCbElecElu[ nNoElection ], COLOR_IndexWindow, COLOR_DarkGreen )
.head 9 -  Call SalColorSet( whElu_FR[ nNoElection ], COLOR_IndexWindow, COLOR_DarkGreen )
.head 9 -  Call SalColorSet( whCbElecElu[ nNoElection ], COLOR_IndexWindowText, COLOR_White )
.head 8 +  Else
.head 9 -  Call SalColorSet( whCbElecElu[ nNoElection ], COLOR_IndexWindow, COLOR_Salmon )
.head 9 -  Call SalColorSet( whElu_FR[ nNoElection ], COLOR_IndexWindow, COLOR_Salmon )
.head 9 -  Call SalColorSet( whCbElecElu[ nNoElection ], COLOR_IndexWindowText, COLOR_Black )
.head 8 -  Call VisWaitCursor( FALSE)
.head 7 +  Else
.head 8 -  Set bOk = FALSE
.head 6 +  Else
.head 7 -  Call SalMessageBox("Erreur de mot de passe", "Ereur", MB_Ok | MB_IconHand ) 
.head 5 +  If wbClickOn
.head 6 -  Call SalSendMsg( pbAction , SAM_Click, 0,0 )
.head 5 -  Return bOk
.head 3 -  !
.head 3 +  Function: PalDtmCheckSumListe
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  Number: nCheckSumPrec
.head 5 -  Number: nNbSuiv
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nCheckOut
.head 5 -  Number: nCheckMod
.head 4 +  Actions
.head 5 -  Call SalGetProfileInt( 'DATABASE', 'CHECK_SUM_MOD',  nCheckMod, wsPathINI )
.head 5 +  If nCheckMod = 0 or nCheckMod = NUMBER_Null
.head 6 -  Set nCheckMod = 99991
.head 6 -  Call SalSetProfileInt( 'DATABASE', 'CHECK_SUM_MOD',  nCheckMod, wsPathINI )
.head 5 +  If nCheckSumPrec = NUMBER_Null
.head 6 -  Set nCheckOut = nNbSuiv
.head 5 +  Else
.head 6 +  If nNbSuiv = 0
.head 7 -  Set nCheckOut = nCheckSumPrec + 9
.head 6 +  Else
.head 7 -  ! Set nCheckOut = SalNumberMod(  (nCheckSumPrec * nNbSuiv)+1 , 99997 )
.head 7 -  Set nCheckOut = SalNumberMod(  (nCheckSumPrec * nNbSuiv)+1 , 99991 )
.head 5 -  Return nCheckOut
.head 3 +  Function: PalErrLog
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: psFileName
.head 5 -  Number: nNoErr
.head 5 -  String: sText
.head 5 -  String: bErr
.head 5 -  String: bWarning
.head 5 -  Boolean: bCockpit
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsDate
.head 4 +  Actions
.head 5 -  Call SalDateToStr( SalDateCurrent(  ), lsDate )
.head 5 -  Set mlLogFormatR = lsDate || '   -   '|| psFileName ||'
' || sText ||'
'|| SalStrRepeatX( '-' , 35 ) ||'
' || mlLogFormatR
.head 5 +  If bCockpit
.head 6 -  Call PalHttpCockpit( nNoErr, bWarning , bErr, sText, PalDtmExtension(  psFileName ), wsModuleNom, wsModuleLigne, psFileName )
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  Window Handle: whPhase[*]
.head 3 -  String: wsPhase[*]
.head 3 -  String: wsPath
.head 3 -  String: wsPathLoc3
.head 3 -  String: wsPathTmp
.head 3 -  String: wsPathHTTP
.head 3 -  String: wsNomExeLance
.head 3 -  String: wsTmp
.head 3 -  String: wsDiffuseElusCK_BHV
.head 3 -  File Handle: whFile
.head 3 -  String: wsPathINI
.head 3 -  String: wsPathResult
.head 3 -  String: wsPathCopieFichierResulat
.head 3 -  String: wsDateResult
.head 3 -  String: wsEnveloppeR_Glob
.head 3 -  Boolean: wbResultat
.head 3 -  Boolean: wbCoord
.head 3 -  Boolean: wbOkQuit
.head 3 -  Window Handle: whCbElec[25]
.head 3 -  Window Handle: whCbElecFR[25]
.head 3 -  Window Handle: whDateElec[25]
.head 3 -  Window Handle: whDateElecFR[25]
.head 3 -  Window Handle: whMod_FR[25]
.head 3 -  Window Handle: whElu_FR[25]
.head 3 -  Window Handle: whCbElecElu[25]
.head 3 -  Date/Time: wdDate1
.head 3 -  Boolean: wbClickOn
.head 3 -  !
.head 3 -  Boolean: wbSituationZeroResult
.head 3 -  String: wsArray[*]
.head 3 -  String: wsG[20]
.head 3 -  String: wsS[100]
.head 3 -  String: wsB[100]
.head 3 -  String: wsA[5,100]
.head 3 -  String: wsCo[100,100]
.head 3 -  String: wsT[20]
.head 3 -  String: wsH[20]
.head 3 -  String: wsL[250, 100]
.head 3 -  String: wsC[250,250,100]
.head 3 -  String: wsSuppl[250,250,100]
.head 3 -  Number: wnNoListeProvisoire
.head 3 -  Number: wnCheckSumDtm[150]
.head 3 -  Number: wnIdEntiteEnCours
.head 3 -  String: wsModuleNom
.head 3 -  String: wsModuleLigne
.head 3 -  Number: wnPassage
.head 3 -  Number: wnPassageStat
.head 3 -  Number: wnPassageCoord
.head 3 -  String: wsDiffuseElus
.head 3 -  Boolean: wbFormatRManuel
.head 3 -  Boolean: wbFormatRPourEL[*]
.head 3 -  !
.head 3 -  Boolean: wbOk
.head 3 -  String: sInsEntiteApp
.head 3 -  String: sTypeBur
.head 3 -  String: sElExt
.head 3 -  Number: nSiegeDejaAcquisTot[*]
.head 3 -  Number: nSiegeTotEntite[*]
.head 3 -  Number: nSiegeReste[*]
.head 3 -  Number: nNoTimer
.head 3 -  Number: wnPassageLastFile
.head 3 -  Number: wbExtrapolElection[*]
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalDisableWindow( frmLOC2 )
.head 4 -  Set wsDiffuseElusCK_BHV = '0'
.head 4 -  Call SalCenterWindow( hWndForm )
.head 3 +  On SAM_CreateComplete
.head 4 -  Set wsPath = PalGetPrgmDirectory()
.head 4 -  Set wsNomExeLance = PalGetPrgmName(  )
.head 4 +  If NOT SalFileOpen( whFile, wsPath ||"\\" || wsNomExeLance  ||".INI", OF_Exist )
.head 5 +  If NOT SalFileOpen( whFile, wsPath ||"\\LOC2.INI", OF_Exist )
.head 6 -  Call SalMessageBox( "Aucun "|| wsNomExeLance ||".INI  ni LOC2.INI trouvé !!", "ERREUR", MB_Ok )
.head 6 -  Call SalSendMsg( hWndForm, SAM_Close , 0,0 )
.head 5 +  Else
.head 6 -  Set wsPathINI = wsPath ||'\\LOC2.ini'
.head 4 +  Else
.head 5 -  Set wsPathINI = wsPath ||'\\' || wsNomExeLance  ||'.ini'
.head 4 -  Set gsPathApplic = wsPath
.head 4 -  !
.head 4 -  ! Set wsPath = PalGetPrgmDirectory()
.head 4 +  ! If NOT SalFileOpen( whFile, wsPath ||"\\LOC2.INI", OF_Exist )
.head 5 -  Call SalMessageBox( "Aucun LOC2.INI trouvé !!", "ERREUR", MB_Ok )
.head 5 -  Call SalSendMsg( hWndForm, SAM_Close , 0,0 )
.head 4 -  ! Set gsPathApplic = wsPath
.head 4 -  ! Set wsPathINI = wsPath ||'\\LOC2.ini'
.head 4 -  Call SalGetProfileString( 'PATH', 'PATH_LOC2',  wsPath||'\\DETAIL', dfIn, wsPathINI )
.head 4 -  Call SalGetProfileString( 'PATH', 'PATH_RESULT',  wsPath||'\\RESULT', dfOut, wsPathINI )
.head 4 -  ! Call PalMakeAllDir(dfOut )
.head 4 -  Call PalMakeAllDir( dfIn || "\\0\\ARCH_0K" )
.head 4 -  Call PalMakeAllDir( dfIn || "\\1\\ARCH_1K" )
.head 4 -  !
.head 4 -  Call SalGetProfileString( 'PATH', 'PATH_TMP',  wsPath||'\\TMP', wsPathTmp, wsPathINI )
.head 4 -  Call PalMakeAllDir(  wsPathTmp )
.head 4 -  Call SalGetProfileString( 'PATH', 'PATH_RESULT',  wsPath||'\\RESULT', wsPathResult, wsPathINI )
.head 4 -  Call PalMakeAllDir(  wsPathResult )
.head 4 -  Call SalGetProfileString( 'PATH', 'PATH_LOC1_DOWN',  '', gsPathLoc1Down , wsPathINI )
.head 4 -  Call PalMakeAllDir(  gsPathLoc1Down )
.head 4 -  Set dfLoc1 = gsPathLoc1Down
.head 4 -  Call SalGetProfileString( 'PATH', 'PATH_LOC3',  '', dfLoc3 , wsPathINI )
.head 4 -  !
.head 4 -  Set gsPathLogo = wsPath || '\\LOGO\\' 
.head 4 -  Call PalMakeAllDir(  gsPathLogo )
.head 4 -  Set gsPathErreurFF = wsPath || '\\ERR_LOG\\' 
.head 4 -  Call PalMakeAllDir(  gsPathErreurFF )
.head 4 -  Set gsPathExport = wsPath || '\\EXPORT\\' 
.head 4 -  Call PalMakeAllDir(  gsPathExport )
.head 4 -  !
.head 4 -  Call SalGetProfileString( 'DATABASE', 'DATE_EL',  '', gsDateEl, wsPathINI )
.head 4 -  Call SalGetProfileString( 'DATABASE', 'RESULTAT',  '', gsPhaseResult, wsPathINI )
.head 4 -  !
.head 4 -  !
.head 4 -  Call SalGetProfileString( 'DATABASE', 'DB',  'LOC2', SqlDatabase, wsPathINI )
.head 4 -  Call SalGetProfileString( 'DATABASE', 'USER',  'SYSADM', SqlUser, wsPathINI )
.head 4 -  Set SqlPassword = SqlUser
.head 4 +  If SqlConnect( ghSqlMain )
.head 5 -  Call SqlSetParameter( ghSqlMain, DBP_FETCHTHROUGH, TRUE, '' )
.head 5 -  Call SqlSetParameter( ghSqlMain, DBP_PRESERVE, TRUE, '' )
.head 5 -  Call SqlSetIsolationLevel( ghSqlMain, 'RL' )
.head 5 -  !
.head 5 -  Call SqlConnect( ghSqlMsg )
.head 5 -  Call SqlSetParameter( ghSqlMsg, DBP_FETCHTHROUGH, TRUE, '' )
.head 5 -  Call SqlSetParameter( ghSqlMsg, DBP_PRESERVE, TRUE, '' )
.head 5 -  Call SqlSetIsolationLevel( ghSqlMsg, 'RL' )
.head 5 -  !
.head 5 -  Call SqlConnect( ghSqlMaj )
.head 5 -  Call SqlSetParameter( ghSqlMaj, DBP_FETCHTHROUGH, TRUE, '' )
.head 5 -  Call SqlSetParameter( ghSqlMaj, DBP_PRESERVE, TRUE, '' )
.head 5 -  Call SqlSetIsolationLevel( ghSqlMaj, 'RL' )
.head 5 -  !
.head 5 -  Call SqlConnect( ghSqlSecondaire )
.head 5 -  Call SqlSetParameter( ghSqlSecondaire, DBP_FETCHTHROUGH, TRUE, '' )
.head 5 -  Call SqlSetParameter( ghSqlSecondaire, DBP_PRESERVE, TRUE, '' )
.head 5 -  Call SqlSetIsolationLevel( ghSqlSecondaire, 'RL' )
.head 5 -  !
.head 5 -  Call SqlConnect( ghSqlErreur )
.head 5 -  Call SqlSetParameter( ghSqlErreur, DBP_FETCHTHROUGH, TRUE, '' )
.head 5 -  Call SqlSetParameter( ghSqlErreur, DBP_PRESERVE, TRUE, '' )
.head 5 -  Call SqlSetIsolationLevel( ghSqlErreur, 'RL' )
.head 5 -  !
.head 5 -  Call PalChargeMessage(  )
.head 4 +  Else
.head 5 -  Call SalMessageBox( "Aucune connection à la base de données !!","Message", MB_Ok | MB_IconExclamation )
.head 5 -  Call SalQuit(  )
.head 4 -  !
.head 4 -  Call SalGetProfileString( 'ELECTIONS', 'TYPE',  '', gsGestionElectionType, wsPathINI )
.head 4 +  If gsGestionElectionType = ''
.head 5 -  Set gsGestionElectionType = 'EU,CK,SE,WL,VL,BR,DE'
.head 5 -  Call SalSetProfileString( 'ELECTIONS', 'TYPE', gsGestionElectionType, wsPathINI )
.head 4 -  !
.head 4 -  Call PalVerifStructureDb()
.head 4 -  !
.head 4 -  Call PalGetApplParm( "DATE_LOC2_DF", wsTmp )
.head 4 -  Set dfDateDernier = SalStrToDate( wsTmp )
.head 4 -  !
.head 4 -  Call PalCheckRepertoire(0)
.head 4 -  ! !
.head 4 -  Call SalGetProfileString( 'VERSION', 'VERSION_FICHIER',  '', gsVersionFichierOut, wsPathINI )
.head 4 +  If gsVersionFichierOut = ''
.head 5 -  Set gsVersionFichierOut = '1'
.head 5 -  Call SalSetProfileString( 'VERSION', 'VERSION_FICHIER', gsVersionFichierOut, wsPathINI )
.head 4 -  Set dfVersionIR = gsVersionFichierOut
.head 4 -  Call SalGetProfileString( 'DATABASE', 'INTERVAL_RESULT',  '1000', dfTempsEntreR, wsPathINI )
.head 4 -  Call SalGetProfileString( 'DATABASE', 'INTERVAL_COORD',  '1000', dfTempsEntreCoord, wsPathINI )
.head 4 -  Call SalGetProfileString( 'APPLIC', 'MODULE',  "LOC2", wsModuleNom, wsPathINI )
.head 4 -  Call SalGetProfileString( 'APPLIC', 'LIGNE',  "", wsModuleLigne, wsPathINI )
.head 4 -  Call SalGetProfileString( 'PATH', 'PATH_HTTP', wsPath||"\\HTTP.INI" , wsPathHTTP, wsPathINI )
.head 4 -  Call PalHttpIniRead( wsPathHTTP, wsPathINI )
.head 4 -  ! Set wsTmp = ''
.head 4 -  ! Call PalGetApplParm( "EXTRAPOL", wsTmp )
.head 4 -  ! Set cbExtrapolation = SalStrToNumber( wsTmp )
.head 4 -  Set wsTmp = ''
.head 4 -  Call PalGetApplParm( "EXTRAPOL_STD", wsTmp )
.head 4 -  Set cbMethodeStesud = SalStrToNumber( wsTmp )
.head 4 -  !
.head 4 -  Call PalCreateRepDetail(  )
.head 4 -  Call PalNoteVersion(  )
.head 4 -  Call PalDtmTitre()
.head 4 -  Call SalHideWindow( dfLibelleR )
.head 4 -  !
.head 4 -  Set nNoTimer = SalNumberRandom(  )
.head 4 -  !
.head 4 -  Call SalEnableWindow( frmLOC2 )
.head 4 -  ! Call SalPostMsg( pbAction, SAM_Click,0,0)
.head 3 +  On SAM_Timer
.head 4 -  Call SalTimerKill( hWndForm, nNoTimer )
.head 4 +  If NOT gbKillTimer
.head 5 -  Set wnPassageStat = wnPassageStat + 1
.head 5 -  !
.head 5 +  If gsPhaseResult = '1'
.head 6 -  Set wnPassage = wnPassage + 1
.head 6 -  Call PalDtmTempsR( wnPassage )
.head 6 +  If not wbResultat
.head 7 +  If wnPassageLastFile > 0 and wnPassageStat  > SalStrToNumber(SalStrLeftX( dfTempsEntreR, 2))*60 + SalStrToNumber(SalStrRightX( dfTempsEntreR, 2))  
.head 8 +  If wnPassageStat - wnPassageLastFile >= 5
.head 9 -  Set wnPassageStat = 0
.head 9 -  Set wnPassageLastFile = 0
.head 9 -  Set wbResultat = TRUE
.head 5 +  If cbCoordOn
.head 6 -  Set wnPassageCoord = wnPassageCoord + 1
.head 6 -  Call PalDtmTempsCoord( wnPassageCoord )
.head 5 +  If NOT wbResultat and NOT wbCoord
.head 6 -  Call PalPopulateTbl()
.head 5 +  Else If gsPhaseResult = '1' and wbResultat
.head 6 -  Call SalDisableWindow( frmLOC2 )
.head 6 -  Call SalDisableWindow( pbFormatR )
.head 6 +  If PalDtmResult()
.head 7 -  Set wnPassageStat = 0
.head 6 -  Set wbFormatRManuel = FALSE
.head 6 -  Set wbResultat = FALSE
.head 6 -  Set wnPassage= 0
.head 6 -  Set dfTempsR = dfTempsEntreR
.head 6 +  If cbCoordOn
.head 7 -  Call SalShowWindow( dfLibelleR )
.head 7 -  Call SalBringWindowToTop( dfLibelleR )
.head 7 -  Set dfLibelleR = 'Envoi des coordonnées vers LOC3 ...'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call SalDisableWindow( pbFormatCoord )
.head 7 -  Call SalGetProfileString( 'PATH', 'PATH_LOC3',  '', wsPathLoc3, frmLOC2.wsPathINI )
.head 7 -  Call PalGenereCoord( wsPathLoc3 , frmLOC2.wsPathTmp)
.head 7 -  Set dfTempsCoord = dfTempsEntreCoord
.head 7 -  Call SalEnableWindow( pbFormatCoord )
.head 7 -  Call SalHideWindow( dfLibelleR )
.head 7 -  !
.head 7 -  Call PalHttpCockpit( 458, '', '', '', '', wsModuleNom, wsModuleLigne, '' )
.head 7 -  !
.head 6 -  Call SalEnableWindow( pbFormatR )
.head 6 -  Call SalEnableWindow( frmLOC2 )
.head 6 +  If SalIsWindowEnabled( pbStop )
.head 7 -  Call SalTimerSet( hWndForm, nNoTimer, 100 )
.head 6 -  Set wdDate1 = SalDateCurrent(  )
.head 5 +  Else If wbCoord 
.head 6 -  Call SalDisableWindow( frmLOC2 )
.head 6 +  If cbCoordOn
.head 7 -  Call SalShowWindow( dfLibelleR )
.head 7 -  Call SalBringWindowToTop( dfLibelleR )
.head 7 -  Set dfLibelleR = 'Envoi des coordonnées vers LOC3 ...'
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call SalDisableWindow( pbFormatCoord )
.head 7 -  Call SalGetProfileString( 'PATH', 'PATH_LOC3',  '', wsPathLoc3, frmLOC2.wsPathINI )
.head 7 -  Call PalGenereCoord( wsPathLoc3 , frmLOC2.wsPathTmp)
.head 7 -  !
.head 7 -  Call PalHttpCockpit( 458, '', '', '', '', wsModuleNom, wsModuleLigne, '' )
.head 7 -  !
.head 7 -  Set wnPassageCoord= 0
.head 7 -  Set dfTempsCoord = dfTempsEntreCoord
.head 7 -  Call SalEnableWindow( pbFormatCoord )
.head 7 -  Call SalHideWindow( dfLibelleR )
.head 7 +  If SalIsWindowEnabled( pbStop )
.head 8 -  Call SalTimerSet( hWndForm, nNoTimer, 100 )
.head 6 -  Call SalEnableWindow( frmLOC2 )
.head 6 -  Set wbCoord = FALSE
.head 5 -  !
.head 5 -  Call SalHideWindow( dfLibelleR )
.head 4 +  Else
.head 5 -  Call SalEnableWindow( pbAction )
.head 5 -  Call SalDisableWindow( pbStop )
.head 4 +  If SalIsWindowEnabled( pbAction )
.head 5 -  Set gbKillTimer = TRUE
.head 3 +  On SAM_Close
.head 4 -  !
.head 4 +  If NOT wbOkQuit
.head 5 -  Call SalSendMsg( pbQuit, SAM_Click, 0,0 )
.head 5 -  Return FALSE
.head 4 -  !
.head 4 -  Call PalLibereElection( NUMBER_Null )
.head 4 -  !
.head 4 -  ! Call PalLoc2Actif( -1, hWndForm , '')
.head 4 -  Call SqlDisconnect( ghSqlSecondaire )
.head 4 -  Call SqlDisconnect( ghSqlErreur )
.head 4 -  Call SqlDisconnect( ghSqlMaj )
.head 4 -  Call SqlDisconnect( ghSqlMsg )
.head 4 -  Call SqlDisconnect( ghSqlMain )
.head 3 +  On 17
.head 4 -  Call SalSendMsg( pbStop, SAM_Click,0,0)
.head 4 -  Set wbOkQuit = TRUE
.head 4 -  Call PalHttpCockpit( 498, '', '', '', '', wsModuleNom, wsModuleLigne, '' )
.head 4 -  Call SalSendMsg( hWndForm, SAM_Close, 0,0)
.head 3 +  On SAM_QuitMulti
.head 4 -  Call SalSendMsg( pbStop, SAM_Click,0,0)
.head 4 -  Set wbOkQuit = TRUE
.head 4 -  ! Call PalHttpCockpit( 499, '', '', '', '', wsModuleNom, wsModuleLigne, '' )
.head 4 -  Call SalSendMsg( hWndForm, SAM_Close, 0,0)
.head 1 +  Dialog Box: dlgGenereFile
.head 2 -  Class: cQuickTabsDialog
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Accessories Enabled? Class Default
.head 2 -  Visible? Class Default
.head 2 -  Display Settings
.head 3 -  Display Style? Class Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Class Default
.head 3 -  Allow Dock to Parent? Class Default
.head 3 -  Docking Orientation: Class Default
.head 3 -  Window Location and Size
.head 4 -  Left: 7.55"
.head 4 -  Top: 2.229"
.head 4 -  Width:  15.85"
.head 4 -  Width Editable? Class Default
.head 4 -  Height: 7.298"
.head 4 -  Height Editable? Class Default
.head 3 -  Absolute Screen Location? Class Default
.head 3 -  Font Name: Class Default
.head 3 -  Font Size: Class Default
.head 3 -  Font Enhancement: Class Default
.head 3 -  Text Color: Class Default
.head 3 -  Background Color: Class Default
.head 3 -  Resizable? Class Default
.head 3 -  Vertical Scroll? Class Default
.head 3 -  Horizontal Scroll? Class Default
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Docking Toolbar? No
.head 4 -  Toolbar Docking Orientation: Top | Bottom
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Resizable? No
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  ! Pushbutton: pbMajEntite
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Maj Entite
.head 4 -  Window Location and Size
.head 5 -  Left: 6.083"
.head 5 -  Top: 5.238"
.head 5 -  Width:  1.35"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.end
.head 4 +  Message Actions 
.head 5 +  On SAM_Click
.head 6 -  Call PalMajEntite()
.head 3 +  Picture: picTabs
.data CLASSPROPS
0000: 5461624C6566744D 617267696E000200 3000005461624375 7272656E74000600
0020: 4E616D6530000054 616252696768744D 617267696E000200 3000005461624E61
0040: 6D65730030004E61 6D6530094E616D65 33094E616D653109 4E616D6534094E61
0060: 6D6535094E616D65 36094E616D653209 4E616D6537000054 61624C6162656C73
0080: 00B4004574617420 646573206C697374 6573094EB0204C69 73746573206E6174
00A0: 696F6E616C657309 47657374696F6E20 6465732067726F75 706573094C69656E
00C0: 206176656320416E 6369656E73206772 6F75706573094265 6C67657320E0206C
00E0: 27E97472616E6765 7220284535290942 7572656175782064 652044E9702E202F
0100: 20566F7465730949 6E697469616C6973 6174696F6E206574 2056616C69646174
0120: 696F6E094E697665 61757820537570E9 7269657572730000 5461625061676543
0140: 6F756E7400020031 0000546162426F74 746F6D4D61726769 6E00020030000054
0160: 6162447261775374 796C65000B005769 6E39355374796C65 0000546162466F72
0180: 6D50616765730008 0009090909090909 0000546162546F70 4D617267696E0002
01A0: 0030000000000000 0000000000000000 0000000000000000
.enddata
.data CLASSPROPSSIZE
0000: B801
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 1
.head 4 -  Class ChildKey: 0
.head 4 -  Class: cQuickTabsDialog
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.25"
.head 5 -  Top: 0.06"
.head 5 -  Width:  15.283"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 7.071"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Editable? Class Default
.head 4 -  File Name:
.head 4 -  Storage: Class Default
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Fit: Class Default
.head 4 -  Scaling
.head 5 -  Width:  Class Default
.head 5 -  Height:  Class Default
.head 4 -  Corners: Class Default
.head 4 -  Border Style: Class Default
.head 4 -  Border Thickness: Class Default
.head 4 -  Tile To Parent? No
.head 4 -  Border Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Message Actions
.head 3 -  ! Tabs 0
.head 3 -  Background Text: Election:
.data CLASSPROPSSIZE
0000: 3700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573002400 4E616D6530094E61 6D6531094E616D65
0020: 34094E616D653509 4E616D6536094E61 6D653700000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 44323
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.367"
.head 5 -  Top: 0.464"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Combo Box: cmbEl
.data CLASSPROPSSIZE
0000: 3D00
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573002A00 4E616D6530094E61 6D6531094E616D65
0020: 34094E616D653509 4E616D6536094E61 6D6532094E616D65 3700000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left: 1.367"
.head 5 -  Top: 0.44"
.head 5 -  Width:  1.05"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 3.679"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  String Type: String
.head 4 -  Maximum Data Length: Default
.head 4 -  Sorted? No
.head 4 -  Always Show List? No
.head 4 -  Vertical Scroll? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  List Initialization
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call PalPopulateCmbEl( cmbEl )
.head 5 +  On SAM_Click
.head 6 -  Call tblEntite.PalPopulateTbl(  )
.head 6 -  Call tblGroupe.PalPopulateGroupe(  )
.head 6 -  Call tblGrpOld.PalPopulateGrpOld(  )
.head 6 -  Call tblEntite_E5.PalPopulateTbl(  )
.head 6 -  Call tblEntite_BVD.PalPopulateTbl(  )
.head 6 -  Set dfModeElection = cmbEl
.head 6 +  If wnTabActif = 7
.head 7 -  Call tblNivSup.PalPopulate()
.head 6 -  !
.head 6 -  ! Charge gsPhaseResult - wnValidGrp
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ele_Loc2_Result , Ele_Loc2_ValidGrp , ele_Loc2_EluDiffuse
	from election
	Where Ele_lettre = :cmbEl 
	Into :gsPhaseResult, :wnValidGrp, :wsDiffuseElus ")
.head 6 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  !
.head 6 -  Call PalValidGroupe( 0 )
.head 6 +  If wnValidGrp
.head 7 -  Set dfModeElection = dfModeElection ||' - Groupes validés'
.head 6 -  !
.head 6 -  !
.head 6 +  If gsPhaseResult = '1' 
.head 7 -  Set dfModeElection = dfModeElection ||' - Mode Résultat'
.head 7 +  If wsDiffuseElus = '1'
.head 8 -  Set dfModeElection = dfModeElection ||' - Avec diffusion des élus'
.head 8 -  Call SalDisableWindow( pbDiffusionSiege )
.head 8 -  Call SalColorSet( pbDiffusionSiege, COLOR_IndexWindow, COLOR_DarkGreen )
.head 7 +  Else
.head 8 -  Call SalColorSet( pbDiffusionSiege, COLOR_IndexWindow, COLOR_Salmon )
.head 8 -  Call SalEnableWindow( pbDiffusionSiege )
.head 7 -  Call PalDtmBureauDep( )
.head 6 +  Else
.head 7 -  Set dfModeElection = dfModeElection ||' - Mode Collecte'
.head 7 -  Call SalClearField( dfBurDep_Siege )
.head 7 -  Call SalClearField( dfBurTot_Siege )
.head 7 -  Call SalClearField( dfSitDep_Siege )
.head 7 -  Call SalColorSet( pbDiffusionSiege, COLOR_IndexWindow, COLOR_Gray )
.head 7 -  Call SalDisableWindow( pbDiffusionSiege )
.head 3 +  Combo Box: cmbEl_Rapport
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6536000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left: 11.183"
.head 5 -  Top: 0.452"
.head 5 -  Width:  1.05"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 3.524"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Editable? No
.head 4 -  String Type: String
.head 4 -  Maximum Data Length: Default
.head 4 -  Sorted? No
.head 4 -  Always Show List? No
.head 4 -  Vertical Scroll? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Input Mask: Unformatted
.head 4 -  List Initialization
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call PalPopulateCmbEl( cmbEl_Rapport )
.head 3 +  Child Table: tblEntite
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65300000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: CTable
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.267"
.head 6 -  Top: 0.774"
.head 6 -  Width:  9.917"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 6.143"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Yes
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: 1
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colIns
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: INS
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.683"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEl
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: EL
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.383"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNiv
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Niv
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.333"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEntite
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Entité
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  4.433"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colInsDepListe
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: InsDepLIste
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSituation
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Situation
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.867"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colId
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNbSiege
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNbListe
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Nb. Listes
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colApp
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: App.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colAppIns
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: App.
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colAttention
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Message
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.4"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: tfOnCreate
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: b
.head 7 -  String: s
.head 7 -  Number: nImg
.head 7 -  Window Handle: hWndaCols[*]
.head 6 +  Actions
.head 7 -  ! Subclass
.head 7 -  Call MTblSubClass( hWndForm )
.head 7 -  ! Mousewheel scrolling
.head 7 -  Call MTblEnableMWheelScroll( hWndForm, TRUE )
.head 7 -  Call MTblSetMWheelOption( hWndForm, MTMW_PAGE_KEY, VK_Control )
.head 7 -  ! Selection
.head 7 -  Call MTblSetSelectionColors( hWndForm, COLOR_White, COLOR_DarkBlue )
.head 7 -  Call MTblSetFlags( hWndForm, MTBL_FLAG_FULL_OVERLAP_SELECTION, TRUE )
.head 7 -  !
.head 5 +  Function: PalPopulateTbl
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: lsSelect
.head 7 -  String: lsNiv
.head 7 -  String: lsLettre
.head 7 -  String: lsElection
.head 6 +  Actions
.head 7 -  Set lsSelect = "Select ent_ins, ENT_ELE_EXT,ENT_NIV_LETTRE,ENT_NOM_FF, ENT_DEP_LISTE, ENT_STATUS, ENT_ID, ENT_NB_CDT_MAX, Ent_GRP_App
	from entite
	where ent_ins is not null  "
.head 7 +  If cmbEl != ''
.head 8 -  Set lsElection = ''
.head 8 +  If cmbEl = 'CK'
.head 9 -  Set lsLettre = 'C'
.head 8 +  Else If cmbEl = 'SE'
.head 9 -  Set lsLettre = 'L'
.head 8 +  Else If cmbEl = 'WL'
.head 9 -  Set lsLettre = 'C'
.head 8 +  Else If cmbEl = 'EU'
.head 9 -  Set lsLettre = 'L'
.head 8 +  Else If cmbEl = 'VL'
.head 9 -  Set lsLettre = 'C'
.head 8 +  Else If cmbEl = 'BR'
.head 9 -  Set lsLettre = 'R'
.head 8 +  Else If cmbEl = 'DE'
.head 9 -  Set lsLettre = 'G'
.head 8 -  !
.head 8 -  Set lsSelect = lsSelect || " AND ENT_ELE_EXT = :cmbEl  and ENT_NIV_LETTRE = :lsLettre "
.head 7 -  Set lsSelect = lsSelect || "
Order by 1,2 
Into :tblEntite.colIns,:tblEntite.colEl ,:tblEntite.colNiv ,:tblEntite.colEntite ,:tblEntite.colInsDepListe ,:tblEntite.colSituation ,:tblEntite.colId ,:tblEntite.colNbSiege, ,:tblEntite.colAppIns "
.head 7 -  Call SalTblPopulate( tblEntite, ghSqlMain, lsSelect, TBL_FillAll )
.head 4 +  Window Variables
.head 5 -  Number: wnPic
.head 5 -  Boolean: bDepot
.head 5 -  Boolean: bExist
.head 5 -  Number: lnColor
.head 5 -  Number: lnColor2
.head 5 -  Number: tnPourcent
.head 5 -  Number: tnBurDep
.head 5 -  Number: tnBurDepTot
.head 5 -  Number: tnPic
.head 5 -  Number: lnNbListe
.head 5 -  Number: lnNbListeApp
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call tfOnCreate()
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_SingleSelection, TRUE )
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_MovableCols, FALSE )
.head 5 +  On SAM_CreateComplete
.head 6 -  Call tblEntite.PalPopulateTbl(  )
.head 5 +  On SAM_FetchRowDone
.head 6 +  If tblEntite.colSituation = 'D'
.head 7 -  Set lnColor = COLOR_LightGreen
.head 7 -  Set lnColor2 = COLOR_DarkGreen
.head 6 +  Else If tblEntite.colSituation = 'L'
.head 7 -  Set lnColor = COLOR_Yellow
.head 7 -  Set lnColor2 = COLOR_DarkBlue
.head 6 +  Else If tblEntite.colSituation = 'P'
.head 7 -  Set lnColor = COLOR_Salmon
.head 7 -  Set lnColor2 = COLOR_DarkRed
.head 6 +  Else
.head 7 -  Set lnColor = COLOR_White
.head 7 -  Set lnColor2 = COLOR_White
.head 6 -  Call MTblSetCellBackColor( tblEntite.colIns , SalTblQueryContext( tblEntite), lnColor, 0  )
.head 6 -  Call MTblSetCellBackColor( tblEntite.colEntite , SalTblQueryContext( tblEntite), lnColor, 0  )
.head 6 -  Call MTblSetCellBackColor( tblEntite.colSituation , SalTblQueryContext( tblEntite), lnColor2, 0  )
.head 6 +  If lnColor2 != COLOR_White
.head 7 -  Call MTblSetCellTextColor( tblEntite.colSituation , SalTblQueryContext( tblEntite), COLOR_White, 0  )
.head 7 -  Call MTblSetCellFont( tblEntite.colSituation, SalTblQueryContext( tblEntite), MTBL_FONT_UNDEF_NAME, 8 , FONT_EnhBold , 0  )
.head 6 +  Else
.head 7 -  Call MTblSetCellTextColor( tblEntite.colSituation , SalTblQueryContext( tblEntite), COLOR_Black, 0  )
.head 6 -  !
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select Count(*) from Listes  where LIS_ENT_FK = :tblEntite.colId into :tblEntite.colNbListe ")
.head 6 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 6 -  Call SqlCommit( ghSqlSecondaire)
.head 6 -  !
.head 6 -  Call SqlExists( "Select * from Erreur_encours where err_ent_fk = :tblEntite.colId ", bExist)
.head 6 +  If bExist
.head 7 -  Set tnPic = MImgLoadFromResource( "resAttention", MIMG_TYPE_ICO , 0 )
.head 7 -  ! Call MTblSetCellImage( tblEntite.colAttention, SalTblQueryContext( tblEntite ),  tnPic, MTSI_REDRAW | MTSI_ALIGN_HCENTER | MTSI_ALIGN_VCENTER | MTSI_NOLEAD_LEFT | MTSI_NOLEAD_TOP )
.head 7 -  Call MTblSetCellImage( tblEntite.colEntite, SalTblQueryContext( tblEntite ),  tnPic, MTSI_REDRAW | MTSI_ALIGN_RIGHT | MTSI_ALIGN_VCENTER  )
.head 7 -  Set tblEntite.colAttention = '1'
.head 6 -  !
.head 6 +  If tblEntite.colAppIns != ''
.head 7 -  Set lnColor = COLOR_Maize
.head 7 -  Call MTblSetCellBackColor( tblEntite.colApp , SalTblQueryContext( tblEntite), lnColor, 0  )
.head 7 -  ! Vérification de l'apparentement
.head 7 -  Set lnNbListeApp = NUMBER_Null
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select count(LIS_INSBURAPP )  from listes where LIS_INSBUR  = :tblEntite.colIns and LIS_ELE_EXT = :cmbEl  and LIS_INSBURAPP is not null
	into :lnNbListeApp ")
.head 7 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  If lnNbListeApp != 0
.head 8 -  Set lnNbListeApp = 0
.head 8 -  Set lnNbListe = 0
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select count(*), count(LIS_INSBURAPP )  from listes where LIS_INSBUR  = :tblEntite.colIns and LIS_ELE_EXT = :cmbEl  
	into :lnNbListe, :lnNbListeApp ")
.head 8 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  If lnNbListe = 0
.head 9 -  Set tblEntite.colApp = '---'
.head 8 +  Else
.head 9 +  If lnNbListe = lnNbListeApp
.head 10 -  Set tblEntite.colApp = 'OK'
.head 9 +  Else
.head 10 -  Set tblEntite.colApp = 'Erreur'
.head 7 +  Else
.head 8 -  Set tblEntite.colApp = '!!'
.head 7 -  Call SqlCommit( ghSqlSecondaire)
.head 5 +  On SAM_DoubleClick
.head 6 +  If tblEntite.colAttention = '1'
.head 7 -  Call SalModalDialog( dlgMsgErreur , hWndForm, tblEntite.colEntite, tblEntite.colId )
.head 5 +  On SAM_Click
.head 6 -  Call tblListeEntite.PalPopulateListe(  )
.head 3 +  Child Table: tblListeEntite
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65300000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 10.333"
.head 6 -  Top: 1.917"
.head 6 -  Width:  5.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.143"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Default
.head 5 -  Discardable? Yes
.head 4 +  Contents
.head 5 +  Column: ColNo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: No
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.567"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: ColDepot
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Dépôt
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.633"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: ColSigle
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Sigle
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.4"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: ColEff
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Eff.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.633"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: ColSuppl
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Suppl
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.65"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: ColApp
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: App.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.633"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: PalPopulateListe
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: lsSelect
.head 7 -  String: lsNiv
.head 7 -  String: lsLettre
.head 7 -  String: lsElection
.head 6 +  Actions
.head 7 +  If tblEntite.colSituation = 'P' or tblEntite.colSituation = ''
.head 8 -  Call SalHideWindow( tblListeEntite.ColNo )
.head 8 -  Call SalShowWindow( tblListeEntite.ColDepot )
.head 7 +  Else
.head 8 -  Call SalShowWindow( tblListeEntite.ColNo )
.head 8 -  Call SalHideWindow( tblListeEntite.ColDepot )
.head 7 +  If tblEntite.colAppIns != ''
.head 8 -  Call SalShowWindow( tblListeEntite.ColApp )
.head 7 +  Else
.head 8 -  Call SalHideWindow( tblListeEntite.ColApp )
.head 7 -  Set lsSelect = "Select  LIS_NOORDREDEPOT,LIS_NO,LIS_SIGLE , LIS_NOGROUPE , LIS_NBEFF ,LIS_NBSUPPL
	from listes
	where LIS_ENT_FK  = :tblEntite.colId "
.head 7 -  Set lsSelect = lsSelect || "
	order by 2,1 
Into :tblListeEntite.ColDepot,:tblListeEntite.ColNo ,:tblListeEntite.ColSigle, :tblListeEntite.ColApp, :tblListeEntite.ColEff, :tblListeEntite.ColSuppl "
.head 7 -  Call SalTblPopulate( tblListeEntite, ghSqlMain, lsSelect, TBL_FillAll )
.head 4 -  Window Variables
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbVerifCandidature
.data INHERITPROPS
0000: 0100
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65300000
.enddata
.data CLASSPROPSSIZE
0000: 1700
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Vérification manuelle candidature
.head 4 -  Window Location and Size
.head 5 -  Left: 11.083"
.head 5 -  Top: 0.81"
.head 5 -  Width:  3.35"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.536"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalVerifEnsembleCandidature( )
.head 3 +  Pushbutton: pbCdtEU
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65300000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Edition des Cdts Européens
.head 4 -  Window Location and Size
.head 5 -  Left: 11.083"
.head 5 -  Top: 1.452"
.head 5 -  Width:  3.35"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalDtmCdtEU( )
.head 3 -  ! Tabs 1
.head 3 +  Child Table: tblGroupe
.data CLASSPROPSSIZE
0000: 1F00
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000C00 4E616D6531094E61 6D653400000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: CTable
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.333"
.head 6 -  Top: 0.881"
.head 6 -  Width:  4.55"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 5.071"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colNom
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Nom
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.217"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: TriSelect
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Tri
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.383"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: No
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.85"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colPhon
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCouleur
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: CColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: RGB
.head 6 -  Visible? Class Default
.head 6 -  Editable? Class Default
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Center
.head 6 -  Width:  1.117"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colColorBck
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: PalPopulateGroupe
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: lsElection
.head 6 +  Actions
.head 7 -  Call SalTblReset( tblListe )
.head 7 -  Call SalTblPopulate( tblGroupe, ghSqlMain, "select GRL_Nom, GRL_Id, GRL_Phon, Grl_Tri , Grl_Couleur
	from groupe_listes 
	where Grl_el = :cmbEl 
	order by 4,3
	Into :tblGroupe.colNom, :tblGroupe.colNo, :tblGroupe.colPhon , :tblGroupe.TriSelect, , :tblGroupe.colColorBck ", TBL_FillAll )
.head 5 +  Function: PalAddGrp
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bExist
.head 7 -  String: lsTmp
.head 7 -  String: lsPhon
.head 7 -  Number: lnTri
.head 6 +  Actions
.head 7 +  If dfSigleGrp != ''
.head 8 -  Call PalNextValueApplParm( "GRL_ID", lsTmp )
.head 8 -  Set lsPhon = PalTransPhonetique( dfSigleGrp )
.head 8 -  Call SqlPrepareAndExecute( ghSqlMaj, "Select Max(Grl_Tri) from Groupe_Listes where Grl_El = :cmbEl into :lnTri " )
.head 8 -  Call SqlFetchNext( ghSqlMaj, Btmp )
.head 8 +  If lnTri = NUMBER_Null 
.head 9 -  Set lnTri = 1
.head 8 +  Else
.head 9 -  Set lnTri = lnTri +1
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Insert into Groupe_Listes (Grl_Id, Grl_Nom, Grl_Phon, Grl_El, Grl_Tri) values (:lsTmp, :dfSigleGrp, :lsPhon , :cmbEl , :lnTri) " )
.head 9 -  Call SqlCommit( ghSqlMaj )
.head 9 -  Call SalClearField( dfSigleGrp )
.head 9 -  Call tblGroupe.PalPopulateGroupe(  )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "Rollback" )
.head 9 -  Call SalMessageBox( "Erreur de mise à jour", "ERREUR", MB_Ok )
.head 7 +  Else
.head 8 -  Call SalMessageBox( "Erreur dans l'encodage du groupe !!", "Attention", MB_Ok )
.head 5 +  Function: PalDeleteGrp
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bExist
.head 7 -  Number: lnTri
.head 6 +  Actions
.head 7 +  If SalTblAnyRows( tblGroupe, ROW_Selected, 0)
.head 8 +  If NOT SalTblAnyRows( tblListe, 0,0)
.head 9 +  If SalMessageBox( "Désirez-vous supprimer ce groupe ?", "Question", MB_YesNo ) = IDYES
.head 10 -  Set lnTri = tblGroupe.TriSelect
.head 10 +  If SqlPrepareAndExecute( ghSqlMaj, "Delete from Groupe_Listes where Grl_Id = :tblGroupe.colNo and Grl_El =:cmbEl " )
.head 11 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Groupe_Listes Set Grl_Tri = grl_Tri - 1 where Grl_Tri  > :lnTri and Grl_El =:cmbEl " )
.head 12 -  Call SqlCommit( ghSqlMaj )
.head 12 -  Call tblGroupe.PalPopulateGroupe(  )
.head 11 +  Else
.head 12 -  Call SqlPrepareAndExecute( ghSqlMaj, "Rollback" )
.head 12 -  Call SalMessageBox( "Erreur de mise à jour du tri", "ERREUR", MB_Ok )
.head 10 +  Else
.head 11 -  Call SqlPrepareAndExecute( ghSqlMaj, "Rollback" )
.head 11 -  Call SalMessageBox( "Erreur de mise à jour", "ERREUR", MB_Ok )
.head 8 +  Else
.head 9 -  Call SalMessageBox( "Ce groupe contient encore au moins une liste ...
Impossible de supprimer ce groupe !!", "Message", MB_Ok )
.head 7 +  Else
.head 8 -  Call SalMessageBox( "Veuillez sélectionner une liste !!", "Attention", MB_Ok )
.head 5 +  Function: PalChangeGroupe
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  Number: lnNewSection
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: lnI
.head 7 -  String: lsNewSection
.head 6 +  Actions
.head 7 +  If SalTblSetContext(tblGroupe ,lnNewSection)
.head 8 -  Set lsNewSection = tblGroupe.colNo
.head 8 -  Call SalTblClearSelection(tblGroupe)
.head 8 -  Set lnI =0
.head 8 +  While SalTblSetContext(tblListe ,lnI)
.head 9 +  If SalTblQueryRowFlags( tblListe, lnI, ROW_Selected )
.head 10 +  If SqlPrepareAndExecute(ghSqlMain,'Update Listes
	set LIS_GRL_FK = :lsNewSection
	where LIS_ID = :tblListe.colNo ')
.head 11 -  Call SqlPrepareAndExecute(ghSqlMain,'Commit')
.head 10 +  Else
.head 11 -  Call SqlPrepareAndExecute( ghSqlMaj, "Rollback" )
.head 11 -  Call SalMessageBox( "Erreur de mise à jour", "ERREUR", MB_Ok )
.head 9 -  Set lnI=lnI+1
.head 8 -  Call SalSendMsg( tblGroupe, SAM_Click , 0,0 )
.head 8 -  Call SalTblClearSelection(tblListe)
.head 8 -  Call SalTblSetRowFlags(tblGroupe,lnNewSection,ROW_Selected,TRUE)
.head 5 +  Function: PalUpdateColorGroupe
.head 6 -  Description:
.head 6 -  Returns
.head 6 +  Parameters
.head 7 -  Number: lnNewSection
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: lnI
.head 7 -  String: lsNewSection
.head 6 +  Actions
.head 7 +  If SalTblSetContext(tblGroupe ,lnNewSection)
.head 8 -  Set lsNewSection = tblGroupe.colNo
.head 8 +  If SqlPrepareAndExecute(ghSqlMain,'Update Groupe_Listes
	set GRL_Couleur = :tblGroupe.colColorBck
	where GRL_ID = :lsNewSection ')
.head 9 -  Call SqlPrepareAndExecute(ghSqlMain,'Commit')
.head 8 -  Call SalSendMsg( tblGroupe, SAM_Click , 0,0 )
.head 8 -  Call SalTblSetRowFlags(tblGroupe,lnNewSection,ROW_Selected,TRUE)
.head 5 +  Function: PalGetRow
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Number:
.head 6 +  Parameters
.head 7 -  Window Handle: lhTbl
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nCX
.head 7 -  Number: nCY
.head 7 -  Number: nCY2
.head 7 -  Number: nWX
.head 7 -  Number: nWY
.head 7 -  Number: nLigne
.head 7 -  Number: n1
.head 7 -  Number: nYLigne
.head 7 -  Number: n2
.head 7 -  Number: nY
.head 7 -  Number: nX
.head 7 -  Number: nYFen
.head 7 -  Number: nXFen
.head 7 -  Number: nW
.head 7 -  Number: nH
.head 6 +  Actions
.head 7 -  Call GetCursorPos(nCX,nCY)
.head 7 -  Call SalGetWindowLoc( dlgGenereFile, nXFen, nYFen )
.head 7 -  Call SalGetWindowLoc( lhTbl, nX, nY )
.head 7 -  Call SalGetWindowSize( lhTbl, nW, nH )
.head 7 -  Set nYLigne = nH / 25
.head 7 -  Set nCX = SalPixelsToFormUnits(lhTbl,nCX,FALSE)
.head 7 -  Set nCY = SalPixelsToFormUnits(lhTbl,nCY,TRUE)
.head 7 -  Call SalTblQueryVisibleRange(lhTbl,n1,n2)
.head 7 -  ! Set nLigne=SalNumberRound( (nCY-nY-nYFen) / nYLigne - (4.5+  (nH-nCY)/5 ) )
.head 7 -  Set nLigne=SalNumberRound( (nCY-nY-nYFen) / nYLigne - 1.8 + n1-1 )
.head 7 -  ! Set ml6 = "nYLigne : " || SalNumberToStrX( nYLigne ,0 ) || "
nCX : " || SalNumberToStrX( nCX ,0 ) || "
nCY : " || SalNumberToStrX( nCY ,0 ) || "
nH : " || SalNumberToStrX( nH ,0 ) || "
nXFen : " || SalNumberToStrX( nXFen ,0 ) || "
nYFen : " || SalNumberToStrX( nYFen ,0 ) || "
n1 : " || SalNumberToStrX( n1 ,0 ) || "
n2 : " || SalNumberToStrX( n2 ,0 ) || "
nLigne : " || SalNumberToStrX( nLigne ,0 )

.head 7 +  If nLigne < n1 or nLigne > n2
.head 8 -  Set nLigne = - 1
.head 7 -  Return nLigne
.head 5 +  Function: tfOnCreate
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: b
.head 7 -  String: s
.head 7 -  Number: nImg
.head 7 -  Window Handle: hWndaCols[*]
.head 6 +  Actions
.head 7 -  ! Subclass
.head 7 -  Call MTblSubClass( hWndForm )
.head 7 -  ! Mousewheel scrolling
.head 7 -  Call MTblEnableMWheelScroll( hWndForm, TRUE )
.head 7 -  Call MTblSetMWheelOption( hWndForm, MTMW_PAGE_KEY, VK_Control )
.head 7 -  ! Selection
.head 7 -  Call MTblSetSelectionColors( hWndForm, COLOR_White, COLOR_DarkRed )
.head 7 -  Call MTblSetFlags( hWndForm, MTBL_FLAG_FULL_OVERLAP_SELECTION | MTBL_FLAG_SOLID_ROWHDR, TRUE )
.head 7 -  !
.head 7 -  ! ! ! Define Button column
.head 7 -  Call MTblDefineButtonColumn( colCouleur, TRUE, -1, "RGB", 0, MTBL_BTN_SHARE_FONT )
.head 4 +  Window Variables
.head 5 -  Number: nColorBck
.head 5 -  Boolean: wbOk
.head 5 -  Number: nRed
.head 5 -  Number: nGreen
.head 5 -  Number: nBlue
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call tfOnCreate()
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_SingleSelection, TRUE )
.head 6 -  Call PalPopulateGroupe()
.head 5 +  On SAM_Click
.head 6 -  Call tblListe.PalPopulateListe(  )
.head 6 -  Call tblGrpOld.PalPopulateGrpOld(  )
.head 5 +  On SAM_DragDrop
.head 6 -  Call SalDragDropStop ( )
.head 6 +  If gsPhaseResult = '0'
.head 7 -  Set wnRowSection1 = SalTblQueryContext(tblGroupe)
.head 7 -  Set wsSection1 =  tblGroupe.colNom 
.head 7 +  If SalTblAnyRows( tblGroupe, ROW_Selected, 0)
.head 8 +  If tblGroupe.colNom != ''
.head 9 -  Call SalTblSetContext(tblGroupe,wnRowSection)
.head 9 -  Set wsSection2 = tblGroupe.colNom
.head 9 -  Call SalTblSetContext(tblGroupe,wnRowSection1)
.head 9 +  If SalMessageBox('Désirez-vous déplacer cette liste du groupe
       ' || wsSection1 || '
vers le groupe
       ' || wsSection2 || ' ?', 'Message de confirmation', MB_YesNo) = IDYES
.head 10 -  Set hWndSource = SalNumberToWindowHandle( wParam )
.head 10 +  If hWndSource != hWndItem
.head 11 -  Call tblGroupe.PalChangeGroupe( wnRowSection )
.head 9 +  Else
.head 10 -  Call SalTblClearSelection(tblGroupe)
.head 10 -  Call SalTblSetContext(tblGroupe,wnRowSection1)
.head 10 -  Call SalTblSetRowFlags(tblGroupe,wnRowSection1,ROW_Selected,TRUE)
.head 10 -  Call SalSendMsg( tblGroupe, SAM_Click , 0,0 )
.head 8 +  Else
.head 9 -  Call SalTblClearSelection(tblGroupe)
.head 9 -  Call SalTblSetContext(tblGroupe,wnRowSection1)
.head 9 -  Call SalTblSetRowFlags(tblGroupe,wnRowSection1,ROW_Selected,TRUE)
.head 9 -  Call SalSendMsg( tblGroupe, SAM_Click , 0,0 )
.head 7 +  Else
.head 8 -  Call SalTblClearSelection(tblGroupe)
.head 8 -  Call SalTblSetContext(tblGroupe,wnRowSection1)
.head 8 -  Call SalTblSetRowFlags(tblGroupe,wnRowSection1,ROW_Selected,TRUE)
.head 8 -  Call SalSendMsg( tblGroupe, SAM_Click , 0,0 )
.head 6 +  Else
.head 7 -  Call SalMessageBox('Plus aucun mouvement n\'est autorisé !!','ATTENTION',
MB_Ok)
.head 5 +  On SAM_DragMove
.head 6 +  If gsPhaseResult = '0' and wnValidGrp = 0
.head 7 -  Call SalTblClearSelection(tblGroupe)
.head 7 -  Set wnRowSection = PalGetRow(tblGroupe)
.head 7 -  Call SalTblSetRowFlags(tblGroupe,wnRowSection,ROW_Selected,TRUE)
.head 6 +  Else
.head 7 -  Call SalMessageBox('Plus aucun mouvement n\'est autorisé !!','ATTENTION',
MB_Ok)
.head 5 +  On MTM_BtnClick
.head 6 +  If TRUE
.head 7 -  Call SalSendClassMessage( MTM_BtnClick, wParam, lParam )
.head 7 -  Set nColorBck =  tblGroupe.colColorBck
.head 7 -  Call SalModalDialog( dlgChoixCouleur, hWndForm, tblGroupe.colNom,  nColorBck, wbOk )
.head 7 +  ! If wbOk
.head 8 -  Set tblGroupe.colColorBck = nColorBck
.head 8 +  If tblGroupe.colColorBck != NUMBER_Null
.head 9 -  Call MTblSetCellBackColor( tblGroupe.colCouleur, SalTblQueryContext( tblGroupe ), tblGroupe.colColorBck, MTSC_REDRAW )
.head 9 -  Call PalUpdateColorGroupe( SalTblQueryContext( tblGroupe ) )
.head 7 +  If wbOk
.head 8 -  Set tblGroupe.colColorBck = nColorBck
.head 8 +  If tblGroupe.colColorBck != NUMBER_Null
.head 9 -  Call MTblSetCellBackColor( tblGroupe.colCouleur, SalTblQueryContext( tblGroupe ), tblGroupe.colColorBck, MTSC_REDRAW )
.head 9 -  Call PalUpdateColorGroupe( SalTblQueryContext( tblGroupe ) )
.head 9 -  Call SalColorToRGB (  tblGroupe.colColorBck, nRed, nGreen, nBlue )
.head 9 -  Set tblGroupe.colCouleur = PalDecToHexa( nRed ) || PalDecToHexa( nGreen ) || PalDecToHexa( nBlue )
.head 6 +  Else
.head 7 -  Call SalMessageBox('Plus aucun changement n\'est autorisé !!','ATTENTION',
MB_Ok)
.head 5 +  On SAM_FetchRowDone
.head 6 +  If tblGroupe.colColorBck != NUMBER_Null and tblGroupe.colColorBck != 13421772
.head 7 -  Call MTblSetCellBackColor( tblGroupe.colCouleur, SalTblQueryContext( tblGroupe ), tblGroupe.colColorBck, MTSC_REDRAW )
.head 7 -  Call SalColorToRGB (  tblGroupe.colColorBck, nRed, nGreen, nBlue )
.head 7 -  Set tblGroupe.colCouleur = PalDecToHexa( nRed ) || PalDecToHexa( nGreen ) || PalDecToHexa( nBlue )
.head 6 +  Else
.head 7 -  Call MTblSetCellBackColor( tblGroupe.colCouleur, SalTblQueryContext( tblGroupe ), 13421772, MTSC_REDRAW )
.head 7 -  Set tblGroupe.colCouleur = 'Other'
.head 3 +  Pushbutton: pbUp
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65310000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsBasePbOnForm
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 3.667"
.head 5 -  Top: 6.036"
.head 5 -  Width:  0.5"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.333"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalMoveRowUp(tblGroupe, tblGroupe.TriSelect)
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet(hWndItem, resMoveUp ,  PIC_FormatBitmap )
.head 3 +  Pushbutton: pbDown
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65310000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsBasePbOnForm
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 3.667"
.head 5 -  Top: 6.429"
.head 5 -  Width:  0.5"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.333"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalMoveRowDown(tblGroupe,tblGroupe.TriSelect)
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet(hWndItem, resMoveDown ,  PIC_FormatBitmap )
.head 3 +  Child Table: tblListe
.data CLASSPROPSSIZE
0000: 1F00
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000C00 4E616D6531094E61 6D653400000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 4.933"
.head 6 -  Top: 0.881"
.head 6 -  Width:  4.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 5.071"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Default
.head 5 -  Discardable? Yes
.head 4 +  Contents
.head 5 +  Column: colNom
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Nom
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.75"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNoLis
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: No
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.733"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colINS
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: INS
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.8"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colElect
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Election
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.3"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: PalPopulateListe
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Call SalTblPopulate( tblListe, ghSqlMain, "select LIS_SIGLE, LIS_NO, LIS_InsBur, Lis_Ele_Ext, LIS_Id from Listes 
	Where Lis_GRL_Fk = :tblGroupe.colNo and Lis_ELE_Ext = :cmbEl
	order by 3,2,4", TBL_FillAll )
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_SingleSelection, TRUE )
.head 5 +  On SAM_DragCanAutoStart
.head 6 -  Return TRUE
.head 3 +  Data Field: dfSigleGrp
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6531000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 18
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.733"
.head 6 -  Top: 6.06"
.head 6 -  Width:  2.45"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbAddGrp
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6531000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 1.183"
.head 5 -  Top: 6.381"
.head 5 -  Width:  0.65"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.429"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call tblGroupe.PalAddGrp()
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resPlus , PIC_FormatBitmap )
.head 3 +  Pushbutton: pbDeleteGrp
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6531000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 1.983"
.head 5 -  Top: 6.381"
.head 5 -  Width:  0.65"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.429"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call tblGroupe.PalDeleteGrp()
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resDelete , PIC_FormatBitmap )
.head 3 +  Pushbutton: pbValidGrp
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6531000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Validation des groupes
.head 4 -  Window Location and Size
.head 5 -  Left: 9.2"
.head 5 -  Top: 5.0"
.head 5 -  Width:  2.233"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.94"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If gsPhaseResult = '0' and wnValidGrp = 0
.head 7 -  Call SalModalDialog(dlgPW, hWndForm, 'VALID', wbOkVide)
.head 7 +  If wbOkVide
.head 8 +  If SalMessageBox("Désirez-vous valider ces groupes et passer à la liaison avec les groupes de l'ancienne élection ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 9 -  Call VisWaitCursor( TRUE )
.head 9 -  Call PalSetApplParm( "VALID_GRP","1" ) 
.head 9 -  Set wnValidGrp = 1
.head 9 -  Call PalValidGroupe( 1 )
.head 9 -  Call VisWaitCursor( FALSE)
.head 6 +  Else
.head 7 -  Call SalMessageBox( "Ces groupes sont déjà validés  !!", "Message", MB_Ok )
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resAccepter , PIC_FormatIcon )
.head 6 +  If gsPhaseResult = '1' or wnValidGrp = 1
.head 7 -  Call SalDisableWindow( hWndItem )
.head 3 +  Pushbutton: pbImportGrpOld1
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6531000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Importation des Groupes en Historique
.head 4 -  Window Location and Size
.head 5 -  Left: 11.7"
.head 5 -  Top: 1.964"
.head 5 -  Width:  3.5"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If PalImportGrpOld( cmbEl )
.head 7 -  Call SalSendMsg( cmbEl, SAM_Click , 0,0 )
.head 7 -  Call SalMessageBox( "Anciens Groupes et Lieux  importés", "Message", MB_Ok )
.head 3 +  Child Table: tblGrpOld
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6534000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 9.083"
.head 6 -  Top: 0.881"
.head 6 -  Width:  4.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 5.071"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Default
.head 5 -  Discardable? Yes
.head 4 +  Contents
.head 5 +  Column: colSel
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: _
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.6"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Check Box
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value: 1
.head 8 -  Uncheck Value: 0
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 +  On SAM_AnyEdit
.head 8 +  If SalTblAnyRows( tblGroupe, ROW_Selected, 0 )
.head 9 -  Call tblGrpOld.PalAssocGrp()
.head 9 -  Call SalSendMsg( tblGrpOld , SAM_Click, 0,0 )
.head 5 +  Column: colNom
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Nom
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.467"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: No
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.85"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNo2
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: No
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.85"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: PalPopulateGrpOld
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: lsTmp
.head 6 +  Actions
.head 7 -  Call SalTblReset( tblGrpListeOld )
.head 7 -  ! Call SalTblPopulate( tblGrpOld, ghSqlMain, "select  A.GRP_NO, GRP_SIGLE, B.Grp_No, @upper( grp_sigle ) from 
	grp_old A, Grp_corresp B
	where  A.Grp_No =B.Grp_NoOLd (+) and B.Grp_no (+) = :tblGroupe.colNo and A.Grp_el =:cmbEl 
	order by 3 desc, 4
	Into :tblGrpOld.colNo,:tblGrpOld.colNom , :tblGrpOld.colNo2 , :lsTmp ", TBL_FillAll )
.head 7 -  ! Call SalTblPopulate( tblGrpOld, ghSqlMain, "select  A.GRP_NO, GRP_SIGLE, B.Grp_No, @upper( grp_sigle ) from 
	grp_old A, Grp_corresp B
	where  A.Grp_No =B.Grp_NoOLd (+)    and B.Grp_no(+) =:tblGroupe.colNo and A.Grp_el =:cmbEl and not exists( select GRP_NOOLD from grp_corresp C where C.Grp_no !=:tblGroupe.colNo and B.Grp_NO(+) = C.Grp_No)
	order by 3 desc, 4
	Into :tblGrpOld.colNo,:tblGrpOld.colNom , :tblGrpOld.colNo2 , :lsTmp ", TBL_FillAll )
.head 7 -  Call SalTblPopulate( tblGrpOld, ghSqlMain, "select  A.GRP_NO, GRP_SIGLE, B.Grp_No, @upper( grp_sigle ) 
	from grp_old A, Grp_corresp B
	where  A.Grp_No =B.Grp_NoOLd  and A.Grp_el =:cmbEl and B.Grp_no =:tblGroupe.colNo and  A.Grp_el  =  B.Grp_el 
UNION
	select  A.GRP_NO, GRP_SIGLE, -1 , @upper( grp_sigle ) 
	from grp_old A
	where  A.Grp_el = :cmbEl  and GRP_NO not in ( select GRP_NOOLD from grp_corresp C where C.Grp_El = :cmbEl )


order by 3 desc, 4
	Into :tblGrpOld.colNo,:tblGrpOld.colNom , :tblGrpOld.colNo2 , :lsTmp ", TBL_FillAll )
.head 7 +  If SalTblAnyRows( tblGrpOld, 0, 0 )
.head 8 -  Call SalTblSetContext( tblGrpOld, 0 )
.head 8 -  Call SalSendMsg( tblGrpOld, SAM_Click, 0,0 )
.head 5 +  Function: PalAssocGrp
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bExist
.head 7 -  String: lsTmp
.head 7 -  String: lsPhon
.head 6 +  Actions
.head 7 +  If tblGrpOld.colSel = TRUE
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Insert into Grp_Corresp (Grp_No, Grp_NoOLd,Grp_El) values (:tblGroupe.colNo, :tblGrpOld.colNo, :cmbEl ) " )
.head 9 -  Call SqlCommit( ghSqlMaj )
.head 9 -  Call tblGrpOld.PalPopulateGrpOld(  )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "Rollback" )
.head 9 -  Call SalMessageBox( "Erreur de mise à jour", "ERREUR", MB_Ok )
.head 7 +  Else
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Delete from Grp_Corresp where Grp_No = :tblGroupe.colNo And Grp_NoOLd = :tblGrpOld.colNo and Grp_el = :cmbEl " )
.head 9 -  Call SqlCommit( ghSqlMaj )
.head 9 -  Call tblGrpOld.PalPopulateGrpOld(  )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "Rollback" )
.head 9 -  Call SalMessageBox( "Erreur de mise à jour", "ERREUR", MB_Ok )
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_SingleSelection, TRUE )
.head 6 -  Call PalPopulateGrpOld()
.head 5 +  On SAM_FetchRowDone
.head 6 +  If colNo2 != NUMBER_Null and colNo2 != -1
.head 7 -  Set tblGrpOld.colSel = TRUE
.head 5 +  On SAM_Click
.head 6 -  Call tblGrpListeOld.PalPopulateListe(  )
.head 3 +  Child Table: tblGrpListeOld
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6534000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 13.067"
.head 6 -  Top: 0.893"
.head 6 -  Width:  2.367"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 5.071"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Default
.head 5 -  Discardable? Yes
.head 4 +  Contents
.head 5 +  Column: colINS
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: INS
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.8"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colElect
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: El.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.667"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: PalPopulateListe
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Call SalTblPopulate( tblGrpListeOld, ghSqlMain, "select LIEU_INS,LIEU_EL from Lieu_Old
	Where LIEU_GRPNO = :tblGrpOld.colNo and LIEU_EL = :cmbEl
	order by 1,2", TBL_FillAll )
.head 4 -  Window Variables
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_SingleSelection, TRUE )
.head 5 +  On SAM_DragCanAutoStart
.head 6 -  Return TRUE
.head 3 -  Background Text: Groupes de l'élection précédente
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65340000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 45905
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 9.133"
.head 5 -  Top: 0.69"
.head 5 -  Width:  4.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Pushbutton: pbEditGroupe
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6534000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsBasePbOnForm
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 13.333"
.head 5 -  Top: 6.524"
.head 5 -  Width:  0.75"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Dark Gray
.head 4 -  Button Appearance: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resReport, PIC_FormatIcon )
.head 5 +  On SAM_Click
.head 6 -  Call PalEditGroupes(  )
.head 3 +  Check Box: cbGroupeEntite
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6534000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Par Groupes / Entités
.head 4 -  Window Location and Size
.head 5 -  Left: 11.083"
.head 5 -  Top: 6.452"
.head 5 -  Width:  2.1"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Check Box: cbDocTravStesud
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65340000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Doc. travail STESUD
.head 4 -  Window Location and Size
.head 5 -  Left: 11.083"
.head 5 -  Top: 6.738"
.head 5 -  Width:  2.1"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Child Table: tblEditGroupe
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65340000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.4"
.head 6 -  Top: 8.036"
.head 6 -  Width:  9.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 1.119"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  View: Table
.head 5 -  Allow Row Sizing? No
.head 5 -  Lines Per Row: Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Default
.head 5 -  Discardable? No
.head 4 +  Contents
.head 5 +  Column: colIns
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.867"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEntite
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.217"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colElect
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.133"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colGrp
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.267"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colGrpOld
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  1.933"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colGrpTri
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  2.267"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 -  Functions
.head 4 -  Window Variables
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbExportGrp
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65310000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Exportation des Groupes
.head 4 -  Window Location and Size
.head 5 -  Left: 9.183"
.head 5 -  Top: 1.881"
.head 5 -  Width:  2.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.536"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalExportGrp( cmbEl )
.head 3 +  Pushbutton: pbImportGrpOld
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65340000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Importation des Groupes en Historique
.head 4 -  Window Location and Size
.head 5 -  Left: 9.383"
.head 5 -  Top: 6.06"
.head 5 -  Width:  3.5"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If PalImportGrpOld( cmbEl )
.head 7 -  Call SalSendMsg( cmbEl, SAM_Click , 0,0 )
.head 7 -  Call SalMessageBox( "Anciens Groupes et Lieux  importés", "Message", MB_Ok )
.head 3 -  ! Tabs 3
.head 3 +  Child Table: tblListeNoNat
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65330000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: CTable
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 1.983"
.head 6 -  Top: 0.381"
.head 6 -  Width:  8.35"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 4.071"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: 1
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colNo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: N°
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.767"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colSigle
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Sigle
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  3.3"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colLogo
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colPic
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Logo
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.833"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: PalPopulateLN
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 -  Local variables
.head 6 +  Actions
.head 7 -  Call SalTblPopulate( tblListeNoNat, ghSqlMain, "Select Lis_no, sigle, Logo from listes_nat order by 1 
	into :tblListeNoNat.colNo, :tblListeNoNat.colSigle , :tblListeNoNat.colLogo  ", TBL_FillAll )
.head 5 +  Function: PalAddLN
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bExist
.head 6 +  Actions
.head 7 +  If dfNoListeNat != NUMBER_Null and dfNoListeNat > 0 and dfSigleListeNat != ''
.head 8 -  Call SqlExists( "Select * from Listes_Nat where lis_No = :dfNoListeNat ", bExist )
.head 8 +  If NOT bExist
.head 9 +  If SqlPrepareAndExecute( ghSqlMaj, "Insert into Listes_Nat (lis_No, Sigle) values (:dfNoListeNat, :dfSigleListeNat ) " )
.head 10 -  Call SqlCommit( ghSqlMaj )
.head 10 -  Call SalClearField( dfNoListeNat )
.head 10 -  Call SalClearField( dfSigleListeNat )
.head 10 -  Call tblListeNoNat.PalPopulateLN(  )
.head 10 -  Call SalSetFocus( dfNoListeNat )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlMaj, "Rollback" )
.head 10 -  Call SalMessageBox( "Erreur de mise à jour", "ERREUR", MB_Ok )
.head 8 +  Else
.head 9 -  Call SalMessageBox( "Ce n° de liste existe déjà !!", "Attention", MB_Ok )
.head 7 +  Else
.head 8 -  Call SalMessageBox( "Erreur dans l'encodage du n° ou du sigle de la liste !!", "Attention", MB_Ok )
.head 5 +  Function: PalDeleteLN
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bExist
.head 6 +  Actions
.head 7 +  If SalTblAnyRows( tblListeNoNat, ROW_Selected, 0)
.head 8 +  If SalMessageBox( "Désirez-vous supprimer cette liste de la liste des n° nationaux ?", "Question", MB_YesNo ) = IDYES
.head 9 +  If tblListeNoNat.colLogo != ''
.head 10 -  Call PalSupprLogo( tblListeNoNat.colLogo )
.head 9 +  If SqlPrepareAndExecute( ghSqlMaj, "Delete from Listes_Nat where lis_No = :tblListeNoNat.colNo " )
.head 10 -  Call SqlCommit( ghSqlMaj )
.head 10 -  Call tblListeNoNat.PalPopulateLN(  )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlMaj, "Rollback" )
.head 10 -  Call SalMessageBox( "Erreur de mise à jour", "ERREUR", MB_Ok )
.head 7 +  Else
.head 8 -  Call SalMessageBox( "Veuillez sélectionner une liste !!", "Attention", MB_Ok )
.head 5 +  Function: PalCreateFileLN
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: bExist
.head 7 -  File Handle: lhFile
.head 7 -  File Handle: lhFilePic
.head 7 -  String: lsNo
.head 7 -  String: lsSigle
.head 7 -  String: lsLogo
.head 6 +  Actions
.head 7 +  If SalTblAnyRows( tblListeNoNat, 0, 0)
.head 8 +  If SalMessageBox( "Désirez-vous générer le fichier des n° de listes nationales ?", "Question", MB_YesNo ) = IDYES
.head 9 +  If SalFileOpen( lhFile, gsPathLoc1Down ||'\\NOLISTE.TXT', OF_Create | OF_ReadWrite | OF_Text )
.head 10 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Lis_No, Sigle, Logo from Listes_Nat order by lis_No into :lsNo, :lsSigle, :lsLogo " )
.head 10 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 11 -  Call SalFilePutStr( lhFile, SalStrRightX( '00'|| lsNo, 2) || lsSigle )
.head 11 +  If lsLogo != ''
.head 12 +  If SalFileOpen( lhFilePic, gsPathLogo || lsLogo, OF_Exist)
.head 13 -  Call VisFileCopy( gsPathLogo || lsLogo, gsPathLoc1Down ||'\\'|| lsLogo )
.head 10 -  Call SalFileClose( lhFile )
.head 10 -  Call SalMessageBox( "Le fichier des n° de listes nationales (NOLISTE.TXT) a été créé et copié 
(ainsi que les logos associés) dans le répertoire
"|| gsPathLoc1Down , "Message", MB_Ok )
.head 9 +  Else
.head 10 -  Call SalMessageBox( "Erreur de création du fichier
"|| gsPathLoc1Down ||'\\NOLISTE.TXT' , "Attention", MB_Ok )
.head 7 +  Else
.head 8 -  Call SalMessageBox( "Veuillez encoder au moins une liste !!", "Attention", MB_Ok )
.head 5 +  Function: tfOnCreate
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: b
.head 7 -  String: s
.head 7 -  Number: nImg
.head 7 -  Window Handle: hWndaCols[*]
.head 6 +  Actions
.head 7 -  ! Subclass
.head 7 -  Call MTblSubClass( hWndForm )
.head 7 -  ! Mousewheel scrolling
.head 7 -  Call MTblEnableMWheelScroll( hWndForm, TRUE )
.head 7 -  Call MTblSetMWheelOption( hWndForm, MTMW_PAGE_KEY, VK_Control )
.head 7 -  ! Selection
.head 7 -  Call MTblSetSelectionColors( hWndForm, COLOR_White, COLOR_DarkBlue )
.head 7 -  Call MTblSetFlags( hWndForm, MTBL_FLAG_FULL_OVERLAP_SELECTION, TRUE )
.head 7 -  !
.head 5 +  Function: PalSupprLogo
.head 6 -  Description:
.head 6 +  Returns
.head 7 -  Boolean:
.head 6 +  Parameters
.head 7 -  String: sLogo
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: sFile
.head 7 -  String: lsChamp
.head 7 -  String: sTrace
.head 6 +  Actions
.head 7 +  If VisFileDelete( gsPathLogo || sLogo ) = 1
.head 8 -  Return ( TRUE ) 
.head 7 +  Else
.head 8 -  Call SalMessageBox( "Erreur de suppression du logo
"|| gsPathLogo || sLogo , 'Erreur', MB_Ok )
.head 8 -  Return ( FALSE) 
.head 4 +  Window Variables
.head 5 -  Number: hPicLogo
.head 4 +  Message Actions
.head 5 +  On SAM_CreateComplete
.head 6 -  Call tblListeNoNat.PalPopulateLN(  )
.head 5 +  On SAM_Create
.head 6 -  Call tfOnCreate()
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_SingleSelection, TRUE )
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_MovableCols, FALSE )
.head 5 +  On SAM_Click
.head 6 +  If colLogo != ''
.head 7 +  If SalFileOpen( hFilePic, gsPathLogo || colLogo , OF_Exist )
.head 8 -  Call SalPicSet( pbLogoLN, resLogoSup, PIC_FormatIcon)
.head 7 +  Else
.head 8 -  Call SalPicSet( pbLogoLN, resLogo, PIC_FormatIcon)
.head 6 +  Else
.head 7 -  Call SalPicSet( pbLogoLN, resLogo, PIC_FormatIcon)
.head 5 +  On SAM_FetchRowDone
.head 6 +  If colLogo != ''
.head 7 -  Set hPicLogo = MImgLoadFromFile( gsPathLogo || tblListeNoNat.colLogo , MIMG_TYPE_BMP , 0 )
.head 7 -  Call MTblSetCellImage( tblListeNoNat.colPic, SalTblQueryContext( tblListeNoNat ) ,  hPicLogo, MTSI_REDRAW | MTSI_ALIGN_HCENTER | MTSI_ALIGN_VCENTER | MTSI_ALIGN_TILE )
.head 6 +  Else
.head 7 -  Set hPicLogo = 0
.head 7 -  Call MTblSetCellImage( tblListeNoNat.colPic, SalTblQueryContext( tblListeNoNat ) ,  hPicLogo, MTSI_REDRAW | MTSI_ALIGN_HCENTER | MTSI_ALIGN_VCENTER | MTSI_ALIGN_TILE )
.head 3 +  Data Field: dfNoListeNat
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65330000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 2.533"
.head 6 -  Top: 4.631"
.head 6 -  Width:  0.85"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.321"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: #0
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfSigleListeNat
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65330000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 3.433"
.head 6 -  Top: 4.631"
.head 6 -  Width:  5.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.321"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbAddLN
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65330000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 8.683"
.head 5 -  Top: 4.631"
.head 5 -  Width:  0.45"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call tblListeNoNat.PalAddLN()
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resPlus , PIC_FormatBitmap )
.head 3 +  Pushbutton: pbDeleteLN
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6533000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 10.7"
.head 5 -  Top: 2.214"
.head 5 -  Width:  0.633"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.417"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call tblListeNoNat.PalDeleteLN()
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resDelete , PIC_FormatBitmap )
.head 3 +  Pushbutton: pbLogoLN
.data INHERITPROPS
0000: 0100
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6533000000 00
.enddata
.data CLASSPROPSSIZE
0000: 1900
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsBasePbOnForm
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 10.683"
.head 5 -  Top: 1.548"
.head 5 -  Width:  0.65"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.429"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Button Appearance: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resLogo, PIC_FormatIcon)
.head 5 +  On SAM_Click
.head 6 +  If SalTblAnyRows( tblListeNoNat, ROW_Selected, 0 )
.head 7 +  If tblListeNoNat.colLogo = ''
.head 8 -  Set wsTmp = ""
.head 8 -  Call SalModalDialog( dlgImportLogo, hWndForm,SalNumberToStrX( tblListeNoNat.colNo,0) , wsTmp )
.head 8 +  If wsTmp != '' and SalFileOpen( hFilePic, gsPathLogo || wsTmp , OF_Exist )
.head 9 -  Call SalPicSet( hWndItem, resLogoSup, PIC_FormatIcon)
.head 9 -  Call SqlPrepareAndExecute( ghSqlMain, "Update listes_nat set Logo = :wsTmp where Lis_no = :tblListeNoNat.colNo " )
.head 8 +  Else
.head 9 -  Call SalPicSet( hWndItem, resLogo, PIC_FormatIcon)
.head 9 -  Call SqlPrepareAndExecute( ghSqlMain, "Update listes_nat set Logo = '' where Lis_no = :tblListeNoNat.colNo " )
.head 7 +  Else
.head 8 -  Set wsTmp = tblListeNoNat.colLogo
.head 8 +  If SalMessageBox( "Désirez-vous supprimer ce logo ?", "Question", MB_OkCancel | MB_DefButton2  ) = IDOK
.head 9 +  If tblListeNoNat.PalSupprLogo( tblListeNoNat.colLogo  )
.head 10 -  Call SalPicSet( hWndItem, resLogo, PIC_FormatIcon)
.head 10 -  Call SqlPrepareAndExecute( ghSqlMain, "Update listes_nat set Logo = '' where Lis_no = :tblListeNoNat.colNo " )
.head 10 -  Set wsTmp = ""
.head 7 -  Set tblListeNoNat.colLogo = wsTmp
.head 7 -  Call SalSendMsg( tblListeNoNat, SAM_FetchRowDone, 0,0 )
.head 7 -  Call SqlCommit( ghSqlMain )
.head 3 +  Pushbutton: pbFileListeNat
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65330000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Générer le fichier
.head 4 -  Window Location and Size
.head 5 -  Left: 5.283"
.head 5 -  Top: 5.06"
.head 5 -  Width:  1.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.536"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call tblListeNoNat.PalCreateFileLN()
.head 3 -  ! Tabs 4
.head 3 +  Child Table: tblEntite_E5
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6535000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: CTable
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.467"
.head 6 -  Top: 0.81"
.head 6 -  Width:  10.017"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 6.179"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: 1
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colIns
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: INS
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.683"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEl
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: EL
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.383"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEntite
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Entité
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  5.467"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNbRecus
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Bull. reçus
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 +  On SAM_Validate
.head 8 +  If tblEntite_E5.colNbRecus = NUMBER_Null or tblEntite_E5.colNbRecus < 0
.head 9 -  Set tblEntite_E5.colNbRecus = 0
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Bulletins_BEtr set BETR_Recus = :tblEntite_E5.colNbRecus
	where BETR_ins = :tblEntite_E5.colIns and BETR_El = :tblEntite_E5.colEl " )
.head 9 -  Call SqlCommit( ghSqlMain )
.head 7 +  On SAM_SetFocus
.head 8 -  Call MTblGetCellBackColor( hWndItem, SalTblQueryContext( tblEntite_E5 ), lnColor )
.head 8 +  If lnColor != COLOR_Maize 
.head 9 -  Call SalTblSetFocusRow(  tblEntite_E5, SalTblQueryContext( tblEntite_E5 ) )
.head 9 -  Call SalTblSetRowFlags( tblEntite_E5, SalTblQueryContext( tblEntite_E5 ), ROW_Selected, TRUE )
.head 5 +  Column: colNbEncode
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Encode
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 +  On SAM_Validate
.head 8 +  If tblEntite_E5.colNbRecus = NUMBER_Null or tblEntite_E5.colNbRecus < 0
.head 9 -  Set tblEntite_E5.colNbRecus = 0
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Bulletins_BEtr set BETR_Recus = :tblEntite_E5.colNbRecus
	where BETR_ins = :tblEntite_E5.colIns and BETR_El = :tblEntite_E5.colEl " )
.head 9 -  Call SqlCommit( ghSqlMain )
.head 4 +  Functions
.head 5 +  Function: tfOnCreate
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: b
.head 7 -  String: s
.head 7 -  Number: nImg
.head 7 -  Window Handle: hWndaCols[*]
.head 6 +  Actions
.head 7 -  ! Subclass
.head 7 -  Call MTblSubClass( hWndForm )
.head 7 -  ! Mousewheel scrolling
.head 7 -  Call MTblEnableMWheelScroll( hWndForm, TRUE )
.head 7 -  Call MTblSetMWheelOption( hWndForm, MTMW_PAGE_KEY, VK_Control )
.head 7 -  ! Selection
.head 7 -  Call MTblSetSelectionColors( hWndForm, COLOR_White, COLOR_DarkBlue )
.head 7 -  Call MTblSetFlags( hWndForm, MTBL_FLAG_FULL_OVERLAP_SELECTION, TRUE )
.head 7 -  !
.head 5 +  Function: PalPopulateTbl
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: lsSelect
.head 7 -  String: lsNiv
.head 7 -  String: lsLettre
.head 6 +  Actions
.head 7 -  Set lsSelect = "Select BETR_ins, BETR_EL, ENT_NOM_FF, BETR_Recus, BETR_Encode
	from Bulletins_BEtr, entite
	where ent_ins =BEtr_ins and ENT_NIV_LETTRE = 'K' and ENT_ELE_EXT = BETR_EL   "
.head 7 +  If cmbEl != ''
.head 8 -  Set lsSelect = lsSelect || " AND ENT_ELE_EXT = :cmbEl  "
.head 7 -  Set lsSelect = lsSelect || "
Order by 1,3
Into :tblEntite_E5.colIns,:tblEntite_E5.colEl ,:tblEntite_E5.colEntite , :tblEntite_E5.colNbRecus , :tblEntite_E5.colNbEncode "
.head 7 -  Call SalTblPopulate( tblEntite_E5, ghSqlMain, lsSelect, TBL_FillAll )
.head 5 +  Function: wfDoExcel
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: lnRet
.head 7 -  String: lsText
.head 6 +  Actions
.head 7 -  Call VisWaitCursor( TRUE )
.head 7 -  Call wfSaveSettings(  )
.head 7 -  ! Set lnRet = MTblExportToExcel( frmTiers.ctblTiers, frmTiers.ExcExp.Language, frmTiers.ExcExp.ExcStartCell, frmTiers.ExcExp.ExcFlags, frmTiers.ExcExp.ExpFlags, frmTiers.ExcExp.RowFlagsOn,
	frmTiers.ExcExp.RowFlagsOff, frmTiers.ExcExp.ColFlagsOn,frmTiers.ExcExp.ColFlagsOff )
.head 7 -  Set lnRet = MTblExportToExcel( dlgGenereFile.tblEntite_E5, 1, "", dlgGenereFile.ExcExp.ExcFlags, dlgGenereFile.ExcExp.ExpFlags, dlgGenereFile.ExcExp.RowFlagsOn,
	dlgGenereFile.ExcExp.RowFlagsOff, dlgGenereFile.ExcExp.ColFlagsOn,dlgGenereFile.ExcExp.ColFlagsOff )
.head 7 -  Call VisWaitCursor( FALSE )
.head 7 +  If lnRet < 1
.head 8 +  Select Case lnRet
.head 9 +  Case MTE_ERR_CANCELLED
.head 10 -  Set lsText = "Export cancelled."
.head 10 -  Break
.head 9 +  Case MTE_ERR_RUNNING_INSTANCE
.head 10 -  Set lsText = "Error getting running instance"
.head 10 -  Break
.head 9 +  Case MTE_ERR_NEW_INSTANCE
.head 10 -  Set lsText = "Error creating new instance"
.head 10 -  Break
.head 9 +  Case MTE_ERR_OLE_EXCEPTION
.head 10 -  Set lsText = "An OLE exception has occured"
.head 10 -  Break
.head 9 +  Case MTE_ERR_EXCEPTION
.head 10 -  Set lsText = "An exception has occured"
.head 10 -  Break
.head 9 +  Case MTE_ERR_NOT_SUBCLASSED
.head 10 -  Set lsText = "Table isn't subclassed"
.head 10 -  Break
.head 9 +  Default
.head 10 -  Set lsText = "Export failed."
.head 10 -  Break
.head 8 -  Call SalMessageBox( lsText, "Export error", MB_IconHand | MB_Ok )
.head 5 +  Function: wfSaveSettings
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  FunctionalVar: ExcExp
.head 8 -  Class: fcExcExp
.head 6 +  Actions
.head 7 -  ! Language
.head 7 -  Set ExcExp.Language = 1
.head 7 -  ! Excel start cell
.head 7 -  Set ExcExp.ExcStartCell = "0"
.head 7 -  ! Excel flags
.head 7 -  Set ExcExp.ExcFlags = ExcExp.ExcFlags | MTE_EXCEL_NEW_WORKSHEET
.head 7 -  ! Set ExcExp.ExcFlags = ExcExp.ExcFlags | MTE_EXCEL_STRING_COLS_AS_TEXT
.head 7 -  ! Export flags
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_COL_HEADERS
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_COLORS
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_FONTS
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_GRID
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_SHOW_STATUS
.head 7 -  ! Rows to export
.head 7 -  Set ExcExp.RowFlagsOff = ROW_Hidden
.head 7 -  ! Columns to export
.head 7 -  Set ExcExp.ColFlagsOn = COL_Visible
.head 7 -  ! Assign
.head 7 -  Call dlgGenereFile.ExcExp.Assign( ExcExp )
.head 4 +  Window Variables
.head 5 -  Number: wnPic
.head 5 -  Boolean: bDepot
.head 5 -  Boolean: bExist
.head 5 -  Number: lnColor
.head 5 -  Number: lnColor2
.head 5 -  Number: tnPourcent
.head 5 -  Number: tnBurDep
.head 5 -  Number: tnBurDepTot
.head 5 -  Number: tnPic
.head 5 -  FunctionalVar: ExcExp
.head 6 -  Class: fcExcExp
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call tfOnCreate()
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_SingleSelection, TRUE )
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_MovableCols, FALSE )
.head 5 +  On SAM_CreateComplete
.head 6 -  Call tblEntite_E5.PalPopulateTbl(  )
.head 5 +  On SAM_FetchRowDone
.head 6 +  If colNbEncode = 1
.head 7 +  If tblEntite_E5.colEl = 'CK' and tblEntite_E5.colIns = '21004' 
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Update Bulletins_BEtr set BETR_Recus=NULL, BETR_Encode = 0 where BETR_EL = 'CK' and BEtr_ins= '21004'  ") 
.head 8 -  Call SqlCommit( ghSqlSecondaire )
.head 7 +  Else
.head 8 -  Call MTblSetCellBackColor( tblEntite_E5.colNbRecus , SalTblQueryContext( tblEntite_E5), COLOR_Maize , 0  )
.head 5 -  On SAM_DoubleClick
.head 3 -  !
.head 3 +  Pushbutton: pbClose
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Fermer
.head 4 -  Window Location and Size
.head 5 -  Left: 14.233"
.head 5 -  Top: 6.238"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.798"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalSendMsg( hWndForm, SAM_Close, 0,0)
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resExitWin , PIC_FormatBitmap )
.head 3 +  Data Field: dfLibelle
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 1.033"
.head 6 -  Top: 2.31"
.head 6 -  Width:  8.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.393"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 14
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Blue
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Group Box: Initialisation
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 45904
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.533"
.head 5 -  Top: 1.024"
.head 5 -  Width:  14.75"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 1.429"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Group Box: Désignation des élus
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 45903
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.533"
.head 5 -  Top: 4.595"
.head 5 -  Width:  11.35"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 1.679"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Group Box: Validation et mise à disposition des données Format F Définitif + PV
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 35420
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.533"
.head 5 -  Top: 2.631"
.head 5 -  Width:  11.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 1.857"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Background Text: Election:
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 59478
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.4"
.head 5 -  Top: 0.452"
.head 5 -  Width:  0.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  ! Combo Box: cmbEl_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left: 1.85"
.head 5 -  Top: 0.607"
.head 5 -  Width:  1.05"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 2.595"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  String Type: String
.head 4 -  Maximum Data Length: Default
.head 4 -  Sorted? No
.head 4 -  Always Show List? No
.head 4 -  Vertical Scroll? Yes
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Input Mask: Unformatted
.end
.head 4 -  List Initialization 
.head 4 +  Message Actions 
.head 5 +  On SAM_Create
.head 6 -  Call PalPopulateCmbEl( cmbEl_Siege )
.head 6 -  Call SalSendMsg( cmbEl_Siege, SAM_Click, 0,0)
.head 5 +  On SAM_Click
.head 6 -  ! Charge gsPhaseResult - wnValidGrp
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ele_Loc2_Result , Ele_Loc2_ValidGrp 
	from election
	Where Ele_lettre = :cmbEl 
	Into :gsPhaseResult, :wnValidGrp ")
.head 6 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  !
.head 6 +  If gsPhaseResult = '1' 
.head 7 -  Set wsDiffuseElus = ''
.head 7 -  Call PalGetApplParm( "ELU_DIFFUSE", wsDiffuseElus )
.head 7 +  If wsDiffuseElus = ''
.head 8 -  Call SqlPrepareAndExecute( ghSqlSecondaire, 
"Insert into appl_parm ( NAME, LABEL_NL, LABEL_FR, DESC_NL, DESC_FR, VALUE, VALUE_DATATYPE, USER_YN, SYSMAN_YN, ORDER)
	values( 'ELU_DIFFUSE','Dffusion des élus','Diffusion', '', '', '0', 'N', 'N','Y',7) " )
.head 8 -  Call SqlCommit( ghSqlSecondaire)
.head 8 -  Call PalGetApplParm( "ELU_DIFFUSE", wsDiffuseElus )
.head 7 +  If wsDiffuseElus = '1'
.head 8 -  Call SalDisableWindow( pbDiffusionSiege )
.head 8 -  Call SalColorSet( pbDiffusionSiege, COLOR_IndexWindow, COLOR_DarkGreen )
.head 7 +  Else 
.head 8 -  Call SalColorSet( pbDiffusionSiege, COLOR_IndexWindow, COLOR_Salmon )
.head 8 -  Call SalEnableWindow( pbDiffusionSiege )
.head 7 -  Call PalDtmBureauDep( )
.head 6 +  Else 
.head 7 -  Call SalClearField( dfBurDep_Siege )
.head 7 -  Call SalClearField( dfBurTot_Siege )
.head 7 -  Call SalClearField( dfSitDep_Siege )
.head 7 -  Call SalColorSet( pbDiffusionSiege, COLOR_IndexWindow, COLOR_Gray )
.head 7 -  Call SalDisableWindow( pbDiffusionSiege )
.head 3 -  ! Background Text: Situation dépouillement:
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 3.083"
.head 5 -  Top: 5.44"
.head 5 -  Width:  2.05"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.end
.head 3 +  ! Data Field: dfSitDep_Siege
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 5.383"
.head 6 -  Top: 5.381"
.head 6 -  Width:  1.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Percentage
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.end
.head 4 -  Message Actions 
.head 3 +  ! Data Field: dfBurDep_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 3.333"
.head 6 -  Top: 5.702"
.head 6 -  Width:  1.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: #0
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.end
.head 4 -  Message Actions 
.head 3 +  ! Data Field: dfBurTot_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 4.683"
.head 6 -  Top: 5.702"
.head 6 -  Width:  1.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: #0
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.end
.head 4 -  Message Actions 
.head 3 -  ! Background Text: /
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 4.433"
.head 5 -  Top: 5.655"
.head 5 -  Width:  0.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.333"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: 14
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.end
.head 3 -  Background Text: Bureaux dépouillés:
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 55286
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 4.383"
.head 5 -  Top: 5.298"
.head 5 -  Width:  2.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Blue
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfSitDep_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 5.183"
.head 6 -  Top: 5.56"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Percentage
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfBurDep_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 4.383"
.head 6 -  Top: 5.845"
.head 6 -  Width:  1.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: #0
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfBurTot_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 5.883"
.head 6 -  Top: 5.845"
.head 6 -  Width:  1.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: #0
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: /
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 55287
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 5.583"
.head 5 -  Top: 5.798"
.head 5 -  Width:  0.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.333"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: 14
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Background Text: Cantons complets:
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 55288
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 1.383"
.head 5 -  Top: 5.298"
.head 5 -  Width:  2.017"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Blue
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfSitK_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 1.933"
.head 6 -  Top: 5.524"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Percentage
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfCantComplet_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 1.083"
.head 6 -  Top: 5.81"
.head 6 -  Width:  1.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: #0
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfCantonTot_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 2.583"
.head 6 -  Top: 5.81"
.head 6 -  Width:  1.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: #0
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: /
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 55284
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 2.283"
.head 5 -  Top: 5.798"
.head 5 -  Width:  0.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.333"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: 14
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Frame
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 55285
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.783"
.head 5 -  Top: 5.202"
.head 5 -  Width:  3.15"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 1.0"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Charcoal
.head 4 -  Background Color: Default
.head 3 -  Background Text: Sièges calculés:
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 55280
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 7.783"
.head 5 -  Top: 5.298"
.head 5 -  Width:  2.017"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Blue
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfSitS_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 8.383"
.head 6 -  Top: 5.524"
.head 6 -  Width:  1.0"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Percentage
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfDistribue_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 7.483"
.head 6 -  Top: 5.845"
.head 6 -  Width:  1.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: #0
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Data Field: dfTot_Siege
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: Number
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 9.033"
.head 6 -  Top: 5.845"
.head 6 -  Width:  1.1"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: #0
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 -  Background Text: /
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 55283
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 8.683"
.head 5 -  Top: 5.833"
.head 5 -  Width:  0.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.333"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Center
.head 4 -  Font Name: Default
.head 4 -  Font Size: 14
.head 4 -  Font Enhancement: Bold
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 -  Frame
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 55282
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 7.283"
.head 5 -  Top: 5.202"
.head 5 -  Width:  3.05"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 1.036"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Charcoal
.head 4 -  Background Color: Default
.head 3 -  Frame
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 55281
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 3.983"
.head 5 -  Top: 5.202"
.head 5 -  Width:  3.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 1.0"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Corners: Square
.head 4 -  Border Style: Etched
.head 4 -  Border Thickness: 1
.head 4 -  Border Color: Charcoal
.head 4 -  Background Color: Default
.head 3 +  Pushbutton: pbDiffusionSiege
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Diffusion des Sièges - Elus
.head 4 -  Window Location and Size
.head 5 -  Left: 2.533"
.head 5 -  Top: 4.81"
.head 5 -  Width:  3.0"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Gray
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If gsPhaseResult = '1'
.head 7 -  Call SalModalDialog(dlgPW, hWndForm, 'VALID', wbOkVide)
.head 7 +  If wbOkVide
.head 8 +  If SalMessageBox("Désirez-vous commencer à diffuser les sièges et les élus ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 9 -  Call VisWaitCursor( TRUE )
.head 9 -  Call PalSetApplParm( "ELU_DIFFUSE", "1" )
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update Election set  ele_Loc2_EluDiffuse = 1
	where ELE_LETTRE = :cmbEl " )
.head 9 -  Call SqlCommit( ghSqlMaj )
.head 9 -  Call SalSendMsg( cmbEl, SAM_Click, 0,0)
.head 9 -  Call VisWaitCursor( FALSE)
.head 7 +  Else
.head 8 -  Call SalMessageBox("Erreur de mot de passe", "Ereur", MB_Ok | MB_IconHand ) 
.head 7 -  Call SalSendMsg( cmbEl,SAM_Click, 0,0)
.head 3 +  Check Box: cbResultWeb5
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Envoi direct des résultats sur WEB5
.head 4 -  Window Location and Size
.head 5 -  Left: 8.133"
.head 5 -  Top: 4.131"
.head 5 -  Width:  3.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 +  If gsPhaseResult = '1'
.head 7 -  Call SalEnableWindow( hWndItem )
.head 7 -  Call PalGetApplParm( "RESULT_WEB5", wsTmp  )
.head 7 -  Set MyValue = SalStrToNumber( wsTmp )
.head 6 +  Else
.head 7 -  Call SalDisableWindow( hWndItem )
.head 5 +  On SAM_Click
.head 6 +  If cbResultWeb5
.head 7 -  Call PalSetApplParm( "RESULT_WEB5", "1" )
.head 6 +  Else
.head 7 -  Call PalSetApplParm( "RESULT_WEB5", "0" )
.head 3 -  ! Tabs 5
.head 3 +  Child Table: tblEntite_BVD
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6536000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: CTable
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.433"
.head 6 -  Top: 0.774"
.head 6 -  Width:  13.75"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 6.25"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: 1
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colIns
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: INS
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.683"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEl
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: EL
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.383"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEntite
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Entité
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  4.417"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colTypeVote
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Type
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.583"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNbBDep
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Bur. Dép.
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.833"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 +  On SAM_Validate
.head 8 +  If tblEntite_BVD.colNbBDep = NUMBER_Null or tblEntite_BVD.colNbBDep < 0
.head 9 -  Set tblEntite_BVD.colNbBDep = 1
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Coord_Bureau set CB_NBBURDEP= :tblEntite_BVD.colNbBDep
	where CB_ins = :tblEntite_BVD.colIns and CB_TYPEBUR = 'K' and CB_ELECT =:cmbEl " )
.head 9 +  If tblEntite_BVD.colTypeVote = ''
.head 10 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Entite set ENT_BURDEP_TOT = :tblEntite_BVD.colNbBDep
	where ent_ins = :tblEntite_BVD.colIns and ent_niv_lettre = 'K'  and ENT_ELE_EXT =:cmbEl " )
.head 11 -  Call SqlCommit( ghSqlMain )
.head 10 +  Else
.head 11 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK")
.head 11 -  Call SalMessageBox( "Erreur dans la mise à jour", "ERREUR", MB_Ok )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK")
.head 9 -  Call SalMessageBox( "Erreur dans la mise à jour", "ERREUR", MB_Ok )
.head 7 +  On SAM_SetFocus
.head 8 +  If tblEntite_BVD.colTypeVote != ''
.head 9 -  ! Call SalSetFocus( tblEntite_BVD.colNbBVote )
.head 9 -  Call SalTblSetFocusCell( tblEntite_BVD, SalTblQueryContext( tblEntite_BVD ), colNbBVote, 0, -1 )
.head 5 +  Column: colNbBVote
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Bur. Vote
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.933"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 +  On SAM_Validate
.head 8 +  If tblEntite_BVD.colNbBVote = NUMBER_Null or tblEntite_BVD.colNbBVote < 0
.head 9 -  Set tblEntite_BVD.colNbBVote = 1
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Coord_Bureau set CB_NBBV= :tblEntite_BVD.colNbBVote
	where CB_ins = :tblEntite_BVD.colIns and CB_TYPEBUR = 'K'  and CB_ELECT =:cmbEl " )
.head 9 +  If tblEntite_BVD.colTypeVote != ''
.head 10 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Entite set ENT_BURDEP_TOT = :tblEntite_BVD.colNbBVote
	where ent_ins = :tblEntite_BVD.colIns and ent_niv_lettre = 'K' and ENT_ELE_EXT =:cmbEl  " )
.head 11 -  Call SqlCommit( ghSqlMain )
.head 10 +  Else
.head 11 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK")
.head 11 -  Call SalMessageBox( "Erreur dans la mise à jour", "ERREUR", MB_Ok )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK")
.head 9 -  Call SalMessageBox( "Erreur dans la mise à jour", "ERREUR", MB_Ok )
.head 5 +  Column: colNbInscritBB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Inscrits BB
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  1.3"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 +  On SAM_Validate
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Entite set ENT_INSCRITS_BB = :tblEntite_BVD.colNbInscritBB
	where ent_ins = :tblEntite_BVD.colIns and ent_niv_lettre = 'K' and ENT_ELE_EXT =:cmbEl  " )
.head 9 -  Call SqlCommit( ghSqlMain )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK")
.head 9 -  Call SalMessageBox( "Erreur dans la mise à jour", "ERREUR", MB_Ok )
.head 7 +  On SAM_SetFocus
.head 8 -  Call MTblGetCellBackColor( hWndItem, SalTblQueryContext( tblEntite_BVD ), lnColor )
.head 8 +  If lnColor != COLOR_Maize 
.head 9 -  Call SalTblSetFocusRow(  tblEntite_BVD, SalTblQueryContext( tblEntite_BVD ) )
.head 9 -  Call SalTblSetRowFlags( tblEntite_BVD, SalTblQueryContext( tblEntite_BVD ), ROW_Selected, TRUE )
.head 5 +  Column: colNbInscritE1E2
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Inscrits E1E2
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 +  On SAM_Validate
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Entite set ENT_INSCRITS_E1_E2 = :tblEntite_BVD.colNbInscritE1E2
	where ent_ins = :tblEntite_BVD.colIns and ent_niv_lettre = 'K' and ENT_ELE_EXT =:cmbEl   " )
.head 9 -  Call SqlCommit( ghSqlMain )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK")
.head 9 -  Call SalMessageBox( "Erreur dans la mise à jour", "ERREUR", MB_Ok )
.head 7 +  On SAM_SetFocus
.head 8 -  Call MTblGetCellBackColor( hWndItem, SalTblQueryContext( tblEntite_BVD ), lnColor )
.head 8 +  If lnColor != COLOR_Maize 
.head 9 -  Call SalTblSetFocusRow(  tblEntite_BVD, SalTblQueryContext( tblEntite_BVD ) )
.head 9 -  Call SalTblSetRowFlags( tblEntite_BVD, SalTblQueryContext( tblEntite_BVD ), ROW_Selected, TRUE )
.head 5 +  Column: colNbInscritE3E4
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Inscrits E3E4
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 +  On SAM_Validate
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Entite set ENT_INSCRITS_E3_E4= :tblEntite_BVD.colNbInscritE3E4
	where ent_ins = :tblEntite_BVD.colIns and ent_niv_lettre = 'K' and ENT_ELE_EXT =:cmbEl  " )
.head 9 -  Call SqlCommit( ghSqlMain )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK")
.head 9 -  Call SalMessageBox( "Erreur dans la mise à jour", "ERREUR", MB_Ok )
.head 7 +  On SAM_SetFocus
.head 8 -  Call MTblGetCellBackColor( hWndItem, SalTblQueryContext( tblEntite_BVD ), lnColor )
.head 8 +  If lnColor != COLOR_Maize 
.head 9 -  Call SalTblSetFocusRow(  tblEntite_BVD, SalTblQueryContext( tblEntite_BVD ) )
.head 9 -  Call SalTblSetRowFlags( tblEntite_BVD, SalTblQueryContext( tblEntite_BVD ), ROW_Selected, TRUE )
.head 5 +  Column: colNbInscritE5
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Inscrits E5
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  1.167"
.head 6 -  Width Editable? Yes
.head 6 -  Format: #0
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 +  Message Actions
.head 7 +  On SAM_Validate
.head 8 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Entite set ENT_INSCRITS_E5= :tblEntite_BVD.colNbInscritE5
	where ent_ins = :tblEntite_BVD.colIns and ent_niv_lettre = 'K' and ENT_ELE_EXT =:cmbEl " )
.head 9 -  Call SqlCommit( ghSqlMain )
.head 8 +  Else
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK")
.head 9 -  Call SalMessageBox( "Erreur dans la mise à jour", "ERREUR", MB_Ok )
.head 7 +  On SAM_SetFocus
.head 8 -  Call MTblGetCellBackColor( hWndItem, SalTblQueryContext( tblEntite_BVD ), lnColor )
.head 8 +  If lnColor != COLOR_Maize 
.head 9 -  Call SalTblSetFocusRow(  tblEntite_BVD, SalTblQueryContext( tblEntite_BVD ) )
.head 9 -  Call SalTblSetRowFlags( tblEntite_BVD, SalTblQueryContext( tblEntite_BVD ), ROW_Selected, TRUE )
.head 5 +  Column: colId
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: INS
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.683"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: tfOnCreate
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: b
.head 7 -  String: s
.head 7 -  Number: nImg
.head 7 -  Window Handle: hWndaCols[*]
.head 6 +  Actions
.head 7 -  ! Subclass
.head 7 -  Call MTblSubClass( hWndForm )
.head 7 -  ! Mousewheel scrolling
.head 7 -  Call MTblEnableMWheelScroll( hWndForm, TRUE )
.head 7 -  Call MTblSetMWheelOption( hWndForm, MTMW_PAGE_KEY, VK_Control )
.head 7 -  ! Selection
.head 7 -  Call MTblSetSelectionColors( hWndForm, COLOR_White, COLOR_DarkBlue )
.head 7 -  Call MTblSetFlags( hWndForm, MTBL_FLAG_FULL_OVERLAP_SELECTION, TRUE )
.head 7 -  !
.head 5 +  Function: PalPopulateTbl
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: lsSelect
.head 7 -  String: lsNiv
.head 7 -  String: lsLettre
.head 6 +  Actions
.head 7 -  Set lsSelect = "Select Ent_ins, Ent_Ele_Ext, ENT_NOM_FF, ENT_TYPEVOTE, CB_NBBV,CB_NBBURDEP, ENT_INSCRITS_BB, ENT_INSCRITS_E1_E2,ENT_INSCRITS_E3_E4,ENT_INSCRITS_E5, ENT_ID
	from entite, Coord_Bureau
	where ent_ins =CB_ins and ENT_NIV_LETTRE = 'K' and ENT_NIV_LETTRE = CB_TYPEBUR and ENT_ELE_EXT = CB_ELECT  "
.head 7 +  If cmbEl != ''
.head 8 -  Set lsSelect = lsSelect || " AND ENT_ELE_EXT = :cmbEl  "
.head 7 -  Set lsSelect = lsSelect || "
Order by 1,2
Into :tblEntite_BVD.colIns,:tblEntite_BVD.colEl ,:tblEntite_BVD.colEntite ,:tblEntite_BVD.colTypeVote , :tblEntite_BVD.colNbBVote,:tblEntite_BVD.colNbBDep,
	:tblEntite_BVD.colNbInscritBB, :tblEntite_BVD.colNbInscritE1E2, :tblEntite_BVD.colNbInscritE3E4, :tblEntite_BVD.colNbInscritE5, :tblEntite_BVD.colId "
.head 7 -  Call SalTblPopulate( tblEntite_BVD, ghSqlMain, lsSelect, TBL_FillAll )
.head 5 +  Function: wfDoExcel
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: lnRet
.head 7 -  String: lsText
.head 6 +  Actions
.head 7 -  Call VisWaitCursor( TRUE )
.head 7 -  Call wfSaveSettings(  )
.head 7 -  Set lnRet = MTblExportToExcel( dlgGenereFile.tblEntite_BVD, 1, "", dlgGenereFile.ExcExp.ExcFlags, dlgGenereFile.ExcExp.ExpFlags, dlgGenereFile.ExcExp.RowFlagsOn,
	dlgGenereFile.ExcExp.RowFlagsOff, dlgGenereFile.ExcExp.ColFlagsOn,dlgGenereFile.ExcExp.ColFlagsOff )
.head 7 -  Call VisWaitCursor( FALSE )
.head 7 +  If lnRet < 1
.head 8 +  Select Case lnRet
.head 9 +  Case MTE_ERR_CANCELLED
.head 10 -  Set lsText = "Export cancelled."
.head 10 -  Break
.head 9 +  Case MTE_ERR_RUNNING_INSTANCE
.head 10 -  Set lsText = "Error getting running instance"
.head 10 -  Break
.head 9 +  Case MTE_ERR_NEW_INSTANCE
.head 10 -  Set lsText = "Error creating new instance"
.head 10 -  Break
.head 9 +  Case MTE_ERR_OLE_EXCEPTION
.head 10 -  Set lsText = "An OLE exception has occured"
.head 10 -  Break
.head 9 +  Case MTE_ERR_EXCEPTION
.head 10 -  Set lsText = "An exception has occured"
.head 10 -  Break
.head 9 +  Case MTE_ERR_NOT_SUBCLASSED
.head 10 -  Set lsText = "Table isn't subclassed"
.head 10 -  Break
.head 9 +  Default
.head 10 -  Set lsText = "Export failed."
.head 10 -  Break
.head 8 -  Call SalMessageBox( lsText, "Export error", MB_IconHand | MB_Ok )
.head 5 +  Function: wfSaveSettings
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  FunctionalVar: ExcExp
.head 8 -  Class: fcExcExp
.head 6 +  Actions
.head 7 -  ! Language
.head 7 -  Set ExcExp.Language = 1
.head 7 -  ! Excel start cell
.head 7 -  Set ExcExp.ExcStartCell = "0"
.head 7 -  ! Excel flags
.head 7 -  Set ExcExp.ExcFlags = ExcExp.ExcFlags | MTE_EXCEL_NEW_WORKSHEET
.head 7 -  ! Set ExcExp.ExcFlags = ExcExp.ExcFlags | MTE_EXCEL_STRING_COLS_AS_TEXT
.head 7 -  ! Export flags
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_COL_HEADERS
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_COLORS
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_FONTS
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_GRID
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_SHOW_STATUS
.head 7 -  ! Rows to export
.head 7 -  Set ExcExp.RowFlagsOff = ROW_Hidden
.head 7 -  ! Columns to export
.head 7 -  Set ExcExp.ColFlagsOn = COL_Visible
.head 7 -  ! Assign
.head 7 -  Call dlgGenereFile.ExcExp.Assign( ExcExp )
.head 4 +  Window Variables
.head 5 -  Number: wnPic
.head 5 -  Boolean: bDepot
.head 5 -  Boolean: bExist
.head 5 -  Number: lnColor
.head 5 -  Number: lnColor2
.head 5 -  Number: tnPourcent
.head 5 -  Number: tnBurDep
.head 5 -  Number: tnBurDepTot
.head 5 -  Number: tnPic
.head 5 -  Boolean: bBB
.head 5 -  Boolean: bE1E2
.head 5 -  Boolean: bE3E4
.head 5 -  Boolean: bE5
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call tfOnCreate()
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_SingleSelection, TRUE )
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_MovableCols, FALSE )
.head 5 +  On SAM_CreateComplete
.head 6 -  Call tblEntite_BVD.PalPopulateTbl(  )
.head 5 +  On SAM_FetchRowDone
.head 6 +  If tblEntite_BVD.colTypeVote != ''
.head 7 -  Call MTblSetCellBackColor( tblEntite_BVD.colIns , SalTblQueryContext( tblEntite_BVD), COLOR_LightPeriwinkle, 0  )
.head 7 -  Call MTblSetCellBackColor( tblEntite_BVD.colEntite , SalTblQueryContext( tblEntite_BVD), COLOR_LightPeriwinkle, 0  )
.head 7 -  Call MTblSetCellBackColor( tblEntite_BVD.colTypeVote , SalTblQueryContext( tblEntite_BVD), COLOR_LightPeriwinkle, 0  )
.head 7 -  Call MTblSetCellBackColor( tblEntite_BVD.colNbBDep , SalTblQueryContext( tblEntite_BVD), COLOR_LightPeriwinkle, 0  )
.head 7 -  Set tblEntite_BVD.colNbBDep  = 1
.head 7 -  Call MTblSetCellBackColor( tblEntite_BVD.colNbBVote, SalTblQueryContext( tblEntite_BVD), COLOR_Maize , 0  )
.head 6 +  Else
.head 7 -  Call MTblSetCellBackColor( tblEntite_BVD.colNbBVote, SalTblQueryContext( tblEntite_BVD), COLOR_Maize , 0  )
.head 7 -  Call MTblSetCellBackColor( tblEntite_BVD.colNbBDep, SalTblQueryContext( tblEntite_BVD), COLOR_Maize , 0  )
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ine_BB, ine_E1E2, ine_E3E4, ine_E5 from insc_entite where ine_id = :tblEntite_BVD.colId 
	into :bBB, :bE1E2, :bE3E4, :bE5 ") 
.head 6 +  If SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  If bBB
.head 8 -  Call MTblSetCellBackColor( tblEntite_BVD.colNbInscritBB , SalTblQueryContext( tblEntite_BVD), COLOR_Maize , 0  )
.head 7 +  If bE1E2
.head 8 -  Call MTblSetCellBackColor( tblEntite_BVD.colNbInscritE1E2 , SalTblQueryContext( tblEntite_BVD), COLOR_Maize , 0  )
.head 7 +  If bE3E4
.head 8 -  Call MTblSetCellBackColor( tblEntite_BVD.colNbInscritE3E4 , SalTblQueryContext( tblEntite_BVD), COLOR_Maize , 0  )
.head 7 +  If bE5
.head 8 -  Call MTblSetCellBackColor( tblEntite_BVD.colNbInscritE5 , SalTblQueryContext( tblEntite_BVD), COLOR_Maize , 0  )
.head 5 -  On SAM_DoubleClick
.head 3 +  Data Field: dfModeElection
.data CLASSPROPSSIZE
0000: 3700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573002400 4E616D6530094E61 6D6531094E616D65
0020: 34094E616D653509 4E616D6536094E61 6D653200000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 2.483"
.head 6 -  Top: 0.452"
.head 6 -  Width:  6.2"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Blue
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbChgt_Bureau
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65360000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Charge Bureaux % =>>
.head 4 -  Window Location and Size
.head 5 -  Left: 8.983"
.head 5 -  Top: 0.417"
.head 5 -  Width:  2.1"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If cmbEl != cmbEl_Rapport
.head 7 +  If SalMessageBox( "Désirez-vous vraiment charger les Bureaux  de  << "|| cmbEl || " >> 
par rapport à l'élection << "|| cmbEl_Rapport || " >> ?", "QUESTION", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 8 +  If SalTblAnyRows(  tblEntite_BVD , 0, 0 )
.head 9 -  Call PalChargeBureau(   )
.head 3 +  Pushbutton: pbImportIE
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65360000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Import IE.EL
.head 4 -  Window Location and Size
.head 5 -  Left: 12.883"
.head 5 -  Top: 0.452"
.head 5 -  Width:  1.25"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If PalImport_IE_Inscrits( cmbEl)
.head 7 -  Call SalSendMsg( cmbEl, SAM_Click , 0,0 )
.head 7 -  Call SalMessageBox( "Mise à jour OK pour les inscrits de l'élection " || cmbEl , "Message", MB_Ok )
.head 3 -  ! Tabs 2
.head 3 +  Pushbutton: pbImportCoord2007
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Import coord 2007
.head 4 -  Window Location and Size
.head 5 -  Left: 12.783"
.head 5 -  Top: 5.274"
.head 5 -  Width:  1.75"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.821"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If SalMessageBox( "Désirez-vous importer les coordonnées des bureaux de 2007 ?", "QUESTION", MB_YesNo | MB_IconQuestion ) = IDYES
.head 7 -  Call PalImportCoord2007()
.head 3 +  Pushbutton: pbViderDb
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Initialisation complète 
.head 4 -  Window Location and Size
.head 5 -  Left: 12.483"
.head 5 -  Top: 3.56"
.head 5 -  Width:  2.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.821"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalModalDialog(dlgPW, hWndForm, 'VIDER', wbOkVide)
.head 6 +  If wbOkVide
.head 7 +  If SalMessageBox("Désirez-vous vider la base de données ?
ATTENTION: Toutes les références ID seront réinitiliasées !!", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 8 +  If SalMessageBox("Etes-vous vraiment CERTAIN de vouloir vider la base de données ?
ATTENTION: Toutes les références ID seront réinitiliasées !!", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 9 -  Call PalInitDB()
.head 3 +  Pushbutton: pbViderResultComplet
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Initialisation Resultats
.head 4 -  Window Location and Size
.head 5 -  Left: 12.483"
.head 5 -  Top: 4.417"
.head 5 -  Width:  2.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.821"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If gsPhaseResult = '1'
.head 7 -  Call SalModalDialog(dlgPW, hWndForm, 'VIDER', wbOkVide)
.head 7 +  If wbOkVide
.head 8 +  If SalMessageBox("Désirez-vous réinitilaiser les résultats de la base de données 
pour l'ensemble des élections gérées ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 9 +  If SalMessageBox("Etes-vous vraiment CERTAIN de vouloir réinitilaiser les résultats de la base de données ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 10 -  Call PalInitResultDB_TteEl()
.head 6 +  Else
.head 7 -  Call SalMessageBox( "Vous n'êtes pas en phase résultats !!", "Message", MB_Ok )
.head 6 -  Call SalSendMsg( cmbEl,SAM_Click, 0,0)
.head 5 +  On SAM_Create
.head 6 -  Call VisWinSetStyle( hWndItem, BS_MULTILINE, TRUE )
.head 6 -  Call SalSetWindowText( hWndItem, "Initialisation de 
tous les résultats " )
.head 3 +  Pushbutton: pbViderDbParEl
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Initialisation de l'élection choisie
.head 4 -  Window Location and Size
.head 5 -  Left: 0.833"
.head 5 -  Top: 1.381"
.head 5 -  Width:  3.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.821"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalModalDialog(dlgPW, hWndForm, 'VIDER', wbOkVide)
.head 6 +  If wbOkVide
.head 7 +  If SalMessageBox("Désirez-vous vider la base de données pour l'élection "|| cmbEl ||" ?
ATTENTION: Toutes les références ID seront réinitiliasées !!", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 8 +  If SalMessageBox("Etes-vous vraiment CERTAIN de vouloir vider la base de données pour l'élection "|| cmbEl ||" ?
ATTENTION: Toutes les références ID seront réinitiliasées !!", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 9 -  Call PalInitDB_ParEl( cmbEl )
.head 3 +  Pushbutton: pbViderResultDB
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Initialiser les résultats pour l'élection choisie
.head 4 -  Window Location and Size
.head 5 -  Left: 4.133"
.head 5 -  Top: 1.381"
.head 5 -  Width:  3.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.821"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If gsPhaseResult = '1'
.head 7 -  Call SalModalDialog(dlgPW, hWndForm, 'VIDER', wbOkVide)
.head 7 +  If wbOkVide
.head 8 +  If SalMessageBox("Désirez-vous réinitilaiser les résultats de la base de données ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 9 +  If SalMessageBox("Etes-vous vraiment CERTAIN de vouloir réinitilaiser les résultats de la base de données ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 10 -  Call PalInitResultDB()
.head 6 +  Else
.head 7 -  Call SalMessageBox( "Vous n'êtes pas en phase résultats !!", "Message", MB_Ok )
.head 6 -  Call SalSendMsg( cmbEl,SAM_Click, 0,0)
.head 3 -  Background Text: INS:
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Resource Id: 6438
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 12.233"
.head 5 -  Top: 1.369"
.head 5 -  Width:  0.55"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.179"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfINSResult
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 5
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 12.933"
.head 6 -  Top: 1.345"
.head 6 -  Width:  0.95"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: 99999
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbViderResultCantonChoisi
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Initialiser les résultats pour le canton
.head 4 -  Window Location and Size
.head 5 -  Left: 11.75"
.head 5 -  Top: 1.595"
.head 5 -  Width:  3.233"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.619"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If gsPhaseResult = '1'
.head 7 +  If dfINSResult != ''
.head 8 -  Call SalModalDialog(dlgPW, hWndForm, 'VIDER', wbOkVide)
.head 8 +  If wbOkVide
.head 9 +  If SalMessageBox("Désirez-vous réinitilaiser les résultats de ce canton (INS: "|| dfINSResult ||") de la base de données
pour l'élection choisie ("|| cmbEl ||") ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 10 +  If SalMessageBox("Etes-vous vraiment CERTAIN de vouloir réinitilaiser les résultats de ce canton (INS: "|| dfINSResult ||") de la base de données
pour l'élection choisie ("|| cmbEl ||") ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 11 -  Call PalInitResultCantonDB( dfINSResult , cmbEl )
.head 7 +  Else
.head 8 -  Call SalMessageBox( "Veuillez encoder le code INS du canton désiré !!", "Message", MB_Ok )
.head 6 +  Else
.head 7 -  Call SalMessageBox( "Vous n'êtes pas en phase résultats !!", "Message", MB_Ok )
.head 6 -  Call SalSendMsg( cmbEl,SAM_Click, 0,0)
.head 3 +  Pushbutton: pbTransfertFile
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 4.083"
.head 5 -  Top: 3.024"
.head 5 -  Width:  2.85"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.929"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalTransfertFileArret(  )
.head 6 -  Call SalMessageBox( "Transfert terminé !!", 'Message', MB_Ok )
.head 5 +  On SAM_Create
.head 6 -  !
.head 6 -  Call VisWinSetStyle( hWndItem, BS_MULTILINE, TRUE )
.head 6 -  Call SalSetWindowText( hWndItem, "MISE à DISPOSITION
des fichiers Format F, PDF et
format Digivote" )
.head 3 +  Pushbutton: pbGenereTbl
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.783"
.head 5 -  Top: 3.024"
.head 5 -  Width:  3.15"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.929"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If gsPhaseResult = '0' and wnValidGrp = 1
.head 7 -  Call SalModalDialog(dlgPW, hWndForm, 'VALID', wbOkVide)
.head 7 +  If wbOkVide
.head 8 +  If SalMessageBox("Désirez-vous valider ces listes et passer en mode résultat ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 9 -  Call VisWaitCursor( TRUE )
.head 9 +  If NOT cbAllElect
.head 10 +  If PalVerifListe( cmbEl , '')
.head 11 -  Call PalInitResultDB_ParEl( cmbEl )
.head 10 +  Else
.head 11 -  Call VisWaitCursor( FALSE)
.head 11 -  Call SalMessageBox( 'Erreur de vérification des listes - '|| cmbEl, "Message", MB_Ok )
.head 9 +  Else
.head 10 +  If PalVerifListe( cmbEl , '')
.head 11 -  Call PalInitResultDB_TteEl( )
.head 10 +  Else
.head 11 -  Call VisWaitCursor( FALSE)
.head 11 -  Call SalMessageBox( 'Erreur de vérification des listes - '|| cmbEl, "Message", MB_Ok )
.head 9 -  Call VisWaitCursor( FALSE)
.head 6 +  Else
.head 7 -  Call SalMessageBox( "Vous êtes en phase résultats !!
ou
Les groupes ne sont pas validés !!", "Message", MB_Ok )
.head 6 -  Call SalSendMsg( cmbEl,SAM_Click, 0,0)
.head 5 +  On SAM_Create
.head 6 -  Call VisWinSetStyle( hWndItem, BS_MULTILINE, TRUE )
.head 6 -  Call SalSetWindowText( hWndItem, "PASSAGE EN MODE RESULTAT
Validation des listes, 
création des lignes RESULT 
et génération des fichiers R et I" )
.head 3 +  Check Box: cbAllElect
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65320000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Toutes les élections gérées
.head 4 -  Window Location and Size
.head 5 -  Left: 0.833"
.head 5 -  Top: 4.06"
.head 5 -  Width:  3.1"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbGenere
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Générer Fichiers I
.head 4 -  Window Location and Size
.head 5 -  Left: 7.083"
.head 5 -  Top: 3.024"
.head 5 -  Width:  1.95"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.94"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call VisWaitCursor( TRUE )
.head 6 -  Set wnI = 0
.head 6 -  Set wsSection1 = ''
.head 6 +  While SalListSetSelect( cmbEl, wnI )
.head 7 -  Call SalSendMsg( cmbEl , SAM_Click , 0,0)
.head 7 +  If cmbEl != ''
.head 8 -  Call SalGetProfileString( 'PATH', 'PATH_LOC3',  '', wsPathLoc3, frmLOC2.wsPathINI )
.head 8 +  If wsPathLoc3 != ""
.head 9 -  Call PalMakeAllDir( wsPathLoc3 )
.head 9 +  If PalVerifListe( cmbEl , '')
.head 10 +  If PalGenereIL( cmbEl )
.head 11 +  If PalGenereIC( cmbEl )
.head 12 +  If PalGenereIE( cmbEl )
.head 13 +  If PalGenereIG( cmbEl )
.head 14 -  ! Zip des format I + Transfert vers loc 3
.head 14 -  Call SalGetProfileString( 'PATH', 'PKZIP',  '', lsPkZip, frmLOC2.wsPathINI )
.head 14 +  If lsPkZip = ''
.head 15 -  Call SalMessageBox( "PkZip non trouvé !!", "ERREUR", MB_Ok )
.head 15 -  Return (FALSE)
.head 14 +  If SalStrScan( SalStrUpperX(lsPkZip), "ZIP.EXE" ) != -1
.head 15 -  Set sFileZIP = wsPathLoc3 ||"\\I"|| SalStrRightX( gsDateEl, 4 ) ||"_"|| SalStrRightX('000' || gsVersionFichierOut, 3) ||"_"|| cmbEl ||".ZIP"
.head 15 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\I*."|| cmbEl  ,  Window_NotVisible, nRet )
.head 14 +  Else
.head 15 -  Set sFileZIP = wsPathLoc3 ||"\\I"|| SalStrRightX( gsDateEl, 4 ) ||"_"|| SalStrRightX('000' || gsVersionFichierOut, 3) ||"_"|| cmbEl ||".7ZA"
.head 15 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\I*."|| cmbEl ,  Window_NotVisible, nRet )
.head 14 -  ! Ok format I
.head 14 +  If wsSection1 != ''
.head 15 -  Set wsSection1 = wsSection1 || ', '
.head 14 -  Set wsSection1 = wsSection1 || cmbEl
.head 13 +  Else
.head 14 -  Call VisWaitCursor( FALSE)
.head 14 -  Call SalMessageBox( 'Erreur génération IG.'||cmbEl||' !!', "Message", MB_Ok )
.head 12 +  Else
.head 13 -  Call VisWaitCursor( FALSE)
.head 13 -  Call SalMessageBox( 'Erreur génération IE.'||cmbEl||' !!', "Message", MB_Ok )
.head 11 +  Else
.head 12 -  Call VisWaitCursor( FALSE)
.head 12 -  Call SalMessageBox( 'Erreur génération IC.'||cmbEl||' !!', "Message", MB_Ok )
.head 10 +  Else
.head 11 -  Call VisWaitCursor( FALSE)
.head 11 -  Call SalMessageBox( 'Erreur génération IL.'||cmbEl||' !!', "Message", MB_Ok )
.head 9 -  Call VisWaitCursor( FALSE)
.head 8 +  Else
.head 9 -  Call VisWaitCursor( FALSE)
.head 9 -  Call SalMessageBox( 'Destination non trouvée pour LOC3', "Message", MB_Ok )
.head 7 -  Call SalSendMsg( cmbEl,SAM_Click, 0,0)
.head 7 -  Set wnI = wnI + 1
.head 6 -  !
.head 6 -  ! Ok format I
.head 6 -  Call SalMessageBox("Formats I générés pour l'élection "|| wsSection1 ||"
"|| wsPathLoc3, "Message", MB_Ok)
.head 5 +  On SAM_Create
.head 6 -  Call VisWinSetStyle( hWndItem, BS_MULTILINE, TRUE )
.head 6 -  Call SalSetWindowText( hWndItem, "Générer Fichiers I
pour l'ensemble 
des élections gérées" )
.head 3 +  Pushbutton: pbGenereFormatI_Indiv
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Générer Fichiers I par élection
.head 4 -  Window Location and Size
.head 5 -  Left: 8.75"
.head 5 -  Top: 0.464"
.head 5 -  Width:  3.783"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.417"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call VisWaitCursor( TRUE )
.head 6 +  If cmbEl != ''
.head 7 -  Call SalGetProfileString( 'PATH', 'PATH_LOC3',  '', wsPathLoc3, frmLOC2.wsPathINI )
.head 7 +  If wsPathLoc3 != ""
.head 8 -  Call PalMakeAllDir( wsPathLoc3 )
.head 8 +  If PalVerifListe( cmbEl , '')
.head 9 +  If PalGenereIL( cmbEl )
.head 10 +  If PalGenereIC( cmbEl )
.head 11 +  If PalGenereIE( cmbEl )
.head 12 +  If PalGenereIG( cmbEl )
.head 13 -  ! Zip des format I + Transfert vers loc 3
.head 13 -  Call SalGetProfileString( 'PATH', 'PKZIP',  '', lsPkZip, frmLOC2.wsPathINI )
.head 13 +  If lsPkZip = ''
.head 14 -  Call SalMessageBox( "PkZip non trouvé !!", "ERREUR", MB_Ok )
.head 14 -  Return (FALSE)
.head 13 +  If SalStrScan( SalStrUpperX(lsPkZip), "ZIP.EXE" ) != -1
.head 14 -  Set sFileZIP = wsPathLoc3 ||"\\I"|| SalStrRightX( gsDateEl, 4 ) ||"_"|| SalStrRightX('000' || gsVersionFichierOut, 3) ||"_"|| cmbEl ||".ZIP"
.head 14 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\I*."|| cmbEl  ,  Window_NotVisible, nRet )
.head 13 +  Else
.head 14 -  Set sFileZIP = wsPathLoc3 ||"\\I"|| SalStrRightX( gsDateEl, 4 ) ||"_"|| SalStrRightX('000' || gsVersionFichierOut, 3) ||"_"|| cmbEl ||".7ZA"
.head 14 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\I*."|| cmbEl ,  Window_NotVisible, nRet )
.head 13 -  ! Ok format I
.head 13 -  Call SalMessageBox("Formats I générés pour l'élection "|| cmbEl ||"
"|| wsPathLoc3, "Message", MB_Ok)
.head 12 +  Else
.head 13 -  Call VisWaitCursor( FALSE)
.head 13 -  Call SalMessageBox( 'Erreur génération IG.'||cmbEl||' !!', "Message", MB_Ok )
.head 11 +  Else
.head 12 -  Call VisWaitCursor( FALSE)
.head 12 -  Call SalMessageBox( 'Erreur génération IE.'||cmbEl||' !!', "Message", MB_Ok )
.head 10 +  Else
.head 11 -  Call VisWaitCursor( FALSE)
.head 11 -  Call SalMessageBox( 'Erreur génération IC.'||cmbEl||' !!', "Message", MB_Ok )
.head 9 +  Else
.head 10 -  Call VisWaitCursor( FALSE)
.head 10 -  Call SalMessageBox( 'Erreur génération IL.'||cmbEl||' !!', "Message", MB_Ok )
.head 8 -  Call VisWaitCursor( FALSE)
.head 7 +  Else
.head 8 -  Call VisWaitCursor( FALSE)
.head 8 -  Call SalMessageBox( 'Destination non trouvée pour LOC3', "Message", MB_Ok )
.head 6 -  Call SalSendMsg( cmbEl,SAM_Click, 0,0)
.head 3 +  Pushbutton: pbInitDateFormatR
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Mise à Zéro - Format R
.head 4 -  Window Location and Size
.head 5 -  Left: 9.183"
.head 5 -  Top: 3.024"
.head 5 -  Width:  2.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.94"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If gsPhaseResult = '1'
.head 7 -  Call SalModalDialog(dlgPW, hWndForm, 'VIDER', wbOkVide)
.head 7 +  If wbOkVide
.head 8 -  Call PalInitDateFormatR( "ALL" )
.head 6 +  Else
.head 7 -  Call SalMessageBox( "Vous n'êtes pas en phase résultats !!", "Message", MB_Ok )
.head 3 +  Pushbutton: pbInitDateFormatR_El
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6532000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Mise à Zéro - Format R - Election choisie
.head 4 -  Window Location and Size
.head 5 -  Left: 7.9"
.head 5 -  Top: 1.381"
.head 5 -  Width:  3.483"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.845"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If gsPhaseResult = '1'
.head 7 -  Call SalModalDialog(dlgPW, hWndForm, 'VIDER', wbOkVide)
.head 7 +  If wbOkVide
.head 8 -  Call PalInitDateFormatR( cmbEl )
.head 6 +  Else
.head 7 -  Call SalMessageBox( "Vous n'êtes pas en phase résultats !!", "Message", MB_Ok )
.head 3 +  Pushbutton: pbExcel_BVD
.data INHERITPROPS
0000: 0100
.enddata
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65360000
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsBasePbOnForm
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 14.55"
.head 5 -  Top: 0.464"
.head 5 -  Width:  0.633"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.393"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resExcel, PIC_FormatBitmap )
.head 5 +  On SAM_Click
.head 6 +  If SalTblAnyRows( tblEntite_BVD, 0,0 )
.head 7 -  Call tblEntite_BVD.wfDoExcel(  )
.head 3 +  Pushbutton: pbExcel_E5
.data INHERITPROPS
0000: 0100
.enddata
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65350000
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsBasePbOnForm
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 10.667"
.head 5 -  Top: 0.44"
.head 5 -  Width:  0.633"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.393"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resExcel, PIC_FormatBitmap )
.head 5 +  On SAM_Click
.head 6 +  If SalTblAnyRows( tblEntite_E5, 0,0 )
.head 7 -  Call tblEntite_E5.wfDoExcel(  )
.head 3 -  ! Tabs 7
.head 3 +  Child Table: tblNivSup
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65370000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: CTable
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.333"
.head 6 -  Top: 0.738"
.head 6 -  Width:  14.4"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 3.143"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? No
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colSelection
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: x
.head 6 -  Visible? Yes
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.483"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Check Box
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value: 1
.head 8 -  Uncheck Value: 0
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colLibelle
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Entité
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  6.017"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colNiveau
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Niv.
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.75"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEl
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Election
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.883"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colIns
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: INS
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  0.917"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFichierDuRep
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Fichier FF
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.967"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFichier
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Fichier FF
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  1.967"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colFichierData
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Fichier DATA
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Center
.head 6 -  Width:  2.567"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colEntDepListe
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Niv.
.head 6 -  Visible? No
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  0.75"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: tfOnCreate
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: b
.head 7 -  String: s
.head 7 -  Number: nImg
.head 7 -  Window Handle: hWndaCols[*]
.head 6 +  Actions
.head 7 -  ! Subclass
.head 7 -  Call MTblSubClass( hWndForm )
.head 7 -  ! Mousewheel scrolling
.head 7 -  Call MTblEnableMWheelScroll( hWndForm, TRUE )
.head 7 -  Call MTblSetMWheelOption( hWndForm, MTMW_PAGE_KEY, VK_Control )
.head 7 -  ! Selection
.head 7 -  Call MTblSetSelectionColors( hWndForm, COLOR_White, COLOR_DarkBlue )
.head 7 -  Call MTblSetFlags( hWndForm, MTBL_FLAG_FULL_OVERLAP_SELECTION, TRUE )
.head 7 -  !
.head 7 -  Call MTblSetColumnFont( colLibelle, MTBL_FONT_UNDEF_NAME, MTBL_FONT_UNDEF_SIZE,  FONT_EnhBold, 0 )
.head 5 +  Function: PalPopulate
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: lsWhere
.head 6 +  Actions
.head 7 -  Set lsWhere = ' ENT_ELE_EXT = :cmbEl '
.head 7 +  If cmbEl = 'SE' or cmbEl = 'EU'
.head 8 -  Set lsWhere = lsWhere || " and ent_niv_lettre NOT IN ('K','R','C') "
.head 7 +  Else If cmbEl = 'CK'
.head 8 -  Set lsWhere = lsWhere || " and ent_niv_lettre NOT IN ('K','R', 'G') "
.head 7 +  Else If cmbEl = 'WL' or cmbEl = 'VL'
.head 8 -  Set lsWhere = lsWhere || " and ent_niv_lettre NOT IN ('K','R','P') "
.head 7 +  Else
.head 8 -  Set lsWhere = lsWhere || " and ent_niv_lettre NOT IN ('K') "
.head 7 -  Call SalTblPopulate( tblNivSup, ghSqlMain, "Select 0,ENT_NOM_FF,ENT_NIV_LETTRE,ENT_ELE_EXT,ENT_INS, ENT_FORMAT_F, ENT_FORMAT_F, 'DATA_'||ENT_NIV_LETTRE||ENT_INS||'_'||ENT_ELE_EXT||'.zip'   , ent_dep_liste
	from entite where "|| lsWhere ||"
	Order by 3,5 " , TBL_FillAll )
.head 5 +  Function: PalAnalyseNivSup
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: nI
.head 7 -  Boolean: bExec
.head 7 -  Long String: llsErr
.head 6 +  Actions
.head 7 -  Set nI = -1
.head 7 -  Set bExec = FALSE
.head 7 +  While SalTblFindNextRow( tblNivSup, nI, 0,0)
.head 8 -  Call SalTblSetContext( tblNivSup , nI )
.head 8 +  If tblNivSup.colSelection = 1
.head 9 -  Set llsErr = ''
.head 9 -  Call SalHideWindow( dlgGenereFile )
.head 9 +  If SalStrRightX( tblNivSup.colFichierDuRep, 4) = '.ERR'
.head 10 -  Call VisFileRename( frmLOC2.dfIn || "\\SUP\\"|| tblNivSup.colFichierDuRep, frmLOC2.dfIn || "\\SUP\\"|| tblNivSup.colFichier )
.head 10 -  Call SalPause(250)
.head 9 +  If NOT frmLOC2.PalResultNiveauSup( frmLOC2.dfIn || "\\SUP\\"|| tblNivSup.colFichier , tblNivSup.colFichier, llsErr )
.head 10 -  ! Call SalShowWindow( dlgGenereFile )
.head 10 -  Call VisFileRename( frmLOC2.dfIn || "\\SUP\\"|| tblNivSup.colFichier, frmLOC2.dfIn || "\\SUP\\"|| tblNivSup.colFichier ||".ERR" )
.head 10 -  Set tblNivSup.colFichierDuRep = tblNivSup.colFichier || '.ERR'
.head 9 +  Else
.head 10 -  Set tblNivSup.colFichierDuRep = tblNivSup.colFichier 
.head 9 -  Set tblNivSup.colSelection = 0
.head 7 -  Call SalShowWindow( dlgGenereFile )
.head 5 +  Function: PalCheckErr
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: tnPic
.head 7 -  Long String: lsErr
.head 6 +  Actions
.head 7 -  Set mlErreurNivSup = ''
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select ERR_INFO
	 from Erreur_EnCours where Err_File = :tblNivSup.colFichier 
	into :lsErr " )
.head 7 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  If mlErreurNivSup != ''
.head 9 -  Set mlErreurNivSup = mlErreurNivSup ||'
'|| SalStrRepeatX( '=', 60 ) ||'
'
.head 8 -  Set mlErreurNivSup = mlErreurNivSup || lsErr
.head 7 -  !
.head 7 +  If mlErreurNivSup != ''
.head 8 -  Set tnPic = MImgLoadFromResource( "resAttention", MIMG_TYPE_ICO , 0 )
.head 8 -  Call MTblSetCellImage( tblNivSup.colLibelle, SalTblQueryContext( tblNivSup ),  tnPic, MTSI_REDRAW | MTSI_ALIGN_RIGHT | MTSI_ALIGN_VCENTER  )
.head 7 +  Else
.head 8 -  Call MTblSetCellImage( tblNivSup.colLibelle, SalTblQueryContext( tblNivSup ),  0, MTSI_REDRAW | MTSI_ALIGN_RIGHT | MTSI_ALIGN_VCENTER  )
.head 5 +  Function: PalEditMl_Err
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  File Handle: hFile
.head 7 -  Long String: sBuffer
.head 6 +  Actions
.head 7 +  If SalFileOpen( hFile, frmLOC2.wsPathTmp || "\\ERR.TXT", OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  Set sBuffer = tblNivSup.colNiveau || tblNivSup.colIns || tblNivSup.colEl || "

" || tblNivSup.colLibelle ||"

"|| mlErreurNivSup
.head 8 -  Call SalFilePutStr( hFile, sBuffer )
.head 8 -  Call SalFileClose( hFile )
.head 8 -  Call PalEditFile( frmLOC2.wsPathTmp || "\\ERR.TXT" )
.head 8 -  Call VisFileDelete( frmLOC2.wsPathTmp || "\\ERR.TXT" )
.head 4 +  Window Variables
.head 5 -  File Handle: hFileNivSup
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call tfOnCreate()
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_SingleSelection, TRUE )
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_MovableCols, FALSE )
.head 5 +  On SAM_FetchRowDone
.head 6 +  If colEl = 'CK' or colEl = 'WL' or colEl = 'BR'
.head 7 -  Set colFichier = 'S' || colFichier
.head 6 +  Else If colEl = 'DE'
.head 7 -  Set colFichier = '2' || colFichier
.head 6 +  Else If SalStrLeftX( colFichier ,1) = 'L'
.head 7 -  Set colFichier = 'S' || colFichier
.head 6 +  Else
.head 7 -  Set colFichier = '2' || colFichier
.head 6 -  !
.head 6 +  If SalFileOpen( hFileNivSup, frmLOC2.dfIn || '\\SUP\\'|| colFichier  , OF_Exist )
.head 7 -  Call MTblSetCellBackColor( tblNivSup.colFichierDuRep , SalTblQueryContext( tblNivSup), COLOR_LightGreen, 0  )
.head 6 +  Else
.head 7 +  If SalFileOpen( hFileNivSup, frmLOC2.dfIn || '\\SUP\\'|| colFichier ||".ERR" , OF_Exist )
.head 8 -  Call MTblSetCellBackColor( tblNivSup.colFichierDuRep , SalTblQueryContext( tblNivSup), COLOR_Maize , 0  )
.head 8 -  Set colFichierDuRep = colFichier  ||".ERR" 
.head 7 +  Else
.head 8 -  Call MTblSetCellBackColor( tblNivSup.colFichierDuRep , SalTblQueryContext( tblNivSup), COLOR_Salmon, 0  )
.head 6 -  !
.head 6 +  If SalFileOpen( hFileNivSup, frmLOC2.dfIn || '\\DATA\\'|| colFichierData  , OF_Exist )
.head 7 -  Call MTblSetCellBackColor( tblNivSup.colFichierData , SalTblQueryContext( tblNivSup), COLOR_LightGreen, 0  )
.head 6 +  Else
.head 7 -  Call MTblSetCellBackColor( tblNivSup.colFichierData , SalTblQueryContext( tblNivSup), COLOR_Salmon, 0  )
.head 6 -  !
.head 6 -  Call tblNivSup.PalCheckErr(  )
.head 5 +  On SAM_Click
.head 6 -  Call tblNivSup.PalCheckErr()
.head 3 +  Pushbutton: pbAnalyseNivSup
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65370000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Analyse
.head 4 -  Window Location and Size
.head 5 -  Left: 6.433"
.head 5 -  Top: 6.417"
.head 5 -  Width:  2.15"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call tblNivSup.PalAnalyseNivSup()
.head 3 +  Multiline Field: mlErreurNivSup
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65370000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 60000
.head 5 -  String Type: Long String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Border? Yes
.head 5 -  Word Wrap? Yes
.head 5 -  Vertical Scroll? Yes
.head 5 -  Window Location and Size
.head 6 -  Left: 0.333"
.head 6 -  Top: 3.917"
.head 6 -  Width:  14.4"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 2.286"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? No
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbEditErrAnalyse
.data CLASSPROPSSIZE
0000: 1900
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D6537000000 00
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsBasePbOnForm
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.6"
.head 5 -  Top: 6.393"
.head 5 -  Width:  0.75"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.5"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Dark Gray
.head 4 -  Button Appearance: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resReport, PIC_FormatIcon )
.head 5 +  On SAM_Click
.head 6 -  Call tblNivSup.PalEditMl_Err()
.head 2 +  Functions
.head 3 +  Function: PalPopulateCmbEl
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Window Handle: lhCmb
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsTmp
.head 5 -  Number: nI
.head 4 +  Actions
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ELE_LETTRE, ELE_ID from election
	order by 2
	 into :lsTmp, :nI " )
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If gbGestionElectionType[nI] = 1
.head 7 -  Call SalListAdd( lhCmb, lsTmp )
.head 5 -  Call SalListSetSelect( lhCmb, 0 )
.head 3 +  Function: TabUserRequest
.head 4 -  Description: Indicates that user is attempting to change the current tab by clicking,
 tabbing or some other user action.
NOTE: Call CancelMode() to deny the user's request
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  Window Handle: hWnd
.head 5 -  Number: nTab
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  Call VisWaitCursor(TRUE)
.head 5 -  Set wnTabActif = nTab
.head 5 -  !
.head 5 +  If wnTabActif = 0
.head 6 +  If SalStrScan( "<"|| gsGestionElectionType ||">", "EU" ) >= 0
.head 7 -  Call SalEnableWindow( pbCdtEU )
.head 6 +  Else
.head 7 -  Call SalDisableWindow( pbCdtEU )
.head 5 +  Else
.head 6 +  If wnTabActif = 7
.head 7 -  Call tblNivSup.PalPopulate()
.head 5 -  Call VisWaitCursor(FALSE)
.head 3 +  Function: PalVerifListe
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psEl
.head 5 -  String: psNiv
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Boolean: bOk
.head 5 -  String: lsEntite
.head 5 -  String: lsIns
.head 5 -  Long String: lsMsg
.head 5 -  Number: lnValidGrp
.head 4 +  Actions
.head 5 -  Set bOk = TRUE
.head 5 -  Set lsMsg = ''
.head 5 -  !
.head 5 +  If psNiv = ''
.head 6 +  If psEl = 'CK' or psEl = 'VL' or psEl = 'WL'
.head 7 -  Set psNiv = 'C'
.head 6 +  Else If psEl = 'SE' or psEl = 'EU'
.head 7 -  Set psNiv = 'L'
.head 6 +  Else If psEl = 'DE'
.head 7 -  Set psNiv = 'G'
.head 6 +  Else If psEl = 'BR'
.head 7 -  Set psNiv = 'R'
.head 5 -  !
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "Select Ent_Nom_FF, ent_ins from Entite 
	where ENT_ELE_EXT = :psEl and Ent_niv_Lettre = :psNiv and (Ent_Status != 'D' or ent_status is null)
	into :lsEntite, :lsIns ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If lsMsg != ''
.head 7 -  Set lsMsg = lsMsg ||'
'
.head 6 -  Set lsMsg = lsMsg || "    " || lsIns || " - " || lsEntite 
.head 6 -  Set bOk = FALSE
.head 5 +  If not bOk
.head 6 -  Set lsMsg = "Elections : "|| psEl || " - "|| psNiv ||"
Les listes des entités suivantes ne sont pas définitives :
"|| lsMsg
.head 6 -  Call SalMessageBox( lsMsg, "Attention", MB_Ok | MB_IconHand )
.head 5 +  Else
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select  ele_Loc2_ValidGrp from election where ele_lettre = :psEl
	Into :lnValidGrp ")
.head 6 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If lnValidGrp != 1
.head 7 -  Set lsMsg = "Elections : "|| psEl || " - "|| psNiv ||"
Les groupes de listes ne sont pas validées !!"
.head 7 -  Call SalMessageBox( lsMsg, "Attention", MB_Ok | MB_IconHand )
.head 7 -  Set bOk = FALSE
.head 5 -  Return bOk
.head 3 +  Function: PalGenereIL
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sTypeEl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sBuffer[*]
.head 5 -  String: sBufferTmp2
.head 5 -  String: sBufferTmp
.head 5 -  Long String: sSelect
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsIns
.head 5 -  String: lsInsPrec
.head 5 -  String: lsNiveau
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnNoListe
.head 5 -  Number: lnIdGrp
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  File Handle: lhFile
.head 5 -  Number: lnNbEntite
.head 5 -  String: sNomGrpOld
.head 5 -  String: sNoIdGrpOld
.head 5 -  String: lsSelect
.head 5 -  String: lsIdEntite
.head 5 -  Boolean: bAssocie
.head 4 +  Actions
.head 5 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 5 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 5 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 5 -  Set sDate = SalStrLeftX( sDate, 10)
.head 5 -  Set sDate = SalStrRightX( sDate, 2) ||'/'|| SalStrMidX( sDate, 5,2) ||'/'|| SalStrLeftX( sDate, 4)
.head 5 -  ! Lignes L
.head 5 -  Set lnNbEntite = 0
.head 5 -  Set lnI = 1
.head 5 -  Set lsInsPrec = ''
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select '#L#,#'|| LIS_INSBUR ||'#,#'|| LIS_ELE_EXT ||'#,#'|| LIS_TYPEBUR ||'#,#'|| LIS_NO ||'#,#'|| LIS_SIGLE ||'#,#'|| LIS_REGLING ||
		'#,#'|| LIS_ID ||'#,#'|| LIS_GRL_FK ||'#,#'||  LIS_NBEFF ||'#,#'|| LIS_NBSUPPL ||'#'
	,  LIS_INSBUR , @value(LIS_NO), LIS_TYPEBUR, LIS_GRL_FK, LIS_ENT_FK
	 from listes
	Where LIS_ELE_EXT= :sTypeEl
	Order by 2,3 
	Into :sBufferTmp2,:lsIns,:lnNoListe, :lsNiveau, :lnIdGrp, :lsIdEntite ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If lsInsPrec != '' and lsInsPrec != lsIns
.head 7 -  ! Groupes NON associés avec ancienne élection
.head 7 -  Set lsSelect = "Select Sigle, LIEU_GRPNO  from lieu_old where lieu_ins = :lsInsPrec and  LIEU_EL = :sTypeEl and
	Lieu_GrpNo NOT IN (Select Grp_noOLD from grp_corresp where grp_el = :sTypeEl and grp_no in (Select  GRL_id  from groupe_listes, Listes
									where Lis_GRL_Fk = Grl_id  and Lis_insBur = :lsInsPrec ) ) 
	order by LIEU_GRPNO
	Into :sNomGrpOld , :sNoIdGrpOld "
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, lsSelect )
.head 7 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 -  Set sBufferTmp =  '"L","'|| lsInsPrec ||'","'|| sTypeEl ||'","'|| lsNiveau ||'","null","","","null","null","null","null"'
.head 8 -  Set sBuffer[lnI] =  sBufferTmp || ',"'|| sNoIdGrpOld ||'","' || sNomGrpOld ||'"'
.head 8 -  ! ID Entite
.head 8 -  Set sBuffer[lnI] =  sBuffer[lnI] || ',"null"'
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI] )+2
.head 8 -  Set lnNbEntite = lnNbEntite +1
.head 8 -  Set lnI = lnI +1
.head 6 -  Set lsInsPrec = lsIns
.head 6 -  !
.head 6 -  Set sBufferTmp =  VisStrSubstitute( sBufferTmp2, '#', '"' )
.head 6 -  !
.head 6 -  Set bAssocie  = FALSE
.head 6 -  Set lsSelect = "Select Grp_Sigle, B.Grp_No 
	from grp_corresp A, grp_old B 
	where A.grp_noOld = B.grp_no and A.grp_no = :lnIdGrp and A.GRP_EL = :sTypeEl and A.GRP_EL = B.GRP_EL
	order by B.Grp_No
	Into :sNomGrpOld , :sNoIdGrpOld "
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, lsSelect )
.head 6 +  While SqlFetchNext( ghSqlMaj, Btmp )
.head 7 -  Set bAssocie = TRUE
.head 7 -  Set sBuffer[lnI] =  sBufferTmp || ',"'|| sNoIdGrpOld ||'","' || sNomGrpOld ||'"'
.head 7 -  ! ID Entite
.head 7 -  Set sBuffer[lnI] =  sBuffer[lnI] || ',"' || lsIdEntite ||'"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI] )+2
.head 7 -  Set lnNbEntite = lnNbEntite +1
.head 7 -  Set lnI = lnI +1
.head 6 -  !
.head 6 +  If Not bAssocie
.head 7 -  Set sBuffer[lnI] =  sBufferTmp || ',"null",""'
.head 7 -  ! ID Entite
.head 7 -  Set sBuffer[lnI] =  sBuffer[lnI] || ',"' || lsIdEntite ||'"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI] )+2
.head 7 -  Set lnNbEntite = lnNbEntite +1
.head 7 -  Set lnI = lnI +1
.head 6 -  !
.head 5 +  If TRUE
.head 6 -  ! Groupes NON associés avec ancienne élection - DERNIER INS
.head 6 -  Set lsSelect = "Select Sigle, LIEU_GRPNO  from lieu_old where lieu_ins = :lsInsPrec and  LIEU_EL = :sTypeEl and
	Lieu_GrpNo NOT IN (Select Grp_noOLD from grp_corresp where grp_el = :sTypeEl and grp_no in (Select  GRL_id  from groupe_listes, Listes
									where Lis_GRL_Fk = Grl_id  and Lis_insBur = :lsInsPrec ) ) 
	order by LIEU_GRPNO
	Into :sNomGrpOld , :sNoIdGrpOld "
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, lsSelect )
.head 6 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 -  Set sBufferTmp =  '"L","'|| lsInsPrec ||'","'|| sTypeEl ||'","'|| lsNiveau ||'","null","","","null","null","null","null"'
.head 7 -  Set sBuffer[lnI] =  sBufferTmp || ',"'|| sNoIdGrpOld ||'","' || sNomGrpOld ||'"'
.head 7 -  ! ID Entite
.head 7 -  Set sBuffer[lnI] =  sBuffer[lnI] || ',"null"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI] )+2
.head 7 -  Set lnNbEntite = lnNbEntite +1
.head 7 -  Set lnI = lnI +1
.head 5 -  !
.head 5 -  !
.head 5 -  ! Ligne G
.head 5 -  Set sBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sTypeEl ||'","XXXX","'|| sDate ||'","'|| sHeure ||  '","'|| SalNumberToStrX( lnNbEntite, 0)||'"'
.head 5 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[0] )+2 - 4
.head 5 -  !
.head 5 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 5 -  Set lnLongTot = lnLongTot + lnLong
.head 5 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 6 -  Set lnLongTot = lnLongTot + 1
.head 5 -  Set sBuffer[0] =  VisStrSubstitute( sBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 5 -  !
.head 5 +  If SalFileOpen( lhFile, frmLOC2.wsPathTmp ||'\\IL.'|| sTypeEl , OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set lnJ = 0
.head 6 +  While lnJ < lnI
.head 7 -  Call SalFilePutStr( lhFile, sBuffer[lnJ] )
.head 7 -  Set lnJ = lnJ + 1
.head 6 -  Call SalFileClose( lhFile )
.head 6 -  Return TRUE
.head 5 -  Return FALSE
.head 3 +  Function: PalGenereIC
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sTypeEl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sBuffer[*]
.head 5 -  Long String: sSelect
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsIns
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnNoCdt
.head 5 -  Number: lnNoListe
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  File Handle: lhFile
.head 5 -  Number: lnNbEntite
.head 5 -  String: lsIdEntite
.head 4 +  Actions
.head 5 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 5 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 5 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 5 -  Set sDate = SalStrLeftX( sDate, 10)
.head 5 -  Set sDate = SalStrRightX( sDate, 2) ||'/'|| SalStrMidX( sDate, 5,2) ||'/'|| SalStrLeftX( sDate, 4)
.head 5 -  ! Lignes L
.head 5 -  Set lnI = 1
.head 5 -  Set lnNbEntite = 0
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select '#C#,#'|| LIS_INSBUR ||'#,#'|| LIS_ELE_EXT ||'#,#'|| LIS_TYPEBUR ||'#,#'|| LIS_NO ||'#,#'||LIS_ID||'#,#'|| LIS_GRL_FK ||'#,#'||  CDT_TYPECDT ||'#,#'|| 
	CDT_NOORDRE ||'#,#'|| CDT_CONNUCOMME||'#,#'|| CDT_SEXE||'#,#'|| CDT_ID ||'#,#'|| CDT_DATNAIS ||'#'
	,  LIS_INSBUR , @value(LIS_NO), @Value(CDT_NOORDRE), LIS_ENT_FK
	 from listes, candidats
	Where LIS_ELE_EXT =:sTypeEl  and LIS_ID=CDT_Lis_FK
	Order by 2,3,CDT_TYPECDT, 4
	Into :sBuffer[lnI],:lsIns,:lnNoListe, :lnNoCdt, :lsIdEntite ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], '#', '"' )
.head 6 -  ! ID Entite
.head 6 -  Set sBuffer[lnI] =  sBuffer[lnI] || ',"' || lsIdEntite ||'"'
.head 6 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI] )+2
.head 6 -  Set lnNbEntite = lnNbEntite +1
.head 6 -  Set lnI = lnI +1
.head 5 -  !
.head 5 -  ! Ligne G
.head 5 -  Set sBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sTypeEl ||'","XXXX","'|| sDate ||'","'|| sHeure ||  '","'|| SalNumberToStrX( lnNbEntite, 0)||'"'
.head 5 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[0] )+2 - 4
.head 5 -  !
.head 5 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 5 -  Set lnLongTot = lnLongTot + lnLong
.head 5 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 6 -  Set lnLongTot = lnLongTot + 1
.head 5 -  Set sBuffer[0] =  VisStrSubstitute( sBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 5 -  !
.head 5 +  If SalFileOpen( lhFile, frmLOC2.wsPathTmp ||'\\IC.'|| sTypeEl , OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set lnJ = 0
.head 6 +  While lnJ < lnI
.head 7 -  Call SalFilePutStr( lhFile, sBuffer[lnJ] )
.head 7 -  Set lnJ = lnJ + 1
.head 6 -  Call SalFileClose( lhFile )
.head 6 -  Return TRUE
.head 5 -  Return FALSE
.head 3 +  Function: PalGenereIG
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: lsElec
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sBuffer[*]
.head 5 -  Long String: sSelect
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsIns
.head 5 -  String: lsElecPrec
.head 5 -  String: lsNoListeNationale
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnNoCdt
.head 5 -  Number: lnNoListe
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  File Handle: lhFile
.head 5 -  Number: lnNbEntite
.head 5 -  String: sBufferTmp2
.head 5 -  String: sBufferTmp
.head 5 -  String: sNomGrpOld
.head 5 -  String: sNoIdGrpOld
.head 5 -  String: lsSelect
.head 5 -  Boolean: bAssocie
.head 5 -  String: lsCouleurGrp
.head 5 -  String: lsGrlTri
.head 5 -  Number: nRed
.head 5 -  Number: nGreen
.head 5 -  Number: nBlue
.head 4 +  Actions
.head 5 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 5 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 5 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 5 -  Set sDate = SalStrLeftX( sDate, 10)
.head 5 -  Set sDate = SalStrRightX( sDate, 2) ||'/'|| SalStrMidX( sDate, 5,2) ||'/'|| SalStrLeftX( sDate, 4)
.head 5 -  ! Lignes X
.head 5 -  Set lnNbEntite = 0
.head 5 -  Set lnI = 1
.head 5 -  Set lsElecPrec = ''
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select '#X#,#'|| GRL_NOM ||'#,#'|| GRL_ID ||'#'
	,  GRL_ID, GRL_Couleur, GRL_TRi
	 from Groupe_listes where grl_id != 0 and grl_El = :lsElec
	Order by 2
	Into :sBufferTmp2,:lnNoListe, :lsCouleurGrp, :lsGrlTri ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  !
.head 6 -  Set lsNoListeNationale = ''
.head 6 -  Set lsSelect = "Select A.LIS_NO from listes A, listes_nat B where LIS_GRL_FK = :lnNoListe and A.lis_No=B.LIS_NO
	into :lsNoListeNationale "
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, lsSelect )
.head 6 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 6 +  ! If lsElecPrec != '' and lsElecPrec != lsElec
.head 7 -  ! Groupes NON associés avec ancienne élection
.head 7 -  Set lsSelect = "select  A.Grp_No, grp_sigle from 
	grp_old A
	where  Grp_el =:lsElecPrec and Not exists (Select B.Grp_No from Grp_corresp B where A.Grp_No =B.Grp_NoOLd )
	Into :sNomGrpOld , :sNoIdGrpOld "
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, lsSelect )
.head 7 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 -  Set sBufferTmp =  '"X","","","'
.head 8 -  Set sBuffer[lnI] =  sBufferTmp || ',"'|| sNomGrpOld ||'","' || sNoIdGrpOld 
.head 8 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI] )+2
.head 8 -  Set lnNbEntite = lnNbEntite +1
.head 8 -  Set lnI = lnI +1
.head 6 -  ! Set lsElecPrec = lsElec
.head 6 -  !
.head 6 -  Set sBufferTmp =  VisStrSubstitute( sBufferTmp2, '#', '"' )
.head 6 +  If lsCouleurGrp = ''
.head 7 -  Set lsCouleurGrp = '13421772'
.head 6 -  Call SalColorToRGB ( SalStrToNumber( lsCouleurGrp ), nRed, nGreen, nBlue )
.head 6 -  Set lsCouleurGrp = PalDecToHexa( nRed ) || PalDecToHexa( nGreen ) || PalDecToHexa( nBlue )
.head 6 -  !
.head 6 -  Set bAssocie  = FALSE
.head 6 -  Set lsSelect = "Select Grp_Sigle, B.Grp_No 
	from grp_corresp A, grp_old B 
	where A.grp_noOld = B.grp_no and A.grp_no = :lnNoListe and B.GRP_EL = :lsElec and A.Grp_El = B.GRP_EL
	order by B.Grp_No
	Into :sNomGrpOld , :sNoIdGrpOld "
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, lsSelect )
.head 6 +  While SqlFetchNext( ghSqlMaj, Btmp )
.head 7 -  Set bAssocie = TRUE
.head 7 -  Set sBuffer[lnI] =  sBufferTmp || ',"'|| sNomGrpOld ||'","' || sNoIdGrpOld ||'","'|| lsCouleurGrp ||'","'|| lsNoListeNationale ||'","'|| lsGrlTri ||'"' 
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI] )+2
.head 7 -  Set lnNbEntite = lnNbEntite +1
.head 7 -  Set lnI = lnI +1
.head 6 -  !
.head 6 +  If Not bAssocie
.head 7 -  Set sBuffer[lnI] =  sBufferTmp || ',"","null","'|| lsCouleurGrp ||'","'|| lsNoListeNationale  ||'","'|| lsGrlTri ||'"' 
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI] )+2
.head 7 -  Set lnNbEntite = lnNbEntite +1
.head 7 -  Set lnI = lnI +1
.head 5 +  If TRUE
.head 6 -  ! Groupes NON associés avec ancienne élection - DERNIERE ELECTION
.head 6 -  Set lsSelect = "select  A.Grp_No, grp_sigle from 
	grp_old A
	where  Grp_el =:lsElec and Not exists (Select B.Grp_No from Grp_corresp B where A.Grp_No =B.Grp_NoOLd and A.Grp_El = B.GRP_EL )
	Into  :sNoIdGrpOld ,:sNomGrpOld"
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, lsSelect )
.head 6 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 -  Set lsNoListeNationale = ''
.head 7 -  Set sBufferTmp =  '"X","","null"'
.head 7 -  Set sBuffer[lnI] =  sBufferTmp || ',"'|| sNomGrpOld ||'","' || sNoIdGrpOld ||'","null","","9999"'
.head 7 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI] )+2
.head 7 -  Set lnNbEntite = lnNbEntite +1
.head 7 -  Set lnI = lnI +1
.head 5 -  !
.head 5 -  ! Ligne G
.head 5 -  Set sBuffer[0] = '"G","'|| gsVersionFichierOut ||'","XXXX","'|| sDate ||'","'|| sHeure ||  '","'|| SalNumberToStrX( lnNbEntite, 0)||'"'
.head 5 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[0] )+2 - 4
.head 5 -  !
.head 5 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 5 -  Set lnLongTot = lnLongTot + lnLong
.head 5 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 6 -  Set lnLongTot = lnLongTot + 1
.head 5 -  Set sBuffer[0] =  VisStrSubstitute( sBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 5 -  !
.head 5 +  If SalFileOpen( lhFile, frmLOC2.wsPathTmp ||'\\IG.'|| lsElec , OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set lnJ = 0
.head 6 +  While lnJ < lnI
.head 7 -  Call SalFilePutStr( lhFile, sBuffer[lnJ] )
.head 7 -  Set lnJ = lnJ + 1
.head 6 -  Call SalFileClose( lhFile )
.head 6 -  !
.head 6 -  ! Mise  dispo de IG pour RSRMap (TB)
.head 6 +  ! If SalFileOpen( lhFile, gsPathApplic || "\\RSRMap\\RSRmap"|| lsElec ||".php" , OF_Exist)
.head 7 -  Call VisFileCopy( frmLOC2.wsPathTmp ||'\\IG.'|| lsElec , gsPathApplic || "\\RSRMap\\IG."|| lsElec  )
.head 6 +  If SalFileOpen( lhFile, gsPathApplic || "\\RSRMap\\RSRmap.php" , OF_Exist)
.head 7 -  Call VisFileCopy( frmLOC2.wsPathTmp ||'\\IG.'|| lsElec , gsPathApplic || "\\RSRMap\\IG."|| lsElec  )
.head 6 -  !
.head 6 -  Return TRUE
.head 5 -  Return FALSE
.head 3 +  Function: PalGenereIE
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sTypeEl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sBuffer[*]
.head 5 -  Long String: sSelect
.head 5 -  String: sEntiteFF
.head 5 -  String: sEntiteNL
.head 5 -  String: sEntiteDE
.head 5 -  String: sEntiteEN
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsIns
.head 5 -  String: lsEntIns
.head 5 -  String: lsEntLettre
.head 5 -  String: lsEntInsSup
.head 5 -  Number: lnNbEntite
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnNoListe
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  File Handle: lhFile
.head 5 -  String: lsTypeVote
.head 5 -  String: lsInscrits[10]
.head 5 -  String: lsWhere
.head 4 +  Actions
.head 5 -  Call SalDateToStr( SalDateCurrent(  ), sDate )
.head 5 -  ! Set sHeure = SalStrMidX( sDate, 11, 8)
.head 5 -  Set sHeure = VisStrSubstitute( SalStrMidX( sDate, 11, 8), '.', ':')
.head 5 -  Set sDate = SalStrLeftX( sDate, 10)
.head 5 -  Set sDate = SalStrRightX( sDate, 2) ||'/'|| SalStrMidX( sDate, 5,2) ||'/'|| SalStrLeftX( sDate, 4)
.head 5 -  ! Lignes E et T
.head 5 -  Set lnI = 1
.head 5 -  Set lnNbEntite = 0
.head 5 -  Set lsWhere = ""
.head 5 +  ! If sTypeEl = 'WL'
.head 6 -  Set lsWhere = " and ENT_NIV_LETTRE != 'O' "
.head 5 +  ! Else
.head 6 -  Set lsWhere = ""
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select 
	'#E#,#'|| ENT_ID ||'#,#'|| ENT_NIV_LETTRE ||'#,#'|| ENT_ELE_EXT ||'#,#'|| ENT_INS ||'#,#'|| ENT_INS_NIVSUP||'#,#'|| @nullvalue(ENT_NB_CDT_MAX,-999) ||'#,#'|| @nullvalue(ENT_NB_SUPP_MAX,-999)
		||'#,#'|| 'INSCRITS_BB' ||'#,#'|| 'INSCRITS_E1_E2' ||'#,#'|| 'INSCRITS_E3_E4' ||'#,#'|| 'INSCRITS_E5'
		||'#,#'|| @nullvalue(ent_BurDep_Tot,-999)|| '#,#' || ENT_DEP_LISTE || '#',
	'#T#,#'|| @nullvalue(ENT_ID,-999) ||'#,#FR#,#'|| ENT_NOM_FF ||'#',
	'#T#,#'|| @nullvalue(ENT_ID,-999) ||'#,#NL#,#'|| ENT_NOM_NN ||'#',
	'#T#,#'|| @nullvalue(ENT_ID,-999) ||'#,#DE#,#'|| ENT_NOM_DD ||'#',
	'#T#,#'|| @nullvalue(ENT_ID,-999) ||'#,#EN#,#'|| ENT_NOM_EN ||'#',
	ENT_NIV_LETTRE, ENT_INS ,ENT_INS_NIVSUP, ent_TypeVote,
	@nullvalue(ENT_INSCRITS_BB,-999) , @nullvalue(ENT_INSCRITS_E1_E2,-999), @nullvalue(ENT_INSCRITS_E3_E4,-999) ,@nullvalue(ENT_INSCRITS_E5,-999)
      from Entite
	Where ENT_ELE_EXT= :sTypeEl  "|| lsWhere ||"
	Order by ENT_NIV_LETTRE, ENT_INS 
	Into :sBuffer[lnI],:sBuffer[lnI+1],:sBuffer[lnI+2],:sBuffer[lnI+3],:sBuffer[lnI+4], :lsEntLettre, :lsEntIns, :lsEntInsSup, :lsTypeVote ,
		:lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  ! If sTypeEl = 'CK'
.head 7 +  If lsEntLettre = 'C'
.head 8 -  Set sBuffer[lnI] = sBuffer[lnI] || ',#' || lsEntIns || '#'
.head 7 +  Else If lsEntLettre = 'K'
.head 8 -  Set sBuffer[lnI] = sBuffer[lnI] || ',#' || lsEntInsSup || '#'
.head 7 +  Else 
.head 8 -  Set sBuffer[lnI] = sBuffer[lnI] || ',##'
.head 6 +  ! Else If sTypeEl = 'SE'
.head 7 +  If lsEntLettre = 'C' or lsEntLettre = 'K' or lsEntLettre = 'P'
.head 8 +  If (SalStrLeftX(lsEntIns,2) = '21' or SalStrLeftX(lsEntIns,2) = '23' )
.head 9 -  Set sBuffer[lnI] = sBuffer[lnI] || ',#12025,92094#'
.head 8 +  Else If SalStrLeftX(lsEntIns,1)='1' or SalStrLeftX(lsEntIns,2)='24' or SalStrLeftX(lsEntIns,1)='3' or SalStrLeftX(lsEntIns,1)='4' or SalStrLeftX(lsEntIns,1)='7' 
.head 9 -  Set sBuffer[lnI] = sBuffer[lnI] || ',#12025#'
.head 8 +  Else If SalStrLeftX(lsEntIns,1)='5'  or SalStrLeftX(lsEntIns,2)='25' or SalStrLeftX(lsEntIns,1)='6' or SalStrLeftX(lsEntIns,1)='8' or SalStrLeftX(lsEntIns,1)='9'
.head 9 -  Set sBuffer[lnI] = sBuffer[lnI] || ',#92094#'
.head 8 +  Else 
.head 9 -  Set sBuffer[lnI] = sBuffer[lnI] || ',##'
.head 7 +  Else 
.head 8 -  Set sBuffer[lnI] = sBuffer[lnI] || ',##'
.head 6 +  If lsEntLettre != 'K'
.head 7 +  If sTypeEl = 'CK' or sTypeEl = 'WL' or sTypeEl = 'VL'
.head 8 +  If lsEntLettre = 'C'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ins_nivsup = :lsEntIns and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  Else If (lsEntLettre = 'P' or lsEntLettre = 'O') and sTypeEl = 'WL'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and @left(ent_ins,1) like '"|| SalStrLeftX( lsEntIns, 1 ) ||"' and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  Else If lsEntLettre = 'O'
.head 9 +  If lsEntIns = '21004' 
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and @left(ent_ins,2) in ( '21', '23' , '24' , '25') and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ins_nivSup in (Select ent_ins from entite where ent_ele_ext = :sTypeEl and ent_niv_lettre= 'C' and ENT_GRP_APP = :lsEntIns) and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  Else If lsEntLettre = 'R'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  Else If sTypeEl = 'SE' or sTypeEl = 'EU' 
.head 8 +  If lsEntLettre = 'C' and lsEntIns = '21004'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ins_nivsup = :lsEntIns and ent_ele_ext = :sTypeEl 
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  Else If lsEntLettre = 'C' and lsEntIns != '21004'
.head 9 +  If sTypeEl = 'SE'
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_dep_liste = :lsEntIns and ent_ele_ext = :sTypeEl 
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 +  Else If sTypeEl = 'EU'
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_dep_liste = :lsEntIns and ent_ele_ext = :sTypeEl and  @left( ent_ins ,2) not in ('21','23')
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  If lsEntLettre = 'P'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ins_nivsup = :lsEntIns and ent_ele_ext = :sTypeEl and Ent_Ins not like '%999'
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 8 +  If lsEntLettre = 'L'
.head 9 +  If lsEntIns = '63023'
.head 10 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ins_nivsup = :lsEntIns and ent_ele_ext = :sTypeEl and Ent_Ins not like '%999'
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 10 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 9 +  Else
.head 10 -  Set lsInscrits[0] = '-999' 
.head 10 -  Set lsInscrits[1] = '-999' 
.head 10 -  Set lsInscrits[2] = '-999' 
.head 10 -  Set lsInscrits[3] = '-999' 
.head 8 +  If lsEntLettre = 'R'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  Else If sTypeEl = 'BR'  
.head 8 +  If lsEntLettre = 'R'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  Else If sTypeEl = 'DE'  
.head 8 +  If lsEntLettre = 'G'
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select @nullvalue(sum( ENT_INSCRITS_BB),-999),@nullvalue(sum( ENT_INSCRITS_E1_E2),-999) , 
		@nullvalue(sum( ENT_INSCRITS_E3_E4),-999), @nullvalue(sum(ENT_INSCRITS_E5),-999) 
	from entite where ent_niv_lettre = 'K' and ent_ele_ext = :sTypeEl
	into :lsInscrits[0],:lsInscrits[1],:lsInscrits[2],:lsInscrits[3] "  )
.head 9 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 6 +  Else If lsEntLettre = 'K' and SalStrLeftX(lsEntIns,2) = '23' and sTypeEl = 'EU'
.head 7 -  Set lsEntInsSup = lsEntInsSup || ',92094'
.head 7 -  Set sBuffer[lnI] = VisStrSubstitute( sBuffer[lnI], '#,#12025#',  '#,#12025,92094#')
.head 6 -  !
.head 6 +  If TRUE
.head 7 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], 'INSCRITS_BB', lsInscrits[0] ) 
.head 7 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], 'INSCRITS_E1_E2', lsInscrits[1] ) 
.head 7 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], 'INSCRITS_E3_E4', lsInscrits[2] ) 
.head 7 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], 'INSCRITS_E5', lsInscrits[3] ) 
.head 6 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], '-999', 'null' ) 
.head 6 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer[lnI], '#', '"' ) ||',"'|| lsTypeVote ||'"'
.head 6 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI] )+2
.head 6 -  Set sBuffer[lnI+1] =  VisStrSubstitute( sBuffer[lnI+1], '-999', 'null' )
.head 6 -  Set sBuffer[lnI+1] =  VisStrSubstitute( sBuffer[lnI+1], '#', '"' )
.head 6 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI+1] )+2
.head 6 -  Set sBuffer[lnI+2] =  VisStrSubstitute( sBuffer[lnI+2], '-999', 'null' )
.head 6 -  Set sBuffer[lnI+2] =  VisStrSubstitute( sBuffer[lnI+2], '#', '"' )
.head 6 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI+2] )+2
.head 6 -  Set sBuffer[lnI+3] =  VisStrSubstitute( sBuffer[lnI+3], '-999', 'null' )
.head 6 -  Set sBuffer[lnI+3] =  VisStrSubstitute( sBuffer[lnI+3], '#', '"' )
.head 6 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI+3] )+2
.head 6 -  Set sBuffer[lnI+4] =  VisStrSubstitute( sBuffer[lnI+4], '-999', 'null' )
.head 6 -  Set sBuffer[lnI+4] =  VisStrSubstitute( sBuffer[lnI+4], '#', '"' ) 
.head 6 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[lnI+4] )+2
.head 6 -  Set lnNbEntite = lnNbEntite +1
.head 6 -  Set lnI = lnI +5
.head 5 -  ! Ligne G
.head 5 -  Set sBuffer[0] = '"G","'|| gsVersionFichierOut ||'","'|| sTypeEl ||'","XXXX","'|| sDate ||'","'|| sHeure || '","'|| SalNumberToStrX( lnNbEntite, 0)||'"'
.head 5 -  Set lnLongTot = lnLongTot + SalStrLength( sBuffer[0] )+2 - 4
.head 5 -  !
.head 5 -  Set lnLong = SalStrLength( SalNumberToStrX( lnLongTot, 0 ) )
.head 5 -  Set lnLongTot = lnLongTot + lnLong
.head 5 +  If SalStrLength( SalNumberToStrX( lnLongTot, 0 ) ) != lnLong
.head 6 -  Set lnLongTot = lnLongTot + 1
.head 5 -  Set sBuffer[0] =  VisStrSubstitute( sBuffer[0], 'XXXX', SalNumberToStrX( lnLongTot, 0 ) )
.head 5 -  !
.head 5 +  If SalFileOpen( lhFile,  frmLOC2.wsPathTmp ||'\\IE.'|| sTypeEl , OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set lnJ = 0
.head 6 +  While lnJ < lnI
.head 7 -  Call SalFilePutStr( lhFile, sBuffer[lnJ] )
.head 7 -  Set lnJ = lnJ + 1
.head 6 -  Call SalFileClose( lhFile )
.head 6 -  Return TRUE
.head 5 -  Return FALSE
.head 3 +  Function: PalTransfertFileArret
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsFile
.head 5 -  String: lsFilePrec
.head 5 -  String: lsNo
.head 5 -  File Handle: hFile
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsLigne1Cdt
.head 5 -  String: lsLigne2Cdt 
.head 5 -  String: sBuffer
.head 5 -  String: lsPkZip
.head 5 -  Boolean: bZip
.head 5 -  String: sFileZIP
.head 5 -  Number: nRet
.head 5 -  Number: lnFiles
.head 5 -  Number: lnI
.head 5 -  String: lsFiles[*]
.head 5 -  Number: nFileCK
.head 5 -  Number: nFileSE
.head 4 +  Actions
.head 5 -  Call VisWaitCursor( TRUE )
.head 5 -  Call SalGetProfileString( 'PATH', 'PKZIP',  '', lsPkZip, frmLOC2.wsPathINI )
.head 5 -  Call SalGetProfileString( 'PATH', 'PATH_LOC3',  '', wsPathLoc3, frmLOC2.wsPathINI )
.head 5 +  If lsPkZip = ''
.head 6 -  Call SalMessageBox( "PkZip non trouvé !!", "ERREUR", MB_Ok )
.head 6 -  Return (FALSE)
.head 5 +  If SalStrScan( SalStrUpperX(lsPkZip), "ZIP.EXE" ) != -1
.head 6 -  Set bZip = TRUE
.head 5 +  Else
.head 6 -  Set bZip = FALSE
.head 5 -  !
.head 5 -  ! Fichiers DIGIVOTE
.head 5 -  ! .......... Europe
.head 5 +  If SalStrScan( "<"|| gsGestionElectionType ||">", "EU" ) >= 0
.head 6 -  Call PalGenereFFZip( 'EU', bZip,lsPkZip)
.head 6 -  Call PalGenerePDFZip('EU', bZip,lsPkZip)
.head 6 -  Call PalGenereDigivoteZip('EU', 'L', bZip,lsPkZip)
.head 5 -  ! .......... Sénat
.head 5 +  If SalStrScan( "<"|| gsGestionElectionType ||">", "SE" ) >= 0
.head 6 -  Call PalGenereFFZip( 'SE', bZip,lsPkZip)
.head 6 -  Call PalGenerePDFZip('SE', bZip,lsPkZip)
.head 6 -  Call PalGenereDigivoteZip('SE', 'L', bZip,lsPkZip)
.head 5 -  ! .......... Chambre
.head 5 +  If SalStrScan( "<"|| gsGestionElectionType ||">", "CK" ) >= 0
.head 6 -  Call PalGenereFFZip( 'CK', bZip,lsPkZip)
.head 6 -  Call PalGenerePDFZip('CK', bZip,lsPkZip)
.head 6 -  Call PalGenereDigivoteZip('CK', 'C', bZip,lsPkZip)
.head 5 -  ! .......... WL
.head 5 +  If SalStrScan( "<"|| gsGestionElectionType ||">", "WL" ) >= 0
.head 6 -  Call PalGenereFFZip( 'WL', bZip,lsPkZip)
.head 6 -  Call PalGenerePDFZip('WL', bZip,lsPkZip)
.head 6 -  Call PalGenereDigivoteZip('WL', 'C', bZip,lsPkZip)
.head 5 -  ! .......... VL
.head 5 +  If SalStrScan( "<"|| gsGestionElectionType ||">", "VL" ) >= 0
.head 6 -  Call PalGenereFFZip( 'VL', bZip,lsPkZip)
.head 6 -  Call PalGenerePDFZip('VL', bZip,lsPkZip)
.head 6 -  Call PalGenereDigivoteZip('VL', 'C', bZip,lsPkZip)
.head 5 -  ! .......... BR
.head 5 +  If SalStrScan( "<"|| gsGestionElectionType ||">", "BR" ) >= 0
.head 6 -  Call PalGenereFFZip( 'BR', bZip,lsPkZip)
.head 6 -  Call PalGenerePDFZip('BR', bZip,lsPkZip)
.head 6 -  Call PalGenereDigivoteZip('BR', 'R', bZip,lsPkZip)
.head 5 -  ! .......... DE
.head 5 +  If SalStrScan( "<"|| gsGestionElectionType ||">", "DE" ) >= 0
.head 6 -  Call PalGenereFFZip( 'DE', bZip,lsPkZip)
.head 6 -  Call PalGenerePDFZip('DE', bZip,lsPkZip)
.head 6 -  Call PalGenereDigivoteZip('DE', 'G', bZip,lsPkZip)
.head 5 -  !
.head 5 -  Call VisWaitCursor( FALSE )
.head 3 +  Function: PalGenereFFZip
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sEL
.head 5 -  Boolean: bZip
.head 5 -  String: lsPkZip
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 4 +  Actions
.head 5 -  Call VisFileCopy( frmLOC2.dfIn || "\\Autres\\D*."|| sEL, gsPathLoc1Down )
.head 5 -  Call VisFileCopy( frmLOC2.dfIn || "\\Autres\\?O*."|| sEL, gsPathLoc1Down )
.head 5 -  !
.head 5 -  Call VisFileDelete( frmLOC2.wsPathTmp ||"\\*."|| sEL )
.head 5 -  Call VisFileCopy( frmLOC2.dfIn || "\\Autres\\D*."|| sEL, frmLOC2.wsPathTmp )
.head 5 -  Call VisFileCopy( frmLOC2.dfIn || "\\Autres\\?O*."|| sEL, frmLOC2.wsPathTmp )
.head 5 +  If bZip
.head 6 -  Set sFileZIP = wsPathLoc3 ||"\\FF_Def_"|| sEL ||".ZIP"
.head 6 -  Call SalLoadAppAndWait( lsPkZip || " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*."|| sEL ,  Window_NotVisible, nRet )
.head 6 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 7 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 5 +  Else
.head 6 -  Set sFileZIP =  wsPathLoc3 ||"\\FF_Def_"|| sEL ||".7ZA"
.head 6 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*."|| sEL  ,  Window_NotVisible, nRet )
.head 6 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 7 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 5 -  Call VisFileDelete( frmLOC2.wsPathTmp ||"\\*."|| sEL )
.head 3 +  ! Function: PalGenereDigivoteZip
.head 4 -  Description: 
.head 4 -  Returns 
.head 4 +  Parameters 
.head 5 -  String: sEL
.head 5 -  String: sNiv
.head 5 -  Boolean: bZip
.head 5 -  String: lsPkZip
.head 4 -  Static Variables 
.head 4 +  Local variables 
.head 5 -  String: lsFile
.head 5 -  String: lsFilePrec
.head 5 -  String: lsNo
.head 5 -  String: lsSigle
.head 5 -  String: lsIdListe
.head 5 -  File Handle: hFile
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsLigne1Cdt
.head 5 -  String: lsLigne2Cdt 
.head 5 -  String: sBuffer
.head 5 -  String: sFileZIP
.head 4 +  Actions 
.head 5 -  Set lsFilePrec = ''
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select ENT_NIV_LETTRE || ENT_INS , Lis_No, LIS_ID, LIs_Sigle
      from Entite, Listes
	Where ENT_ELE_EXT= :sEL and Lis_Ent_Fk = Ent_id and ENT_NIV_LETTRE = :sNiv
	order by 1,2
	Into :lsFile, :lsNo, :lsIdListe, :lsSigle ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If lsFile != lsFilePrec and lsFilePrec != ''
.head 7 +  If bZip
.head 8 -  Set sFileZIP = gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP"
.head 8 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\"|| lsFilePrec ||"*.CSV" ,  Window_NotVisible, nRet )
.head 8 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 9 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 8 -  Set sFileZIP = wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP"
.head 8 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\"|| lsFilePrec ||"*.CSV" ,  Window_NotVisible, nRet )
.head 8 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 9 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 7 +  Else 
.head 8 -  Set sFileZIP =  gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA"
.head 8 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\"|| lsFilePrec ||"*.CSV" ,  Window_NotVisible, nRet )
.head 8 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 9 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 8 -  Set sFileZIP =  wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA"
.head 8 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\"|| lsFilePrec ||"*.CSV" ,  Window_NotVisible, nRet )
.head 8 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 9 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 7 -  Call VisFileDelete( frmLOC2.wsPathTmp ||"\\"|| lsFilePrec ||"*.CSV" )
.head 6 -  !
.head 6 +  If SalFileOpen( hFile,  frmLOC2.wsPathTmp ||"\\" || lsFile || lsNo ||"_"|| lsSigle ||".CSV" , OF_Create | OF_ReadWrite | OF_Text )
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire , "select CDT_TYPECDT,CDT_NOORDRE,CDT_LIGNE1_VE,CDT_LIGNE2_VE
      from Candidats
	Where Cdt_Lis_Fk = :lsIdListe
	order by 1, 2
	Into :lsTypeCdt, :lsNoCdt, :lsLigne1Cdt, :lsLigne2Cdt ")
.head 7 +  While SqlFetchNext(ghSqlSecondaire, Btmp  )
.head 8 +  If lsTypeCdt = 'E'
.head 9 -  Set lsTypeCdt =  '0'
.head 8 +  Else 
.head 9 -  Set lsTypeCdt =  '1'
.head 8 -  Set sBuffer = lsTypeCdt ||","||lsNoCdt ||","|| lsLigne1Cdt ||","|| lsLigne2Cdt
.head 8 -  Call SalFilePutStr( hFile, sBuffer )
.head 7 -  Call SalFileClose( hFile )
.head 6 +  Else 
.head 7 -  Call SalMessageBox( "Erreur de création du fichier 
"|| frmLOC2.wsPathTmp ||"\\" ||lsFile || lsNo ||"_"|| lsSigle ||".CSV" , "ERREUR", MB_Ok )
.head 7 -  Break 
.head 6 -  !
.head 6 -  Set lsFilePrec = lsFile
.head 5 +  If lsFilePrec != ''
.head 6 +  If bZip
.head 7 -  Set sFileZIP = gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP"
.head 7 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\"|| lsFilePrec ||"*.CSV" ,  Window_NotVisible, nRet )
.head 7 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 8 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 7 -  Set sFileZIP = wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP"
.head 7 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\"|| lsFilePrec ||"*.CSV" ,  Window_NotVisible, nRet )
.head 7 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 8 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 6 +  Else 
.head 7 -  Set sFileZIP =  gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA"
.head 7 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\"|| lsFilePrec ||"*.CSV" ,  Window_NotVisible, nRet )
.head 7 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 8 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 7 -  Set sFileZIP =  wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA"
.head 7 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\"|| lsFilePrec ||"*.CSV" ,  Window_NotVisible, nRet )
.head 7 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 8 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 6 -  Call VisFileDelete( frmLOC2.wsPathTmp ||"\\"|| lsFilePrec ||"*.CSV" )
.head 3 +  Function: PalGenereDigivoteZip
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sEL
.head 5 -  String: sNiv
.head 5 -  Boolean: bZip
.head 5 -  String: lsPkZip
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsFile
.head 5 -  String: lsFilePrec
.head 5 -  String: lsNo
.head 5 -  String: lsSigle
.head 5 -  String: lsIdListe
.head 5 -  File Handle: hFile
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsLigne1Cdt
.head 5 -  String: lsLigne2Cdt 
.head 5 -  String: sBuffer
.head 5 -  String: sFileZIP
.head 4 +  Actions
.head 5 -  Call VisFileDelete( frmLOC2.wsPathTmp ||"\\*.csv" )
.head 5 -  Call VisFileDelete( frmLOC2.wsPathTmp ||"\\*.zip" )
.head 5 -  Set lsFilePrec = ''
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select ENT_NIV_LETTRE || ENT_INS , Lis_No, LIS_ID, LIs_Sigle
      from Entite, Listes
	Where ENT_ELE_EXT= :sEL and Lis_Ent_Fk = Ent_id and ENT_NIV_LETTRE = :sNiv
	order by 1,2
	Into :lsFile, :lsNo, :lsIdListe, :lsSigle ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If lsFile != lsFilePrec and lsFilePrec != ''
.head 7 +  If bZip
.head 8 -  Call VisFileDelete(  gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP" )
.head 8 -  Set sFileZIP = gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP"
.head 8 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*"|| lsFilePrec ||".CSV" ,  Window_NotVisible, nRet )
.head 8 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 9 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 8 -  Call VisFileDelete(  wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP" )
.head 8 -  Set sFileZIP = wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP"
.head 8 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*"|| lsFilePrec ||".CSV" ,  Window_NotVisible, nRet )
.head 8 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 9 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 7 +  Else
.head 8 -  Call VisFileDelete(  gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA" )
.head 8 -  Set sFileZIP =  gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA"
.head 8 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*"|| lsFilePrec ||".CSV" ,  Window_NotVisible, nRet )
.head 8 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 9 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 8 -  Call VisFileDelete(  wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA" )
.head 8 -  Set sFileZIP =  wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA"
.head 8 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*"|| lsFilePrec ||".CSV" ,  Window_NotVisible, nRet )
.head 8 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 9 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 7 -  Call VisFileDelete( frmLOC2.wsPathTmp ||"\\*"|| lsFilePrec ||".CSV" )
.head 6 -  !
.head 6 +  If SalFileOpen( hFile,  frmLOC2.wsPathTmp ||"\\" || lsNo ||"_"|| lsSigle ||"_" || lsFile || ".CSV" , OF_Create | OF_ReadWrite | OF_Text )
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire , "select CDT_TYPECDT,CDT_NOORDRE,CDT_LIGNE1_VE,CDT_LIGNE2_VE
      from Candidats
	Where Cdt_Lis_Fk = :lsIdListe
	order by 1, 2
	Into :lsTypeCdt, :lsNoCdt, :lsLigne1Cdt, :lsLigne2Cdt ")
.head 7 +  While SqlFetchNext(ghSqlSecondaire, Btmp  )
.head 8 +  If lsTypeCdt = 'E'
.head 9 -  Set lsTypeCdt =  '0'
.head 8 +  Else
.head 9 -  Set lsTypeCdt =  '1'
.head 8 -  Set sBuffer = lsTypeCdt ||","||lsNoCdt ||","|| lsLigne1Cdt ||","|| lsLigne2Cdt
.head 8 -  Call SalFilePutStr( hFile, sBuffer )
.head 7 -  Call SalFileClose( hFile )
.head 6 +  Else
.head 7 -  Call SalMessageBox( "Erreur de création du fichier 
"|| frmLOC2.wsPathTmp ||"\\" ||lsFile || lsNo ||"_"|| lsSigle ||".CSV" , "ERREUR", MB_Ok )
.head 7 -  Break
.head 6 -  !
.head 6 -  Set lsFilePrec = lsFile
.head 5 +  If lsFilePrec != ''
.head 6 +  If bZip
.head 7 -  Call VisFileDelete(  gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP" )
.head 7 -  Set sFileZIP = gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP"
.head 7 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*"|| lsFilePrec ||".CSV" ,  Window_NotVisible, nRet )
.head 7 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 8 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 7 -  Call VisFileDelete(  wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP" )
.head 7 -  Set sFileZIP = wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".ZIP"
.head 7 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*"|| lsFilePrec ||".CSV" ,  Window_NotVisible, nRet )
.head 7 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 8 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 6 +  Else
.head 7 -  Call VisFileDelete(  gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA" )
.head 7 -  Set sFileZIP =  gsPathLoc1Down ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA"
.head 7 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*"|| lsFilePrec ||".CSV" ,  Window_NotVisible, nRet )
.head 7 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 8 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 7 -  Call VisFileDelete(  wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA" )
.head 7 -  Set sFileZIP =  wsPathLoc3 ||"\\"|| lsFilePrec ||"_"|| sEL ||".7ZA"
.head 7 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*"|| lsFilePrec ||".CSV" ,  Window_NotVisible, nRet )
.head 7 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 8 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 6 -  Call VisFileDelete( frmLOC2.wsPathTmp ||"\\*"|| lsFilePrec ||".CSV" )
.head 3 +  Function: PalGenerePDFZip
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sEL
.head 5 -  Boolean: bZip
.head 5 -  String: lsPkZip
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: lnFiles
.head 5 -  String: lsFiles[*]
.head 5 -  Number: lnI
.head 5 -  Number: nFileCK
.head 5 -  File Handle: hFile
.head 4 +  Actions
.head 5 -  Set lnFiles = VisDosEnumFiles( frmLOC2.dfIn || "\\PDF\\*.*", FA_Standard, lsFiles ) 
.head 5 -  Set lnI = 0
.head 5 -  Set nFileCK = 0
.head 5 +  If lnFiles > 0
.head 6 +  While lnI < lnFiles
.head 7 +  If SalStrRightX( lsFiles[lnI], 3) = 'PDF' and SalStrLeftX( lsFiles[lnI], 1) = 'D' and SalStrRightX( lsFiles[lnI], 6) = sEL ||".PDF" 
.head 8 -  Call VisFileCopy( frmLOC2.dfIn || "\\PDF\\"|| lsFiles[lnI] , gsPathLoc1Down || "\\" || lsFiles[lnI] )
.head 8 -  !
.head 8 -  Call VisFileCopy( frmLOC2.dfIn || "\\PDF\\"|| lsFiles[lnI] , frmLOC2.wsPathTmp || "\\" || lsFiles[lnI] )
.head 8 -  Set nFileCK = nFileCK + 1
.head 7 -  Set lnI = lnI +1
.head 6 -  !
.head 6 +  If bZip
.head 7 +  If nFileCK > 0
.head 8 -  Set sFileZIP = wsPathLoc3 ||"\\PDF_"|| sEL ||".ZIP"
.head 8 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*."|| sEL || ".PDF" ,  Window_NotVisible, nRet )
.head 8 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 9 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 6 +  Else
.head 7 +  If nFileCK > 0
.head 8 -  Set sFileZIP =  wsPathLoc3 ||"\\PDF_"|| sEL ||".7ZA"
.head 8 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\*."|| sEL ||".PDF" ,  Window_NotVisible, nRet )
.head 8 +  If NOT SalFileOpen( hFile, sFileZIP , OF_Exist)
.head 9 -  Call SalMessageBox( "Le fichier "|| sFileZIP || " est introuvable !!", "ERREUR", MB_IconHand | MB_Ok)
.head 6 -  Call VisFileDelete( frmLOC2.wsPathTmp ||"\\*."|| sEL ||".PDF" )
.head 6 -  !
.head 3 +  Function: PalTransfertFileArret_ParEl
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sElec
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsFile
.head 5 -  String: lsFilePrec
.head 5 -  String: lsNo
.head 5 -  File Handle: hFile
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNoCdt
.head 5 -  String: lsLigne1Cdt
.head 5 -  String: lsLigne2Cdt 
.head 5 -  String: sBuffer
.head 5 -  String: lsPkZip
.head 5 -  Boolean: bZip
.head 5 -  String: sFileZIP
.head 5 -  Number: nRet
.head 5 -  Number: lnFiles
.head 5 -  Number: lnI
.head 5 -  String: lsFiles[*]
.head 5 -  Number: nFileCK
.head 5 -  Number: nFileSE
.head 5 -  String: sNiveau
.head 4 +  Actions
.head 5 -  Call VisWaitCursor( TRUE )
.head 5 -  Call SalGetProfileString( 'PATH', 'PKZIP',  '', lsPkZip, frmLOC2.wsPathINI )
.head 5 -  Call SalGetProfileString( 'PATH', 'PATH_LOC3',  '', wsPathLoc3, frmLOC2.wsPathINI )
.head 5 +  If lsPkZip = ''
.head 6 -  Call SalMessageBox( "PkZip non trouvé !!", "ERREUR", MB_Ok )
.head 6 -  Return (FALSE)
.head 5 +  If SalStrScan( SalStrUpperX(lsPkZip), "ZIP.EXE" ) != -1
.head 6 -  Set bZip = TRUE
.head 5 +  Else
.head 6 -  Set bZip = FALSE
.head 5 -  !
.head 5 +  If sElec = 'EU' or sElec = 'SE'
.head 6 -  Set sNiveau = 'L'
.head 5 +  Else If sElec = 'CK' or sElec = 'WL'  or sElec = 'VL'
.head 6 -  Set sNiveau = 'C'
.head 5 +  Else If sElec = 'BR'
.head 6 -  Set sNiveau = 'R'
.head 5 +  Else If sElec = 'DE'
.head 6 -  Set sNiveau = 'G'
.head 5 -  !
.head 5 -  Call PalGenereFFZip( sElec, bZip,lsPkZip)
.head 5 -  Call PalGenerePDFZip(sElec, bZip,lsPkZip)
.head 5 -  Call PalGenereDigivoteZip(sElec, sNiveau, bZip,lsPkZip)
.head 5 -  !
.head 5 -  Call VisWaitCursor( FALSE )
.head 3 +  ! Function: PalMajEntite
.head 4 -  Description: 
.head 4 -  Returns 
.head 4 -  Parameters 
.head 4 -  Static Variables 
.head 4 +  Local variables 
.head 5 -  File Handle: lhFile
.head 5 -  Long String: sBuffer
.head 5 -  String: sArray[*]
.head 5 -  Number: lnId
.head 5 -  Number: lnEleId
.head 5 -  Number: lnNivId
.head 5 -  String: lsEntId
.head 5 -  String: lsFormatF
.head 4 +  Actions 
.head 5 +  If SalFileOpen( lhFile, frmLOC2.wsPathTmp||"\\ENTITE.TXT", OF_Read |OF_Text )
.head 6 +  While SalFileGetStr( lhFile, sBuffer, 1000 )
.head 7 -  Set sArray[7] = ''
.head 7 +  If SalStrTokenize( sBuffer, '', '|', sArray ) >= 7
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain, "Select ENT_ID from entite where  ent_ins = :sArray[6] and ENT_ELE_EXT = :sArray[0] and 
	ENT_NIV_LETTRE = :sArray[5] 
	Into :lnId" )
.head 8 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update entite
	set ent_Nom_FF = :sArray[1],ent_Nom_NN = :sArray[2],ent_Nom_DD = :sArray[3],ent_Nom_EN = :sArray[4], ent_status = 1,ENT_INS_NIVSUP=:sArray[7] 
	Where ENT_ID = :lnId " )
.head 8 +  Else 
.head 9 -  Call SqlPrepareAndExecute( ghSqlMain, "Select NIV_ID, NIV_ELE_FK  from Niveaux where  NIV_ELE_EXT = :sArray[0] and NIV_LETTRE=:sArray[5]
	Into :lnNivId, :lnEleId" )
.head 9 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 9 -  Call PalNextValueApplParm( 'ENT_ID', lsEntId )
.head 9 -  Set lsFormatF = sArray[5] || sArray[6] || '.'||sArray[0]
.head 9 -  Call SqlPrepareAndExecute( ghSqlMaj, "Insert into entite (ENT_ID,ENT_INS,ENT_ELE_FK,ENT_ELE_EXT,ENT_NIV_FK,ENT_NIV_LETTRE,ENT_FORMAT_F,
	ENT_NOM_FF,ENT_NOM_NN,ENT_NOM_DD,ENT_INS_NIVSUP,ENT_STATUS,ENT_NOM_EN)
values (:lsEntId,:sArray[6],:lnEleId,:sArray[0],:lnNivId,:sArray[5],:lsFormatF,:sArray[1],:sArray[2],:sArray[3],:sArray[7],1,:sArray[4] )" )
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 7 +  Else 
.head 8 -  Call SalMessageBox('Erreur sur cette ligne 
'|| sBuffer ,'ERR', MB_Ok)
.head 6 -  Call SalFileClose( lhFile )
.head 6 -  Call SalMessageBox( 'Terminé ...', 'Ok', MB_Ok )
.head 3 +  Function: PalGenereTableRelsultat
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sTypeEl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: lnNivId
.head 5 -  Number: lnEntId
.head 5 -  Number: lnElecId
.head 5 -  Number: lnLisId
.head 5 -  Number: lnCdtId
.head 5 -  Number: lnTotBurDep
.head 5 -  Boolean: bContinue
.head 5 -  String: lsNivLettre
.head 5 -  String: lsEntIns
.head 5 -  String: lsLisNo
.head 5 -  String: lsCdtNo
.head 5 -  String: lsEntNivSup
.head 5 -  String: lsEntNivSupSup
.head 5 -  String: lsInsBur
.head 5 -  String: lsWhere
.head 5 -  String: lsCdtType
.head 5 -  Sql Handle: lhSelect1
.head 5 -  Sql Handle: lhSelect2
.head 5 -  Sql Handle: lhSelect3
.head 4 +  Actions
.head 5 -  !
.head 5 -  Call SalShowWindow( dfLibelle )
.head 5 -  Call SalBringWindowToTop( dfLibelle )
.head 5 -  Set dfLibelle = "Suppression des lignes dans RESULT - " || sTypeEl
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlConnect( lhSelect1 )
.head 5 -  Call SqlSetParameter( lhSelect1, DBP_FETCHTHROUGH, TRUE, '' )
.head 5 -  Call SqlSetParameter( lhSelect1, DBP_PRESERVE, TRUE, '' )
.head 5 -  Call SqlSetIsolationLevel( lhSelect1, 'RL' )
.head 5 -  Call SqlConnect( lhSelect2 )
.head 5 -  Call SqlSetParameter( lhSelect2, DBP_FETCHTHROUGH, TRUE, '' )
.head 5 -  Call SqlSetParameter( lhSelect2, DBP_PRESERVE, TRUE, '' )
.head 5 -  Call SqlSetIsolationLevel( lhSelect2, 'RL' )
.head 5 -  Call SqlConnect( lhSelect3 )
.head 5 -  Call SqlSetParameter( lhSelect3, DBP_FETCHTHROUGH, TRUE, '' )
.head 5 -  Call SqlSetParameter( lhSelect3, DBP_PRESERVE, TRUE, '' )
.head 5 -  Call SqlSetIsolationLevel( lhSelect3, 'RL' )
.head 5 -  Set bContinue = TRUE
.head 5 -  !
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from HISTO_EVOL  where hev_el = :sTypeEl  " )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from HISTO_ELU  where hie_el = :sTypeEl  " )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_Scrutin where RES_ELE_EXT = :sTypeEl ")
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_Listes where REL_ELE_EXT = :sTypeEl  ")
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_Cdt where REC_ELE_EXT = :sTypeEl  ")
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "update appl_parm set value = '1900-01-01' where name ='RESULT' ")
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  !
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "select niv_id,NIV_ELE_FK, NIV_LETTRE from niveaux where niv_ele_ext = :sTypeEl order by niv_ordre
	Into :lnNivId, :lnElecId, :lsNivLettre " )
.head 5 +  If SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Call SqlPrepareAndExecute( lhSelect1, "Select ENT_ID, ent_ins, Ent_Ins_NivSup, Ent_Ins_NivSupSup, ent_BurDep_Tot  
	from entite 
	where ent_niv_fk = :lnNivId and ent_ele_fk = :lnElecId
	order by ent_ins
	Into :lnEntId, :lsEntIns, :lsEntNivSup, :lsEntNivSupSup , :lnTotBurDep " )
.head 6 +  While SqlFetchNext( lhSelect1 , Btmp ) and bContinue
.head 7 -  Call SalBringWindowToTop( dfLibelle )
.head 7 -  Set dfLibelle = "Insert " || lsEntIns ||" - " || sTypeEl
.head 7 -  Call DispatchMessage(  )
.head 7 -  !
.head 7 +  If (sTypeEl = 'SE' or sTypeEl = 'EU') and (SalStrLeftX( lsEntIns,2)  = '21' or SalStrLeftX( lsEntIns,2)  = '23')
.head 8 +  If NOT SqlPrepareAndExecute( ghSqlMaj, "Insert into RESULT_Scrutin (RES_ENT_FK,RES_ELE_FK,RES_ENT_INS, RES_ENT_INS_SUP,RES_ELE_EXT,RES_NIV_FK,RES_NIV_LETTRE, RES_BDEP_TOT )
	Values ( :lnEntId, :lnElecId,:lsEntIns, '12025' , :sTypeEl, :lnNivId, :lsNivLettre, :lnTotBurDep ) ")
.head 9 -  Set bContinue = FALSE
.head 8 +  If bContinue
.head 9 +  If NOT SqlPrepareAndExecute( ghSqlMaj, "Insert into RESULT_Scrutin (RES_ENT_FK,RES_ELE_FK,RES_ENT_INS, RES_ENT_INS_SUP,RES_ELE_EXT,RES_NIV_FK,RES_NIV_LETTRE, RES_BDEP_TOT )
	Values ( :lnEntId, :lnElecId,:lsEntIns, '92094' , :sTypeEl, :lnNivId, :lsNivLettre, :lnTotBurDep ) ")
.head 10 -  Set bContinue = FALSE
.head 7 +  Else
.head 8 +  If NOT SqlPrepareAndExecute( ghSqlMaj, "Insert into RESULT_Scrutin (RES_ENT_FK,RES_ELE_FK,RES_ENT_INS, RES_ENT_INS_SUP,RES_ELE_EXT,RES_NIV_FK,RES_NIV_LETTRE, RES_BDEP_TOT )
	Values ( :lnEntId, :lnElecId,:lsEntIns, :lsEntNivSup, :sTypeEl, :lnNivId, :lsNivLettre, :lnTotBurDep ) ")
.head 9 -  Set bContinue = FALSE
.head 7 +  If bContinue
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 8 +  If sTypeEl = 'CK' or sTypeEl = 'WL' or sTypeEl='VL' or sTypeEl='BR' or sTypeEl='DE'
.head 9 -  Set lsWhere = "and LIS_INSBUR = :lsEntNivSup "
.head 8 +  Else If sTypeEl = 'SE'  or sTypeEl = 'EU' 
.head 9 +  If SalStrLeftX( lsEntIns,2)  = '21' or SalStrLeftX( lsEntIns,2)  = '23'
.head 10 +  If sTypeEl = 'SE'
.head 11 -  Set lsWhere = "and LIS_INSBUR in (12025,92094) "
.head 10 +  Else
.head 11 -  Set lsWhere = "and LIS_INSBUR in ("|| lsEntNivSupSup ||") "
.head 9 +  Else
.head 10 -  Set lsWhere = "and LIS_INSBUR = :lsEntNivSupSup "
.head 9 -  !
.head 8 -  Call SqlPrepareAndExecute( lhSelect2, "Select LIS_ID, LIS_NO from Listes 
	where Lis_ele_fk = :lnElecId "|| lsWhere || "
	order by LIS_NO
	Into :lnLisId, :lsLisNo " )
.head 8 +  While SqlFetchNext( lhSelect2 , Btmp ) and bContinue
.head 9 -  Call SalBringWindowToTop( dfLibelle )
.head 9 -  Set dfLibelle = "Insert " || lsEntIns ||" - " || sTypeEl || " - Liste no "|| lsLisNo
.head 9 +  If NOT SqlPrepareAndExecute( ghSqlMaj, "Insert into RESULT_Listes (REL_LIS_FK,REL_ENT_FK,REL_ELE_FK,REL_LIS_NO,REL_ENT_INS,REL_ELE_EXT,REL_NIV_FK,REL_NIV_LETTRE)
	Values ( :lnLisId, :lnEntId, :lnElecId,:lsLisNo, :lsEntIns, :sTypeEl, :lnNivId, :lsNivLettre ) ")
.head 10 -  Set bContinue = FALSE
.head 9 +  Else
.head 10 -  Call SqlCommit( ghSqlMaj )
.head 10 +  If sTypeEl = 'CK' or sTypeEl = 'WL' or sTypeEl='VL' or sTypeEl='BR' or sTypeEl='DE'
.head 11 -  Set lsWhere = "and CDT_INSBUR = :lsEntNivSup "
.head 10 +  Else If sTypeEl = 'SE' or sTypeEl = 'EU'
.head 11 +  If SalStrLeftX( lsEntIns,2)  = '21' or SalStrLeftX( lsEntIns,2)  = '23'
.head 12 -  Set lsWhere = ''
.head 11 +  Else
.head 12 -  Set lsWhere = "and CDT_INSBUR = :lsEntNivSupSup "
.head 10 -  Call SqlPrepareAndExecute( lhSelect3, "Select CDT_ID, CDT_NOORDRE, CDT_TYPECDT from Candidats where Cdt_ele_fk = :lnElecId and cdt_lis_FK =:lnLisId "|| lsWhere || "
	order by CDT_NOORDRE
	Into :lnCdtId, :lsCdtNo, :lsCdtType " )
.head 10 +  While SqlFetchNext( lhSelect3 , Btmp ) and bContinue
.head 11 +  If NOT SqlPrepareAndExecute( ghSqlMaj, "Insert into RESULT_CDT ( REC_CDT_FK,REC_CDT_NO,REC_CDT_TYPE,RECL_LIS_FK,REC_ENT_FK,REC_ELE_FK,REC_LIS_NO,REC_ENT_INS,REC_ELE_EXT,
		REC_NIV_FK,REC_NIV_LETTRE)
	Values ( :lnCdtId, :lsCdtNo, :lsCdtType, :lnLisId, :lnEntId, :lnElecId,:lsLisNo, :lsEntIns, :sTypeEl, :lnNivId, :lsNivLettre ) ")
.head 12 -  Set bContinue = FALSE
.head 7 -  !
.head 7 +  If bContinue
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 7 -  !
.head 5 +  Else
.head 6 -  Set bContinue = FALSE
.head 5 -  !
.head 5 +  If bContinue
.head 6 -  Set frmLOC2.cbFichAutre = FALSE
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  !
.head 6 -  Call SalBringWindowToTop( dfLibelle )
.head 6 -  Set dfLibelle = "Update des statistiques"
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update statistics on table RESULT_SCRUTIN" )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update statistics on table RESULT_LISTES" )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update statistics on table RESULT_CDT" )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  !
.head 5 -  Call SqlCommit( lhSelect1 )
.head 5 -  Call SqlCommit( lhSelect2 )
.head 5 -  Call SqlCommit( lhSelect3 )
.head 5 -  Call SqlDisconnect( lhSelect1 )
.head 5 -  Call SqlDisconnect( lhSelect2 )
.head 5 -  Call SqlDisconnect( lhSelect3 )
.head 5 -  Call SalHideWindow( dfLibelle )
.head 5 -  Return bContinue
.head 3 +  Function: PalInitDB
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsTmp
.head 4 +  Actions
.head 5 -  Call VisWaitCursor( TRUE )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SalShowWindow( dfLibelle )
.head 5 -  Set dfLibelle = "Delete de l'historique du dépouillement"
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from HISTO_EVOL " )
.head 5 -  Set dfLibelle = 'Delete des candidats'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from CANDIDATS" )
.head 5 -  Set dfLibelle = 'Delete des listes'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from LISTES" )
.head 5 -  Set dfLibelle = 'Delete des Correspondances avec anciens groupes'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from Grp_Corresp" )
.head 5 -  Set dfLibelle = 'Delete des groupes'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from GROUPE_LISTES" )
.head 5 -  Set dfLibelle = 'Delete des résultats par scrutin'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_SCRUTIN" )
.head 5 -  Set dfLibelle = 'Delete des résultats par listes'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_LISTES" )
.head 5 -  Set dfLibelle = 'Delete des résultats par candidats'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_CDT" )
.head 5 -  Set dfLibelle = 'Delete des élus au niveau du Royaume'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_ELU_ROYAUME" )
.head 5 -  Set dfLibelle = 'Update des status dans ENTITE'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update ENTITE Set ent_Status = '' where ent_status is not null " )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SqlPrepareAndExecute(  ghSqlMaj , "Delete from Erreur_EnCours")
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Set dfLibelle = 'Delete des fichiers résultats antérieurs'
.head 5 -  Call VisFileDelete( frmLOC2.wsPathResult ||"\\*.*" )
.head 5 -  Call DispatchMessage(  )
.head 5 -  Set dfLibelle = 'MàJ des paramètres'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update ELECTION 
	Set ELE_LOC2_RESULT = 0, ELE_LOC2_VALIDGRP=0, ELE_LOC2_DATEDERNIER=2000-01-01, ELE_LOC2_ELUDIFFUSE=0 , ELE_D_RESULT=2000-01-01,
		ELE_D_FORMATR=2000-01-01 , ELE_NB_FORMATR = null " )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call PalSetApplParm( "LIS_ID", "0" )
.head 5 -  Call PalSetApplParm( "CDT_ID", "0" )
.head 5 -  Call PalSetApplParm( "GRL_ID", "0" )
.head 5 -  Call PalSetApplParm( "VALID_GRP", "0" )
.head 5 -  Call PalSetApplParm( "ELU_DIFFUSE", "0" )
.head 5 -  Call PalSetApplParm( "DATE_LOC2_DF", "2000-01-01-08.00.00" )
.head 5 -  Call PalGetApplParm( "DATE_LOC2_DF", lsTmp )
.head 5 -  Set frmLOC2.dfDateDernier = SalStrToDate( lsTmp )
.head 5 -  Set gsPhaseResult = '0'
.head 5 -  Call SalSetProfileString( 'DATABASE', 'RESULTAT', '0', frmLOC2.wsPathINI )
.head 5 -  Call PalSetApplParm( 'RESUL_ACTIF', '0' )
.head 5 -  ! Call frmLOC2.PalCheckRepertoire( )
.head 5 -  Set dfLibelle = 'Update statistics sur la base de données ...'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update statistics on table RESULT_CDT" )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SalHideWindow( dfLibelle )
.head 5 -  Call VisWaitCursor( FALSE )
.head 5 -  Call SalMessageBox( "Initialisation de la base de données terminée !!", "Msg", MB_Ok )
.head 3 +  Function: PalInitDB_ParEl
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sEl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsTmp
.head 4 +  Actions
.head 5 -  Call VisWaitCursor( TRUE )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SalShowWindow( dfLibelle )
.head 5 -  Set dfLibelle = "Delete de l'historique du dépouillement"
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from HISTO_EVOL  where hev_el = :sEl  " )
.head 5 -  Set dfLibelle = 'Delete des candidats'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from CANDIDATS where cdt_ele_ext = :sEl " )
.head 5 -  Set dfLibelle = 'Delete des listes'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from LISTES  where Lis_ele_ext = :sEl " )
.head 5 -  Set dfLibelle = 'Delete des Correspondances avec anciens groupes'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from Grp_Corresp  where GRP_NO in (Select GRL_ID from groupe_Listes where Grl_EL= :sEl)  " )
.head 5 -  Set dfLibelle = 'Delete des groupes'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from GROUPE_LISTES where Grl_EL= :sEl" )
.head 5 -  Set dfLibelle = 'Delete des résultats par scrutin'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_SCRUTIN where RES_ELE_EXT= :sEl " )
.head 5 -  Set dfLibelle = 'Delete des résultats par listes'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_LISTES where REL_ELE_EXT= :sEl " )
.head 5 -  Set dfLibelle = 'Delete des résultats par candidats'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_CDT where REC_ELE_EXT= :sEl " )
.head 5 -  Set dfLibelle = 'Delete des élus au niveau du Royaume'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_ELU_ROYAUME where ELU_ELECT= :sEl  " )
.head 5 -  Set dfLibelle = 'Update des status dans ENTITE'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update ENTITE Set ent_Status = '' where ent_status is not null and ent_ele_ext = :sEl " )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SqlPrepareAndExecute(  ghSqlMaj , "Delete from Erreur_EnCours where ERR_FILE like '%."|| sEl ||"'  ")
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Set dfLibelle = 'Delete des fichiers résultats antérieurs'
.head 5 -  Call VisFileDelete( frmLOC2.wsPathResult ||"\\*."|| sEl )
.head 5 -  Call DispatchMessage(  )
.head 5 -  Set dfLibelle = 'MàJ des paramètres'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update ELECTION 
	Set ELE_LOC2_RESULT = 0, ELE_LOC2_VALIDGRP=0, ELE_LOC2_DATEDERNIER=2000-01-01 , ELE_LOC2_ELUDIFFUSE = 0, ELE_D_RESULT=2000-01-01,
		ELE_D_FORMATR=2000-01-01, ELE_NB_FORMATR=null
	Where ELE_LETTRE = :sEl " )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Set lsTmp = "2000-01-01"
.head 5 -  Set frmLOC2.dfDateDernier = SalStrToDate( lsTmp )
.head 5 -  Set gsPhaseResult = '0'
.head 5 -  ! Call frmLOC2.PalCheckRepertoire( )
.head 5 -  Set dfLibelle = 'Update statistics sur la base de données ...'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update statistics on table RESULT_CDT" )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SalHideWindow( dfLibelle )
.head 5 -  Call VisWaitCursor( FALSE )
.head 5 -  Call SalMessageBox( "Initialisation de la base de données terminée pour l'élection " || sEl, "Msg", MB_Ok )
.head 3 +  Function: PalInitResultDB
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsTmp
.head 4 +  Actions
.head 5 -  Call VisWaitCursor( TRUE )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SalShowWindow( dfLibelle )
.head 5 -  Set dfLibelle = 'Delete des élus au niveau du Royaume'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_ELU_ROYAUME where ELU_ELECT = :cmbEl " )
.head 5 -  Call SqlCommit( ghSqlMain )
.head 5 -  Set dfLibelle = 'Delete des fichiers résultats antérieurs'
.head 5 -  Call VisFileDelete( frmLOC2.wsPathResult ||"\\*."|| cmbEl )
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call PalSetApplParm( "ELU_DIFFUSE", "0" )
.head 5 -  Call PalSetApplParm( "DATE_LOC2_DF", "2000-01-01-08.00.00" )
.head 5 -  Call PalGetApplParm( "DATE_LOC2_DF", lsTmp )
.head 5 -  !
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update Election set  ele_Loc2_EluDiffuse = 0 , ELE_LOC2_DATEDERNIER = 2000-01-01, ELE_D_RESULT=2000-01-01,
		ELE_D_FORMATR=2000-01-01, ELE_NB_FORMATR=null
	where ELE_LETTRE = :cmbEl " )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  !
.head 5 -  Set frmLOC2.dfDateDernier = SalStrToDate( lsTmp )
.head 5 -  !
.head 5 +  If PalGenereTableRelsultat( cmbEl )
.head 6 -  Set gsPhaseResult = '1'
.head 6 -  Call SalSetProfileString( 'DATABASE', 'RESULTAT', gsPhaseResult, frmLOC2.wsPathINI )
.head 6 -  Call PalSetApplParm( 'RESUL_ACTIF', '1' )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update Election set  ELE_LOC2_RESULT = 1 
	where ELE_LETTRE = :cmbEl " )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  ! Call frmLOC2.PalCheckRepertoire( )
.head 6 -  !
.head 6 -  ! Création des fichiers format I
.head 6 -  Call SalShowWindow( dfLibelle )
.head 6 -  Call SalBringWindowToTop( dfLibelle )
.head 6 -  Set dfLibelle = "Génération des formats I"
.head 6 -  Call DispatchMessage(  )
.head 6 -  Set wsPathLoc3 = gsPathLoc1Down
.head 6 -  Call PalGenereCoord( wsPathLoc3, frmLOC2.wsPathTmp )
.head 6 -  !
.head 6 -  Call SalGetProfileString( 'PATH', 'PATH_TMP',  frmLOC2.wsPath||'\\TMP', frmLOC2.wsPathTmp, frmLOC2.wsPathINI )
.head 6 +  If SalMessageBox( "Vous allez (re)générer des formats I ....
Désirez-vous passer à la version suivante (v"|| gsVersionFichierOut ||" --> v" || SalNumberToStrX( SalStrToNumber( gsVersionFichierOut) + 1,0) ||") ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 7 -  Set gsVersionFichierOut = SalNumberToStrX( SalStrToNumber( gsVersionFichierOut) + 1,0)
.head 7 -  Call SalSetProfileString( 'VERSION', 'VERSION_FICHIER', gsVersionFichierOut, frmLOC2.wsPathINI )
.head 6 -  !
.head 6 +  If PalGenereIL( cmbEl )
.head 7 +  If PalGenereIC( cmbEl )
.head 8 +  If PalGenereIE( cmbEl )
.head 9 +  If PalGenereIG( cmbEl )
.head 10 -  ! Ok format I
.head 10 -  Call SalGetProfileString( 'PATH', 'PATH_LOC3',  '', wsPathLoc3, frmLOC2.wsPathINI )
.head 10 -  ! Zip des format I + Transfert vers loc 3
.head 10 -  Call SalGetProfileString( 'PATH', 'PKZIP',  '', lsPkZip, frmLOC2.wsPathINI )
.head 10 +  If lsPkZip = ''
.head 11 -  Call SalMessageBox( "PkZip non trouvé !!", "ERREUR", MB_Ok )
.head 11 -  Return (FALSE)
.head 10 +  If SalStrScan( SalStrUpperX(lsPkZip), "ZIP.EXE" ) != -1
.head 11 -  Set sFileZIP = wsPathLoc3 ||"\\I"|| SalStrRightX( gsDateEl, 4 ) ||"_"|| SalStrRightX('000' || gsVersionFichierOut, 3) ||"_"|| cmbEl ||".ZIP"
.head 11 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\I*."|| cmbEl  ,  Window_NotVisible, nRet )
.head 10 +  Else
.head 11 -  Set sFileZIP = wsPathLoc3 ||"\\I"|| SalStrRightX( gsDateEl, 4 ) ||"_"|| SalStrRightX('000' || gsVersionFichierOut, 3) ||"_"|| cmbEl ||".7ZA"
.head 11 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\I*."|| cmbEl  ,  Window_NotVisible, nRet )
.head 9 +  Else
.head 10 -  Call VisWaitCursor( FALSE)
.head 10 -  Call SalMessageBox( 'Erreur génération IG.'|| cmbEl, "Message", MB_Ok )
.head 8 +  Else
.head 9 -  Call VisWaitCursor( FALSE)
.head 9 -  Call SalMessageBox( 'Erreur génération IE.'||cmbEl , "Message", MB_Ok )
.head 7 +  Else
.head 8 -  Call VisWaitCursor( FALSE)
.head 8 -  Call SalMessageBox( 'Erreur génération IC.'||cmbEl , "Message", MB_Ok )
.head 6 +  Else
.head 7 -  Call VisWaitCursor( FALSE)
.head 7 -  Call SalMessageBox( 'Erreur génération IL.'||cmbEl  , "Message", MB_Ok )
.head 6 -  !
.head 6 +  If SalMessageBox( "Désirez-vous vider le répertoire DETAIL de tous les résultats de cette élection ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 7 -  Call VisFileDelete( frmLOC2.dfIn ||"\\0\\*." || cmbEl )
.head 7 -  Call VisFileDelete( frmLOC2.dfIn ||"\\1\\*." || cmbEl )
.head 6 -  !
.head 6 -  !
.head 6 -  ! Mise à disposition des formats définitifs - Web3, Download
.head 6 -  Call SalBringWindowToTop( dfLibelle )
.head 6 -  Set dfLibelle = "Copie des fichiers Format F et  PDF"
.head 6 -  Call DispatchMessage(  )
.head 6 -  Call PalTransfertFileArret_ParEl( cmbEl )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Call SqlCommit( ghSqlMain )
.head 5 +  Else
.head 6 -  Call VisWaitCursor( FALSE)
.head 6 -  Call SalMessageBox( 'Erreur génération table RESULT - '|| cmbEl , "Message", MB_Ok )
.head 5 -  !
.head 5 -  ! Call frmLOC2.PalCheckRepertoire( )
.head 5 -  !
.head 5 -  Set dfLibelle = 'Update statistics sur la base de données ...'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update statistics on table RESULT_CDT" )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SalHideWindow( dfLibelle )
.head 5 -  Call VisWaitCursor( FALSE )
.head 5 -  Call SalMessageBox( "Initialisation des résultats la base de données terminée !!", "Msg", MB_Ok )
.head 3 +  Function: PalInitResultCantonDB
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sIns
.head 5 -  String: sElection
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsTmp
.head 5 -  Boolean: bContinue
.head 4 +  Actions
.head 5 -  Call VisWaitCursor( TRUE )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SalShowWindow( dfLibelle )
.head 5 -  Set dfLibelle = "Initialisation des résultats d'un canton"
.head 5 -  Call SalBringWindowToTop( dfLibelle )
.head 5 -  Call DispatchMessage(  )
.head 5 -  !
.head 5 -  Set bContinue = FALSE
.head 5 +  If SqlPrepareAndExecute( ghSqlMaj, "Update RESULT_Scrutin
	set RES_NB_VV=null, RES_NB_BE=null, RES_NB_VBN=null, RES_SIT_DEP=null, RES_BDEP_TRAIT=null, DATE_HEURE_MAJ=null, RES_NB_VV_E5=null, RES_NB_VBN_E5=null, RES_T_DEP=null, RES_CHECK_SUM=null
	Where RES_ELE_EXT = :sElection and RES_ENT_INS = :sIns and RES_NIV_LETTRE = 'K' ")
.head 6 +  If SqlPrepareAndExecute( ghSqlMaj, "Update result_Listes
	set REL_SC1=null, REL_SC2=null, REL_SC3=null, REL_SC4=null, REL_CHECK_SUM=null
	Where REL_ELE_EXT = :sElection and REL_ENT_INS = :sIns and REL_NIV_LETTRE = 'K' ")
.head 7 +  If SqlPrepareAndExecute( ghSqlMaj, "Update result_Cdt
	set REC_NB_VOIX=null
	Where REC_ELE_EXT = :sElection and REC_ENT_INS = :sIns and REC_NIV_LETTRE = 'K' ")
.head 8 -  Set bContinue = TRUE
.head 8 -  Call SqlCommit( ghSqlMaj )
.head 5 -  !
.head 5 +  If bContinue
.head 6 -  Call DispatchMessage(  )
.head 6 -  Set dfLibelle = "Update des statistiques"
.head 6 -  Call SalBringWindowToTop( dfLibelle )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update statistics on table RESULT_SCRUTIN" )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update statistics on table RESULT_LISTES" )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update statistics on table RESULT_CDT" )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Call VisWaitCursor( FALSE )
.head 6 -  Call SalHideWindow( dfLibelle )
.head 6 -  Call SalMessageBox( "Initialisation des résultats du canton choisi ("|| dfINSResult ||") terminée !!", "Msg", MB_Ok )
.head 5 +  Else
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK" )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Call VisWaitCursor( FALSE )
.head 6 -  Call SalHideWindow( dfLibelle )
.head 6 -  Call SalMessageBox( "ERREUR dans l'initialisation des résultats du canton choisi ("|| dfINSResult ||") !!", "ERREUR", MB_Ok | MB_IconExclamation )
.head 5 -  !
.head 5 -  !
.head 3 +  Function: PalInitResultDB_ParEl
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sElec
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsTmp
.head 5 -  Number: lnI
.head 4 +  Actions
.head 5 -  Call VisWaitCursor( TRUE )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SalShowWindow( dfLibelle )
.head 5 -  Set dfLibelle = 'Delete des élus au niveau du Royaume - '|| sElec
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_ELU_ROYAUME where ELU_ELECT = :sElec " )
.head 5 -  Set dfLibelle = 'Delete des fichiers résultats antérieurs'
.head 5 -  Call VisFileDelete( frmLOC2.wsPathResult ||"\\*." || sElec )
.head 5 -  Call DispatchMessage(  )
.head 5 -  !
.head 5 +  If PalGenereTableRelsultat( sElec )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update Election set  ELE_LOC2_RESULT = 1 , ELE_NB_FORMATR=null,ele_Loc2_EluDiffuse = 0 , ELE_D_FORMATR=2000-01-01
	where ELE_LETTRE = :sElec " )
.head 6 -  Call SqlCommit( ghSqlMain )
.head 6 -  !
.head 6 -  ! Création des fichiers format I
.head 6 -  Call SalShowWindow( dfLibelle )
.head 6 -  Call SalBringWindowToTop( dfLibelle )
.head 6 -  Set dfLibelle = "Génération des formats I"
.head 6 -  Call DispatchMessage(  )
.head 6 -  !
.head 6 -  Call SalGetProfileString( 'PATH', 'PATH_TMP',  frmLOC2.wsPath||'\\TMP', frmLOC2.wsPathTmp, frmLOC2.wsPathINI )
.head 6 +  If PalGenereIL( sElec )
.head 7 +  If PalGenereIC( sElec )
.head 8 +  If PalGenereIE( sElec )
.head 9 +  If PalGenereIG( sElec)
.head 10 -  ! Ok format I
.head 10 -  Call SalGetProfileString( 'PATH', 'PATH_LOC3',  '', wsPathLoc3, frmLOC2.wsPathINI )
.head 10 -  ! Zip des format I + Transfert vers loc 3
.head 10 -  Call SalGetProfileString( 'PATH', 'PKZIP',  '', lsPkZip, frmLOC2.wsPathINI )
.head 10 +  If lsPkZip = ''
.head 11 -  Call SalMessageBox( "PkZip non trouvé !!", "ERREUR", MB_Ok )
.head 11 -  Return (FALSE)
.head 10 +  If SalStrScan( SalStrUpperX(lsPkZip), "ZIP.EXE" ) != -1
.head 11 -  Set sFileZIP = wsPathLoc3 ||"\\I"|| SalStrRightX( gsDateEl, 4 ) ||"_"|| SalStrRightX('000' || gsVersionFichierOut, 3) ||"_"|| sElec || ".ZIP"
.head 11 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\I*."|| sElec ,  Window_NotVisible, nRet )
.head 10 +  Else
.head 11 -  Set sFileZIP = wsPathLoc3 ||"\\I"|| SalStrRightX( gsDateEl, 4 ) ||"_"|| SalStrRightX('000' || gsVersionFichierOut, 3) ||"_"|| sElec || ".7ZA"
.head 11 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\I*."|| sElec  ,  Window_NotVisible, nRet )
.head 9 +  Else
.head 10 -  Call VisWaitCursor( FALSE)
.head 10 -  Call SalMessageBox( 'Erreur génération IG.'|| sElec||' !!', "Message", MB_Ok )
.head 8 +  Else
.head 9 -  Call VisWaitCursor( FALSE)
.head 9 -  Call SalMessageBox( 'Erreur génération IE.'|| sElec||' !!', "Message", MB_Ok )
.head 7 +  Else
.head 8 -  Call VisWaitCursor( FALSE)
.head 8 -  Call SalMessageBox( 'Erreur génération IC.'|| sElec||' !!', "Message", MB_Ok )
.head 6 +  Else
.head 7 -  Call VisWaitCursor( FALSE)
.head 7 -  Call SalMessageBox( 'Erreur génération IL.'|| sElec||' !!', "Message", MB_Ok )
.head 6 -  !
.head 6 +  If SalMessageBox( "Désirez-vous vider le répertoire DETAIL de tous les résultats de cette élection ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 7 -  Call VisFileDelete( frmLOC2.dfIn ||"\\0\\*." || sElec )
.head 7 -  Call VisFileDelete( frmLOC2.dfIn ||"\\1\\*." || sElec )
.head 6 -  !
.head 5 +  Else
.head 6 -  Call VisWaitCursor( FALSE)
.head 6 -  Call SalMessageBox( 'Erreur génération table RESULT - "|| sElec || " !!', "Message", MB_Ok )
.head 5 -  !
.head 5 -  Set dfLibelle = 'Update statistics sur la base de données ...'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update statistics on table RESULT_CDT" )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SalHideWindow( dfLibelle )
.head 5 -  Call VisWaitCursor( FALSE )
.head 5 -  Call SalMessageBox( "Initialisation des résultats la base de données terminée !! - Election "|| sElec , "Msg", MB_Ok )
.head 3 +  Function: PalInitResultDB_TteEl
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsTmp
.head 5 -  Number: lnI
.head 5 -  String: sElec
.head 4 +  Actions
.head 5 -  Call VisWaitCursor( TRUE )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SalShowWindow( dfLibelle )
.head 5 -  Set lnI = 0
.head 5 +  While SalListSetSelect( cmbEl, lnI )
.head 6 -  Set sElec = cmbEl
.head 6 -  Set dfLibelle = 'Delete des élus au niveau du Royaume - '|| sElec
.head 6 -  Call DispatchMessage(  )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Delete from RESULT_ELU_ROYAUME where ELU_ELECT = :sElec " )
.head 6 -  Set dfLibelle = 'Delete des fichiers résultats antérieurs'
.head 6 -  Call VisFileDelete( frmLOC2.wsPathResult ||"\\*." || sElec )
.head 6 -  Call DispatchMessage(  )
.head 6 -  !
.head 6 +  If PalGenereTableRelsultat( sElec )
.head 7 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update Election set  ELE_LOC2_RESULT = 1 , ELE_NB_FORMATR=null,ele_Loc2_EluDiffuse = 0 , ELE_D_FORMATR=2000-01-01
	where ELE_LETTRE = :sElec " )
.head 7 -  Call SqlCommit( ghSqlMain )
.head 7 -  !
.head 7 -  ! Création des fichiers format I
.head 7 -  Call SalShowWindow( dfLibelle )
.head 7 -  Call SalBringWindowToTop( dfLibelle )
.head 7 -  Set dfLibelle = "Génération des formats I"
.head 7 -  Call DispatchMessage(  )
.head 7 -  !
.head 7 -  Call SalGetProfileString( 'PATH', 'PATH_TMP',  frmLOC2.wsPath||'\\TMP', frmLOC2.wsPathTmp, frmLOC2.wsPathINI )
.head 7 +  If PalGenereIL( sElec )
.head 8 +  If PalGenereIC( sElec )
.head 9 +  If PalGenereIE( sElec )
.head 10 +  If PalGenereIG( sElec)
.head 11 -  ! Ok format I
.head 11 -  Call SalGetProfileString( 'PATH', 'PATH_LOC3',  '', wsPathLoc3, frmLOC2.wsPathINI )
.head 11 -  ! Zip des format I + Transfert vers loc 3
.head 11 -  Call SalGetProfileString( 'PATH', 'PKZIP',  '', lsPkZip, frmLOC2.wsPathINI )
.head 11 +  If lsPkZip = ''
.head 12 -  Call SalMessageBox( "PkZip non trouvé !!", "ERREUR", MB_Ok )
.head 12 -  Return (FALSE)
.head 11 +  If SalStrScan( SalStrUpperX(lsPkZip), "ZIP.EXE" ) != -1
.head 12 -  Set sFileZIP = wsPathLoc3 ||"\\I"|| SalStrRightX( gsDateEl, 4 ) ||"_"|| SalStrRightX('000' || gsVersionFichierOut, 3) ||"_"|| sElec || ".ZIP"
.head 12 -  Call SalLoadAppAndWait( lsPkZip|| " " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\I*."|| sElec ,  Window_NotVisible, nRet )
.head 11 +  Else
.head 12 -  Set sFileZIP = wsPathLoc3 ||"\\I"|| SalStrRightX( gsDateEl, 4 ) ||"_"|| SalStrRightX('000' || gsVersionFichierOut, 3) ||"_"|| sElec || ".7ZA"
.head 12 -  Call SalLoadAppAndWait( lsPkZip|| " A " || sFileZIP  || " "|| frmLOC2.wsPathTmp ||"\\I*."|| sElec  ,  Window_NotVisible, nRet )
.head 10 +  Else
.head 11 -  Call VisWaitCursor( FALSE)
.head 11 -  Call SalMessageBox( 'Erreur génération IG.'|| sElec||' !!', "Message", MB_Ok )
.head 9 +  Else
.head 10 -  Call VisWaitCursor( FALSE)
.head 10 -  Call SalMessageBox( 'Erreur génération IE.'|| sElec||' !!', "Message", MB_Ok )
.head 8 +  Else
.head 9 -  Call VisWaitCursor( FALSE)
.head 9 -  Call SalMessageBox( 'Erreur génération IC.'|| sElec||' !!', "Message", MB_Ok )
.head 7 +  Else
.head 8 -  Call VisWaitCursor( FALSE)
.head 8 -  Call SalMessageBox( 'Erreur génération IL.'|| sElec||' !!', "Message", MB_Ok )
.head 7 -  !
.head 7 +  If SalMessageBox( "Désirez-vous vider le répertoire DETAIL de tous les résultats de cette élection ?", "Question", MB_YesNo | MB_DefButton2 | MB_IconQuestion ) = IDYES
.head 8 -  Call VisFileDelete( frmLOC2.dfIn ||"\\0\\*." || sElec )
.head 8 -  Call VisFileDelete( frmLOC2.dfIn ||"\\1\\*." || sElec )
.head 7 -  !
.head 6 +  Else
.head 7 -  Call VisWaitCursor( FALSE)
.head 7 -  Call SalMessageBox( 'Erreur génération table RESULT - "|| sElec || " !!', "Message", MB_Ok )
.head 6 -  !
.head 6 -  Set lnI = lnI + 1
.head 6 -  !
.head 5 -  !
.head 5 -  Set dfLibelle = 'Update statistics sur la base de données ...'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update statistics on table RESULT_CDT" )
.head 5 -  Call SqlCommit( ghSqlMaj )
.head 5 -  Call SalHideWindow( dfLibelle )
.head 5 -  Call VisWaitCursor( FALSE )
.head 5 -  Call SalMessageBox( "Initialisation des résultats la base de données terminée !!" , "Msg", MB_Ok )
.head 3 +  Function: PalImportCoord2007
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsSelect
.head 5 -  Long String: lsInsert
.head 5 -  Long String: lsInsertValues
.head 5 -  Long String: lsErr
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnK
.head 5 -  String: lsNoListe
.head 5 -  String: lsNoCdt
.head 5 -  String: lsElExt
.head 5 -  Long String: llsMsg
.head 5 -  String: sErreur
.head 5 -  !
.head 5 -  Boolean: bContinue
.head 5 -  Number: lnNoElFK
.head 5 -  Number: lnNivElFK
.head 5 -  Number: lnEntiteFK
.head 5 -  String: lsLisID
.head 5 -  String: lsCdtID
.head 5 -  String: lsNomFormatF
.head 5 -  String: lsArrayColListe[*]
.head 5 -  String: lsArrayColCdt[*]
.head 5 -  String: lsNoGroupe
.head 5 -  String: lsEtat
.head 5 -  String: lsEntite
.head 5 -  !
.head 5 -  String: lsNivPrec
.head 5 -  String: lsInsPrec
.head 5 -  String: lsElPrec
.head 5 -  String: lsTypeCoPrec
.head 5 -  String: lsNiv
.head 5 -  String: lsIns
.head 5 -  String: lsEl
.head 5 -  String: lsTypeCo
.head 5 -  String: lsNom
.head 5 -  String: lsPrenom
.head 5 -  String: lsFct
.head 5 -  String: lsTel1
.head 5 -  String: lsTel2
.head 5 -  String: lsFax1
.head 5 -  String: lsFax2
.head 5 -  String: lsMail1
.head 5 -  String: lsMail2
.head 5 -  String: lsAdr
.head 5 -  String: lsCP
.head 5 -  String: lsComm
.head 5 -  String: lsTelP
.head 5 -  String: lsFaxP
.head 5 -  String: lsGsmP
.head 5 -  String: lsNN
.head 5 -  String: lsInfo
.head 5 -  String: lsSexe
.head 4 +  Actions
.head 5 -  Set bContinue = TRUE
.head 5 -  Call SalShowWindow( dfLibelle )
.head 5 -  Set dfLibelle = 'Delete des coordonnées'
.head 5 -  Call DispatchMessage(  )
.head 5 -  Call SqlPrepareAndExecute(  ghSqlMaj , "Delete from Coord_Bureau")
.head 5 -  Call SqlPrepareAndExecute(  ghSqlMaj , "Delete from Coord_Adresse")
.head 5 -  Call SqlPrepareAndExecute(  ghSqlMaj , "Delete from Coord_Contact")
.head 5 -  !
.head 5 -  ! Insertion des coordonnées
.head 5 -  ! Bureau
.head 5 +  If bContinue
.head 6 -  Set dfLibelle = 'Insert coord. bureaux 2007'
.head 6 -  Call DispatchMessage(  )
.head 6 -  Set lsInsert =  "Insert into Coord_Bureau ( CB_TYPEBUR,CB_INS,CB_ELECT ) 
Select distinct niveau,ins,elect from Coord_Adr_CEVI "
.head 6 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert )
.head 7 -  Set lsErr = "Erreur INSERT dans Coord_Bureau "
.head 7 -  Set bContinue = FALSE
.head 5 -  ! Adresse
.head 5 +  If bContinue
.head 6 -  Set dfLibelle = 'Insert coord. Adresses 2007'
.head 6 -  Call DispatchMessage(  )
.head 6 -  Set lsInsert =  "Insert into Coord_Adresse ( CA_TYPEBUR,CA_INS,CA_ELECT,CA_TYPEADR,CA_LIEU, CA_ADRESSE,CA_CP,CA_COMMUNE,CA_TEL1,CA_TEL2,
    CA_FAX1,CA_FAX2,CA_MAIL1,CA_MAIL2,CA_INFO ) 
Select niveau,ins,elect, TypeAdr, Lieu,Adresse,CP,Commune,Tel1, Tel2, Fax1, Fax2,Mail1, MAil2, INfo 
	from Coord_Adr_CEVI "
.head 6 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert )
.head 7 -  Set lsErr = "Erreur INSERT dans Coord_Bureau "
.head 7 -  Set bContinue = FALSE
.head 5 -  ! Contacts
.head 5 +  If bContinue
.head 6 -  Set dfLibelle = 'Insert coord. contacts 2007'
.head 6 -  Call DispatchMessage(  )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Select niveau,ins,elect, TypeCo, Nom,Prenom,Sexe,Fct,Tel1, Tel2, Fax1, Fax2,Mail1, MAil2,Adresse,CP,Commune,TelPrive,FaxPrive,GsmPrive,NN, INfo 
	from Coord_Co_Cevi
	Order by 1,2,3,4
	Into :lsNiv,:lsIns,:lsEl,:lsTypeCo,:lsNom,:lsPrenom,:lsSexe,:lsFct,:lsTel1,:lsTel2,:lsFax1,:lsFax2,:lsMail1,:lsMail2,:lsAdr,:lsCP,:lsComm,:lsTelP,:lsFaxP,:lsGsmP,:lsNN,:lsInfo ")
.head 6 +  While SqlFetchNext( ghSqlMain,Btmp ) and bContinue
.head 7 +  If lsNiv != lsNivPrec or lsIns != lsInsPrec or lsEl != lsElPrec or lsTypeCo != lsTypeCoPrec
.head 8 -  Set lsInsert =  "Insert into Coord_Contact
(  CC_TypeBur, CC_Ins, CC_Elect, CC_TypeCo,CC_Nom, CC_Prenom,CC_Sexe, CC_Fct, CC_Tel1, CC_Tel2,
	CC_Fax1, CC_Fax2, CC_Mail1, CC_Mail2, CC_Adr, CC_CP, CC_Commune, CC_TelPrive, CC_FaxPrive, CC_GsmPrive,
	CC_NN, CC_Info ) "
.head 8 -  Set lsInsert =  lsInsert || " 
values (:lsNiv,:lsIns,:lsEl,:lsTypeCo,:lsNom,:lsPrenom,:lsSexe, :lsFct,:lsTel1,:lsTel2,:lsFax1,:lsFax2,:lsMail1,:lsMail2,:lsAdr,:lsCP,:lsComm,:lsTelP,:lsFaxP,:lsGsmP,:lsNN,:lsInfo )"
.head 8 +  If NOT SqlPrepareAndExecute( ghSqlMaj, lsInsert  )
.head 9 -  Set lsErr = "Erreur INSERT dans Coord_Contact "
.head 9 -  Set bContinue = FALSE
.head 5 +  If NOT bContinue
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK" )
.head 6 -  Call SalMessageBox( lsErr, "ERREUR", MB_Ok )
.head 5 +  Else
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  Call SalMessageBox( 'Importation terminée ...', "Message", MB_Ok )
.head 5 -  Call SalHideWindow( dfLibelle )
.head 5 -  Return (bContinue)
.head 3 +  ! Function: PalGenereCoord
.head 4 -  Description: 
.head 4 +  Returns 
.head 5 -  Boolean: 
.head 4 -  Parameters 
.head 4 -  Static Variables 
.head 4 +  Local variables 
.head 5 -  Long String: sBuffer[*]
.head 5 -  String: sBuffer1[*]
.head 5 -  String: sBuffer2[*]
.head 5 -  Long String: sSelect
.head 5 -  String: sDate
.head 5 -  String: sHeure
.head 5 -  String: lsIns
.head 5 -  Number: lnI
.head 5 -  Number: lnJ
.head 5 -  Number: lnNoCdt
.head 5 -  Number: lnNoListe
.head 5 -  Number: lnLongTot
.head 5 -  Number: lnLong
.head 5 -  File Handle: lhFile
.head 5 -  Number: lnNbEntite
.head 4 +  Actions 
.head 5 -  ! Coord Bureaux
.head 5 -  Set sBuffer[0] = "CB_TYPEBUR#CB_INS#CB_ELECT#CB_NBBV#CB_NBBURDEP#CB_NBELECT"
.head 5 -  Set sBuffer[0] =  VisStrSubstitute( sBuffer[lnI], '#', '|' )
.head 5 -  Set lnI = 1
.head 5 -  Set lnNbEntite = 0
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select CB_TYPEBUR||'#'||CB_INS||'#'||CB_ELECT||'#'|| CB_NBBV||'#'|| CB_NBBURDEP||'#'|| CB_NBELECT
	from Coord_Bureau
	Order by CB_TYPEBUR,CB_INS,CB_ELECT
	Into :sBuffer1[lnI] ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer1[lnI], '#', '|' )
.head 6 -  Set lnI = lnI +1
.head 5 +  If SalFileOpen( lhFile, wsPathLoc3||'\\CoBur.TXT' , OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set lnJ = 0
.head 6 +  While lnJ < lnI
.head 7 -  Call SalFilePutStr( lhFile, sBuffer[lnJ] )
.head 7 -  Set lnJ = lnJ + 1
.head 6 -  Call SalFileClose( lhFile )
.head 5 -  ! Coord Adresses
.head 5 -  Set sBuffer[0] = "CA_TYPEBUR#CA_INS#CA_ELECT#CA_TYPEADR#CA_LIEU#CA_ADRESSE#CA_CP#CA_COMMUNE#CA_TEL1#CA_TEL2#CA_FAX1#CA_FAX2#CA_MAIL1#CA_MAIL2#CA_INFO"
.head 5 -  Set sBuffer[0] =  VisStrSubstitute( sBuffer[0], '#', '|' )
.head 5 -  Set lnI = 1
.head 5 -  Set lnNbEntite = 0
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select CA_TYPEBUR||'#'||CA_INS||'#'||CA_ELECT||'#'||CA_TYPEADR||'#'||CA_LIEU||'#'||CA_ADRESSE||'#'||CA_CP||'#'||CA_COMMUNE||'#'||CA_TEL1||'#'||CA_TEL2||'#',
	CA_FAX1||'#'||CA_FAX2||'#'||CA_MAIL1||'#'||CA_MAIL2||'#'||CA_INFO
	from Coord_Adresse
	Order by CA_TYPEBUR,CA_INS,CA_ELECT,CA_TYPEADR
	Into :sBuffer1[lnI], :sBuffer2[lnI] ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer1[lnI]||sBuffer2[lnI], '#', '|' )
.head 6 -  Set lnI = lnI +1
.head 5 +  If SalFileOpen( lhFile, wsPathLoc3||'\\CoAdr.TXT' , OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set lnJ = 0
.head 6 +  While lnJ < lnI
.head 7 -  Call SalFilePutStr( lhFile, sBuffer[lnJ] )
.head 7 -  Set lnJ = lnJ + 1
.head 6 -  Call SalFileClose( lhFile )
.head 5 -  ! Coord Contacts
.head 5 -  Set sBuffer[0] = "CC_TYPEBUR#CC_INS#CC_ELECT#CC_TYPECO#CC_NOM#CC_PRENOM#CC_SEXE#CC_FCT#CC_TEL1#CC_TEL2#CC_FAX1#CC_FAX2#CC_MAIL1#CC_MAIL2#CC_ADR'#'"
.head 5 -  Set sBuffer[0] = sBuffer[0] || "CC_CP#CC_COMMUNE#CC_TELPRIVE#CC_FAXPRIVE#CC_GSMPRIVE#CC_NN#CC_INFO"
.head 5 -  Set sBuffer[0] =  VisStrSubstitute( sBuffer[0], '#', '|' )
.head 5 -  Set lnI = 1
.head 5 -  Set lnNbEntite = 0
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain , "select 
CC_TYPEBUR||'#'||CC_INS||'#'||CC_ELECT||'#'||CC_TYPECO||'#'||CC_NOM||'#'||CC_PRENOM||'#'||CC_SEXE||'#'||CC_FCT||'#'||CC_TEL1||'#'||CC_TEL2||'#'||CC_FAX1||'#'||CC_FAX2||'#',
CC_MAIL1||'#'||CC_MAIL2||'#'||CC_ADR||'#'||CC_CP||'#'||CC_COMMUNE||'#'||CC_TELPRIVE||'#'||CC_FAXPRIVE||'#'||CC_GSMPRIVE||'#'||CC_NN||'#'||CC_INFO
	from Coord_Contact
	Order by CC_TYPEBUR,CC_INS,CC_ELECT,CC_TYPECO
	Into :sBuffer1[lnI], :sBuffer2[lnI]  ")
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  Set sBuffer[lnI] =  VisStrSubstitute( sBuffer1[lnI] ||sBuffer2[lnI] , '#', '|' )
.head 6 -  Set lnI = lnI +1
.head 5 +  If SalFileOpen( lhFile, wsPathLoc3||'\\CoCont.TXT' , OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set lnJ = 0
.head 6 +  While lnJ < lnI
.head 7 -  Call SalFilePutStr( lhFile, sBuffer[lnJ] )
.head 7 -  Set lnJ = lnJ + 1
.head 6 -  Call SalFileClose( lhFile )
.head 5 -  !
.head 5 -  Return TRUE
.head 3 +  Function: PalValidGroupe
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Number: nType
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  !
.head 5 +  If nType = 1
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "Update election set ele_Loc2_ValidGrp = :wnValidGrp where ele_lettre = :cmbEl ")
.head 6 -  Call SqlCommit( ghSqlMain )
.head 5 -  !
.head 5 -  !
.head 5 +  If wnValidGrp = 1
.head 6 -  Call SWTabsEnable( picTabs, 3, TRUE )
.head 6 +  If gsPhaseResult = '1' 
.head 7 -  Call SalDisableWindow( pbImportGrpOld )
.head 6 +  Else
.head 7 -  Call SalEnableWindow( pbImportGrpOld )
.head 5 +  Else
.head 6 +  If wnTabActif = 3
.head 7 -  Call SWTabsPrev( picTabs )
.head 6 -  Call SWTabsEnable( picTabs, 3, FALSE )
.head 5 +  If gsPhaseResult = '1' or wnValidGrp = 1
.head 6 -  Call SalDisableWindow( pbAddGrp )
.head 6 -  Call SalDisableWindow( pbDeleteGrp )
.head 6 -  Call SalDisableWindow( dfSigleGrp )
.head 6 -  Call SalDisableWindow( pbValidGrp )
.head 5 +  Else
.head 6 -  Call SalEnableWindow( pbAddGrp )
.head 6 -  Call SalEnableWindow( pbDeleteGrp )
.head 6 -  Call SalEnableWindow( dfSigleGrp )
.head 6 -  Call SalEnableWindow( pbValidGrp )
.head 5 +  If gsPhaseResult = '1' 
.head 6 -  Call SalDisableWindow( tblGrpOld.colSel )
.head 6 -  Call SalDisableWindow( pbGenereTbl )
.head 6 -  Call SalEnableWindow( pbGenere )
.head 5 +  Else
.head 6 -  Call SalEnableWindow( tblGrpOld.colSel )
.head 6 -  Call SalDisableWindow( pbGenere )
.head 6 -  Call SalEnableWindow( pbGenereTbl )
.head 3 +  Function: PalEditGroupes
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsLettre
.head 5 -  String: lsSelect
.head 5 -  String: sNomEnt
.head 5 -  String: sId
.head 5 -  String: sIns
.head 5 -  Number: nIdGrp
.head 5 -  String: sNomGrp
.head 5 -  String: sNomGrpOld
.head 5 -  String: sNoIdGrpOld
.head 5 -  Boolean: bAssocie
.head 4 +  Actions
.head 5 -  Call SalTblReset (tblEditGroupe )
.head 5 -  Set lsSelect = "Select ENT_NOM_FF, ENT_ID, ENT_INS
	from entite
	where ent_ins is not null  "
.head 5 +  If cmbEl != ''
.head 6 +  If cmbEl = 'CK' or cmbEl = 'WL' or cmbEl = 'VL' 
.head 7 -  Set lsLettre = 'C'
.head 6 +  Else If cmbEl = 'DE'
.head 7 -  Set lsLettre = 'G'
.head 6 +  Else If cmbEl = 'BR'
.head 7 -  Set lsLettre = 'R'
.head 6 +  Else If cmbEl = 'SE' or cmbEl = 'EU'
.head 7 -  Set lsLettre = 'L'
.head 6 -  Set lsSelect = lsSelect || " AND ENT_ELE_EXT = :cmbEl  and ENT_NIV_LETTRE = :lsLettre "
.head 5 -  Set lsSelect = lsSelect || "
Order by 3,1 
Into :sNomEnt,:sId, :sIns  "
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, lsSelect )
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 -  ! Groupes associés avec ancienne élection
.head 6 -  Set lsSelect = "Select GRL_NOM, GRL_id  from groupe_listes, Listes
	where Lis_GRL_Fk = Grl_id and LIS_InsBur = :sIns and LIS_ELE_EXT = :cmbEl
	order by 1, 2
	Into :sNomGrp, :nIdGrp "
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, lsSelect )
.head 6 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  If cbDocTravStesud
.head 8 -  Set sNomGrp = sNomGrp || "  - [" || SalNumberToStrX( nIdGrp, 0 ) ||"]"
.head 7 -  Set bAssocie = FALSE
.head 7 -  Set lsSelect = "Select Grp_Sigle, B.Grp_No from grp_corresp A, grp_old B where A.grp_noOld = B.grp_no and A.grp_no = :nIdGrp and A.GRP_EL = :cmbEl and A.grp_el=B.Grp_El
	order by B.Grp_No
	Into :sNomGrpOld , :sNoIdGrpOld "
.head 7 -  Call SqlPrepareAndExecute( ghSqlMaj, lsSelect )
.head 7 +  While SqlFetchNext( ghSqlMaj, Btmp )
.head 8 -  Set bAssocie = TRUE
.head 8 +  If cbDocTravStesud
.head 9 -  Set sNomGrpOld = sNomGrpOld || "  - [" || sNoIdGrpOld ||"]"
.head 8 -  Call PalInsertRowTblGrp( sIns, sNomEnt , sNomGrp, sNomGrpOld )
.head 7 +  If NOT bAssocie
.head 8 -  Call PalInsertRowTblGrp( sIns, sNomEnt , sNomGrp, '-' )
.head 6 -  ! Groupes NON associés avec ancienne élection
.head 6 +  If cbGroupeEntite
.head 7 -  Set lsSelect = "Select distinct Sigle, LIEU_GRPNO  from lieu_old where LIEU_EL = :cmbEl and
	Lieu_GrpNo NOT IN (Select Grp_noOLD from grp_corresp where grp_el= :cmbEl and grp_no in (Select  GRL_id  from groupe_listes, Listes
									where Lis_GRL_Fk = Grl_id  and GRL_EL = :cmbEl and GRL_EL = LIS_ELE_EXT ) ) 
	order by LIEU_GRPNO
	Into :sNomGrpOld , :sNoIdGrpOld "
.head 6 +  Else
.head 7 -  Set lsSelect = "Select Sigle, LIEU_GRPNO  from lieu_old where lieu_ins = :sIns and LIEU_EL = :cmbEl and
	Lieu_GrpNo NOT IN (Select Grp_noOLD from grp_corresp where grp_el= :cmbEl and grp_no in (Select  GRL_id  from groupe_listes, Listes
									where Lis_GRL_Fk = Grl_id  and Lis_insBur = :sIns and GRL_EL = :cmbEl and GRL_EL = LIS_ELE_EXT ) ) 
	order by LIEU_GRPNO
	Into :sNomGrpOld , :sNoIdGrpOld "
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, lsSelect )
.head 6 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  If cbDocTravStesud
.head 8 -  Set sNomGrpOld = sNomGrpOld || "  - [" || sNoIdGrpOld ||"]"
.head 7 -  Call PalInsertRowTblGrp( sIns, sNomEnt , '-', sNomGrpOld )
.head 5 -  !
.head 5 +  If SalTblAnyRows( tblEditGroupe, 0,0 )
.head 6 -  Set gnError = NUMBER_Null
.head 6 +  If cbGroupeEntite
.head 7 -  Call SalTblSortRows( tblEditGroupe, 6, TBL_SortIncreasing)
.head 7 -  Call SalReportTableView( tblEditGroupe, hWndNULL, gsPathApplic ||"\\Report\\GRP_ENTITE.QRP" , gnError )
.head 6 +  Else
.head 7 -  Call SalReportTableView( tblEditGroupe, hWndNULL, gsPathApplic ||"\\Report\\GRP.QRP" , gnError )
.head 3 +  Function: PalInsertRowTblGrp
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sIns
.head 5 -  String: sEntite
.head 5 -  String: sGroupe
.head 5 -  String: sOldGrp
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nRow
.head 4 +  Actions
.head 5 -  Set nRow = SalTblInsertRow( tblEditGroupe, TBL_MaxRow )
.head 5 -  Call SalTblSetContext( tblEditGroupe, nRow )
.head 5 -  Set tblEditGroupe.colElect = cmbEl
.head 5 -  Set tblEditGroupe.colEntite = sEntite
.head 5 -  Set tblEditGroupe.colIns = sIns
.head 5 -  Set tblEditGroupe.colGrp = sGroupe
.head 5 -  Set tblEditGroupe.colGrpOld = sOldGrp
.head 5 +  If sGroupe = '-'
.head 6 -  Set tblEditGroupe.colGrpTri = 'ZZZZZZZZZZZZ_' || sOldGrp
.head 5 +  Else
.head 6 -  Set tblEditGroupe.colGrpTri = sGroupe
.head 3 +  Function: PalInitDateFormatR
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sEl
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: lsTmp
.head 5 -  Number: nI
.head 4 +  Actions
.head 5 -  Call PalSetApplParm( "DATE_LOC2_DF", "1900-01-01-08.00.00" )
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "update appl_parm set value = '1900-01-01' where name = 'RESULT' " )
.head 5 -  ! Call SqlPrepareAndExecute( ghSqlMain, "update Election set ELE_D_RESULT = '1900-01-01' where ELE_LETTRE in ('"|| VisStrSubstitute(gsGestionElectionType, ",", "','") ||"')" )
.head 5 +  If sEl = "ALL"
.head 6 -  Call SalListSetSelect( cmbEl, 0 )
.head 6 -  Set sEl = cmbEl
.head 6 -  Set nI = 0
.head 5 +  Else
.head 6 -  Set nI = -9
.head 5 +  While sEl != ''
.head 6 -  Call SqlPrepareAndExecute( ghSqlMain, "update Result_Scrutin set DATE_HEURE_MAJ = NULL where RES_ELE_EXT = :sEl ")
.head 6 -  Call SqlCommit( ghSqlMain )
.head 6 -  Call VisFileDelete( frmLOC2.wsPathResult||"\\*."|| sEl )
.head 6 +  If nI = -9
.head 7 -  Break
.head 6 +  Else
.head 7 -  Set nI = nI + 1
.head 7 +  If SalListSetSelect( cmbEl, nI )
.head 8 -  Set sEl = cmbEl
.head 7 +  Else
.head 8 -  Set sEl = ""
.head 5 -  Call PalGetApplParm( "DATE_LOC2_DF", lsTmp )
.head 5 -  Call SalMessageBox( "Mise à jour de la date OK", "Message", MB_Ok )
.head 3 -  !
.head 3 +  Function: PalMoveRowUp
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Window Handle: hWndTble
.head 5 -  Window Handle: hWndCol
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nRowDelete
.head 5 -  String: lsNoLiOld
.head 5 -  String: lsNoLiNew
.head 5 -  Number: nCurrentRow
.head 5 -  String: lsCdt[100]
.head 5 -  Number: lnI
.head 5 -  Number: lnTri
.head 4 +  Actions
.head 5 +  If SalTblAnyRows(hWndTble,ROW_Selected,0)
.head 6 -  Call SalGetWindowText(hWndCol,lsNoLiOld,254)
.head 6 -  Set nCurrentRow= SalTblQueryContext( hWndTble )
.head 6 -  Call SalTblSetContext( hWndTble,nCurrentRow-1 )
.head 6 -  Call SalGetWindowText(hWndCol,lsNoLiNew,254)
.head 6 -  Call SalSetWindowText(hWndCol,lsNoLiOld)
.head 6 -  Set lnTri = SalStrToNumber( lsNoLiOld )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update groupe_listes Set grL_Tri = :lnTri where GRL_EL= :cmbEl and  grl_Id = :tblGroupe.colNo ")
.head 6 -  Call SalTblSetContext( hWndTble,nCurrentRow )
.head 6 -  Call SalSetWindowText(hWndCol,lsNoLiNew)
.head 6 -  Set lnTri = SalStrToNumber( lsNoLiNew )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update groupe_listes Set grL_Tri = :lnTri where GRL_EL= :cmbEl and  grl_Id = :tblGroupe.colNo ")
.head 6 -  Call SalTblSortRows( hWndTble, SalTblQueryColumnPos ( hWndCol ), 1 )
.head 6 -  Call SalTblSetFocusRow(hWndTble,nCurrentRow-1 )
.head 6 -  Call SalTblSetContext(hWndTble,nCurrentRow-1 )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  !
.head 6 -  !
.head 3 +  Function: PalMoveRowDown
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  Window Handle: hWndTble
.head 5 -  Window Handle: hWndCol
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nRowDelete
.head 5 -  String: lsNoLiOld
.head 5 -  String: lsNoLiNew
.head 5 -  Number: nCurrentRow
.head 5 -  String: lsCdt[100]
.head 5 -  Number: lnI
.head 5 -  Number: lnTri
.head 4 +  Actions
.head 5 +  If SalTblAnyRows(hWndTble,ROW_Selected,0)
.head 6 -  Call SalGetWindowText(hWndCol,lsNoLiOld,254)
.head 6 -  Set nCurrentRow= SalTblQueryContext( hWndTble )
.head 6 -  Call SalTblSetContext( hWndTble,nCurrentRow+1 )
.head 6 -  Call SalGetWindowText(hWndCol,lsNoLiNew,254)
.head 6 -  Call SalSetWindowText(hWndCol,lsNoLiOld)
.head 6 -  Set lnTri = SalStrToNumber( lsNoLiOld )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update groupe_listes Set grL_Tri = :lnTri where GRL_EL= :cmbEl and  grl_Id = :tblGroupe.colNo ")
.head 6 -  Call SalTblSetContext( hWndTble,nCurrentRow )
.head 6 -  Call SalSetWindowText(hWndCol,lsNoLiNew)
.head 6 -  Set lnTri = SalStrToNumber( lsNoLiNew )
.head 6 -  Call SqlPrepareAndExecute( ghSqlMaj, "Update groupe_listes Set grL_Tri = :lnTri where GRL_EL= :cmbEl and  grl_Id = :tblGroupe.colNo ")
.head 6 -  Call SalTblSortRows( hWndTble, SalTblQueryColumnPos ( hWndCol ), 1 )
.head 6 -  Call SalTblSetFocusRow(hWndTble,nCurrentRow+1 )
.head 6 -  Call SalTblSetContext(hWndTble,nCurrentRow+1 )
.head 6 -  Call SqlCommit( ghSqlMaj )
.head 6 -  !
.head 3 -  !
.head 3 +  ! Function: PalDtmBureauDep
.head 4 -  Description: 
.head 4 -  Returns 
.head 4 -  Parameters 
.head 4 -  Static Variables 
.head 4 -  Local variables 
.head 4 +  Actions 
.head 5 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1) )
	from Result_scrutin
	where RES_ELE_EXT = :cmbEl_Siege
	into  :dfBurDep_Siege, :dfBurTot_Siege  ")
.head 5 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 5 -  Set dfSitDep_Siege = dfBurDep_Siege / dfBurTot_Siege
.head 3 +  Function: PalDtmBureauDep
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 -  Local variables
.head 4 +  Actions
.head 5 -  ! Bureaux
.head 5 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select sum(@nullvalue(RES_BDEP_TRAIT,0)) , sum(@nullvalue(RES_BDEP_TOT,1) )
	from Result_scrutin
	where RES_ELE_EXT = :cmbEl
	into  :dfBurDep_Siege, :dfBurTot_Siege  ")
.head 5 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 5 +  If dfBurTot_Siege != NUMBER_Null and dfBurTot_Siege >0
.head 6 -  Set dfSitDep_Siege = dfBurDep_Siege / dfBurTot_Siege
.head 5 -  ! Cantons
.head 5 -  Call SqlPrepareAndExecute( ghSqlSecondaire, " select count(*) , sum( @nullvalue( RES_SIT_DEP, 0) ) from result_scrutin
	where RES_ELE_EXT = :cmbEl and RES_NIV_LETTRE = 'K'
	into  :dfCantonTot_Siege, :dfCantComplet_Siege  ")
.head 5 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 5 +  If dfCantonTot_Siege != NUMBER_Null and dfCantonTot_Siege >0
.head 6 -  Set dfSitK_Siege = dfCantComplet_Siege / dfCantonTot_Siege
.head 5 -  ! Sieges
.head 5 +  If cmbEl = 'CK' or cmbEl = 'WL' or cmbEl = 'VL'
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select sum(@nullvalue(ENT_NB_CDT_MAX,0))
	from entite
	where ent_ele_ext = :cmbEl and ENT_NIV_LETTRE = 'C'
	into  :dfTot_Siege  ")
.head 6 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 5 +  Else If cmbEl = 'DE'
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select sum(@nullvalue(ENT_NB_CDT_MAX,0))
	from entite
	where ent_ele_ext = :cmbEl and ENT_NIV_LETTRE = 'G'
	into  :dfTot_Siege  ")
.head 6 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 5 +  Else If cmbEl = 'BR'
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select sum(@nullvalue(ENT_NB_CDT_MAX,0))+17
	from entite
	where ent_ele_ext = :cmbEl and ENT_NIV_LETTRE = 'R'
	into  :dfTot_Siege  ")
.head 6 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 5 +  Else If cmbEl = 'SE' or cmbEl = 'EU'
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select sum(@nullvalue(ENT_NB_CDT_MAX,0))
	from entite
	where ent_ele_ext = :cmbEl and ENT_NIV_LETTRE = 'L'
	into  :dfTot_Siege  ")
.head 6 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 5 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select sum(@nullvalue(elu_sieges,0))
	from result_elu_royaume
	where elu_elect = :cmbEl 
	into  :dfDistribue_Siege  ")
.head 5 -  Call SqlFetchNext( ghSqlSecondaire, Btmp )
.head 5 +  If dfTot_Siege > 0
.head 6 -  Set dfSitS_Siege = dfDistribue_Siege / dfTot_Siege
.head 3 +  Function: PalChargeBureau
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nRow
.head 5 -  Number: lnBV
.head 5 -  Number: lnBD
.head 4 +  Actions
.head 5 -  Set nRow = -1
.head 5 +  While SalTblFindNextRow( tblEntite_BVD, nRow, 0,0 )
.head 6 -  Call SalTblSetContext( tblEntite_BVD, nRow )
.head 6 -  Call SalTblSetFocusRow( tblEntite_BVD, nRow )
.head 6 -  !
.head 6 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Select CB_NBBV,CB_NBBURDEP
	from entite, Coord_Bureau
	where Ent_ins = :tblEntite_BVD.colIns and ent_ins =CB_ins and ENT_NIV_LETTRE = 'K' and ENT_NIV_LETTRE = CB_TYPEBUR and ENT_ELE_EXT = CB_ELECT and ENT_ELE_Ext = :cmbEl_Rapport
	into :lnBV, :lnBD " )
.head 6 +  If SqlFetchNext( ghSqlSecondaire, Btmp )
.head 7 +  If tblEntite_BVD.colTypeVote != ''
.head 8 -  Set lnBD = 1
.head 7 -  Set tblEntite_BVD.colNbBVote = lnBV
.head 7 -  Set tblEntite_BVD.colNbBDep = lnBD
.head 7 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Coord_Bureau set CB_NBBV= :tblEntite_BVD.colNbBVote,CB_NBBURDEP= :tblEntite_BVD.colNbBDep
	where CB_ins = :tblEntite_BVD.colIns and CB_TYPEBUR = 'K'  and CB_ELECT =:cmbEl " )
.head 8 +  If tblEntite_BVD.colTypeVote != ''
.head 9 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Entite set ENT_BURDEP_TOT = :tblEntite_BVD.colNbBVote
	where ent_ins = :tblEntite_BVD.colIns and ent_niv_lettre = 'K' and ENT_ELE_EXT =:cmbEl  " )
.head 10 -  Call SqlCommit( ghSqlMain )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK")
.head 10 -  Call SalMessageBox( "Erreur dans la mise à jour", "ERREUR", MB_Ok )
.head 8 +  Else
.head 9 +  If SqlPrepareAndExecute( ghSqlMaj, "Update Entite set ENT_BURDEP_TOT = :tblEntite_BVD.colNbBDep
	where ent_ins = :tblEntite_BVD.colIns and ent_niv_lettre = 'K' and ENT_ELE_EXT =:cmbEl   " )
.head 10 -  Call SqlCommit( ghSqlMain )
.head 9 +  Else
.head 10 -  Call SqlPrepareAndExecute( ghSqlMaj, "ROLLBACK")
.head 10 -  Call SalMessageBox( "Erreur dans la mise à jour", "ERREUR", MB_Ok )
.head 3 -  !
.head 3 +  Function: PalVerifEnsembleCandidature
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nI
.head 5 -  Number: nRow
.head 4 +  Actions
.head 5 -  Call SalShowWindow( dfLibelle )
.head 5 -  Set nI = 0
.head 5 +  While TRUE
.head 6 +  If SalListSetSelect( cmbEl, nI ) = 0
.head 7 -  Break
.head 6 -  Call SalSendMsg( cmbEl , SAM_Click, 0,0 )
.head 6 -  Set nRow = -1
.head 6 +  While SalTblFindNextRow( tblEntite, nRow, 0, 0 )
.head 7 -  Set dfLibelle = cmbEl || " - " || tblEntite.colNiv || tblEntite.colIns || " - " || tblEntite.colEntite 
.head 7 -  Call DispatchMessage(  )
.head 7 -  Call SalTblSetContext( tblEntite, nRow )
.head 7 -  Call SalTblSetFocusRow (tblEntite, nRow )
.head 7 -  Call frmLOC2.PalCtrlDoubleCandidature( tblEntite.colIns, SalStrToNumber( tblEntite.colId ), 'M' || tblEntite.colNiv || tblEntite.colIns ||"."|| tblEntite.colEl )
.head 6 -  Set nI = nI + 1
.head 5 -  Call SalHideWindow( dfLibelle )
.head 3 +  Function: PalExportGrp
.head 4 -  Description:
.head 4 -  Returns
.head 4 +  Parameters
.head 5 -  String: sEl_in
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 5 -  File Handle: hFile2
.head 5 -  String: sId
.head 5 -  String: sNom
.head 5 -  String: sEl
.head 5 -  String: sIns
.head 5 -  String: sBuffer
.head 4 +  Actions
.head 5 +  If NOT SalIsWindowEnabled( pbValidGrp )
.head 6 +  If SalFileOpen( hFile, gsPathExport || sEl_in || "_GrpOld.TXT" ,OF_Create | OF_ReadWrite | OF_Text )
.head 7 +  If SalFileOpen( hFile2, gsPathExport || sEl_in || "_LieuOld.TXT" ,OF_Create | OF_ReadWrite | OF_Text )
.head 8 -  Call SqlPrepareAndExecute( ghSqlMain , "Select Grl_Id, Grl_Nom, Grl_EL from Groupe_Listes where GRL_EL = :sEl_in
	into :sId, :sNom, :sEl ") 
.head 8 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 9 -  Set sBuffer = sId ||"|"|| sNom ||"|"|| sEl
.head 9 -  Call SalFilePutStr( hFile, sBuffer )
.head 9 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "select LIS_InsBur, LIS_SIGLE
	from Listes 
	Where Lis_GRL_Fk = :sId and Lis_Ele_Ext =:sEl_in
	order by 1,Lis_No
	Into :sIns,  :sNom" )
.head 9 +  While SqlFetchNext( ghSqlSecondaire, Btmp )
.head 10 -  Set sBuffer = sIns ||"|"|| sEl ||"|"|| sNom ||"|"|| sId
.head 10 -  Call SalFilePutStr( hFile2, sBuffer )
.head 8 -  Call SalFileClose( hFile2 )
.head 8 -  Call SalMessageBox("Création terminée dans " || gsPathExport, "Message", MB_Ok  )
.head 7 +  Else
.head 8 -  Call SalMessageBox("Impossible de créer " || gsPathExport || sEl_in || "_LieuOld.TXT", "Message", MB_Ok | MB_IconExclamation )
.head 7 -  Call SalFileClose( hFile )
.head 6 +  Else
.head 7 -  Call SalMessageBox("Impossible de créer " || gsPathExport || sEl_in || "_GrpOld.TXT", "Message", MB_Ok | MB_IconExclamation )
.head 5 +  Else
.head 6 -  Call SalMessageBox("Pour exporter les groupes d'une élection, il faut que ceux-ci soient validés !!", "Message", MB_Ok | MB_IconExclamation )
.head 3 +  Function: PalImportGrpOld
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sEl_in
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 5 -  File Handle: hFile2
.head 5 -  Boolean: bOk
.head 5 -  String: sId
.head 5 -  String: sNom
.head 5 -  String: sEl
.head 5 -  String: sIns
.head 5 -  String: sBuffer
.head 5 -  Number: nIndex
.head 5 -  String: strFilters[*]
.head 5 -  String: strFileName
.head 5 -  String: strPathFileName
.head 5 -  String: strFileName2
.head 5 -  String: strPathFileName2
.head 4 +  Actions
.head 5 -  Set bOk = TRUE
.head 5 -  Set strFilters[0] = 'TXT Files'
.head 5 -  Set strFilters[1] = sEl_in || '_GrpOld.TXT'
.head 5 -  Set nIndex = 1
.head 5 +  If SalDlgOpenFile( hWndForm, 'TXT File', strFilters, 2, nIndex, strFileName, strPathFileName )
.head 6 +  If SalFileOpen( hFile, strPathFileName ,OF_Read | OF_Text )
.head 7 -  Set strPathFileName2 = VisStrSubstitute( strPathFileName, strFileName, sEl_in || "_LieuOld.TXT") 
.head 7 +  If NOT SalFileOpen( hFile2, strPathFileName2  , OF_Exist )
.head 8 -  Set strFilters[0] = 'TXT Files'
.head 8 -  Set strFilters[1] = sEl_in || '_LieuOld.TXT'
.head 8 -  Set nIndex = 1
.head 8 +  If NOT SalDlgOpenFile( hWndForm, 'TXT File', strFilters, 2, nIndex, strFileName2, strPathFileName2 )
.head 9 -  Call SalFileClose( hFile )
.head 9 -  Set bOk = FALSE
.head 9 -  Call SalMessageBox("Fichier non trouvé !!", "Message", MB_Ok | MB_IconExclamation )
.head 9 -  Return FALSE
.head 7 +  If SalFileOpen( hFile2, strPathFileName2 , OF_Read | OF_Text  )
.head 8 -  !
.head 8 +  If SalMessageBox( "Désirez-vous supprimer toutes les associations antérieures (pour toutes les élections !!) ?", "Question", MB_YesNo | MB_IconQuestion | MB_DefButton2 ) = IDYES
.head 9 +  If NOT SqlPrepareAndExecute( ghSqlSecondaire, "Delete from grp_corresp   " )
.head 10 -  Set bOk = FALSE
.head 8 +  If bOk and NOT SqlPrepareAndExecute( ghSqlSecondaire, "Delete from GRP_OLD  where GRP_EL = :sEl_in " )
.head 9 -  Set bOk = FALSE
.head 8 +  If bOk and NOT SqlPrepareAndExecute( ghSqlSecondaire, "Delete from LIEU_OLD  where LIEU_EL = :sEl_in " )
.head 9 -  Set bOk = FALSE
.head 8 +  If bOk
.head 9 +  While SalFileGetStr( hFile, sBuffer,  250 ) and bOk
.head 10 +  If sBuffer != ''
.head 11 -  Set nIndex = SalStrTokenize( sBuffer, '', '|', strFilters )
.head 11 +  If nIndex = 3
.head 12 +  If NOT SqlPrepareAndExecute( ghSqlSecondaire, "Insert into GRP_OLD ( GRP_NO,GRP_SIGLE,GRP_EL )
	values ( :strFilters[0], :strFilters[1], :strFilters[2] ) " )
.head 13 -  Set bOk = FALSE
.head 11 +  Else
.head 12 -  Set bOk = FALSE
.head 12 -  Call SalMessageBox("Erreur dans le fichier:  " || strPathFileName, "Message", MB_Ok | MB_IconExclamation )
.head 8 +  If bOk
.head 9 +  While SalFileGetStr( hFile2, sBuffer,  250 ) and bOk
.head 10 +  If sBuffer != ''
.head 11 -  Set nIndex = SalStrTokenize( sBuffer, '', '|', strFilters )
.head 11 +  If nIndex = 4
.head 12 +  If NOT SqlPrepareAndExecute( ghSqlSecondaire, "Insert into LIEU_OLD (LIEU_INS,LIEU_EL,SIGLE,LIEU_GRPNO )
	values ( :strFilters[0], :strFilters[1], :strFilters[2], :strFilters[3] ) " )
.head 13 -  Set bOk = FALSE
.head 11 +  Else
.head 12 -  Set bOk = FALSE
.head 12 -  Call SalMessageBox("Erreur dans le fichier:  " || strPathFileName2 , "Message", MB_Ok | MB_IconExclamation )
.head 8 -  !
.head 8 -  Call SalFileClose( hFile2 )
.head 7 +  Else
.head 8 -  Set bOk = FALSE
.head 8 -  Call SalMessageBox("Impossible de lire " || strPathFileName, "Message", MB_Ok | MB_IconExclamation )
.head 7 -  Call SalFileClose( hFile )
.head 6 +  Else
.head 7 -  Call SalMessageBox("Impossible de lire " || strPathFileName, "Message", MB_Ok | MB_IconExclamation )
.head 7 -  Set bOk = FALSE
.head 6 +  If bOk 
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Rollback" )
.head 6 -  Return bOk
.head 3 +  Function: PalImport_IE_Inscrits
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sEl_in
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 5 -  File Handle: hFile2
.head 5 -  Boolean: bOk
.head 5 -  String: sId
.head 5 -  String: sNom
.head 5 -  String: sEl
.head 5 -  String: sIns
.head 5 -  String: sBuffer
.head 5 -  Number: nIndex
.head 5 -  String: strFilters[*]
.head 5 -  String: strFileName
.head 5 -  String: strPathFileName
.head 5 -  String: strFileName2
.head 5 -  String: strPathFileName2
.head 5 -  String: sBureauDep
.head 5 -  String: sBureauVote
.head 4 +  Actions
.head 5 -  Set bOk = TRUE
.head 5 -  Set strFilters[0] = 'TXT Files'
.head 5 -  Set strFilters[1] = 'IE.'|| sEl_in 
.head 5 -  Set nIndex = 1
.head 5 +  If SalDlgOpenFile( hWndForm, 'TXT File', strFilters, 2, nIndex, strFileName, strPathFileName )
.head 6 +  If SalFileOpen( hFile, strPathFileName ,OF_Read | OF_Text )
.head 7 +  If SalMessageBox( "Désirez-vous importer les inscrits pour cette élection à partir du fichier sélectionné ?", "Question", MB_YesNo | MB_IconQuestion | MB_DefButton2 ) = IDYES
.head 8 -  Set bOk = TRUE
.head 8 +  While SalFileGetStr( hFile, sBuffer,  250 ) and bOk
.head 9 +  If sBuffer != ''
.head 10 -  Set nIndex = 0
.head 10 +  While nIndex <=20
.head 11 -  Set strFilters[nIndex] = ''
.head 11 -  Set nIndex = nIndex + 1
.head 10 -  Set nIndex = PalStrTokenize( sBuffer,  strFilters )
.head 10 +  If strFilters[0] ='E' and strFilters[2] = 'K' and strFilters[3] = sEl_in
.head 11 +  If NOT SqlPrepareAndExecute( ghSqlSecondaire, "Update ENTITE set
		ENT_INSCRITS_BB=" || strFilters[8] ||", ENT_INSCRITS_E1_E2=" || strFilters[9] ||", 
		ENT_INSCRITS_E3_E4=" || strFilters[10] ||", ENT_INSCRITS_E5=" || strFilters[11] ||",
		ENT_BURDEP_TOT = "|| strFilters[12] ||"
	where ENT_ID = " || strFilters[1]  )
.head 12 -  Set bOk = FALSE
.head 11 +  If strFilters[14] = ''
.head 12 -  Set sBureauDep = strFilters[12]
.head 12 -  Set sBureauVote = 'null'
.head 11 +  Else
.head 12 -  Set sBureauDep = '1'
.head 12 -  Set sBureauVote = strFilters[12]
.head 11 +  If NOT SqlPrepareAndExecute( ghSqlSecondaire, "Update COORD_BUREAU set
		CB_NBBV = "|| sBureauVote || ", CB_NBBURDEP = "|| sBureauDep ||"
	where CB_TYPEBUR = '" || strFilters[2] ||"' and  CB_INS = '"|| strFilters[4] || "' and CB_ELECT = '"|| strFilters[3] || "' "  )
.head 12 -  Set bOk = FALSE
.head 7 -  Call SalFileClose( hFile )
.head 6 +  Else
.head 7 -  Call SalMessageBox("Impossible de lire " || strPathFileName, "Message", MB_Ok | MB_IconExclamation )
.head 7 -  Set bOk = FALSE
.head 6 +  If bOk 
.head 7 -  Call SqlCommit( ghSqlSecondaire )
.head 6 +  Else
.head 7 -  Call SqlPrepareAndExecute( ghSqlSecondaire, "Rollback" )
.head 6 -  Return bOk
.head 3 +  Function: PalStrTokenize
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Number:
.head 4 +  Parameters
.head 5 -  String: psLine
.head 5 -  Receive String: psLineTokens[*]
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: lnCount
.head 5 -  Number: lnNumberOfChar
.head 5 -  Number: lnCountToken
.head 5 -  String: wsLeftChar
.head 4 +  Actions
.head 5 -  Set lnNumberOfChar = SalStrLength( psLine )
.head 5 +  While lnCount <  lnNumberOfChar
.head 6 -  Set wsLeftChar = SalStrLeftX( psLine, 1 )
.head 6 +  If wsLeftChar = '"'
.head 7 -  Set psLine = SalStrRightX( psLine, SalStrLength( psLine ) - 1 )
.head 7 -  Set wsLeftChar = SalStrLeftX( psLine, 1 )
.head 7 -  !
.head 7 +  While wsLeftChar != '"' and  lnCount <  lnNumberOfChar
.head 8 -  Set psLineTokens[ lnCountToken ] = psLineTokens[ lnCountToken ] || wsLeftChar
.head 8 -  Set psLine = SalStrRightX( psLine, SalStrLength( psLine ) - 1 )
.head 8 -  Set wsLeftChar = SalStrLeftX( psLine, 1 )
.head 8 -  Set lnCount = lnCount + 1
.head 7 -  !
.head 7 +  If SalStrLength( psLine ) > 0
.head 8 -  Set psLine = SalStrRightX( psLine, SalStrLength( psLine ) - 1 )
.head 8 -  Set wsLeftChar = SalStrLeftX( psLine, 1 )
.head 8 +  If SalStrLength( psLine ) > 0
.head 9 -  !
.head 9 +  If wsLeftChar =','
.head 10 -  Set psLine = SalStrRightX( psLine, SalStrLength( psLine ) - 1 )
.head 10 -  Set wsLeftChar = SalStrLeftX( psLine, 1 )
.head 9 +  Else
.head 10 -  ! Erreur
.head 10 -  Return ( FALSE)
.head 8 -  Set lnCountToken = lnCountToken + 1
.head 7 +  Else
.head 8 -  ! Erreur
.head 8 -  Return ( FALSE)
.head 6 +  Else
.head 7 +  If lnCount= 0
.head 8 -  ! Erreur
.head 8 -  Return ( FALSE)
.head 7 -  Set psLine = SalStrRightX( psLine, SalStrLength( psLine ) - 1 )
.head 6 -  Set lnCount = lnCount + 1
.head 5 -  Return (lnCountToken)
.head 3 -  !
.head 3 +  Function: PalDtmCdtEU
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: lnNbEU
.head 5 -  String: lsIns
.head 5 -  String: lsCollegeF
.head 5 -  String: lsCollegeN
.head 5 -  String: lsNoListe
.head 5 -  String: lsSigleListe
.head 5 -  String: lsNoCdt
.head 5 -  String: lsTypeCdt
.head 5 -  String: lsNomCdt
.head 5 -  String: lsPrenomCdt
.head 5 -  String: lsConnuCommeCdt
.head 5 -  String: lsSexe
.head 5 -  String: lsAdresse
.head 5 -  String: lsCP
.head 5 -  String: lsLocalite
.head 5 -  String: lsDateNais
.head 5 -  Long String: sBuffer
.head 5 -  File Handle: hFile
.head 5 -  Number: lnI
.head 4 +  Actions
.head 5 -  Set lnNbEU = 0
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "Select count(*)
from candidats, Listes , Entite
where cdt_lis_FK = lis_Id and LIS_ENT_FK = ent_id and cdt_ent_fk = ent_id and cdt_ele_ext = 'EU' and @Left(@right(CDT_NN,5),3) in ('998','999')
 into :lnNbEU " )
.head 5 -  Call SqlFetchNext( ghSqlMain, Btmp )
.head 5 +  If lnNbEU > 0
.head 6 +  If SalFileOpen( hFile, gsPathApplic ||"\\CDT_EU.TXT", OF_Create | OF_Text | OF_ReadWrite )
.head 7 -  Set sBuffer = "Candidats de nationalité étrangère figurant sur des listes belges pour l'élection du Parlement européen:" 
.head 7 -  Set sBuffer = SalStrRepeatX ('=' , SalStrLength( sBuffer )) ||"
" || sBuffer || "
" || SalStrRepeatX ('=' , SalStrLength( sBuffer )) ||"

" 
.head 7 -  Call SalFilePutStr( hFile, sBuffer )
.head 7 -  Set lnI = 1
.head 7 -  Call SqlPrepareAndExecute( ghSqlMain, "Select CDT_INSBUR, ent_nom_FF, ent_NOM_NN ,LIS_NO, LIS_SIGLE,CDT_NO,CDT_TYPECDT,
	CDT_NOM, CDT_PRENOM,CDT_CONNUCOMME,CDT_SEXE,CDT_ADRESSE,
	CDT_CP,CDT_LOCALITE, CDT_DATNAIS
from candidats, Listes , Entite
where cdt_lis_FK = lis_Id and LIS_ENT_FK = ent_id and cdt_ent_fk = ent_id and cdt_ele_ext = 'EU' and @Left(@right(CDT_NN,5),3) in ('998','999')
order by 1, 4, 7, 6
into :lsIns, :lsCollegeF, :lsCollegeN, :lsNoListe, :lsSigleListe, :lsNoCdt, :lsTypeCdt,
	:lsNomCdt, :lsPrenomCdt, :lsConnuCommeCdt, :lsSexe, :lsAdresse,
	:lsCP, :lsLocalite, :lsDateNais " )
.head 7 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 8 -  Set sBuffer = SalStrRightX('   ' || SalNumberToStrX(lnI,0) ,3) ||". " ||  lsNomCdt || ' ' || lsPrenomCdt || "  -  " || lsDateNais ||"
        " || lsAdresse || " - " || lsCP || " " || lsLocalite ||"   (Liste " || lsSigleListe ||")
        " || lsIns || " - " || lsCollegeF ||"
"   
.head 8 -  Call SalFilePutStr( hFile, sBuffer )
.head 8 -  Set lnI = lnI + 1
.head 7 -  Call SalFileClose( hFile )
.head 7 -  Call PalEditFile( gsPathApplic ||"\\CDT_EU.TXT" )
.head 7 -  Call VisFileDelete( gsPathApplic ||"\\CDT_EU.TXT" )
.head 2 -  Window Parameters
.head 2 +  Window Variables
.head 3 -  String: wsPathLoc3
.head 3 -  Boolean: wbOkVide
.head 3 -  Number: wnRowSection
.head 3 -  Number: wnRowSection1
.head 3 -  Number: wnValidGrp
.head 3 -  String: wsTmp
.head 3 -  String: wsSection1
.head 3 -  String: wsSection2
.head 3 -  Window Handle: hWndSource
.head 3 -  Number: wnTabActif
.head 3 -  Number: wnI
.head 3 -  String: wsDiffuseElus
.head 3 -  String: sFileZIP
.head 3 -  String: lsPkZip
.head 3 -  Number: nRet
.head 3 -  String: wsElection
.head 3 -  File Handle: hFilePic
.head 3 -  FunctionalVar: ExcExp
.head 4 -  Class: fcExcExp
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow( hWndForm )
.head 4 -  Call PalGetApplParmN( "VALID_GRP", wnValidGrp )
.head 3 +  On SAM_CreateComplete
.head 4 -  ! Call PalValidGroupe()
.head 4 -  Call SWTabsBringToTop( picTabs, 0, TRUE )
.head 4 -  Call SalSendMsg( cmbEl,SAM_Click, 0,0)
.head 1 +  Dialog Box: dlgImportLogo
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Accessories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Allow Dock to Parent? No
.head 3 -  Docking Orientation: All
.head 3 -  Window Location and Size
.head 4 -  Left: 4.625"
.head 4 -  Top: 2.417"
.head 4 -  Width:  6.617"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 2.44"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 3 -  Resizable? No
.head 3 -  Vertical Scroll? Yes
.head 3 -  Horizontal Scroll? Yes
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Docking Toolbar? No
.head 4 -  Toolbar Docking Orientation: Top | Bottom
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Resizable? No
.head 3 -  Contents
.head 2 +  Contents
.head 3 -  Background Text: Fichier:
.head 4 -  Resource Id: 14913
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.183"
.head 5 -  Top: 0.167"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Data Field: dfFileName
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.183"
.head 6 -  Top: 0.321"
.head 6 -  Width:  5.8"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Unformatted
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbLoad
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: ...
.head 4 -  Window Location and Size
.head 5 -  Left: 5.983"
.head 5 -  Top: 0.31"
.head 5 -  Width:  0.4"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Light Gray
.head 4 -  Background Color: Black
.head 4 -  Button Appearance: Flat Look
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If SalDlgOpenFile( hWndForm, 'BMP File', strFilters, 2, nIndex, strFileName, strPathFileName )
.head 7 -  Set dfFileName = strPathFileName
.head 7 -  Call SalPicSetFile( picLogo, dfFileName )
.head 5 +  On SAM_Create
.head 6 -  Set strFilters[0] = 'BMP Files'
.head 6 -  Set strFilters[1] = '*.BMP'
.head 6 -  Set nIndex = 1
.head 3 -  Background Text: Prévisualisation:
.head 4 -  Resource Id: 14914
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Window Location and Size
.head 5 -  Left: 0.183"
.head 5 -  Top: 0.833"
.head 5 -  Width:  1.6"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.167"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Justify: Left
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Bold-Underline
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 3 +  Picture: picLogo
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Window Location and Size
.head 5 -  Left: 2.083"
.head 5 -  Top: 0.643"
.head 5 -  Width:  1.8"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.583"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Editable? No
.head 4 -  File Name:
.head 4 -  Storage: External
.head 4 -  Picture Transparent Color: None
.head 4 -  Fit: Scale
.head 4 -  Scaling
.head 5 -  Width:  100
.head 5 -  Height:  100
.head 4 -  Corners: Square
.head 4 -  Border Style: No Border
.head 4 -  Border Thickness: 1
.head 4 -  Tile To Parent? No
.head 4 -  Border Color: Default
.head 4 -  Background Color: 3D Face Color
.head 4 +  Message Actions
.head 5 -  On SAM_Create
.head 3 +  Pushbutton: pbAccept
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Ok
.head 4 -  Window Location and Size
.head 5 -  Left: 0.883"
.head 5 -  Top: 1.417"
.head 5 -  Width:  1.883"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If dfFileName != ''
.head 7 +  If PalSaveLogo( sNoListe , dfFileName, sPathLogo )
.head 8 -  Set bAddOk = TRUE
.head 8 -  Call SalSendMsg( hWndForm, SAM_Close, 0, 0 )
.head 3 +  Pushbutton: pbClose
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: FERMER
.head 4 -  Window Location and Size
.head 5 -  Left: 4.283"
.head 5 -  Top: 1.417"
.head 5 -  Width:  1.7"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set sPathLogo = ""
.head 6 -  Call SalSendMsg( hWndForm, SAM_Close, 0, 0 )
.head 2 +  Functions
.head 3 +  Function: PalVerifLogo
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: sLogo
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 5 -  Number: nTailleFile
.head 5 -  Number: nTaille
.head 5 -  Number: nCouleur
.head 5 -  Number: nLargeur
.head 5 -  Number: nHauteur
.head 5 -  Boolean: bOk
.head 5 -  String: sBuffer
.head 4 +  Actions
.head 5 -  Set nTailleFile = VisFileGetSize( sLogo)
.head 5 -  Call SalFileOpen( hFile, sLogo , OF_Read |  OF_Binary | OF_Text )
.head 5 -  Call SalFileRead( hFile, sBuffer, 100 )
.head 5 -  Call SalFileClose( hFile )
.head 5 -  Set nTaille = CStructGetByte( sBuffer, 2 )
.head 5 -  Set nCouleur = CStructGetByte( sBuffer, 28 )
.head 5 -  Set nLargeur = CStructGetByte( sBuffer, 18 )
.head 5 -  Set nHauteur = CStructGetByte( sBuffer, 22 )
.head 5 +  If nTailleFile <= 376
.head 6 +  If (nTailleFile = 376 and nTaille = 120) or (nTailleFile = 374 and nTaille = 118)
.head 7 +  If nCouleur = 1
.head 8 +  If nLargeur = 78 and nHauteur = 26
.head 9 -  Set bOk = TRUE
.head 8 +  Else
.head 9 -  Set bOk = FALSE
.head 7 +  Else
.head 8 -  Set bOk = FALSE
.head 6 +  Else
.head 7 -  Set bOk = FALSE
.head 5 +  Else
.head 6 -  Set bOk = FALSE
.head 5 -  !
.head 5 +  If not bOk
.head 6 -  Call SalMessageBox( gsMessage[37], gsMessage[3] , MB_Ok )
.head 5 -  !
.head 5 -  Return (bOk)
.head 3 +  Function: PalSaveLogo
.head 4 -  Description:
.head 4 +  Returns
.head 5 -  Boolean:
.head 4 +  Parameters
.head 5 -  String: psNoListe
.head 5 -  String: sPathLogoFile
.head 5 -  Receive String: sPathLogo
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  String: sFile
.head 5 -  String: lsChamp
.head 4 +  Actions
.head 5 +  If PalVerifLogo( sPathLogoFile )
.head 6 -  Set sFile = "LisNat_" || SalStrRightX( '00' || psNoListe, 2) ||".BMP"
.head 6 +  If VisFileCopy( sPathLogoFile, gsPathLogo || sFile )
.head 7 -  Set sPathLogo = sFile
.head 7 -  Return ( TRUE )
.head 6 +  Else
.head 7 -  Call SalMessageBox( "Erreur de copie du fichier dans le répertoire :
"|| gsPathLogo || sFile , "Erreur", MB_Ok )
.head 7 -  Return (FALSE)
.head 2 +  Window Parameters
.head 3 -  String: sNoListe
.head 3 -  Receive String: sPathLogo
.head 2 +  Window Variables
.head 3 -  Number: nIndex
.head 3 -  String: strFilters[*]
.head 3 -  String: strFileName
.head 3 -  String: strPathFileName
.head 3 -  String: sTrace
.head 3 -  Boolean: bAddOk
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow( hWndForm )
.head 4 -  Call SalSetWindowText( hWndItem, "Import du logo pour une liste")
.head 4 -  Set bAddOk = FALSE
.head 3 +  On SAM_Close
.head 4 -  !
.head 1 +  Dialog Box: dlgMsgErreur
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title:
.head 2 -  Accessories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Allow Dock to Parent? No
.head 3 -  Docking Orientation: All
.head 3 -  Window Location and Size
.head 4 -  Left: 3.363"
.head 4 -  Top: 1.521"
.head 4 -  Width:  8.717"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 5.44"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 3 -  Resizable? No
.head 3 -  Vertical Scroll? Yes
.head 3 -  Horizontal Scroll? Yes
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Docking Toolbar? No
.head 4 -  Toolbar Docking Orientation: Top | Bottom
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Resizable? No
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Data Field: dfEntite
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: Default
.head 5 -  Data Type: String
.head 5 -  Editable? No
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.133"
.head 6 -  Top: 0.095"
.head 6 -  Width:  8.3"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.25"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Center
.head 5 -  Format: Uppercase
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Multiline Field: mlErreur
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 30000
.head 5 -  String Type: Long String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Border? Yes
.head 5 -  Word Wrap? Yes
.head 5 -  Vertical Scroll? Yes
.head 5 -  Window Location and Size
.head 6 -  Left: 0.133"
.head 6 -  Top: 0.381"
.head 6 -  Width:  8.3"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 4.429"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Font Name: Default
.head 5 -  Font Size: Default
.head 5 -  Font Enhancement: Default
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbEdit
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Edition
.head 4 -  Window Location and Size
.head 5 -  Left: 0.183"
.head 5 -  Top: 4.917"
.head 5 -  Width:  1.2"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call PalEditMl(  )
.head 3 +  Pushbutton: pbClose
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Fermer
.head 4 -  Window Location and Size
.head 5 -  Left: 7.283"
.head 5 -  Top: 4.917"
.head 5 -  Width:  1.15"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Call SalSendMsg( hWndForm, SAM_Close, 0,0 )
.head 2 +  Functions
.head 3 +  Function: PalEditMl
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  File Handle: hFile
.head 5 -  Long String: sBuffer
.head 4 +  Actions
.head 5 +  If SalFileOpen( hFile, frmLOC2.wsPathTmp || "\\ERR.TXT", OF_Create | OF_ReadWrite | OF_Text )
.head 6 -  Set sBuffer = dfEntite ||"

"|| mlErreur
.head 6 -  Call SalFilePutStr( hFile, sBuffer )
.head 6 -  Call SalFileClose( hFile )
.head 6 -  Call PalEditFile( frmLOC2.wsPathTmp || "\\ERR.TXT" )
.head 6 -  Call VisFileDelete( frmLOC2.wsPathTmp || "\\ERR.TXT" )
.head 3 +  Function: PalChargeErreur
.head 4 -  Description:
.head 4 -  Returns
.head 4 -  Parameters
.head 4 -  Static Variables
.head 4 +  Local variables
.head 5 -  Number: nType
.head 5 -  Long String: llsErreur
.head 4 +  Actions
.head 5 -  Set wnType = 0
.head 5 -  Set mlErreur = ''
.head 5 -  Call SqlPrepareAndExecute( ghSqlMain, "Select err_type, err_info from Erreur_EnCours where err_ent_fk = :pnIdEntite into :nType, :llsErreur " )
.head 5 +  While SqlFetchNext( ghSqlMain, Btmp )
.head 6 +  If mlErreur !=''
.head 7 -  Set mlErreur = mlErreur ||'
'|| SalStrRepeatX( '-', 60 ) ||'
'
.head 6 +  If nType = 0
.head 7 -  Set mlErreur = mlErreur || "Warning :
" || llsErreur
.head 6 +  Else
.head 7 -  Set mlErreur = mlErreur || "ERREUR :
" || llsErreur
.head 6 +  If wnType = 0
.head 7 +  If nType = 1
.head 8 -  Set wnType = 1
.head 5 -  !
.head 5 +  If wnType = 0
.head 6 -  Call SalColorSet( mlErreur,COLOR_IndexWindow, COLOR_Maize )
.head 5 +  Else
.head 6 -  Call SalColorSet( mlErreur, COLOR_IndexWindow, COLOR_Salmon )
.head 2 +  Window Parameters
.head 3 -  String: psEntite
.head 3 -  String: pnIdEntite
.head 2 +  Window Variables
.head 3 -  Number: wnType
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow( hWndForm )
.head 4 -  Set dfEntite = psEntite
.head 4 -  Call PalChargeErreur()
.head 3 +  On SAM_CreateComplete
.head 4 -  Call SalSetFocus( pbClose )
.head 1 +  Dialog Box: dlgChoixCouleur
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Choix des couleurs
.head 2 -  Accessories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Allow Dock to Parent? No
.head 3 -  Docking Orientation: All
.head 3 -  Window Location and Size
.head 4 -  Left: 7.938"
.head 4 -  Top: 2.365"
.head 4 -  Width:  10.167"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 4.298"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 3 -  Resizable? No
.head 3 -  Vertical Scroll? Yes
.head 3 -  Horizontal Scroll? Yes
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Docking Toolbar? No
.head 4 -  Toolbar Docking Orientation: Top | Bottom
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Resizable? No
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Pushbutton: pbChooseColorFond
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Couleur RGB à encoder
.head 4 -  Window Location and Size
.head 5 -  Left: 0.483"
.head 5 -  Top: 3.75"
.head 5 -  Width:  2.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If SalDlgChooseColor( hWndForm, wnColor )
.head 7 -  Set pnColorBck = wnColor
.head 7 -  Set bOk = TRUE
.head 7 -  Call SalSendMsg( hWndForm, SAM_Close, 1,0 )
.head 3 +  Pushbutton: pbOk
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsBasePbOnForm
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Ok
.head 4 -  Window Location and Size
.head 5 -  Left: 4.683"
.head 5 -  Top: 3.75"
.head 5 -  Width:  1.1"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Button Appearance: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If SalTblAnyRows( tblColorRef, ROW_Selected, 0 )
.head 7 -  Set wnColor = tblColorRef.colColorBck
.head 7 -  Set bOk = TRUE
.head 7 -  Set pnColorBck = wnColor
.head 7 -  Call SalSendMsg( hWndForm , SAM_Close , 1,0)
.head 3 +  Pushbutton: pbCancel
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsBasePbOnForm
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Annuler
.head 4 -  Window Location and Size
.head 5 -  Left: 6.733"
.head 5 -  Top: 3.75"
.head 5 -  Width:  1.1"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: Class Default
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Class Default
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Button Appearance: Class Default
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set bOk = FALSE
.head 6 -  Call SalSendMsg( hWndForm , SAM_Close , 0,0)
.head 3 +  ! Pushbutton: pbDefault
.winattr
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Couleur per défaut
.head 4 -  Window Location and Size
.head 5 -  Left: 0.533"
.head 5 -  Top: 0.393"
.head 5 -  Width:  2.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.25"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: (none)
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.end
.head 4 +  Message Actions 
.head 5 +  On SAM_Click
.head 6 -  Call SalColorSet( dfAbrev, COLOR_IndexWindow , COLOR_Default)
.head 6 -  Set wnColor = SalColorGet( dfAbrev, COLOR_IndexWindow )
.head 3 +  Child Table: tblColorRef
.data CLASSPROPSSIZE
0000: 1F00
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000C00 4E616D6531094E61 6D653400000000
.enddata
.data INHERITPROPS
0000: 0100
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: CTable
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.35"
.head 6 -  Top: 0.143"
.head 6 -  Width:  9.533"
.head 6 -  Width Editable? Class Default
.head 6 -  Height: 3.452"
.head 6 -  Height Editable? Class Default
.head 5 -  Visible? Yes
.head 5 -  Font Name: Class Default
.head 5 -  Font Size: Class Default
.head 5 -  Font Enhancement: Class Default
.head 5 -  Text Color: Class Default
.head 5 -  Background Color: Class Default
.head 5 -  View: Class Default
.head 5 -  Allow Row Sizing? Class Default
.head 5 -  Lines Per Row: Class Default
.head 4 -  Memory Settings
.head 5 -  Maximum Rows in Memory: Class Default
.head 5 -  Discardable? Class Default
.head 4 +  Contents
.head 5 +  Column: colNom
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Nom
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  3.55"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colPhon
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title:
.head 6 -  Visible? No
.head 6 -  Editable? Yes
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: String
.head 6 -  Justify: Left
.head 6 -  Width:  Default
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCouleur
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: CColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: RGB
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Class Default
.head 6 -  Justify: Center
.head 6 -  Width:  1.417"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCouleurR
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: CColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: R
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.7"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCouleurG
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: CColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: G
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.7"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colCouleurB
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class: CColumn
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: B
.head 6 -  Visible? Class Default
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Class Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  0.7"
.head 6 -  Width Editable? Class Default
.head 6 -  Format: Class Default
.head 6 -  Country: Class Default
.head 6 -  Input Mask: Class Default
.head 6 -  Cell Options
.head 7 -  Cell Type? Class Default
.head 7 -  Multiline Cell? Class Default
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Class Default
.head 8 -  Vertical Scroll? Class Default
.head 8 -  Auto Drop Down? Class Default
.head 8 -  Allow Text Editing? Class Default
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Class Default
.head 6 -  List Values
.head 6 -  Message Actions
.head 5 +  Column: colColorBck
.head 6 -  Class Child Ref Key: 0
.head 6 -  Class ChildKey: 0
.head 6 -  Class:
.head 6 -  Property Template:
.head 6 -  Class DLL Name:
.head 6 -  Title: Color DEC
.head 6 -  Visible? Yes
.head 6 -  Editable? No
.head 6 -  Maximum Data Length: Default
.head 6 -  Data Type: Number
.head 6 -  Justify: Center
.head 6 -  Width:  1.55"
.head 6 -  Width Editable? Yes
.head 6 -  Format: Unformatted
.head 6 -  Country: Default
.head 6 -  Input Mask: Unformatted
.head 6 -  Cell Options
.head 7 -  Cell Type? Standard
.head 7 -  Multiline Cell? No
.head 7 -  Cell DropDownList
.head 8 -  Sorted? Yes
.head 8 -  Vertical Scroll? Yes
.head 8 -  Auto Drop Down? No
.head 8 -  Allow Text Editing? Yes
.head 7 -  Cell CheckBox
.head 8 -  Check Value:
.head 8 -  Uncheck Value:
.head 8 -  Ignore Case? Yes
.head 6 -  List Values
.head 6 -  Message Actions
.head 4 +  Functions
.head 5 +  Function: PalPopulateColor
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  String: lsElection
.head 6 +  Actions
.head 7 -  Call SalTblPopulate( tblColorRef, ghSqlMain, "select GRL_Nom, GRL_Phon, Grl_Couleur
	from groupe_color
	order by 2
	Into :tblColorRef.colNom, :tblColorRef.colPhon , :tblColorRef.colColorBck ", TBL_FillAll )
.head 5 +  Function: tfOnCreate
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Boolean: b
.head 7 -  String: s
.head 7 -  Number: nImg
.head 7 -  Window Handle: hWndaCols[*]
.head 6 +  Actions
.head 7 -  ! Subclass
.head 7 -  Call MTblSubClass( hWndForm )
.head 7 -  ! Mousewheel scrolling
.head 7 -  Call MTblEnableMWheelScroll( hWndForm, TRUE )
.head 7 -  Call MTblSetMWheelOption( hWndForm, MTMW_PAGE_KEY, VK_Control )
.head 7 -  ! Selection
.head 7 -  Call MTblSetSelectionColors( hWndForm, COLOR_White, COLOR_DarkRed )
.head 7 -  Call MTblSetFlags( hWndForm, MTBL_FLAG_FULL_OVERLAP_SELECTION | MTBL_FLAG_SOLID_ROWHDR, TRUE )
.head 7 -  !
.head 5 +  Function: wfDoExcel
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  Number: lnRet
.head 7 -  String: lsText
.head 6 +  Actions
.head 7 -  Call VisWaitCursor( TRUE )
.head 7 -  Call wfSaveSettings(  )
.head 7 -  Set lnRet = MTblExportToExcel( dlgChoixCouleur.tblColorRef, 1, "", dlgChoixCouleur.ExcExp.ExcFlags, dlgChoixCouleur.ExcExp.ExpFlags, dlgChoixCouleur.ExcExp.RowFlagsOn,
	dlgChoixCouleur.ExcExp.RowFlagsOff, dlgChoixCouleur.ExcExp.ColFlagsOn,dlgChoixCouleur.ExcExp.ColFlagsOff )
.head 7 -  Call VisWaitCursor( FALSE )
.head 7 +  If lnRet < 1
.head 8 +  Select Case lnRet
.head 9 +  Case MTE_ERR_CANCELLED
.head 10 -  Set lsText = "Export cancelled."
.head 10 -  Break
.head 9 +  Case MTE_ERR_RUNNING_INSTANCE
.head 10 -  Set lsText = "Error getting running instance"
.head 10 -  Break
.head 9 +  Case MTE_ERR_NEW_INSTANCE
.head 10 -  Set lsText = "Error creating new instance"
.head 10 -  Break
.head 9 +  Case MTE_ERR_OLE_EXCEPTION
.head 10 -  Set lsText = "An OLE exception has occured"
.head 10 -  Break
.head 9 +  Case MTE_ERR_EXCEPTION
.head 10 -  Set lsText = "An exception has occured"
.head 10 -  Break
.head 9 +  Case MTE_ERR_NOT_SUBCLASSED
.head 10 -  Set lsText = "Table isn't subclassed"
.head 10 -  Break
.head 9 +  Default
.head 10 -  Set lsText = "Export failed."
.head 10 -  Break
.head 8 -  Call SalMessageBox( lsText, "Export error", MB_IconHand | MB_Ok )
.head 5 +  Function: wfSaveSettings
.head 6 -  Description:
.head 6 -  Returns
.head 6 -  Parameters
.head 6 -  Static Variables
.head 6 +  Local variables
.head 7 -  FunctionalVar: ExcExp
.head 8 -  Class: fcExcExp
.head 6 +  Actions
.head 7 -  ! Language
.head 7 -  Set ExcExp.Language = 1
.head 7 -  ! Excel start cell
.head 7 -  Set ExcExp.ExcStartCell = "0"
.head 7 -  ! Excel flags
.head 7 -  Set ExcExp.ExcFlags = ExcExp.ExcFlags | MTE_EXCEL_NEW_WORKSHEET
.head 7 -  ! Set ExcExp.ExcFlags = ExcExp.ExcFlags | MTE_EXCEL_STRING_COLS_AS_TEXT
.head 7 -  ! Export flags
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_COL_HEADERS
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_COLORS
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_FONTS
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_GRID
.head 7 -  Set ExcExp.ExpFlags = ExcExp.ExpFlags | MTE_SHOW_STATUS
.head 7 -  ! Rows to export
.head 7 -  Set ExcExp.RowFlagsOff = ROW_Hidden
.head 7 -  ! Columns to export
.head 7 -  Set ExcExp.ColFlagsOn = COL_Visible
.head 7 -  ! Assign
.head 7 -  Call dlgChoixCouleur.ExcExp.Assign( ExcExp )
.head 4 +  Window Variables
.head 5 -  Number: nColorBck
.head 5 -  Boolean: wbOk
.head 5 -  Number: nRed
.head 5 -  Number: nGreen
.head 5 -  Number: nBlue
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call tfOnCreate()
.head 6 -  Call SalTblSetTableFlags( hWndForm, TBL_Flag_SingleSelection, TRUE )
.head 6 -  Call tblColorRef.PalPopulateColor()
.head 5 +  On SAM_FetchRowDone
.head 6 +  If tblColorRef.colColorBck != NUMBER_Null and tblColorRef.colColorBck != 13421772
.head 7 -  Call MTblSetCellBackColor( tblColorRef.colCouleur, SalTblQueryContext( tblColorRef ), tblColorRef.colColorBck, MTSC_REDRAW )
.head 7 -  Call SalColorToRGB (  tblColorRef.colColorBck, nRed, nGreen, nBlue )
.head 7 -  Set tblColorRef.colCouleur = PalDecToHexa( nRed ) || PalDecToHexa( nGreen ) || PalDecToHexa( nBlue )
.head 7 -  Set tblColorRef.colCouleurR = nRed
.head 7 -  Set tblColorRef.colCouleurG = nGreen
.head 7 -  Set tblColorRef.colCouleurB = nBlue
.head 6 +  Else
.head 7 -  Call MTblSetCellBackColor( tblColorRef.colCouleur, SalTblQueryContext( tblColorRef ), 13421772, MTSC_REDRAW )
.head 7 -  Set tblColorRef.colCouleur = 'Other'
.head 3 +  Pushbutton: pbExcel_Color
.data INHERITPROPS
0000: 0100
.enddata
.data CLASSPROPSSIZE
0000: 1700
.enddata
.data CLASSPROPS
0000: 5461624368696C64 4E616D6573000600 4E616D65350000
.enddata
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class: clsBasePbOnForm
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: 9.233"
.head 5 -  Top: 3.702"
.head 5 -  Width:  0.633"
.head 5 -  Width Editable? Class Default
.head 5 -  Height: 0.393"
.head 5 -  Height Editable? Class Default
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Class Default
.head 4 -  Font Name: Class Default
.head 4 -  Font Size: Class Default
.head 4 -  Font Enhancement: Class Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: Class Default
.head 4 -  Image Style: Class Default
.head 4 -  Text Color: Class Default
.head 4 -  Background Color: Class Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Create
.head 6 -  Call SalPicSet( hWndItem, resExcel, PIC_FormatBitmap )
.head 5 +  On SAM_Click
.head 6 +  If SalTblAnyRows( tblColorRef, 0,0 )
.head 7 -  Call tblColorRef.wfDoExcel(  )
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: psCode
.head 3 -  Receive Number: pnColorBck
.head 3 -  Receive Boolean: bOk
.head 2 +  Window Variables
.head 3 -  Number: wnColorTxt
.head 3 -  Number: wnColor
.head 3 -  FunctionalVar: ExcExp
.head 4 -  Class: fcExcExp
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Set bOk = FALSE
.head 4 -  Call SalCenterWindow( hWndForm )
.head 3 +  On SAM_Close
.head 4 +  If wParam = 1
.head 5 -  Set bOk = TRUE
.head 4 +  Else
.head 5 -  Set bOk = FALSE
.head 1 -  !
.head 1 +  Dialog Box: dlgPW
.head 2 -  Class:
.head 2 -  Property Template:
.head 2 -  Class DLL Name:
.head 2 -  Title: Mot de passe
.head 2 -  Accessories Enabled? No
.head 2 -  Visible? Yes
.head 2 -  Display Settings
.head 3 -  Display Style? Default
.head 3 -  Visible at Design time? Yes
.head 3 -  Type of Dialog: Modal
.head 3 -  Allow Dock to Parent? No
.head 3 -  Docking Orientation: All
.head 3 -  Window Location and Size
.head 4 -  Left: 5.863"
.head 4 -  Top: 2.719"
.head 4 -  Width:  2.95"
.head 4 -  Width Editable? Yes
.head 4 -  Height: 0.964"
.head 4 -  Height Editable? Yes
.head 3 -  Absolute Screen Location? Yes
.head 3 -  Font Name: Default
.head 3 -  Font Size: Default
.head 3 -  Font Enhancement: Default
.head 3 -  Text Color: Default
.head 3 -  Background Color: Default
.head 3 -  Resizable? No
.head 3 -  Vertical Scroll? Yes
.head 3 -  Horizontal Scroll? Yes
.head 2 -  Description:
.head 2 +  Tool Bar
.head 3 -  Display Settings
.head 4 -  Display Style? Default
.head 4 -  Location? Top
.head 4 -  Visible? Yes
.head 4 -  Size: Default
.head 4 -  Size Editable? Yes
.head 4 -  Docking Toolbar? No
.head 4 -  Toolbar Docking Orientation: Top | Bottom
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Resizable? No
.head 3 -  Contents
.head 2 +  Contents
.head 3 +  Data Field: dfPW
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Data
.head 5 -  Maximum Data Length: 20
.head 5 -  Data Type: String
.head 5 -  Editable? Yes
.head 4 -  Display Settings
.head 5 -  Window Location and Size
.head 6 -  Left: 0.183"
.head 6 -  Top: 0.071"
.head 6 -  Width:  2.4"
.head 6 -  Width Editable? Yes
.head 6 -  Height: 0.31"
.head 6 -  Height Editable? Yes
.head 5 -  Visible? Yes
.head 5 -  Border? Yes
.head 5 -  Justify: Left
.head 5 -  Format: Invisible
.head 5 -  Country: Default
.head 5 -  Font Name: Default
.head 5 -  Font Size: 12
.head 5 -  Font Enhancement: Bold
.head 5 -  Text Color: Default
.head 5 -  Background Color: Default
.head 5 -  Input Mask: Unformatted
.head 4 -  Message Actions
.head 3 +  Pushbutton: pbOk
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title: Ok
.head 4 -  Window Location and Size
.head 5 -  Left: 0.783"
.head 5 -  Top: 0.512"
.head 5 -  Width:  1.3"
.head 5 -  Width Editable? Yes
.head 5 -  Height: 0.298"
.head 5 -  Height Editable? Yes
.head 4 -  Visible? Yes
.head 4 -  Keyboard Accelerator: Enter
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 -  Set wbOk = TRUE
.head 6 -  Call SalSendMsg( hWndForm, SAM_Close, 0,0)
.head 5 +  On WM_RBUTTONDOWN
.head 6 -  Call SalSendMsg( pbF10, SAM_Click, 0,0 )
.head 3 +  Pushbutton: pbF10
.head 4 -  Class Child Ref Key: 0
.head 4 -  Class ChildKey: 0
.head 4 -  Class:
.head 4 -  Property Template:
.head 4 -  Class DLL Name:
.head 4 -  Title:
.head 4 -  Window Location and Size
.head 5 -  Left: Default
.head 5 -  Top: Default
.head 5 -  Width:  Default
.head 5 -  Width Editable? Yes
.head 5 -  Height: Default
.head 5 -  Height Editable? Yes
.head 4 -  Visible? No
.head 4 -  Keyboard Accelerator: F10
.head 4 -  Font Name: Default
.head 4 -  Font Size: Default
.head 4 -  Font Enhancement: Default
.head 4 -  Picture File Name:
.head 4 -  Picture Transparent Color: None
.head 4 -  Image Style: Single
.head 4 -  Text Color: Default
.head 4 -  Background Color: Default
.head 4 -  Button Appearance: Standard
.head 4 +  Message Actions
.head 5 +  On SAM_Click
.head 6 +  If psType = 'MASTER'
.head 7 -  Set dfPW = 'CODI_MASTER'
.head 6 +  If psType = 'VIDER'
.head 7 -  Set dfPW = 'CODI_RESET'
.head 6 +  If psType = 'VALID'
.head 7 -  Set dfPW = 'CODI_VALID'
.head 2 -  Functions
.head 2 +  Window Parameters
.head 3 -  String: psType
.head 3 -  Receive Boolean: wbOk
.head 2 +  Window Variables
.head 3 -  Number: wnPassage
.head 2 +  Message Actions
.head 3 +  On SAM_Create
.head 4 -  Call SalCenterWindow( hWndForm )
.head 4 -  Set wbOk = FALSE
.head 4 -  Call SalSetWindowText( hWndItem, "Mot de passe")
.head 3 +  On SAM_Close
.head 4 +  If wbOk
.head 5 -  Set wbOk = FALSE
.head 5 +  If psType = 'MASTER' and SalStrUpperX(dfPW) = 'CODI_MASTER'
.head 6 -  Set wbOk = TRUE
.head 5 +  If psType = 'VIDER' and SalStrUpperX(dfPW) = 'CODI_RESET'
.head 6 -  Set wbOk = TRUE
.head 5 +  If psType = 'VALID' and SalStrUpperX(dfPW) = 'CODI_VALID'
.head 6 -  Set wbOk = TRUE
