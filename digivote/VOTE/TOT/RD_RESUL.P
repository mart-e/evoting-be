/* Filename            : RD_RESUL.P                                     */
/*
<pvcs>
<workFile>$Workfile:   RD_RESUL.P  $</workFile>
<revision>$Revision: 1.9 $</revision>
<workFileTimeStamp>$Modtime:   Mar 18 2003 10:38:50  $</workFileTimeStamp>

<archive>$Archive:   C:/PVCS VM/v6.8.00/DIGIVOTE/Archives/VOTE/TOT/RD_RESUL.P-arc  $</archive>
<archiveTimeStamp>$Date: 2005/08/09 06:57:35 $</archiveTimeStamp>
<pvcsUser>$Author: jru $</pvcsUser>
</pvcs>
*/

{chklevel.i 1}

/************************************************************************/
/*                                                                      */
/*        SHARED VARIABLES  VIA INCLUDE FILES                           */
/*                                                                      */
/************************************************************************/
{mencolor.i}          /* De variabelen voor het kleuren van de schermen */
{vargener.i}          /* Variabelen voor het PRP hoofdmenu PMGENEME     */
{selvar.i}            /* De variabelen voor de selection record         */
{disfram.i}

/************************************************************************/
/*                                                                      */
/*        LOCAL VARIABLES                                               */
/*                                                                      */
/************************************************************************/
DEF VAR menusel              AS I FORMAT "9" INIT 1               NO-UNDO.
DEF VAR menuexe              AS I FORMAT "9" INIT 0               NO-UNDO.

DEF VAR men_set              AS C FORMAT "X(15)" EXTENT 2         NO-UNDO.
DEF VAR proglst              AS C EXTENT 2                        NO-UNDO.

DEF VAR active_choices       AS C FORMAT "x(10)"                  NO-UNDO.

DEF VAR avail_men_set        AS C FORMAT "X(15)" EXTENT 4         NO-UNDO.
DEF VAR avail_proglst        AS C EXTENT 4 INIT
      ["totimp.r","recount.r","totexp.r","expzet.r"]              NO-UNDO.

DEF VAR i                    AS I                                 NO-UNDO.
DEF VAR child-sys-type       LIKE setup.sys-type                  NO-UNDO.

/************************************************************************/
/*                                                                      */
/*        LOCAL FORM DESCRIPTIONS                                       */
/*                                                                      */
/************************************************************************/
FORM
    men_set AT 2 SPACE(1) SKIP
    WITH FRAME trdresul
        COLOR DISPLAY VALUE(menu_fg)
        NO-LABELS 
        ATTR-SPACE 
        ROW 4 
        COLUMN 2 
        OVERLAY.

/************************************************************************/
/*                                                                      */
/*        START PROCEDURE                                               */
/*                                                                      */
/************************************************************************/
{call.i &prg="mesfil" &param=",'trdresul,mes01',15,OUTPUT avail_men_set[1]"}
{call.i &prg="mesfil" &param=",'trdresul,mes03',15,OUTPUT avail_men_set[2]"}
{call.i &prg="mesfil" &param=",'trdresul,mes04',15,OUTPUT avail_men_set[3]"}
{call.i &prg="mesfil" &param=",'trdresul,mes05',15,OUTPUT avail_men_set[4]"}

FIND FIRST setup                  NO-LOCK NO-ERROR.
FIND FIRST urnedest               NO-LOCK NO-ERROR.
FIND FIRST organigram OF urnedest NO-LOCK NO-ERROR.
child-sys-type = organigram.sys-type.

REPEAT WITH FRAME trdresul :
    FIND FIRST session WHERE session.s-id = verkdat NO-LOCK NO-ERROR.
    
    active_choices = (IF      session.disk_read <> session.disk_made THEN "1" 
                      ELSE IF setup.orginator    > 0                 THEN "3"
                      ELSE                                                "4").
                      
    IF child-sys-type = "U" THEN active_choices = active_choices + ",2".
    
    IF NUM-ENTRIES(active_choices) = 1
    THEN DO:
        /*@call=totimp.p,totexp.p,expzet.p*/
        {call_var.i &prg="avail_proglst[INT(active_choices)]"}
        HIDE FRAME disframe NO-PAUSE.
        {return.i}
    END.

    REPEAT i = 1 TO NUM-ENTRIES(active_choices):
        ASSIGN
        men_set[i] = avail_men_set[INT(ENTRY(i,active_choices))]
        proglst[i] = avail_proglst[INT(ENTRY(i,active_choices))].
    END.    

    STATUS INPUT OFF.
    DISPLAY men_set.
    COLOR DISPLAY VALUE(menu_fg) men_set[1 FOR 2].
    COLOR DISPLAY VALUE(menu_bg) men_set[menusel].
    NEXT-PROMPT men_set[menusel].

    {call.i &prg="discolme" 
            &param=",'trdresul,hulp' + ENTRY(INT(ENTRY(menusel,active_choices)),
                                             '1,3,4,5'),0"}

    CHOOSE FIELD men_set[1 FOR 2] COLOR VALUE(menu_bg) AUTO-RETURN
        GO-ON ("CURSOR-UP" "CURSOR-DOWN" "TAB" "BACK-TAB" "F1").
    ASSIGN
    menuexe = 0
    menusel = FRAME-INDEX.

    IF      LASTKEY = KEYCODE("TAB") 
         OR LASTKEY = KEYCODE("CURSOR-DOWN")
    THEN IF   menusel = 2
         THEN menusel = 1.
         ELSE menusel = menusel + 1.
    ELSE IF LASTKEY = KEYCODE("BACK-TAB") 
         OR LASTKEY = KEYCODE("CURSOR-UP")
    THEN IF   menusel = 1
         THEN menusel = 2.
         ELSE menusel = menusel - 1.
    ELSE menuexe = 1.

    IF menuexe = 1
    THEN DO :
        IF SEARCH( proglst[menusel]) <> ? OR
           LIBRARY(proglst[menusel]) <> ?
        THEN DO :
            HIDE MESSAGE NO-PAUSE.
            HIDE FRAME trdresul NO-PAUSE.
            /*@call=totimp.p,recount.p,totexp.p,expzet.p*/
            {call_var.i &prg="proglst[menusel]"}
            HIDE FRAME disframe NO-PAUSE.
        END.
        ELSE DO :
            {call.i &prg="disfram" &param=",'general,notavail','',
                                            ',' + proglst[menusel],'',TRUE"}
            HIDE MESSAGE NO-PAUSE.
        END.
    END.
END.

HIDE FRAME trdresul NO-PAUSE.

{return.i}
/* eof */