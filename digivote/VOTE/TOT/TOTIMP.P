/* Filename        : TOTIMP.P                   */
/*
<pvcs>
<workFile>$Workfile:   TOTIMP.P  $</workFile>
<revision>$Revision: 1.8 $</revision>
<workFileTimeStamp>$Modtime:   Apr 17 2002 15:26:36  $</workFileTimeStamp>

<archive>$Archive:   P:/Digivote/Archives/VOTE/TOT/TOTIMP.P-arc  $</archive>
<archiveTimeStamp>$Date: 2005/11/30 17:18:02 $</archiveTimeStamp>
<pvcsUser>$Author: jru $</pvcsUser>
</pvcs>
*/

{chklevel.i 1}

/************************************************************************/
/*                                                                      */
/*    SHARED VARIABLES  VIA INCLUDE FILES                               */
/*                                                                      */
/************************************************************************/
{mencolor.i}          /* De variabelen voor het kleuren van de schermen */
{vargener.i}          /* Variabelen voor het PRP hoofdmenu PMGENEME     */
{selvar.i}            /* De variabelen voor de selection record         */

/************************************************************************/
/*                                                                      */
/*    LOCAL VARIABLES                                                   */
/*                                                                      */
/************************************************************************/
DEF VAR men_tit              AS C FORMAT "x(30)"                  NO-UNDO.
DEF VAR men_mes1             AS C FORMAT "x(7)"                   NO-UNDO.
DEF VAR men_mes2             AS C FORMAT "x(30)".

DEF VAR results_accepted     AS L INIT FALSE                      NO-UNDO.
DEF VAR wz-tmp-shell         AS C FORMAT "x(50)"                  NO-UNDO.
DEF VAR wz-resume            AS C FORMAT "x(50)"                  NO-UNDO.

/************************************************************************/
/*                                                                      */
/*        START PROCEDURE                                               */
/*                                                                      */
/************************************************************************/
ASSIGN
results_accepted = FALSE
wz-tmp-shell     = ramdrive + "VOTE\$_TMPSH_.BAT"
wz-resume        = ramdrive + "VOTE\TRACE.LOG\RESUME".

{call.i &prg="delrdisk"}     
{call.i &prg="toturne" &param=",OUTPUT results_accepted"}
{call.i &prg="delrdisk"}     

IF results_accepted
THEN DO:
    /* Create AutoRun */
    {call.i &prg="resume" &param=",wz-resume"}
   
    call DIGEST VALUE(wz-resume).
    FIND FIRST session.
    ASSIGN
    session.digest = hex-digest
    session.MAC    = "REFRESH".
    {call.i &prg="sec_sess"}

    OUTPUT TO VALUE(wz-tmp-shell) APPEND.
    PUT UNFORMATTED
        "@Echo OFF"                                          SKIP
        "_ProUtil ELECT -C truncate bi > NUL"                SKIP
        "ProLog ELECT > NUL"                                 SKIP
        "Cd \VOTE"                                           SKIP
        "Attrib -R C:\VOTE\ELECT.* > NUL"                    SKIP
        "XCopy /Y /V ELECT.* C:\VOTE > NUL"                  SKIP
        "Pro ELECT -p DIGIVOTE"                              SKIP.
    OUTPUT CLOSE.
    
    /* Temporary quit PROGRESS and cleanup RAMdrive ... */
    {quit.i &corrupt=FALSE}
END.

{return.i}
/* eof */